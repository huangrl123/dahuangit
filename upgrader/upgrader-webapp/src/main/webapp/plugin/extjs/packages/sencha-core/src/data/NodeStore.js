Ext.define("Ext.data.NodeStore",{extend:"Ext.data.Store",alias:"store.node",requires:["Ext.data.NodeInterface"],isNodeStore:true,config:{node:null,recursive:false,rootVisible:false,folderSort:false},isExpandingOrCollapsing:0,getTotalCount:function(){return this.getCount()},afterEdit:function(B,A){if(this.getNode()&&A){if(A.indexOf("loaded")!==-1){return this.add(this.retrieveChildNodes(B))}if(A.indexOf("expanded")!==-1){return this.filter()}if(A.indexOf("sorted")!==-1){return this.sort()}}this.callParent(arguments)},onNodeAppend:function(B,A){this.add([A].concat(this.retrieveChildNodes(A)))},onNodeInsert:function(B,A){this.add([A].concat(this.retrieveChildNodes(A)))},onNodeRemove:function(B,A){this.remove([A].concat(this.retrieveChildNodes(A)))},onNodeExpand:function(B,A){this.loadRecords(A)},applyNode:function(A){if(A){Ext.data.NodeInterface.decorate(A)}return A},updateNode:function(B,A){var C=this,D;if(A&&!A.isDestroyed){A.un({append:"onNodeAppend",insert:"onNodeInsert",remove:"onNodeRemove",load:"onNodeLoad",scope:C});A.unjoin(C)}if(B){B.on({scope:C,append:"onNodeAppend",insert:"onNodeInsert",remove:"onNodeRemove",load:"onNodeLoad"});B.join(C);D=[];if(B.childNodes.length){D=D.concat(C.retrieveChildNodes(B))}if(C.getRootVisible()){D.push(B)}else{if(B.isLoaded()||B.isLoading()){B.set("expanded",true)}}C.getData().clear();C.fireEvent("clear",C);C.suspendEvents();C.add(D);C.resumeEvents();if(D.length===0){C.loaded=B.loaded=true}C.fireEvent("refresh",C,C.data)}},retrieveChildNodes:function(B){var C=this.getNode(),D=this.getRecursive(),E=[],A=B;if(!B.childNodes.length||(!D&&B!==C)){return E}if(!D){return B.childNodes}while(A){if(A._added){delete A._added;if(A===B){break}else{A=A.nextSibling||A.parentNode}}else{if(A!==B){E.push(A)}if(A.firstChild){A._added=true;A=A.firstChild}else{A=A.nextSibling||A.parentNode}}}return E},isVisible:function(A){var B=A.parentNode;if(!this.getRecursive()&&B!==this.getNode()){return false}while(B){if(!B.isExpanded()){return false}if(B===this.getNode()){break}B=B.parentNode}return true}});
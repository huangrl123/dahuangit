Ext.define("Ext.data.proxy.JsonP",{extend:"Ext.data.proxy.Server",alternateClassName:"Ext.data.ScriptTagProxy",alias:["proxy.jsonp","proxy.scripttag"],requires:["Ext.data.JsonP"],config:{callbackKey:"callback",recordParam:"records",autoAppendParams:true},doRequest:function(C){var B=this,A=B.buildRequest(C),D=A.getParams();A.setConfig({callbackKey:B.callbackKey,timeout:B.timeout,scope:B,disableCaching:false,callback:B.createRequestCallback(A,C)});if(B.getAutoAppendParams()){A.setParams({})}A.setRawRequest(Ext.data.JsonP.request(A.getCurrentConfig()));A.setParams(D);B.lastRequest=A;return A},createRequestCallback:function(A,C){var B=this;return function(D,F,E){if(A===B.lastRequest){B.lastRequest=null}B.processResponse(D,C,A,F)}},setException:function(A,B){A.setException(A.getRequest().getRawRequest().errorType)},buildUrl:function(C){var H=this,I=H.callParent(arguments),D=C.getRecords(),A=H.getWriter(),G,J,B,F,E;if(A&&C.getOperation().allowWrite()){C=A.write(C)}G=C.getParams();J=G.filters;delete G.filters;if(J&&J.length){for(F=0;F<J.length;F++){B=J[F];E=B.getValue();if(E){G[B.getProperty()]=E}}}if(Ext.isArray(D)&&D.length>0&&(!A||!A.getEncode())){G[H.getRecordParam()]=H.encodeRecords(D)}if(H.getAutoAppendParams()){I=Ext.urlAppend(I,Ext.Object.toQueryString(G))}return I},abort:function(A){A=A||this.lastRequest;if(A){Ext.data.JsonP.abort(A.getRawRequest())}},encodeRecords:function(B){var C=[],A=0,D=B.length;for(;A<D;A++){C.push(Ext.encode(B[A].getData()))}return C}});
var page=require("webpage").create();var format="#{format}";var data="#{data}";var scale=parseInt("#{scale}",10);var width=parseInt("#{width}",10);var height=parseInt("#{height}",10);try{var pdfOptions=JSON.parse("#{pdf}"||null)}catch(e){console.error("Parsing PDF options failed.")}try{var jpegOptions=JSON.parse("#{jpeg}"||null)}catch(e){console.error("Parsing JPEG options failed.")}if(format==="pdf"){page.paperSize=pdfOptions||{format:"Letter",orientation:"portrait",border:"1cm"}}page.content='<img id="chart" src="'+data+'" style="-webkit-transform-origin: left top">';window.setTimeout(adjustSize,1);function adjustSize(){var A=page.evaluate(function(){var B=document.createElement("style"),C=document.createTextNode("body { margin: 0 }");B.setAttribute("type","text/css");B.appendChild(C);document.head.insertBefore(B,document.head.firstChild);var D=document.getElementById("chart");return{width:D.naturalWidth,height:D.naturalHeight}});if(width&&height){if(width!==A.width||height!==A.height){page.viewportSize={width:width,height:height};page.clipRect={left:0,top:0,width:width,height:height}}}page.evaluate(function(C,B){var D=document.getElementById("chart");D.style.width=C;D.style.height=B},(width||A.width)*scale,(height||A.height)*scale);window.setTimeout(render,1)}function render(){page.render("#{filename}",{format:format,quality:jpegOptions&&jpegOptions.quality||80});phantom.exit()};
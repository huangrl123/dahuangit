Ext.define("Ext.chart.AbstractChart",{extend:"Ext.draw.Container",requires:["Ext.chart.theme.Base","Ext.chart.theme.Theme","Ext.chart.series.Series","Ext.chart.interactions.Abstract","Ext.chart.axis.Axis","Ext.data.StoreManager","Ext.chart.Legend","Ext.data.Store","Ext.chart.overrides.AbstractChart"],mixins:{themeManager:"Ext.chart.theme.Theme"},defaultBindProperty:"store",version:"2.5.0",themeAttrs:null,delegationRegex:/^item([a-z]+)$/i,domEvents:new RegExp("click|focus|blur|paste|input|mousemove|mousedown|mouseup|mouseover|mouseout|keyup|keydown|keypress|submit|pinch|pinchstart|pinchend|touchmove|touchstart|touchend|rotate|rotatestart|rotateend|drag|dragstart|dragend|tap|doubletap|singletap"),config:{store:"ext-empty-store",theme:"Base",style:null,shadow:false,animation:!Ext.isIE8,series:[],axes:[],legend:null,colors:null,insetPadding:{top:10,left:10,right:10,bottom:10},background:"white",interactions:[],mainRect:null,resizeHandler:null,highlightItem:null},resizing:0,animationSuspended:0,surfaceZIndexes:{background:0,main:1,grid:2,series:3,axis:4,chart:5,overlay:6,events:7},animating:0,layoutSuspended:0,applyAnimation:function(B,A){if(!B){B={duration:0}}else{if(B===true){B={easing:"easeInOut",duration:500}}}return A?Ext.apply({},B,A):B},applyInsetPadding:function(B,A){if(!Ext.isObject(B)){return Ext.util.Format.parseBox(B)}else{if(!A){return B}else{return Ext.apply(A,B)}}},suspendAnimation:function(){this.animationSuspended++;if(this.animationSuspended===1){var C=this.getSeries(),A=-1,B=C.length;while(++A<B){C[A].setAnimation(this.getAnimation())}}},resumeAnimation:function(){this.animationSuspended--;if(this.animationSuspended===0){var C=this.getSeries(),A=-1,B=C.length;while(++A<B){C[A].setAnimation(this.getAnimation())}}},suspendLayout:function(){this.layoutSuspended++;if(this.layoutSuspended===1){if(this.scheduledLayoutId){this.layoutInSuspension=true;this.cancelLayout()}else{this.layoutInSuspension=false}}},resumeLayout:function(){this.layoutSuspended--;if(this.layoutSuspended===0){if(this.layoutInSuspension){this.scheduleLayout()}}},cancelLayout:function(){if(this.scheduledLayoutId){Ext.draw.Animator.cancel(this.scheduledLayoutId);this.scheduledLayoutId=null}},scheduleLayout:function(){var A=this;if(A.rendered&&!A.scheduledLayoutId){A.scheduledLayoutId=Ext.draw.Animator.schedule("doScheduleLayout",A)}},doScheduleLayout:function(){if(this.layoutSuspended){this.layoutInSuspension=true}else{this.performLayout()}},getAnimation:function(){if(this.resizing||this.animationSuspended){return{duration:0}}else{return this.callParent()}},constructor:function(A){var B=this,C;B.itemListeners={};B.surfaceMap={};B.isInitializing=true;B.callParent(arguments);delete B.isInitializing;B.suspendLayout();B.getSurface("main");B.getSurface("chart").setFlipRtlText(B.getInherited().rtl);B.getSurface("overlay").waitFor(B.getSurface("series"));B.resumeLayout()},applySprites:function(A){var B=this.getSurface("chart");A=Ext.Array.from(A);B.removeAll(true);B.add(A)},initItems:function(){var C=this.items,A,D,B;if(C&&!C.isMixedCollection){this.items=[];C=Ext.Array.from(C);for(A=0,D=C.length;A<D;A++){B=C[A];if(B.type){Ext.Error.raise("To add custom sprites to the chart use the 'sprites' config.")}else{this.items.push(B)}}}this.callParent()},applyBackground:function(B,A){var C=this.getSurface("background");if(B){C.remove(A,true);if(B.type==="image"&&Ext.isString(B.src)){A=C.add(B)}else{A=C.add({type:"rect",fillStyle:B})}}return A},getLegendStore:function(){return this.legendStore},refreshLegendStore:function(){if(this.getLegendStore()){var A,E,D=this.getSeries(),C,B=[];if(D){for(A=0,E=D.length;A<E;A++){C=D[A];if(C.getShowInLegend()){C.provideLegendInfo(B)}}}this.getLegendStore().setData(B)}},resetLegendStore:function(){if(this.getLegendStore()){var D=this.getLegendStore().getData().items,A,C=D.length,B;for(A=0;A<C;A++){B=D[A];B.beginEdit();B.set("disabled",false);B.commit()}}},onUpdateLegendStore:function(A,C){var D=this.getSeries(),B;if(C&&D){B=D.map[C.get("series")];if(B){B.setHiddenByIndex(C.get("index"),C.get("disabled"));this.redraw()}}},resizeHandler:function(A){var B=this;B.scheduleLayout();return false},applyMainRect:function(B,A){if(!A){return B}this.getSeries();this.getAxes();if(B[0]===A[0]&&B[1]===A[1]&&B[2]===A[2]&&B[3]===A[3]){return A}else{return B}},getAxis:function(A){if(A instanceof Ext.chart.axis.Axis){return A}else{if(Ext.isNumber(A)){return this.getAxes()[A]}else{if(Ext.isString(A)){return Ext.ComponentMgr.get(A)}else{return null}}}},getSurface:function(D,A){D=D||"main";A=A||D;var B=this,E=this.callParent([D]),C=B.surfaceZIndexes;if(A in C){E.element.setStyle("zIndex",C[A])}if(!B.surfaceMap[A]){B.surfaceMap[A]=[]}if(Ext.Array.indexOf(B.surfaceMap[A],(E))<0){E.type=A;B.surfaceMap[A].push(E)}return E},applyAxes:function(E,G){this.resizing++;try{this.getStore();if(!G){G=[];G.map={}}var C=[],F,D,B,H,I=G.map;C.map={};E=Ext.Array.from(E,true);for(F=0,D=E.length;F<D;F++){B=Ext.Object.chain(E[F]);if(!B){continue}if(B.linkedTo){Ext.Array.each(E,function(J){if(J.id===B.linkedTo){B=Ext.merge({},J,B);if(B.id===J.id){delete B.id}return false}})}if(this.getInherited().rtl){B.position={left:"right",right:"left"}[B.position]||B.position}B=Ext.factory(B,null,H=I[B.getId&&B.getId()||B.id],"axis");if(B){B.setChart(this);C.push(B);C.map[B.getId()]=B;if(!H){B.on("animationstart","onAnimationStart",this);B.on("animationend","onAnimationEnd",this)}}}for(F in I){if(!C.map[F]){I[F].destroy()}}return C}catch(A){Ext.log.error(this.$className+": Unhandled Exception: ",A.description||A.message);throw A}finally{this.resizing--}},updateAxes:function(A){this.scheduleLayout()},circularCopyArray:function(F,C,B){var D=[],A,E=F&&F.length;if(E){for(A=0;A<B;A++){D.push(F[(C+A)%E])}}return D},circularCopyObject:function(D,E,C){var B=this,F,G,A={};if(C){for(F in D){if(D.hasOwnProperty(F)){G=D[F];if(Ext.isArray(G)){A[F]=B.circularCopyArray(G,E,C)}else{A[F]=G}}}}return A},getColors:function(){var B=this,A=B.config.colors;if(Ext.isArray(A)&&A.length>0){A=B.applyColors(A)}return A||(B.themeAttrs&&B.themeAttrs.colors)},applyColors:function(A){A=Ext.Array.map(A,function(B){if(Ext.isString(B)){return B}else{return B.toString()}});return A},updateColors:function(C){var H=this,G=C||(H.themeAttrs&&H.themeAttrs.colors),B=0,K=G.length,F,I=H.getSeries(),A=I&&I.length,E,D,J;if(K){for(F=0;F<A;F++){E=I[F];J=E.themeColorCount();D=H.circularCopyArray(G,B,J);B+=J;E.updateChartColors(D)}}H.refreshLegendStore()},updateTheme:function(L,J){var F=this,K=F.getSeries(),N=K.length,E,A,C,G,B,Q,R,O,P,S=F.config.style,I={},M=0,D=0,H;B=F.themeAttrs=F.initTheme(L||this.defaultTheme);if(Ext.isEmpty(B)||Ext.Object.isEmpty(B)){return}Q=F.config.background||B.background;F.setBackground(Q);if(typeof S=="string"){S=Ext.util.Format.trim(S).split(/\s*(?::|;)\s*/);for(E=0,A=S.length;E<A;){I[Ext.Element.normalize(S[E++])]=S[E++]}S=I}R=Ext.applyIf(Ext.Object.chain(S||{}),B.chartTitle);F.setStyle(R);O=F.getColors();F.updateColors(O);for(E=0;E<N;E++){C=K[E];G={};G.style=Ext.apply({},B.series);G.label=Ext.apply({},B.label);G.marker=Ext.apply({},B.marker);if(B.seriesThemes){P=C.themeColorCount();G.subStyle=F.circularCopyObject(B.seriesThemes,M,P);M+=P}else{G.subStyle={}}if(B.markerThemes){H=C.themeMarkerCount();G.markerSubStyle=F.circularCopyObject(B.markerThemes,D,H);D+=H}else{G.markerSubStyle={}}}F.refreshLegendStore()},applySeries:function(J,H){this.resizing++;try{this.getAxes();if(!H){H=[];H.map={}}var E=this,B=[],D,C,F,I=H.map,G;B.map={};J=Ext.Array.from(J,true);for(D=0,C=J.length;D<C;D++){F=J[D];if(!F){continue}G=H.map[F.getId&&F.getId()||F.id];if(F instanceof Ext.chart.series.Series){if(G!==F){if(G){G.destroy()}E.addItemListenersToSeries(F)}F.setChart(this)}else{if(Ext.isObject(F)){if(G){G.setConfig(F);F=G}else{if(Ext.isString(F)){F=Ext.create(F.xclass||("series."+F),{chart:this})}else{F.chart=this;F=Ext.create(F.xclass||("series."+F.type),F)}F.on("animationstart","onAnimationStart",this);F.on("animationend","onAnimationEnd",this);E.addItemListenersToSeries(F)}}}B.push(F);B.map[F.getId()]=F}for(D in I){if(!B.map[I[D].getId()]){I[D].destroy()}}return B}catch(A){Ext.log.error(this.$className+": Unhandled Exception: ",A.description||A.message);throw A}finally{this.resizing--}},applyLegend:function(A,B){return Ext.factory(A,Ext.chart.Legend,B)},updateLegend:function(A,B){if(B){B.destroy()}if(A){this.getItems();this.legendStore=new Ext.data.Store({autoDestroy:true,fields:["id","name","mark","disabled","series","index"]});A.setStore(this.legendStore);this.refreshLegendStore();this.legendStore.on("update","onUpdateLegendStore",this)}},setParent:function(A){this.callParent(arguments);if(A&&this.getLegend()){A.add(this.getLegend())}},updateSeries:function(A,C){this.resizing++;try{this.fireEvent("serieschange",this,A,C);this.refreshLegendStore();this.scheduleLayout()}catch(B){Ext.log.error(this.$className+": Unhandled Exception: ",B.description||B.message);throw B}finally{this.resizing--}},applyInteractions:function(E,D){if(!D){D=[];D.map={}}var G=this,B=[],H=D.map,F,C,A;B.map={};E=Ext.Array.from(E,true);for(F=0,C=E.length;F<C;F++){A=E[F];if(!A){continue}A=Ext.factory(A,null,H[A.getId&&A.getId()||A.id],"interaction");if(A){A.setChart(G);B.push(A);B.map[A.getId()]=A}}for(F in H){if(!B.map[H[F]]){H[F].destroy()}}return B},applyStore:function(A){return A&&Ext.StoreManager.lookup(A)},updateStore:function(C,B){var A=this;if(B){B.un("refresh","onRefresh",A,null,"after");if(B.autoDestroy){B.destroy()}}if(C){C.onAfter({refresh:"onRefresh",update:"onRefresh",scope:A})}A.fireEvent("storechange",C,B);A.onRefresh()},redraw:function(){this.fireEvent("redraw",this)},performLayout:function(){var C=this,A=C.innerElement.getSize(),B=[0,0,A.width,A.height],D=C.getBackground();C.hasFirstLayout=true;C.cancelLayout();C.getSurface("background").setRect(B);C.getSurface("chart").setRect(B);D.setAttributes({width:A.width,height:A.height})},getEventXY:function(A){return this.getSurface().getEventXY(A)},getItemForPoint:function(G,E){var C=this,A=0,F=C.getSeries(),B=F.length,D,H;if(C.hasFirstLayout){for(;A<B;A++){D=F[A];H=D.getItemForPoint(G,E);if(H){return H}}}return null},getItemsForPoint:function(E,F){var D=this,A=D.getSeries(),B,G=[];for(var C=0;C<A.length;C++){B=A[C];var H=B.getItemForPoint(E,F);if(H){G.push(H)}}return G},delayThicknessChanged:0,thicknessChanged:false,suspendThicknessChanged:function(){this.delayThicknessChanged++},resumeThicknessChanged:function(){if(this.delayThicknessChanged>0){this.delayThicknessChanged--;if(this.delayThicknessChanged===0&&this.thicknessChanged){this.onThicknessChanged()}}},onAnimationStart:function(){this.fireEvent("animationstart",this)},onAnimationEnd:function(){this.fireEvent("animationend",this)},onThicknessChanged:function(){if(this.delayThicknessChanged===0){this.thicknessChanged=false;this.performLayout()}else{this.thicknessChanged=true}},onRefresh:function(){if(this.isInitializing){return}var D=this.getMainRect(),B=this.getStore(),E=this.getSeries(),A=this.getAxes(),C,F;if(!B||!A||!E||!D){return}for(C=0,F=E.length;C<F;C++){E[C].processData()}this.redraw()},bindStore:function(A){this.setStore(A)},applyHighlightItem:function(A,B){if(A===B){return}if(Ext.isObject(A)&&Ext.isObject(B)){if(A.sprite===B.sprite&&A.index===B.index){return}}return A},updateHighlightItem:function(A,B){if(B){B.series.setAttributesForItem(B,{highlighted:false})}if(A){A.series.setAttributesForItem(A,{highlighted:true})}},addItemListenersToSeries:function(D){for(var C in this.itemListeners){var B=this.itemListeners[C],A,E;for(A=0,E=B.length;A<E;A++){D.addListener.apply(D,B[A])}}},addItemListener:function(B,G,C,E,H){var J=this.itemListeners[B]||(this.itemListeners[B]=[]),I=this.getSeries(),A,F,D;J.push([B,G,C,E,H]);if(I){for(F=0,D=I.length;F<D;F++){A=I[F];A.addListener(B,G,C,E,H)}}},remoteItemListener:function(B,G,C,E,H){var J=this.itemListeners[B],I=this.getSeries(),A,F,D;if(J){for(F=0,D=J.length;F<D;F++){if(J[F].fn===G){J.splice(F,1);if(I){for(F=0,D=I.length;F<D;F++){A=I[F];A.removeListener(B,G,C,E,H)}}break}}}},doAddListener:function(C,B,D,A,E){if(C.match(this.delegationRegex)){return this.addItemListener(C,B,D||this,A,E)}else{if(C.match(this.domEvents)){return this.element.doAddListener.apply(this.element,arguments)}else{return this.callParent(arguments)}}},doRemoveListener:function(C,B,D,A,E){if(C.match(this.delegationRegex)){return this.remoteItemListener(C,B,D||this,A,E)}else{if(C.match(this.domEvents)){return this.element.doRemoveListener.apply(this.element,arguments)}else{return this.callParent(arguments)}}},onItemRemove:function(A){this.callParent(arguments);if(this.surfaceMap){Ext.Array.remove(this.surfaceMap[A.type],A);if(this.surfaceMap[A.type].length===0){delete this.surfaceMap[A.type]}}},destroy:function(){var C=this,A=[],B=C.getLegend();C.surfaceMap=null;C.setHighlightItem(null);C.setSeries(A);C.setAxes(A);C.setInteractions(A);if(B){B.destroy();C.setLegend(null)}C.legendStore=null;C.setStore(null);C.cancelLayout();this.callParent(arguments)},getRefItems:function(G){var E=this,F=E.getSeries(),D=E.getAxes(),A=E.getInteractions(),H=[],C,B;for(C=0,B=F.length;C<B;C++){H.push(F[C]);if(F[C].getRefItems){H.push.apply(H,F[C].getRefItems(G))}}for(C=0,B=D.length;C<B;C++){H.push(D[C]);if(D[C].getRefItems){H.push.apply(H,D[C].getRefItems(G))}}for(C=0,B=A.length;C<B;C++){H.push(A[C]);if(A[C].getRefItems){H.push.apply(H,A[C].getRefItems(G))}}return H}});
Ext.define("Ext.data.Store",{extend:"Ext.data.ProxyStore",alias:"store.store",mixins:["Ext.data.LocalStore"],requires:["Ext.data.Model","Ext.data.proxy.Ajax","Ext.data.reader.Json","Ext.data.writer.Json","Ext.util.GroupCollection","Ext.util.DelayedTask"],uses:["Ext.data.StoreManager","Ext.util.Grouper"],config:{data:0,clearRemovedOnLoad:true,clearOnPageLoad:true,associatedEntity:null,role:null},addRecordsOptions:{addRecords:true},loadCount:0,complete:false,constructor:function(A){var B=this,C;if(A){if(A.buffered){if(this.self!==Ext.data.Store){Ext.Error.raise("buffered config not supported on derived Store classes. Please derive from Ext.data.BufferedStore.")}return new Ext.data.BufferedStore(A)}if(A.remoteGroup){Ext.log.warn("Ext.data.Store: remoteGroup has been removed. Use remoteSort instead.")}}B.callParent(arguments);C=B.inlineData;if(C){delete B.inlineData;B.loadInlineData(C)}B.getData().addObserver(this)},onCollectionBeginUpdate:function(){this.beginUpdate()},onCollectionEndUpdate:function(){this.endUpdate()},applyData:function(C,A){var B=this;B.getFields();B.getModel();if(!A){A=B.constructDataCollection()}if(C){if(B.isInitializing){B.inlineData=C}else{B.loadData(C)}}return A},loadInlineData:function(D){var B=this,A=B.getProxy(),C;if(A&&A.isMemoryProxy){A.setData(D);C=B.unblockLoad(true);B.suspendEvents();B.read();B.resumeEvents();B.blockLoad(C)}else{B.removeAll(true);B.suspendEvents();B.fireEvent("clear",B);B.loadData(D);B.resumeEvents()}},updateRemoteFilter:function(B){var C=this.getData(),A=this.getFilters();if(B){C.setFilters(null)}else{C.setFilters(A)}this.callParent(arguments)},updateRemoteSort:function(B){var C=this.getData(),A=this.getSorters();if(B){C.setSorters(null)}else{C.setSorters(A)}this.callParent(arguments)},insert:function(E,B){var C=this,D,A;if(B){if(!Ext.isIterable(B)){B=[B]}else{B=Ext.Array.clone(B)}D=B.length}if(!D){return[]}for(A=0;A<D;++A){B[A]=C.createModel(B[A])}C.getData().insert(E,B);return B},onCollectionAdd:function(D,H){var A=this,F=H.items,I=F.length,B=!H.next,G,C,J,E=A.getRemovedRecords();if(A.ignoreCollectionAdd){return}for(G=0;G<I;++G){J=F[G];J.join(A);if(E&&E.length){Ext.Array.remove(E,J)}C=C||J.phantom||J.dirty}A.fireEvent("add",A,F,H.at);if(B){A.fireEvent("datachanged",A)}A.needsSync=A.needsSync||C},onCollectionItemChange:function(B,E){var C=this,A=E.item,D=E.modified;if(C.contains(A)){C.onUpdate(A,"edit",D);C.fireEvent("update",C,A,"edit",D)}},afterEdit:function(A,B){this.needsSync=this.needsSync||A.dirty;this.getData().itemChanged(A,B)},afterDrop:function(A){this.getData().remove(A)},onCollectionFilterAdd:function(B,D){var C=D.length,A;for(A=0;A<C;++A){D[A].join(this)}},add:function(A){return this.insert(this.getCount(),arguments.length===1?A:arguments)},addSorted:function(B){var A=this,D=A.getRemoteSort(),E=A.getData(),C;if(D){E.setSorters(A.getSorters())}C=E.findInsertionIndex(B);if(D){E.setSorters(null)}return A.insert(C,B)},createModel:function(B){if(!B.isModel){var A=this.getModel();B=new A(B,this.getSession())}return B},remove:function(B,E,I){var F=this,A=F.getData(),G,D,H,C;if(B){if(B.isModel){if(F.indexOf(B)>-1){H=[B];G=1}else{G=0}}else{H=[];for(D=0,G=B.length;D<G;++D){C=B[D];if(C&&C.isEntity){if(!A.contains(C)){continue}}else{if(!(C=A.getAt(C))){continue}}H.push(C)}G=H.length}}if(!G){return[]}F.removeIsMove=E===true;F.removeIsSilent=I;A.remove(H);F.removeIsSilent=false;return H},onCollectionRemove:function(E,K){var A=this,F=A.removed,G=K.items,C=K.at,L=G.length,J=A.removeIsMove,N=A.removeIsSilent,B=!K.next,I,M,D,H;if(A.ignoreCollectionRemove){return}for(I=0;I<L;++I){M=G[I];M.unjoin(A);H=!M.phantom;if(F&&!J&&H){M.removedFrom=C+I;F.push(M)}D=D||H}if(!N){A.fireEvent("remove",A,G,C,J);if(B){A.fireEvent("datachanged",A)}}A.needsSync=A.needsSync||(D&&!J)},onFilterEndUpdate:function(){this.callParent(arguments);this.callObservers("Filter")},removeAt:function(B,A){var C=this.getData();B=Math.max(B,0);if(B<C.length){if(arguments.length===1){A=1}else{if(!A){return}}C.removeAt(B,A)}},removeAll:function(E){var D=this,C=D.getData(),A=D.hasListeners.clear,B;if(C.length){D.removeIsSilent=true;D.callObservers("BeforeRemoveAll");if(A){B=C.getRange()}C.removeAll();if(!E){D.fireEvent("clear",D,B);D.fireEvent("datachanged",D)}D.callObservers("AfterRemoveAll",[!!E])}},setRecords:function(B){var A=this.getCount();++this.loadCount;if(A){this.getData().splice(0,A,B)}else{this.add(B)}},splice:function(B,A,C){return this.getData().splice(B,A,C)},load:function(C){var A=this,B=A.getPageSize();if(typeof C==="function"){C={callback:C}}else{C=Ext.apply({},C)}if(A.getRemoteSort()&&!C.grouper&&A.getGrouper()){C.grouper=A.getGrouper()}if(B||"start" in C||"limit" in C||"page" in C){C.page=C.page||A.currentPage;C.start=(C.start!==undefined)?C.start:(C.page-1)*B;C.limit=C.limit||B}C.addRecords=C.addRecords||false;return A.callParent([C])},onProxyLoad:function(F){var E=this,C=F.getResultSet(),B=F.getRecords(),A=F.wasSuccessful(),D,G;if(E.isDestroyed){return}if(C){E.totalCount=C.getTotal()}E.loading=false;if(A){D=E.getSession();G=E.getAssociatedEntity();if(D&&G&&!G.phantom){B=E.getRole().validateAssociationRecords(D,G,B)}E.loadRecords(B,F.getAddRecords()?{addRecords:true}:undefined)}if(E.hasListeners.load){E.fireEvent("load",E,B,A,F)}},getNewRecords:function(){return this.getData().createFiltered(this.filterNew).getRange()},getUpdatedRecords:function(){return this.getData().createFiltered(this.filterUpdated).getRange()},loadData:function(E,D){var B=E.length,A=[],C;for(C=0;C<B;C++){A.push(this.createModel(E[C]))}this.loadRecords(A,D?this.addRecordsOptions:undefined)},loadRawData:function(G,F){var D=this,A=D.getSession(),C=D.getProxy().getReader().read(G,A?{recordCreator:A.recordCreator}:undefined),B=C.getRecords(),E=C.getSuccess();if(E){D.totalCount=C.getTotal();D.loadRecords(B,F?D.addRecordsOptions:undefined)}return E},loadRecords:function(A,G){var I=this,E=A.length,C=I.getData(),F,B,D,H;if(G){F=G.addRecords}D=I.getRemoteSort()||!I.getSortOnLoad();if(D){B=C.getAutoSort();C.setAutoSort(false)}if(!F){I.clearData(true)}I.ignoreCollectionAdd=true;I.callObservers("BeforeLoad");C.add(A);I.ignoreCollectionAdd=false;for(H=0;H<E;H++){A[H].join(I)}if(D){C.setAutoSort(B)}++I.loadCount;I.complete=true;I.fireEvent("datachanged",I);I.fireEvent("refresh",I);I.callObservers("AfterLoad")},loadPage:function(D,C){var B=this,A=B.getPageSize();B.currentPage=D;C=Ext.apply({page:D,start:(D-1)*A,limit:A,addRecords:!B.getClearOnPageLoad()},C);B.read(C)},nextPage:function(A){this.loadPage(this.currentPage+1,A)},previousPage:function(A){this.loadPage(this.currentPage-1,A)},clearData:function(F){var D=this,G=D.getData(),A=D.removed,B,C,E;if(G){B=G.items;for(C=0,E=B.length;C<E;++C){B[C].unjoin(D)}D.ignoreCollectionRemove=true;D.callObservers("BeforeClear");G.removeAll();D.ignoreCollectionRemove=false;D.callObservers("AfterClear")}if(A&&(F!==true||D.getClearRemovedOnLoad())){A.length=0}},onIdChanged:function(A,C,B){this.getData().updateKey(A,C)},commitChanges:function(){var C=this,D=C.getModifiedRecords(),E=D.length,A=C.removed,B=0;for(;B<E;B++){D[B].commit()}if(A){A.length=0}},filterNewOnly:function(A){return A.phantom===true},getRejectRecords:function(){var A=this.getData().createFiltered(this.filterNew).getRange();return Ext.Array.push(A,this.getUpdatedRecords())},rejectChanges:function(){var C=this,D=C.getRejectRecords(),E=D.length,B=0,A;for(;B<E;B++){A=D[B];A.reject();if(A.phantom){C.remove(A)}}D=C.removed;if(D){E=D.length;for(B=E-1;B>=0;B--){A=D[B];C.insert(A.removedFrom||0,A);A.reject()}D.length=0}},onDestroy:function(){var A=this,B=A.loadTask;A.callParent();A.observers=null;if(B){B.cancel();A.loadTask=null}A.getData().destroy();A.setData(null)}});
Ext.define("Ext.ComponentQuery",{singleton:true,requires:["Ext.ComponentManager","Ext.util.Operators","Ext.util.LruCache"]},function(){var I=this,P=Ext.util.Operators,H=/(\d*)n\+?(\d*)/,L=/\D/,B=/^(\s)+/,Q=/\\(.)/g,O=new Ext.util.LruCache({maxSize:100}),E=["var r = [],","i = 0,","it = items,","l = it.length,","c;","for (; i < l; i++) {","c = it[i];","if (c.{0}) {","r.push(c);","}","}","return r;"].join(""),R=function(T,S){return S.method.apply(this,[T].concat(S.args))},M=function(X,U){var V=[],T=0,W=X.length,S,Y=U!==">";for(;T<W;T++){S=X[T];if(S.getRefItems){V=V.concat(S.getRefItems(Y))}}return V},F=function(W){var V=[],T=0,U=W.length,S;for(;T<U;T++){S=W[T];while(!!(S=S.getRefOwner())){V.push(S)}}return V},K=function(X,S,V){if(S==="*"){return X.slice()}else{var W=[],T=0,U=X.length,Y;for(;T<U;T++){Y=X[T];if(Y.isXType(S,V)){W.push(Y)}}return W}},N=function(c,Y,U,X){var T=[],a=0,d=c.length,e,V,S,b,W,Z;if(Y.charAt(0)==="@"){e=true;Y=Y.substr(1)}if(Y.charAt(0)==="?"){e=true;V=true;Y=Y.substr(1)}for(;a<d;a++){S=c[a];if(!e||S.hasOwnProperty(Y)){b=S[Y];if(V){T.push(S)}else{if(U==="~="){if(b){if(!Ext.isArray(b)){b=b.split(" ")}for(W=0,Z=b.length;W<Z;W++){if(P[U](Ext.coerce(b[W],X),X)){T.push(S);break}}}}else{if(U==="/="){if(S[Y]!==undefined&&X.test(S[Y])){T.push(S)}}else{if(!X?!!S[Y]:P[U](Ext.coerce(b,X),X)){T.push(S)}}}}}}return T},A=function(W,X){var V=[],T=0,U=W.length,S;for(;T<U;T++){S=W[T];if(S.getItemId()===X){V.push(S)}}return V},D=function(U,T,S){return I.pseudos[T](U,S)},J=/^(\s?([>\^])\s?|\s|$)/,G=/^(#)?((?:\\\.|[\w\-])+|\*)(?:\((true|false)\))?/,C=[{re:/^\.((?:\\\.|[\w\-])+)(?:\((true|false)\))?/,method:K,argTransform:function(T){var S=T[0];Ext.log.warn('"'+S+'" ComponentQuery selector style is deprecated, use "'+S.replace(/^\./,"")+'" without the leading dot instead');if(T[1]!==undefined){T[1]=T[1].replace(Q,"$1")}return T.slice(1)}},{re:/^(?:\[((?:[@?$])?[\w\-]*)\s*(?:([\^$*~%!\/]?=)\s*(['"])?((?:\\\]|.)*?)\3)?(?!\\)\])/,method:N,argTransform:function(S){var Z=S[0],T=S[1],W=S[2],V=S[3],X=S[4],b;if(X!==undefined){X=X.replace(Q,"$1");var U=Ext.String.format,Y="ComponentQuery selector '{0}' has an unescaped ({1}) character at the {2} of the attribute value pattern. Usually that indicates an error where the opening quote is not followed by the closing quote. If you need to match a ({1}) character at the {2} of the attribute value, escape the quote character in your pattern: (\\{1})",a;if(a=/^(['"]).*?[^'"]$/.exec(X)){Ext.log.warn(U(Y,Z,a[1],"beginning"))}else{if(a=/^[^'"].*?(['"])$/.exec(X)){Ext.log.warn(U(Y,Z,a[1],"end"))}}}if(W==="/="){b=O.get(X);if(b){X=b}else{X=O.add(X,new RegExp(X))}}return[T,W,X]}},{re:/^#((?:\\\.|[\w\-])+)/,method:A},{re:/^\:([\w\-]+)(?:\(((?:\{[^\}]+\})|(?:(?!\{)[^\s>\/]*?(?!\})))\))?/,method:D,argTransform:function(S){if(S[2]!==undefined){S[2]=S[2].replace(Q,"$1")}return S.slice(1)}},{re:/^(?:\{([^\}]+)\})/,method:E}];I.Query=Ext.extend(Object,{constructor:function(S){S=S||{};Ext.apply(this,S)},execute:function(T){var X=this.operations,U=[],V,S,W;for(S=0,W=X.length;S<W;S++){V=X[S];U=U.concat(this._execute(T,V))}return U},_execute:function(T,X){var S=0,U=X.length,W,V;if(!T){V=Ext.ComponentManager.getAll()}else{if(Ext.isIterable(T)){V=T}else{if(T.isMixedCollection){V=T.items}}}for(;S<U;S++){W=X[S];if(W.mode==="^"){V=F(V||[T])}else{if(W.mode){V=M(V||[T],W.mode)}else{V=R(V||M([T]),W)}}if(S===U-1){return V}}return[]},is:function(V){var X=this.operations,T=false,W=X.length,U,S;if(W===0){return true}for(S=0;S<W;S++){U=X[S];T=this._is(V,U);if(T){return T}}return false},_is:function(V,T){var Z=T.length,W=[V],U,b,S,X,Y,a,c;for(b=Z-1;b>=0;--b){U=T[b];X=U.mode;if(X){if(X==="^"){W=M(W," ")}else{if(X===">"){a=[];for(S=0,Z=W.length;S<Z;++S){c=W[S].getRefOwner();if(c){a.push(c)}}W=a}else{W=F(W)}}if(W.length===0){return false}}else{W=R(W,U);if(W.length===0){return false}}}return true},getMatches:function(T,V){var U=V.length,S;for(S=0;S<U;++S){T=R(T,V[S]);if(T.length===0){break}}return T},isMultiMatch:function(){return this.operations.length>1}});Ext.apply(this,{cache:new Ext.util.LruCache({maxSize:100}),pseudos:{not:function(U,Y){var V=Ext.ComponentQuery,Z=0,T=U.length,X=[],S=-1,W;for(;Z<T;++Z){W=U[Z];if(!V.is(W,Y)){X[++S]=W}}return X},first:function(S){var T=[];if(S.length>0){T.push(S[0])}return T},last:function(S){var T=S.length,U=[];if(T>0){U.push(S[T-1])}return U},focusable:function(S){var U=S.length,V=[],T=0,W;for(;T<U;T++){W=S[T];if(W.isFocusable()){V.push(W)}}return V},"nth-child":function(Y,Z){var S=[],X=H.exec(Z=="even"&&"2n"||Z=="odd"&&"2n+1"||!L.test(Z)&&"n+"+Z||Z),b=(X[1]||1)-0,W=X[2]-0,U,V,T;for(U=0;V=Y[U];U++){T=U+1;if(b==1){if(W==0||T==W){S.push(V)}}else{if((T+W)%b==0){S.push(V)}}}return S}},query:function(Y,T){if(!Y){return Ext.ComponentManager.all.getArray()}var W=[],S=[],X={},U=this.cache.get(Y),Z,a,V;if(!U){U=this.cache.add(Y,this.parse(Y))}W=U.execute(T);if(U.isMultiMatch()){Z=W.length;for(V=0;V<Z;V++){a=W[V];if(!X[a.id]){S.push(a);X[a.id]=true}}W=S}return W},visitPreOrder:function(W,T,V,U,S){this._visit(true,W,T,V,U,S)},visitPostOrder:function(W,T,V,U,S){this._visit(false,W,T,V,U,S)},_visit:function(V,e,Y,b,U,S){var d=this,Z=d.cache.get(e),a=[Y],W,X=0,c,T;if(!Z){Z=d.cache.add(e,d.parse(e))}T=Z.is(Y);if(Y.getRefItems){W=Y.getRefItems();X=W.length}if(S){Ext.Array.push(a,S)}if(V){if(T){if(b.apply(U||Y,a)===false){return false}}}for(c=0;c<X;c++){if(d._visit.call(d,V,e,W[c],b,U,S)===false){return false}}if(!V){if(T){if(b.apply(U||Y,a)===false){return false}}}},is:function(S,U){if(!U){return true}var T=this.cache.get(U);if(!T){T=this.cache.add(U,this.parse(U))}return T.is(S)},parse:function(V){var X=[],T,U,S,W;T=Ext.splitAndUnescape(V,",");for(S=0,W=T.length;S<W;S++){U=Ext.String.trim(T[S]);if(U===""){Ext.Error.raise('Invalid ComponentQuery selector: ""')}X.push(this._parse(U))}return new I.Query({operations:X})},_parse:function(e){var X=[],U=Ext.String.trim,W=C.length,f,Y,g,c,S,V,Z,b,d,a,T;while(e&&f!==e){f=e;Y=e.match(G);if(Y){c=Y[1];g=U(Y[2]).replace(Q,"$1");if(c==="#"){X.push({method:A,args:[g]})}else{X.push({method:K,args:[g,Boolean(Y[3])]})}e=e.replace(Y[0],"").replace(B,"$1")}while(!(S=e.match(J))){for(b=0;e&&b<W;b++){d=C[b];V=e.match(d.re);a=d.method;Z=d.argTransform;if(V){if(Z){T=Z(V)}else{T=V.slice(1)}X.push({method:Ext.isString(d.method)?Ext.functionFactory("items",Ext.String.format.apply(Ext.String,[a].concat(V.slice(1)))):d.method,args:T});e=e.replace(V[0],"").replace(B,"$1");break}if(b===(W-1)){Ext.Error.raise('Invalid ComponentQuery selector: "'+arguments[0]+'"')}}}if(S[1]){X.push({mode:S[2]||S[1]});e=e.replace(S[0],"").replace(B,"")}}return X}})});
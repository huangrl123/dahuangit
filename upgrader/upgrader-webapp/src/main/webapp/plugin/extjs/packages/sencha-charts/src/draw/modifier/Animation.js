Ext.define("Ext.draw.modifier.Animation",{requires:["Ext.draw.TimingFunctions","Ext.draw.Animator"],extend:"Ext.draw.modifier.Modifier",alias:"modifier.animation",config:{easing:function(A){return A},duration:0,customEasings:{},customDuration:{}},constructor:function(){this.anyAnimation=false;this.anySpecialAnimations=false;this.animating=0;this.animatingPool=[];this.callParent(arguments)},prepareAttributes:function(A){if(!A.hasOwnProperty("timers")){A.animating=false;A.timers={};A.animationOriginal=Ext.Object.chain(A);A.animationOriginal.upperLevel=A}if(this._previous){this._previous.prepareAttributes(A.animationOriginal)}},updateSprite:function(A){this.setConfig(A.config.fx)},updateDuration:function(A){this.anyAnimation=A>0},applyEasing:function(A){if(typeof A==="string"){return Ext.draw.TimingFunctions.easingMap[A]}else{return A}},applyCustomEasings:function(B,F){F=F||{};var G,C,D,A,E;for(G in B){D=B[G];C=G.split(",");if(typeof D==="string"){D=Ext.draw.TimingFunctions.easingMap[D]}for(A=0,E=C.length;A<E;A++){F[C[A]]=D}}return F},setEasingOn:function(B,C){B=Ext.Array.from(B).slice();var D={},A=0,E=B.length;for(;A<E;A++){D[B[A]]=C}this.setCustomEasings(D)},clearEasingOn:function(B){B=Ext.Array.from(B,true);var A=0,C=B.length;for(;A<C;A++){delete this._customEasings[B[A]]}},applyCustomDuration:function(B,G){G=G||{};var D,E,A,F,C,H=this.anySpecialAnimations;for(D in B){E=B[D];A=D.split(",");H=true;for(F=0,C=A.length;F<C;F++){G[A[F]]=E}}this.anySpecialAnimations=H;return G},setDurationOn:function(C,D){C=Ext.Array.from(C).slice();var A={},B=0,E=C.length;for(;B<E;B++){A[C[B]]=D}this.setCustomDuration(A)},clearDurationOn:function(B){B=Ext.Array.from(B,true);var A=0,C=B.length;for(;A<C;A++){delete this._customDuration[B[A]]}},setAnimating:function(C,A){var D=this,B,E;if(C.animating!==A){C.animating=A;if(A){D.animatingPool.push(C);if(D.animating===0){Ext.draw.Animator.add(D)}D.animating++}else{for(B=0,E=0;B<D.animatingPool.length;B++){if(D.animatingPool[B]!==C){D.animatingPool[E++]=D.animatingPool[B]}}D.animating=D.animatingPool.length=E}}},setAttrs:function(D,J){var T=D.timers,A=this._sprite.self.def._animationProcessors,P=this._easing,G=this._duration,K=this._customDuration,S=this._customEasings,R=this.anySpecialAnimations,C=this.anyAnimation||R,O=D.animationOriginal,H=false,N,Q,I,F,B,L,E;if(!C){for(Q in J){if(D[Q]===J[Q]){delete J[Q]}else{D[Q]=J[Q]}delete O[Q];delete T[Q]}return J}else{for(Q in J){I=J[Q];F=D[Q];if(I!==F&&C&&F!==undefined&&F!==null&&(B=A[Q])){L=P;E=G;if(R){if(Q in S){L=S[Q]}if(Q in K){E=K[Q]}}if(E){if(!T[Q]){T[Q]={}}N=T[Q];N.start=0;N.easing=L;N.duration=E;N.compute=B.compute;N.serve=B.serve||Ext.draw.Draw.reflectFn;if(B.parseInitial){var M=B.parseInitial(F,I);N.source=M[0];N.target=M[1]}else{if(B.parse){N.source=B.parse(F);N.target=B.parse(I)}else{N.source=F;N.target=I}}T[Q]=N;O[Q]=I;delete J[Q];H=true;continue}else{delete O[Q]}}else{delete O[Q]}delete T[Q]}}if(H&&!D.animating){this.setAnimating(D,true)}return J},updateAttributes:function(C){if(!C.animating){return{}}var I={},E=false,A=C.animationOriginal,D=C.timers,H=Ext.draw.Animator.animationTime(),B,F,G;if(C.lastUpdate===H){return{}}for(B in D){F=D[B];if(!F.start){F.start=H;G=0}else{G=(H-F.start)/F.duration}if(G>=1){I[B]=A[B];delete A[B];delete D[B]}else{I[B]=F.serve(F.compute(F.source,F.target,F.easing(G),C[B]));E=true}}C.lastUpdate=H;this.setAnimating(C,E);return I},pushDown:function(B,A){A=this.superclass.pushDown.call(this,B.animationOriginal,A);return this.setAttrs(B,A)},popUp:function(B,A){B=B.upperLevel;A=this.setAttrs(B,A);if(this._next){return this._next.popUp(B,A)}else{return Ext.apply(B,A)}},step:function(){var D=this,A=D.animatingPool.slice(),C,B,G;for(B=0,G=A.length;B<G;B++){C=A[B];var E=this.updateAttributes(C),F;for(F in E){if(this._next){this._next.popUp(C,E)}break}}},stop:function(){this.step();var C=this,A=C.animatingPool,B,D;for(B=0,D=A.length;B<D;B++){A[B].animating=false}C.animatingPool.length=0;C.animating=0;Ext.draw.Animator.remove(C)},destroy:function(){var A=this;A.animatingPool.length=0;A.animating=0}});
Ext.define("Ext.data.reader.Reader",{alternateClassName:["Ext.data.Reader","Ext.data.DataReader"],requires:["Ext.data.ResultSet","Ext.XTemplate"],mixins:["Ext.mixin.Observable","Ext.mixin.Factoryable"],alias:"reader.base",factoryConfig:{defaultType:null},config:{totalProperty:"total",successProperty:"success",rootProperty:"",messageProperty:"",typeProperty:"",implicitIncludes:true,readRecordsOnFailure:true,model:null,proxy:null,transform:null},isReader:true,constructor:function(A){if(A&&A.hasOwnProperty("root")){A=Ext.apply({},A);A.rootProperty=A.root;delete A.root;Ext.log.error('Ext.data.reader.Reader: Using the deprecated "root" configuration. Use "rootProperty" instead.')}var B=this;B.duringInit=true;B.mixins.observable.constructor.call(B,A);delete B.duringInit;B.buildExtractors()},applyModel:function(A){return Ext.data.schema.Schema.lookupEntity(A)},applyTransform:function(A){if(A){if(Ext.isFunction(A)){A={fn:A}}return A.fn.bind(A.scope||this)}return A},forceBuildExtractors:function(){if(!this.duringInit){this.buildExtractors(true)}},updateTotalProperty:function(){this.forceBuildExtractors()},updateMessageProperty:function(){this.forceBuildExtractors()},updateSuccessProperty:function(){this.forceBuildExtractors()},read:function(C,B){var D,A;if(C){if(C.responseText){A=this.getResponseData(C);if(A&&A.__$isError){return new Ext.data.ResultSet({total:0,count:0,records:[],success:false,message:A.msg})}else{D=this.readRecords(A,B)}}else{D=this.readRecords(C,B)}}return D||this.nullResultSet},createReadError:function(A){return{__$isError:true,msg:A}},readRecords:function(D,E){var A=this,B,J,C,F,I,G,K,H;H=this.getTransform();if(H){D=H(D)}A.buildExtractors();A.rawData=D;D=A.getData(D);B=true;J=0;C=[];if(A.getSuccessProperty()){G=A.getSuccess(D);if(G===false||G==="false"){B=false}}if(A.getMessageProperty()){K=A.getMessage(D)}if(A.getReadRecordsOnFailure()||B){F=Ext.isArray(D)?D:A.getRoot(D);if(F){I=F.length}if(A.getTotalProperty()){G=parseInt(A.getTotal(D),10);if(!isNaN(G)){I=G}}if(F){C=A.extractData(F,E);J=C.length}}return new Ext.data.ResultSet({total:I||J,count:J,records:C,success:B,message:K,readRoot:!!F})},extractData:function(G,E){var L=this,K=E&&E.model?Ext.data.schema.Schema.lookupEntity(E.model):L.getModel(),A=K.schema,J=A.hasAssociations(K)&&L.getImplicitIncludes(),B=L.getFieldExtractorInfo(K.fieldExtractors),O=G.length,C=new Array(O),F=L.getTypeProperty(),M,I,H,N,D;if(!O&&Ext.isObject(G)){G=[G];O=1}for(D=0;D<O;D++){N=G[D];if(!N.isModel){I=N;if(F&&(H=L.getChildType(A,I,F))){M=H.getProxy().getReader();N=M.extractRecord(I,E,H,A.hasAssociations(H)&&M.getImplicitIncludes(),M.getFieldExtractorInfo(H.fieldExtractors))}else{N=L.extractRecord(I,E,K,J,B)}}if(N.onLoad){N.onLoad()}C[D]=N}return C},getChildType:function(D,B,C){var A;switch(typeof C){case"string":return D.getEntity(B[C]);case"object":A=C.namespace;return D.getEntity((A?A+".":"")+B[C.name]);case"function":return D.getEntity(C(B))}},extractRecordData:function(B,C){var A=C&&C.model?Ext.data.schema.Schema.lookupEntity(C.model):this.getModel(),D=this.getFieldExtractorInfo(A.fieldExtractors);return this.extractRecord(B,C,A,false,D)},extractRecord:function(D,B,F,E,A){var G=this,C=(B&&B.recordCreator)||G.defaultRecordCreator,I,H;I=G.extractModelData(D,A);H=C.call(G,I,F||G.getModel(),B);if(E&&H.isModel){G.readAssociated(H,D,B)}return H},getFieldExtractorInfo:function(B){var A=this.$className,C=B[A];if(C===undefined){B[A]=C=this.buildFieldExtractors()}return C},buildFieldExtractors:function(){var I=this.getFields(),D=I.length,E=[],A=[],B=null,H=0,G,C,F,J;for(F=0;F<D;++F){G=I[F];J=this.createFieldAccessor(G);if(J){C=G.name;E.push("data['"+C+"'] = extractors["+H+"](raw);");A.push(J);++H}}if(E.length){B={extractors:A,fn:new Function("raw","data","extractors",E.join(""))}}return B},defaultRecordCreator:function(C,A){var B=new A(C);B.phantom=false;return B},getModelData:function(A){return{}},extractModelData:function(D,C){var A=this.getModelData(D),B;if(C){B=C.fn;B(D,A,C.extractors)}return A},readAssociated:function(C,F,E){var D=C.associations,A,B;for(A in D){if(D.hasOwnProperty(A)){B=D[A];if(B.cls){B.read(C,F,this,E)}}}},getFields:function(){return this.getModel().fields},getData:Ext.identityFn,getRoot:Ext.identityFn,getResponseData:function(A){Ext.Error.raise("getResponseData must be implemented in the Ext.data.reader.Reader subclass")},onMetaChange:function(D){var A=this,G=D.fields||A.getFields(),F,E,B,C;A.metaData=D;if(D.root){A.setRootProperty(D.root)}if(D.totalProperty){A.setTotalProperty(D.totalProperty)}if(D.successProperty){A.setSuccessProperty(D.successProperty)}if(D.messageProperty){A.setMessageProperty(D.messageProperty)}B=D.clientIdProperty;E=Ext.define(null,{extend:"Ext.data.Model",fields:G,clientIdProperty:B});A.setModel(E);C=A.getProxy();if(C){C.setModel(E)}A.buildExtractors(true)},buildExtractors:function(C){var B=this,E=B.getTotalProperty(),D=B.getSuccessProperty(),A=B.getMessageProperty();if(C||!B.hasExtractors){if(E){B.getTotal=B.createAccessor(E)}if(D){B.getSuccess=B.createAccessor(D)}if(A){B.getMessage=B.createAccessor(A)}B.hasExtractors=true;return true}},createAccessor:Ext.emptyFn,createFieldAccessor:Ext.emptyFn,destroy:function(){var A=this;delete A.model;delete A.getTotal;delete A.getSuccess;delete A.getMessage}},function(){var A=this.prototype;Ext.apply(A,{nullResultSet:new Ext.data.ResultSet({total:0,count:0,records:[],success:true,message:""})})});
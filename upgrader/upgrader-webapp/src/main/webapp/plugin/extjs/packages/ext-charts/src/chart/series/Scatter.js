Ext.define("Ext.chart.series.Scatter",{extend:"Ext.chart.series.Cartesian",requires:["Ext.chart.axis.Axis","Ext.chart.Shape","Ext.fx.Anim"],type:"scatter",alias:"series.scatter",constructor:function(C){this.callParent(arguments);var D=this,A=D.chart.shadow,F=D.chart.surface,B,E;Ext.apply(D,C,{style:{},markerConfig:{},shadowAttributes:[{"stroke-width":6,"stroke-opacity":0.05,stroke:"rgb(0, 0, 0)"},{"stroke-width":4,"stroke-opacity":0.1,stroke:"rgb(0, 0, 0)"},{"stroke-width":2,"stroke-opacity":0.15,stroke:"rgb(0, 0, 0)"}]});D.group=F.getGroup(D.seriesId);if(A){for(B=0,E=D.shadowAttributes.length;B<E;B++){D.shadowGroups.push(F.getGroup(D.seriesId+"-shadows"+B))}}},getBounds:function(){var F=this,O=F.chart,G=O.getChartStore(),H=O.axes,L=F.getAxesForXAndYFields(),N=L.xAxis,R=L.yAxis,I,A,Q,M,B,K,P,C,D,J,E;F.setBBox();I=F.bbox;if(J=H.get(N)){E=J.applyData();B=E.from;P=E.to}if(J=H.get(R)){E=J.applyData();K=E.from;C=E.to}if(F.xField&&!Ext.isNumber(B)){J=F.getMinMaxXValues();B=J[0];P=J[1]}if(F.yField&&!Ext.isNumber(K)){J=F.getMinMaxYValues();K=J[0];C=J[1]}if(isNaN(B)){B=0;P=G.getCount()-1;A=I.width/(G.getCount()-1)}else{A=I.width/(P-B)}if(isNaN(K)){K=0;C=G.getCount()-1;Q=I.height/(G.getCount()-1)}else{Q=I.height/(C-K)}return{bbox:I,minX:B,minY:K,xScale:A,yScale:Q}},getPaths:function(){var E=this,W=E.chart,L=W.shadow,G=W.getChartStore(),U=G.data.items,C,S,F,O=E.group,Q=E.bounds=E.getBounds(),I=E.bbox,V=Q.xScale,Z=Q.yScale,A=Q.minX,M=Q.minY,D=I.x,T=I.y,J=I.height,R=E.items=[],B=[],N=E.reverse,K,X,P,H,Y;for(C=0,S=U.length;C<S;C++){F=U[C];P=F.get(E.xField);H=F.get(E.yField);if(typeof H=="undefined"||(typeof H=="string"&&!H)||P==null||H==null){if(Ext.isDefined(Ext.global.console)){Ext.global.console.warn("[Ext.chart.series.Scatter]  Skipping a store element with a value which is either undefined or null  at ",F,P,H)}continue}if(typeof P=="string"||typeof P=="object"&&!Ext.isDate(P)){P=C}if(typeof H=="string"||typeof H=="object"&&!Ext.isDate(H)){H=C}if(N){K=D+I.width-((P-A)*V)}else{K=D+(P-A)*V}X=T+J-(H-M)*Z;B.push({x:K,y:X});E.items.push({series:E,value:[P,H],point:[K,X],storeItem:F});if(W.animate&&W.resizing){Y=O.getAt(C);if(Y){E.resetPoint(Y);if(L){E.resetShadow(Y)}}}}return B},resetPoint:function(A){var B=this.bbox;A.setAttributes({translate:{x:(B.x+B.width)/2,y:(B.y+B.height)/2}},true)},resetShadow:function(A){var F=this,B=A.shadows,H=F.shadowAttributes,C=F.shadowGroups.length,G=F.bbox,E,D;for(E=0;E<C;E++){D=Ext.apply({},H[E]);if(D.translate){D.translate.x+=(G.x+G.width)/2;D.translate.y+=(G.y+G.height)/2}else{D.translate={x:(G.x+G.width)/2,y:(G.y+G.height)/2}}B[E].setAttributes(D,true)}},createPoint:function(F,A){var C=this,E=C.chart,B=C.group,D=C.bbox;return Ext.chart.Shape[A](E.surface,Ext.apply({},{x:0,y:0,group:B,translate:{x:(D.x+D.width)/2,y:(D.y+D.height)/2}},F))},createShadow:function(A,I,K){var J=this,E=J.chart,D=J.shadowGroups,M=J.shadowAttributes,L=D.length,B=J.bbox,H,G,C,F;A.shadows=C=[];for(H=0;H<L;H++){F=Ext.apply({},M[H]);if(F.translate){F.translate.x+=(B.x+B.width)/2;F.translate.y+=(B.y+B.height)/2}else{Ext.apply(F,{translate:{x:(B.x+B.width)/2,y:(B.y+B.height)/2}})}Ext.apply(F,I);G=Ext.chart.Shape[K](E.surface,Ext.apply({},{x:0,y:0,group:D[H]},F));C.push(G)}},drawSeries:function(){var E=this,R=E.chart,F=R.getChartStore(),G=E.group,K=R.shadow,S=E.shadowGroups,M=E.shadowAttributes,I=S.length,J,C,P,N,D,A,L,Q,B,H,O;if(!F||!F.getCount()||E.seriesIsHidden){E.hide();E.items=[];return}A=Ext.apply({},E.markerStyle,E.markerConfig);Q=A.type||"circle";delete A.type;if(!F||!F.getCount()){E.hide();E.items=[];return}E.unHighlightItem();E.cleanHighlights();C=E.getPaths();N=C.length;for(D=0;D<N;D++){P=C[D];J=G.getAt(D);Ext.apply(P,A);if(!J){J=E.createPoint(P,Q);if(K){E.createShadow(J,A,Q)}}B=J.shadows;if(R.animate){H=E.renderer(J,F.getAt(D),{translate:P},D,F);J._to=H;E.onAnimate(J,{to:H});for(L=0;L<I;L++){O=Ext.apply({},M[L]);H=E.renderer(B[L],F.getAt(D),Ext.apply({},{hidden:false,translate:{x:P.x+(O.translate?O.translate.x:0),y:P.y+(O.translate?O.translate.y:0)}},O),D,F);E.onAnimate(B[L],{to:H})}}else{H=E.renderer(J,F.getAt(D),{translate:P},D,F);J._to=H;J.setAttributes(H,true);for(L=0;L<I;L++){O=Ext.apply({},M[L]);H=E.renderer(B[L],F.getAt(D),Ext.apply({},{hidden:false,translate:{x:P.x+(O.translate?O.translate.x:0),y:P.y+(O.translate?O.translate.y:0)}},O),D,F);B[L].setAttributes(H,true)}}E.items[D].sprite=J}N=G.getCount();for(D=C.length;D<N;D++){G.getAt(D).hide(true)}E.renderLabels();E.renderCallouts()},onCreateLabel:function(C,I,E,H){var G=this,F=G.labelsGroup,A=G.label,D=Ext.apply({},A,G.seriesLabelStyle),B=G.bbox;return G.chart.surface.add(Ext.apply({type:"text","text-anchor":"middle",group:F,x:Number(I.point[0]),y:B.y+B.height/2},D))},onPlaceLabel:function(R,S,E,G,P,M,F){var I=this,X=I.chart,W=X.resizing,B=I.label,O=B.renderer,D=B.field,L=I.bbox,T=Number(E.point[0]),U=Number(E.point[1]),H=E.sprite.attr.radius,Q,K,N,V,J,C,A;R.setAttributes({text:O(S.get(D),R,S,E,G,P,M,F),hidden:true},true);K=E.sprite.getBBox();K.width=K.width||(H*2);K.height=K.height||(H*2);Q=R.getBBox();N=Q.width/2;V=Q.height/2;if(P=="rotate"){J=K.width/2+N+V/2;if(T+J+N>L.x+L.width){T-=J}else{T+=J}R.setAttributes({"rotation":{x:T,y:U,degrees:-45}},true)}else{if(P=="under"||P=="over"){R.setAttributes({"rotation":{degrees:0}},true);if(T<L.x+N){T=L.x+N}else{if(T+N>L.x+L.width){T=L.x+L.width-N}}C=K.height/2+V;U=U+(P=="over"?-C:C);if(U<L.y+V){U+=2*C}else{if(U+V>L.y+L.height){U-=2*C}}}}if(!X.animate){R.setAttributes({x:T,y:U},true);R.show(true)}else{if(W){A=E.sprite.getActiveAnimation();if(A){A.on("afteranimate",function(){R.setAttributes({x:T,y:U},true);R.show(true)})}else{R.show(true)}}else{I.onAnimate(R,{to:{x:T,y:U}})}}},onPlaceCallout:function(M,V,D,F,R,O,E){var H=this,W=H.chart,N=W.surface,Y=W.resizing,A=H.callouts,S=H.items,K=D.point,Z,I=M.label.getBBox(),C=30,P=10,Q=3,G,U,T,a,B,J=H.bbox,L,X;Z=[Math.cos(Math.PI/4),-Math.sin(Math.PI/4)];L=K[0]+Z[0]*C;X=K[1]+Z[1]*C;G=L+(Z[0]>0?0:-(I.width+2*Q));U=X-I.height/2-Q;T=I.width+2*Q;a=I.height+2*Q;if(G<J[0]||(G+T)>(J[0]+J[2])){Z[0]*=-1}if(U<J[1]||(U+a)>(J[1]+J[3])){Z[1]*=-1}L=K[0]+Z[0]*C;X=K[1]+Z[1]*C;G=L+(Z[0]>0?0:-(I.width+2*Q));U=X-I.height/2-Q;T=I.width+2*Q;a=I.height+2*Q;if(W.animate){H.onAnimate(M.lines,{to:{path:["M",K[0],K[1],"L",L,X,"Z"]}},true);H.onAnimate(M.box,{to:{x:G,y:U,width:T,height:a}},true);H.onAnimate(M.label,{to:{x:L+(Z[0]>0?Q:-(I.width+Q)),y:X}},true)}else{M.lines.setAttributes({path:["M",K[0],K[1],"L",L,X,"Z"]},true);M.box.setAttributes({x:G,y:U,width:T,height:a},true);M.label.setAttributes({x:L+(Z[0]>0?Q:-(I.width+Q)),y:X},true)}for(B in M){M[B].show(true)}},onAnimate:function(A,B){A.show();return this.callParent(arguments)},isItemInPoint:function(F,G,E){var D,A=10,C=Math.abs;function B(H){var I=C(H[0]-F),J=C(H[1]-G);return Math.sqrt(I*I+J*J)}D=E.point;return(D[0]-A<=F&&D[0]+A>=F&&D[1]-A<=G&&D[1]+A>=G)}});
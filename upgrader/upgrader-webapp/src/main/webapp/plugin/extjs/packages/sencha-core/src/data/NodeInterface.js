Ext.define("Ext.data.NodeInterface",{requires:["Ext.data.field.Boolean","Ext.data.field.Integer","Ext.data.field.String","Ext.data.writer.Json","Ext.mixin.Observable"],statics:{decorate:function(B){var F=Ext.data.schema.Schema.lookupEntity(B),D=F.prototype,A,E,C;if(!F.prototype.isObservable){F.mixin(Ext.mixin.Observable.prototype.mixinId,Ext.mixin.Observable)}if(D.isNode){return}A=D.idProperty;E=F.getField(A);C=E.type;F.override(this.getPrototypeBody());F.addFields([{name:"parentId",type:C,defaultValue:null,allowNull:E.allowNull},{name:"index",type:"int",defaultValue:-1,persist:false,convert:null},{name:"depth",type:"int",defaultValue:0,persist:false,convert:null},{name:"expanded",type:"bool",defaultValue:false,persist:false,convert:null},{name:"expandable",type:"bool",defaultValue:true,persist:false,convert:null},{name:"checked",type:"auto",defaultValue:null,persist:false,convert:null},{name:"leaf",type:"bool",defaultValue:false},{name:"cls",type:"string",defaultValue:"",persist:false,convert:null},{name:"iconCls",type:"string",defaultValue:"",persist:false,convert:null},{name:"icon",type:"string",defaultValue:"",persist:false,convert:null},{name:"root",type:"boolean",defaultValue:false,persist:false,convert:null},{name:"isLast",type:"boolean",defaultValue:false,persist:false,convert:null},{name:"isFirst",type:"boolean",defaultValue:false,persist:false,convert:null},{name:"allowDrop",type:"boolean",defaultValue:true,persist:false,convert:null},{name:"allowDrag",type:"boolean",defaultValue:true,persist:false,convert:null},{name:"loaded",type:"boolean",defaultValue:false,persist:false,convert:null},{name:"loading",type:"boolean",defaultValue:false,persist:false,convert:null},{name:"href",type:"string",defaultValue:"",persist:false,convert:null},{name:"hrefTarget",type:"string",defaultValue:"",persist:false,convert:null},{name:"qtip",type:"string",defaultValue:"",persist:false,convert:null},{name:"qtitle",type:"string",defaultValue:"",persist:false,convert:null},{name:"qshowDelay",type:"int",defaultValue:0,persist:false,convert:null},{name:"children",type:"auto",defaultValue:null,persist:false,convert:null},{name:"visible",type:"boolean",defaultValue:true,persist:false},{name:"text",type:"string",persist:false}])},getPrototypeBody:function(){var A={idchanged:true,append:true,remove:true,move:true,insert:true,beforeappend:true,beforeremove:true,beforemove:true,beforeinsert:true,expand:true,collapse:true,beforeexpand:true,beforecollapse:true,sort:true};return{isNode:true,constructor:function(){var B=this;B.mixins.observable.constructor.call(B);B.callParent(arguments);B.firstChild=B.lastChild=B.parentNode=B.previousSibling=B.nextSibling=null;B.childNodes=[];return B},createNode:function(G){var H=this,F=H.childType,B,K,C,J,I,E,D=H.self;if(!G.isModel){if(F){D=H.schema.getEntity(F)}else{B=H.getTreeStore();K=B&&B.getProxy().getReader();C=H.getProxy();J=C?C.getReader():null;I=!K||(J&&J.initialConfig.typeProperty)?J:K;if(I){E=I.typeProperty;if(E){D=H.schema.getEntity(G[E])}}}G=new D(G)}if(!G.childNodes){G.firstChild=G.lastChild=G.parentNode=G.previousSibling=G.nextSibling=null;G.childNodes=[]}return G},isLeaf:function(){return this.get("leaf")===true},setFirstChild:function(B){this.firstChild=B},setLastChild:function(B){this.lastChild=B},updateInfo:function(I,B){var G=this,U=G.data.depth,J={},S=G.childNodes,L=S.length,F,D=G.phantom,M=G.data,P=G.fields,O=G.modified||(G.modified={}),Q,K,H,C,R,T=B.parentId,E,N;if(!B){Ext.Error.raise("NodeInterface expects update info to be passed")}for(Q in B){H=P[G.fieldOrdinals[Q]];K=B[Q];N=H&&H.persist;C=M[Q];E=N&&(Q==="index")&&(C!==-1)&&(T&&T!==O.parentId);if(!E&&G.isEqual(C,K)){continue}M[Q]=K;if(N){if(!E&&O.hasOwnProperty(Q)){if(G.isEqual(O[Q],K)){delete O[Q];G.dirty=false;for(R in O){if(O.hasOwnProperty(R)){G.dirty=true;break}}}}else{G.dirty=true;O[Q]=C}}}if(I){G.commit();G.phantom=D}if(G.data.depth!==U){J={depth:G.data.depth+1};for(F=0;F<L;F++){S[F].updateInfo(I,J)}}},isLast:function(){return this.get("isLast")},isFirst:function(){return this.get("isFirst")},hasChildNodes:function(){return !this.isLeaf()&&this.childNodes.length>0},isExpandable:function(){var B=this;if(B.get("expandable")){return !(B.isLeaf()||(B.isLoaded()&&!B.phantom&&!B.hasChildNodes()))}return false},triggerUIUpdate:function(){this.callJoined("afterEdit",[])},appendChild:function(J,F,L){var K=this,H,E,D,C,I,G={isLast:true,parentId:K.getId(),depth:(K.data.depth||0)+1},B;Ext.suspendLayouts();if(Ext.isArray(J)){E=J.length;B=new Array(E);K.callJoined("beginFill");for(H=0;H<E;H++){B[H]=K.appendChild(J[H],F,L)}K.callJoined("endFill",[B])}else{J=K.createNode(J);if(F!==true&&K.fireEventArgs("beforeappend",[K,J])===false){return false}D=K.childNodes.length;C=J.parentNode;if(C){if(F!==true&&J.fireEventArgs("beforemove",[J,C,K,D])===false){return false}C.removeChild(J,false,false,C.getTreeStore()===K.getTreeStore())}D=K.childNodes.length;if(D===0){K.setFirstChild(J)}K.childNodes[D]=J;J.parentNode=K;J.nextSibling=null;K.setLastChild(J);I=K.childNodes[D-1];if(I){J.previousSibling=I;I.nextSibling=J;I.updateInfo(L,{isLast:false});I.triggerUIUpdate()}else{J.previousSibling=null}G.isFirst=D===0;G.index=D;J.updateInfo(L,G);if(K.isLeaf()){K.set("leaf",false)}if(!K.isLoaded()){K.set("loaded",true)}else{if(K.childNodes.length===1){K.triggerUIUpdate()}}if(D&&K.childNodes[D-1].isExpanded()){K.childNodes[D-1].cascadeBy(K.triggerUIUpdate)}if(!J.isLeaf()&&J.phantom){J.set("loaded",true)}if(F!==true){K.fireEventArgs("append",[K,J,D]);if(C){J.fireEventArgs("move",[J,C,K,D])}}K.callJoined("onNodeAppend",[J,D]);B=J}Ext.resumeLayouts(true);return B},getOwnerTree:function(){var B=this.getTreeStore();if(B){return B.ownerTree}},getTreeStore:function(){return this.store},removeChild:function(H,C,E,I){var J=this,D=J.indexOf(H),F,B,G;if(D===-1||(E!==true&&J.fireEventArgs("beforeremove",[J,H,!!I])===false)){return false}Ext.suspendLayouts();Ext.Array.erase(J.childNodes,D,1);if(J.firstChild===H){J.setFirstChild(H.nextSibling)}if(J.lastChild===H){J.setLastChild(H.previousSibling)}G=H.previousSibling;if(G){H.previousSibling.nextSibling=H.nextSibling}if(H.nextSibling){H.nextSibling.previousSibling=H.previousSibling;if(D===0){H.nextSibling.updateInfo(false,{isFirst:true})}for(F=D,B=J.childNodes.length;F<B;F++){J.childNodes[F].updateInfo(false,{index:F})}}else{if(G){G.updateInfo(false,{isLast:true});if(G.isExpanded()){G.cascadeBy(J.triggerUIUpdate)}else{G.triggerUIUpdate()}}}if(!J.childNodes.length){J.triggerUIUpdate()}Ext.resumeLayouts(true);if(E!==true){J.callJoined("beforeNodeRemove",[[H],!!I]);H.previousSibling=H.nextSibling=H.parentNode=null;J.fireEventArgs("remove",[J,H,!!I]);J.callJoined("onNodeRemove",[[H],!!I])}if(C){H.erase(true)}else{H.clear()}return H},copy:function(C,D){var E=this,G=E.callParent(arguments),F=E.childNodes?E.childNodes.length:0,B;if(D){for(B=0;B<F;B++){G.appendChild(E.childNodes[B].copy(undefined,true))}}return G},clear:function(C){var B=this;B.parentNode=B.previousSibling=B.nextSibling=null;if(C){B.firstChild=B.lastChild=null}},erase:function(G){var D=this,C=D.destroyOptions,E=D.childNodes,F=E.length,B;if(G===true){D.clear(true);for(B=0;B<F;B++){E[B].erase(true)}D.childNodes=null;delete D.destroyOptions;D.callParent([C])}else{D.destroyOptions=G;D.remove(true)}},insertBefore:function(H,I,E){var J=this,D=J.indexOf(I),C=H.parentNode,K=D,B,G,F;if(!I){return J.appendChild(H)}if(H===I){return false}H=J.createNode(H);if(E!==true&&J.fireEventArgs("beforeinsert",[J,H,I])===false){return false}if(C===J&&J.indexOf(H)<D){K--}if(C){if(E!==true&&H.fireEventArgs("beforemove",[H,C,J,D,I])===false){return false}C.removeChild(H,false,false,C.getTreeStore()===J.getTreeStore())}if(K===0){J.setFirstChild(H)}Ext.Array.splice(J.childNodes,K,0,H);H.parentNode=J;H.nextSibling=I;I.previousSibling=H;G=J.childNodes[K-1];if(G){H.previousSibling=G;G.nextSibling=H}else{H.previousSibling=null}H.updateInfo(false,{parentId:J.getId(),index:K,isFirst:K===0,isLast:false,depth:(J.data.depth||0)+1});for(F=K+1,B=J.childNodes.length;F<B;F++){J.childNodes[F].updateInfo(false,{index:F})}if(!J.isLoaded()){J.set("loaded",true)}else{if(J.childNodes.length===1){J.triggerUIUpdate()}}if(!H.isLeaf()&&H.phantom){H.set("loaded",true)}if(E!==true){J.fireEventArgs("insert",[J,H,I]);if(C){H.fireEventArgs("move",[H,C,J,K,I])}}J.callJoined("onNodeInsert",[H,K]);return H},insertChild:function(D,C){var B=this.childNodes[D];if(B){return this.insertBefore(C,B)}else{return this.appendChild(C)}},isLastVisible:function(){var D=this,B=D.data.isLast,C=D.nextSibling;if(!B&&D.getTreeStore().isFiltered()){while(C){if(C.data.visible){return false}C=C.nextSibling}return true}return B},remove:function(E,C){var D=this,B=D.parentNode;if(B){B.removeChild(D,E,C)}else{if(E){D.erase(true)}}return D},removeAll:function(G,C,E){var H=this,B=H.childNodes,D=0,I=B.length,F;if(!I){return}H.callJoined("beforeNodeRemove",[B,false]);for(;D<I;++D){F=B[D];F.previousSibling=F.nextSibling=F.parentNode=null;H.fireEventArgs("remove",[H,F,false]);if(G){F.erase(true)}else{F.removeAll(false,C,true)}}H.callJoined("onNodeRemove",[B,false]);H.firstChild=H.lastChild=null;H.childNodes.length=0;if(!E){H.triggerUIUpdate()}return H},getChildAt:function(B){return this.childNodes[B]},replaceChild:function(E,D,C){var B=D?D.nextSibling:null;this.removeChild(D,false,C);this.insertBefore(E,B,C);return D},indexOf:function(B){return Ext.Array.indexOf(this.childNodes,B)},indexOfId:function(E){var C=this.childNodes,D=C.length,B=0;for(;B<D;++B){if(C[B].getId()===E){return B}}return -1},getPath:function(C,B){C=C||this.idProperty;B=B||"/";var E=[this.get(C)],D=this.parentNode;while(D){E.unshift(D.get(C));D=D.parentNode}return B+E.join(B)},getDepth:function(){return this.get("depth")},bubble:function(C,D,E){var B=this;while(B){if(C.apply(D||B,E||[B])===false){break}B=B.parentNode}},cascade:function(){if(Ext.isDefined(Ext.global.console)){Ext.global.console.warn("Ext.data.Node: cascade has been deprecated. Please use cascadeBy instead.")}return this.cascadeBy.apply(this,arguments)},cascadeBy:function(I,C,B,D){var G=this;if(arguments.length===1&&!Ext.isFunction(I)){D=I.after;C=I.scope;B=I.args;I=I.before}if(!I||I.apply(C||G,B||[G])!==false){var H=G.childNodes,E=H.length,F;for(F=0;F<E;F++){H[F].cascadeBy.call(H[F],I,C,B,D)}if(D){D.apply(C||G,B||[G])}}},eachChild:function(E,F,G){var C=this.childNodes,B=C.length,D;for(D=0;D<B;D++){if(E.apply(F||this,G||[C[D]])===false){break}}},findChild:function(B,D,C){return this.findChildBy(function(){return this.get(B)==D},null,C)},findChildBy:function(F,C,H){var B=this.childNodes,G=B.length,D=0,E,I;for(;D<G;D++){E=B[D];if(F.call(C||E,E)===true){return E}else{if(H){I=E.findChildBy(F,C,H);if(I!==null){return I}}}}return null},contains:function(B){return B.isAncestor(this)},isAncestor:function(C){var B=this.parentNode;while(B){if(B===C){return true}B=B.parentNode}return false},sort:function(J,G,C){var H=this,B=H.childNodes,D=B.length,E,F,I={isFirst:true};if(D>0){if(!J){J=H.getTreeStore().getSortFn()}Ext.Array.sort(B,J);H.setFirstChild(B[0]);H.setLastChild(B[D-1]);for(E=0;E<D;E++){F=B[E];F.previousSibling=B[E-1];F.nextSibling=B[E+1];I.isLast=(E===D-1);I.index=E;F.updateInfo(false,I);I.isFirst=false;if(G&&!F.isLeaf()){F.sort(J,true,true)}}if(C!==true){H.fireEventArgs("sort",[H,B]);H.callJoined("onNodeSort",[B])}}},isExpanded:function(){return this.get("expanded")},isLoaded:function(){return this.get("loaded")},isLoading:function(){return this.get("loading")},isRoot:function(){return !this.parentNode},isVisible:function(){var B=this.parentNode;while(B){if(!B.isExpanded()){return false}B=B.parentNode}return true},expand:function(D,B,E){var C=this;if(!C.isLeaf()){if(C.isLoading()){C.on("expand",function(){C.expand(D,B,E)},C,{single:true})}else{if(!C.isExpanded()){if(C.fireEventArgs("beforeexpand",[C])!==false){C.callJoined("onBeforeNodeExpand",[C.onChildNodesAvailable,C,[D,B,E]])}}else{if(D){C.expandChildren(true,B,E)}else{Ext.callback(B,E||C,[C.childNodes])}}}}else{Ext.callback(B,E||C)}},onChildNodesAvailable:function(C,E,B,F){var D=this;Ext.suspendLayouts();D.set("expanded",true);D.callJoined("onNodeExpand",[C,false]);D.fireEventArgs("expand",[D,C]);if(E){D.expandChildren(true,B,F)}else{Ext.callback(B,F||D,[D.childNodes])}Ext.resumeLayouts(true)},expandChildren:function(I,G,C,B){var J=this,K,F,L,E,D,H;if(Ext.isBoolean(G)){K=G;G=C;C=B;B=K}if(B===undefined){B=J.getTreeStore().singleExpand}L=J.childNodes;E=[];D=B?Math.min(L.length,1):L.length;for(F=0;F<D;++F){H=L[F];if(!H.isLeaf()){E[E.length]=H}}D=E.length;for(F=0;F<D;++F){E[F].expand(I)}if(G){Ext.callback(G,C||J,[J.childNodes])}},collapse:function(G,B,C){var H=this,D=H.isExpanded(),I=H.childNodes.length,E,F;if(!H.isLeaf()&&((!D&&G)||H.fireEventArgs("beforecollapse",[H])!==false)){Ext.suspendLayouts();if(H.isExpanded()){if(G){F=function(){for(E=0;E<I;E++){H.childNodes[E].setCollapsed(true)}};if(B){B=Ext.Function.createSequence(F,Ext.Function.bind(B,C,[H.childNodes]))}else{B=F}}else{if(B){B=Ext.Function.bind(B,C,[H.childNodes])}}H.set("expanded",false);H.callJoined("onNodeCollapse",[H.childNodes,B,C]);H.fireEventArgs("collapse",[H,H.childNodes]);B=null}else{if(G){for(E=0;E<I;E++){H.childNodes[E].setCollapsed(true)}}}Ext.resumeLayouts(true)}Ext.callback(B,C||H,[H.childNodes])},setCollapsed:function(D){var C=this,E=C.childNodes.length,B;if(!C.isLeaf()&&C.fireEventArgs("beforecollapse",[C])!==false){C.data.expanded=false;C.fireEventArgs("collapse",[C,C.childNodes]);if(D){for(B=0;B<E;B++){C.childNodes[B].setCollapsed(true)}}}},collapseChildren:function(H,B,C){var I=this,E,J=I.childNodes,D=J.length,F=[],G;for(E=0;E<D;++E){G=J[E];if(!G.isLeaf()&&G.isLoaded()&&G.isExpanded()){F.push(G)}}D=F.length;if(D){for(E=0;E<D;++E){G=F[E];if(E===D-1){G.collapse(H,B,C)}else{G.collapse(H)}}}else{Ext.callback(B,C)}},fireEvent:function(B){return this.fireEventArgs(B,Ext.Array.slice(arguments,1))},fireEventArgs:function(D,F){var B=Ext.mixin.Observable.prototype.fireEventArgs,C,E;if(A[D]){for(E=this;C!==false&&E;E=E.parentNode){if(E.hasListeners&&E.hasListeners[D]){C=B.call(E,D,F)}}return C}else{return B.apply(this,arguments)}},serialize:function(){var D=Ext.data.writer.Json.prototype.getRecordData(this),C=this.childNodes,E=C.length,F,B;if(E>0){F=[];for(B=0;B<E;B++){F.push(C[B].serialize())}D.children=F}return D}}}}});
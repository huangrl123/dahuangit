Ext.define("Ext.chart.axis.Axis",{extend:"Ext.chart.axis.Abstract",alternateClassName:"Ext.chart.Axis",requires:["Ext.draw.Draw"],hidden:false,forceMinMax:false,dashSize:3,position:"bottom",skipFirst:false,length:0,width:0,adjustEnd:true,majorTickSteps:false,nullGutters:{lower:0,upper:0,verticalAxis:undefined},applyData:Ext.emptyFn,getRange:function(){var I=this,a=I.chart,L=a.getChartStore(),D=L.data.items,R=a.series.items,W=I.position,X,S=Ext.chart.series,K=[],M=Infinity,Y=-Infinity,N=I.position==="left"||I.position==="right"||I.position==="radial",H,U,V,E,F,B=D.length,O,G={},Q={},A=true,T,Z,J,C,P;T=I.fields;for(E=0,U=T.length;E<U;E++){Q[T[E]]=true}for(H=0,U=R.length;H<U;H++){if(R[H].seriesIsHidden){continue}if(!R[H].getAxesForXAndYFields){continue}X=R[H].getAxesForXAndYFields();if(X.xAxis&&X.xAxis!==W&&X.yAxis&&X.yAxis!==W){continue}if(S.Bar&&R[H] instanceof S.Bar&&!R[H].column){T=N?Ext.Array.from(R[H].xField):Ext.Array.from(R[H].yField)}else{T=N?Ext.Array.from(R[H].yField):Ext.Array.from(R[H].xField)}if(I.fields.length){for(E=0,V=T.length;E<V;E++){if(Q[T[E]]){break}}if(E==V){continue}}if(O=R[H].stacked){if(S.Bar&&R[H] instanceof S.Bar){if(R[H].column!=N){O=false;A=false}}else{if(!N){O=false;A=false}}}if(O){Z={};for(E=0;E<T.length;E++){if(A&&R[H].__excludes&&R[H].__excludes[E]){continue}if(!Q[T[E]]){Ext.Logger.warn("Field `"+T[E]+"` is not included in the "+W+" axis config.")}Q[T[E]]=Z[T[E]]=true}K.push({fields:Z,positiveValue:0,negativeValue:0})}else{if(!T||T.length==0){T=I.fields}for(E=0;E<T.length;E++){if(A&&R[H].__excludes&&R[H].__excludes[E]){continue}Q[T[E]]=G[T[E]]=true}}}for(H=0;H<B;H++){J=D[H];for(F=0;F<K.length;F++){K[F].positiveValue=0;K[F].negativeValue=0}for(C in Q){P=J.get(C);if(I.type=="Time"&&typeof P=="string"){P=Date.parse(P)}if(isNaN(P)){continue}if(P===undefined){P=0}else{P=Number(P)}if(G[C]){if(M>P){M=P}if(Y<P){Y=P}}for(F=0;F<K.length;F++){if(K[F].fields[C]){if(P>=0){K[F].positiveValue+=P;if(Y<K[F].positiveValue){Y=K[F].positiveValue}if(M>0){M=0}}else{K[F].negativeValue+=P;if(M>K[F].negativeValue){M=K[F].negativeValue}if(Y<0){Y=0}}}}}}if(!isFinite(Y)){Y=I.prevMax||0}if(!isFinite(M)){M=I.prevMin||0}if(typeof M==="number"){M=Ext.Number.correctFloat(M)}if(typeof Y==="number"){Y=Ext.Number.correctFloat(Y)}if(M!=Y&&(Y!=Math.floor(Y)||M!=Math.floor(M))){M=Math.floor(M);Y=Math.floor(Y)+1}if(!isNaN(I.minimum)){M=I.minimum}if(!isNaN(I.maximum)){Y=I.maximum}if(M>=Y){M=Math.floor(M);Y=M+1}return{min:M,max:Y}},calcEnds:function(){var F=this,H=F.getRange(),C=H.min,D=H.max,E,A,B,G;E=(Ext.isNumber(F.majorTickSteps)?F.majorTickSteps+1:F.steps);A=!(Ext.isNumber(F.maximum)&&Ext.isNumber(F.minimum)&&Ext.isNumber(F.majorTickSteps)&&F.majorTickSteps>0);B=Ext.draw.Draw.snapEnds(C,D,E,A);if(Ext.isNumber(F.maximum)){B.to=F.maximum;G=true}if(Ext.isNumber(F.minimum)){B.from=F.minimum;G=true}if(F.adjustMaximumByMajorUnit){B.to=Math.ceil(B.to/B.step)*B.step;G=true}if(F.adjustMinimumByMajorUnit){B.from=Math.floor(B.from/B.step)*B.step;G=true}if(G){B.steps=Math.ceil((B.to-B.from)/B.step)}F.prevMin=(C==D?0:C);F.prevMax=D;return B},drawAxis:function(X){var J=this,q,g=J.x,h=J.y,H=J.dashSize,j=J.length,B=J.position,a=(B=="left"||B=="right"),A=[],n=(J.isNumericAxis),S=J.applyData(),T=S.step,Y=S.steps,Q=Ext.isArray(Y),p=S.from,O=S.to,M=(O-p)||1,s,o,t,Z,V=J.minorTickSteps||0,d=J.minorTickSteps||0,N=Math.max(V+1,0),W=Math.max(d+1,0),D=(B=="left"||B=="top"?-1:1),F=H*D,k=J.chart.series.items,K=k[0],r=Ext.clone(K?K.nullGutters:J.nullGutters),E,f,m,C,I,c,R=0,e=0,U,l,b,L,G,P;J.from=p;J.to=O;if(J.hidden||(p>O)){return}if((Q&&(Y.length==0))||(!Q&&isNaN(T))){return}if(Q){Y=Ext.Array.filter(Y,function(u,v,i){return(+u>+J.from&&+u<+J.to)},this);Y=Ext.Array.union([J.from],Y,[J.to])}else{Y=new Array;for(L=+J.from;L<+J.to;L+=T){Y.push(L)}Y.push(+J.to)}e=Y.length;for(q=0,b=k.length;q<b;q++){if(k[q].seriesIsHidden){continue}if(!k[q].getAxesForXAndYFields){continue}l=k[q].getAxesForXAndYFields();if(!l.xAxis||!l.yAxis||(l.xAxis===B)||(l.yAxis===B)){E=Ext.clone(k[q].getGutters());f=(E.verticalAxis!==undefined);m=(f&&(E.verticalAxis==a));if(f){if(!m){C=k[q].getPadding();if(a){E={lower:C.bottom,upper:C.top,verticalAxis:true}}else{E={lower:C.left,upper:C.right,verticalAxis:false}}}if(r.lower<E.lower){r.lower=E.lower}if(r.upper<E.upper){r.upper=E.upper}r.verticalAxis=a}}}if(n){J.labels=[]}if(r){if(a){o=Math.floor(g);Z=["M",o+0.5,h,"l",0,-j];s=j-(r.lower+r.upper);for(U=0;U<e;U++){t=h-r.lower-(Y[U]-Y[0])*s/M;Z.push("M",o,Math.floor(t)+0.5,"l",F*2,0);A.push([o,Math.floor(t)]);if(n){J.labels.push(Y[U])}}}else{t=Math.floor(h);Z=["M",g,t+0.5,"l",j,0];s=j-(r.lower+r.upper);for(U=0;U<e;U++){o=g+r.lower+(Y[U]-Y[0])*s/M;Z.push("M",Math.floor(o)+0.5,t,"l",0,F*2+1);A.push([Math.floor(o),t]);if(n){J.labels.push(Y[U])}}}}I=(a?d:V);if(Ext.isArray(I)){if(I.length==2){c=+Ext.Date.add(new Date(),I[0],I[1])-Date.now()}else{c=I[0]}}else{if(Ext.isNumber(I)&&I>0){c=T/(I+1)}}if(r&&c){for(U=0;U<e-1;U++){G=+Y[U];P=+Y[U+1];if(a){for(value=G+c;value<P;value+=c){t=h-r.lower-(value-Y[0])*s/M;Z.push("M",o,Math.floor(t)+0.5,"l",F,0)}}else{for(value=G+c;value<P;value+=c){o=g+r.upper+(value-Y[0])*s/M;Z.push("M",Math.floor(o)+0.5,t,"l",0,F+1)}}}}if(!J.axis){J.axis=J.chart.surface.add(Ext.apply({type:"path",path:Z},J.axisStyle))}J.axis.setAttributes({path:Z},true);J.inflections=A;if(!X&&J.grid){J.drawGrid()}J.axisBBox=J.axis.getBBox();J.drawLabel()},drawGrid:function(){var H=this,L=H.chart.surface,B=H.grid,N=B.odd,Q=B.even,F=H.inflections,J=F.length-((N||Q)?0:1),R=H.position,A=H.chart.maxGutters,M=H.width-2,C,I,G=1,K=[],O,P,S,E=[],D=[];if(((A.bottom!==0||A.top!==0)&&(R=="left"||R=="right"))||((A.left!==0||A.right!==0)&&(R=="top"||R=="bottom"))){G=0;J++}for(;G<J;G++){C=F[G];I=F[G-1];if(N||Q){K=(G%2)?E:D;O=((G%2)?N:Q)||{};P=(O.lineWidth||O["stroke-width"]||0)/2;S=2*P;if(R=="left"){K.push("M",I[0]+1+P,I[1]+0.5-P,"L",I[0]+1+M-P,I[1]+0.5-P,"L",C[0]+1+M-P,C[1]+0.5+P,"L",C[0]+1+P,C[1]+0.5+P,"Z")}else{if(R=="right"){K.push("M",I[0]-P,I[1]+0.5-P,"L",I[0]-M+P,I[1]+0.5-P,"L",C[0]-M+P,C[1]+0.5+P,"L",C[0]-P,C[1]+0.5+P,"Z")}else{if(R=="top"){K.push("M",I[0]+0.5+P,I[1]+1+P,"L",I[0]+0.5+P,I[1]+1+M-P,"L",C[0]+0.5-P,C[1]+1+M-P,"L",C[0]+0.5-P,C[1]+1+P,"Z")}else{K.push("M",I[0]+0.5+P,I[1]-P,"L",I[0]+0.5+P,I[1]-M+P,"L",C[0]+0.5-P,C[1]-M+P,"L",C[0]+0.5-P,C[1]-P,"Z")}}}}else{if(R=="left"){K=K.concat(["M",C[0]+0.5,C[1]+0.5,"l",M,0])}else{if(R=="right"){K=K.concat(["M",C[0]-0.5,C[1]+0.5,"l",-M,0])}else{if(R=="top"){K=K.concat(["M",C[0]+0.5,C[1]+0.5,"l",0,M])}else{K=K.concat(["M",C[0]+0.5,C[1]-0.5,"l",0,-M])}}}}}if(N||Q){if(E.length){if(!H.gridOdd&&E.length){H.gridOdd=L.add({type:"path",path:E})}H.gridOdd.setAttributes(Ext.apply({path:E,hidden:false},N||{}),true)}if(D.length){if(!H.gridEven){H.gridEven=L.add({type:"path",path:D})}H.gridEven.setAttributes(Ext.apply({path:D,hidden:false},Q||{}),true)}}else{if(K.length){if(!H.gridLines){H.gridLines=H.chart.surface.add({type:"path",path:K,"stroke-width":H.lineWidth||1,stroke:H.gridColor||"#ccc"})}H.gridLines.setAttributes({hidden:false,path:K},true)}else{if(H.gridLines){H.gridLines.hide(true)}}}},getOrCreateLabel:function(B,D){var E=this,C=E.labelGroup,A=C.getAt(B),F=E.chart.surface;if(A){if(D!=A.attr.text){A.setAttributes(Ext.apply({text:D},E.label),true);A._bbox=A.getBBox()}}else{A=F.add(Ext.apply({group:C,type:"text",x:0,y:0,text:D},E.label));F.renderItem(A);A._bbox=A.getBBox()}if(E.label.rotation){A.setAttributes({rotation:{degrees:0}},true);A._ubbox=A.getBBox();A.setAttributes(E.label,true)}else{A._ubbox=A._bbox}return A},rect2pointArray:function(A){var G=this.chart.surface,D=G.getBBox(A,true),I=[D.x,D.y],H=I.slice(),J=[D.x+D.width,D.y],F=J.slice(),L=[D.x+D.width,D.y+D.height],B=L.slice(),E=[D.x,D.y+D.height],K=E.slice(),C=A.matrix;I[0]=C.x.apply(C,H);I[1]=C.y.apply(C,H);J[0]=C.x.apply(C,F);J[1]=C.y.apply(C,F);L[0]=C.x.apply(C,B);L[1]=C.y.apply(C,B);E[0]=C.x.apply(C,K);E[1]=C.y.apply(C,K);return[I,J,L,E]},intersect:function(C,D){var B=this.rect2pointArray(C),A=this.rect2pointArray(D);return !!Ext.draw.Draw.intersect(B,A).length},drawHorizontalLabels:function(){var I=this,R=I.label,P=Math.floor,Y=Math.max,X=I.chart.axes,D=I.chart.insetPadding,b=I.chart.maxGutters,W=I.position,F=I.inflections,V=F.length,A=I.labels,K=0,T,L,C,a,N,U=I.adjustEnd,c=X.findIndex("position","left")!=-1,J=X.findIndex("position","right")!=-1,H=I.reverse,M,Q,E,S,O,Z,G,B;S=V-1;C=F[0];B=I.getOrCreateLabel(0,I.label.renderer(A[0]));T=Math.floor(Math.abs(Math.sin(R.rotate&&(R.rotate.degrees*Math.PI/180)||0)));for(G=0;G<V;G++){C=F[G];E=G;if(H){E=V-G-1}Q=I.label.renderer(A[E]);M=I.getOrCreateLabel(G,Q);L=M._bbox;K=Y(K,L.height+I.dashSize+I.label.padding);O=P(C[0]-(T?L.height:L.width)/2);if(U&&b.left==0&&b.right==0){if(G==0&&!c){O=C[0]}else{if(G==S&&!J){O=Math.min(O,C[0]-L.width+D)}}}if(W=="top"){Z=C[1]-(I.dashSize*2)-I.label.padding-(L.height/2)}else{Z=C[1]+(I.dashSize*2)+I.label.padding+(L.height/2)}M.setAttributes({hidden:false,x:O,y:Z},true);if(G!=0&&(I.intersect(M,a)||I.intersect(M,B))){if(G===S&&N!==0){a.hide(true)}else{M.hide(true);continue}}a=M;N=G}return K},drawVerticalLabels:function(){var G=this,E=G.inflections,U=G.position,T=E.length,W=G.chart,D=W.insetPadding,A=G.labels,H=0,S=Math.max,O=Math.floor,J=Math.ceil,V=G.chart.axes,Z=G.chart.maxGutters,K,C,Y,M,N=V.findIndex("position","top")!=-1,P=V.findIndex("position","bottom")!=-1,Q=G.adjustEnd,L,B,R=T-1,I,X,F;for(F=0;F<T;F++){C=E[F];B=G.label.renderer(A[F]);L=G.getOrCreateLabel(F,B);K=L._bbox;H=S(H,K.width+G.dashSize+G.label.padding);X=C[1];if(Q&&(Z.bottom+Z.top)<K.height/2){if(F==R&&!N){X=Math.max(X,G.y-G.length+J(K.height/2)-D)}else{if(F==0&&!P){X=G.y+Z.bottom-O(K.height/2)}}}if(U=="left"){I=C[0]-K.width-G.dashSize-G.label.padding-2}else{I=C[0]+G.dashSize+G.label.padding+2}L.setAttributes(Ext.apply({hidden:false,x:I,y:X},G.label),true);if(F!=0&&G.intersect(L,Y)){if(F===R&&M!==0){Y.hide(true)}else{L.hide(true);continue}}Y=L;M=F}return H},drawLabel:function(){var A=this,D=A.position,B=A.labelGroup,F=A.inflections,E=0,G=0,C,H;if(D=="left"||D=="right"){E=A.drawVerticalLabels()}else{G=A.drawHorizontalLabels()}C=B.getCount();H=F.length;for(;H<C;H++){B.getAt(H).hide(true)}A.bbox={};Ext.apply(A.bbox,A.axisBBox);A.bbox.height=G;A.bbox.width=E;if(Ext.isString(A.title)){A.drawTitle(E,G)}},setTitle:function(A){this.title=A;this.drawLabel()},drawTitle:function(H,K){var J=this,G=J.position,I=J.titleAlign,E=J.chart.surface,A=J.displaySprite,D=J.title,F=(G=="left"||G=="right"),N=J.x,L=J.y,B,M,C;if(A){A.setAttributes({text:D},true)}else{B={type:"text",x:0,y:0,text:D};A=J.displaySprite=E.add(Ext.apply(B,J.axisTitleStyle,J.labelTitle));E.renderItem(A)}M=A.getBBox();C=J.dashSize+J.label.padding;if(F){if(I==="end"){L-=J.length-M.height}else{if(!I||I==="center"){L-=((J.length/2)-(M.height/2))}}if(G=="left"){N-=(H+C+(M.width/2))}else{N+=(H+C+M.width-(M.width/2))}J.bbox.width+=M.width+10}else{if(I==="end"||(J.reverse&&I==="start")){N+=J.length-M.width}else{if(!I||I==="center"){N+=(J.length/2)-(M.width*0.5)}}if(G=="top"){L-=(K+C+(M.height*0.3))}else{L+=(K+C+(M.height*0.8))}J.bbox.height+=M.height+10}A.setAttributes({translate:{x:N,y:L}},true)}});
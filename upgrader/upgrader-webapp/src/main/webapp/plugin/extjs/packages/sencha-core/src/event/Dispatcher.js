Ext.define("Ext.event.Dispatcher",{requires:["Ext.event.ListenerStack","Ext.event.Controller"],statics:{getInstance:function(){if(!this.instance){this.instance=new this()}return this.instance},setInstance:function(A){this.instance=A;return this}},baseHasListeners:{_decr_:function(A){if(!--this[A]){delete this[A]}},_incr_:function(A){if(this.hasOwnProperty(A)){++this[A]}else{this[A]=1}}},hasListeners:{},config:{publishers:{}},wildcard:"*",constructor:function(A){this.listenerStacks={};this.captureListenerStacks={};this.directListenerStacks={};this.activePublishers={};this.publishersCache={};this.noActivePublishers=[];this.controller=null;this.initConfig(A);return this},getListenerStack:function(B,D,C,A){return this.doGetListenerStack(this.listenerStacks,B,D,C,A)},getCaptureListenerStack:function(B,D,C,A){return this.doGetListenerStack(this.captureListenerStacks,B,D,C,A)},getDirectListenerStack:function(B,D,C,A){return this.doGetListenerStack(this.directListenerStacks,B,D,C,A)},doGetListenerStack:function(E,D,F,C,A){var B=E[D],G;if(!B){if(A){E[D]=B={}}else{return null}}B=B[F];if(!B){if(A){E[D][F]=B={}}else{return null}}G=B[C];if(!G){if(A){B[C]=G=new Ext.event.ListenerStack()}else{return null}}return G},getController:function(D,F,E,G){var B=this,A=B.controller,C={targetType:D,target:F,eventName:E};if(!A){B.controller=A=new Ext.event.Controller(B)}if(A.isFiring){A=new Ext.event.Controller(B)}A.setInfo(C);if(G&&A!==G){A.connect(G)}return A},applyPublishers:function(C){var A,B;this.publishersCache={};for(A in C){if(C.hasOwnProperty(A)){B=C[A];this.registerPublisher(B)}}return C},registerPublisher:function(A){var C=this.activePublishers,B=A.getTargetType(),D=C[B];if(!D){C[B]=D=[]}D.push(A);A.setDispatcher(this);return this},getCachedActivePublishers:function(B,C){var A=this.publishersCache,D;if((D=A[B])&&(D=D[C])){return D}return null},cacheActivePublishers:function(B,C,D){var A=this.publishersCache;if(!A[B]){A[B]={}}A[B][C]=D;return D},getActivePublishers:function(H,D){var G=this.getCachedActivePublishers(H,D),F,C,E,B,A;if(G){return G}F=this.activePublishers[H];if(F){G=[];for(E=0,B=F.length;E<B;E++){A=F[E];if(A.handles(D)){G.push(A)}}if(!G.length&&H==="element"){C=this.getPublisher("dom");if(C){G.push(C)}}}else{G=this.noActivePublishers}return this.cacheActivePublishers(H,D,G)},hasListener:function(C,F,D){var A=this.getListenerStack(C,F,D),B=this.getCaptureListenerStack(C,F,D),E=false;if(A){E=A.count()>0}if(!E&&C==="element"){E=B.count()>0}return E},getHasListeners:function(A,B){var D=this.hasListeners,C=B&&B.hasListeners;if(!C){C=D[A]||(D[A]=Ext.Object.chain(this.baseHasListeners));if(B){B.hasListeners=C=Ext.Object.chain(C)}}return C},addListener:function(I,J,D,G,B,E,L,F){E=E||{};var H=this.getActivePublishers(I,D),C=H.length,K,A;A=this.doAddListener(I,J,D,G,B,E,L,F);if(A){for(K=0;K<C;K++){H[K].subscribe(J,D,E,F)}}return A},doAddListener:function(H,I,D,G,B,E,K,F){E=E||{};var A=this,J,C;if(H==="element"){if(E.capture){J=A.getCaptureListenerStack(H,I,D,true)}else{C=A.getPublisher("dom");if(E.delegated===false||C.directEvents[D]||(!C.isTargetWin&&I==="#ext-window")){J=A.getDirectListenerStack(H,I,D,true)}}}if(!J){J=A.getListenerStack(H,I,D,true)}A.getHasListeners(H,F)._incr_(D);return J.add(G,B,E,K,F)},removeListener:function(I,J,D,G,B,E,L,F){E=E||{};var H=this.getActivePublishers(I,D),C=H.length,K,A;A=this.doRemoveListener(I,J,D,G,B,E,L,F);if(A){for(K=0;K<C;K++){H[K].unsubscribe(J,D,null,E,F)}}return A},doRemoveListener:function(H,I,D,G,B,E,K,F){E=E||{};var A=this,J,C;if(H==="element"){if(E.capture){J=A.getCaptureListenerStack(H,I,D)}else{C=A.getPublisher("dom");if(E.delegated===false||C.directEvents[D]||(!C.isTargetWin&&I==="#ext-window")){J=A.getDirectListenerStack(H,I,D)}}}if(!J){J=A.getListenerStack(H,I,D)}if(J&&J.remove(G,B,K)){A.getHasListeners(H,F)._decr_(D);return true}return false},clearListeners:function(C,F,A){var D=this,E=D.listenerStacks[C],B=D.captureListenerStacks[C],G;if(E){D.doClearListeners(E,C,F,{},A)}if(B){D.doClearListeners(B,C,F,{capture:true},A)}if(A){G=D.directListenerStacks[C];if(G){D.doClearListeners(G,C,F,{delegated:false},A)}}},doClearListeners:function(G,I,J,E,F){var A=this,H=G[J],L=A.getHasListeners(I,F),D,K,C,B;if(H){for(D in H){B=A.getActivePublishers(I,D);for(K=0,C=B.length;K<C;K++){B[K].unsubscribe(J,D,true,E,F)}if(!(L[D]-=H[D].length)){delete L[D]}}delete G[J]}},dispatchEvent:function(C,E,D){var F=this.getActivePublishers(C,D),B=F.length,A;if(B>0){for(A=0;A<B;A++){F[A].notify(E,D)}}return this.doDispatchEvent.apply(this,arguments)},doDispatchEvent:function(G,H,D,B,J,F,A){var I=A?this.getCaptureListenerStack(G,H,D):this.getListenerStack(G,H,D,A),C=this.getWildcardListenerStacks(G,H,D,A),E;if(!I||!I.length){if(!C.length&&!J){return}}else{C.push(I)}E=this.getController(G,H,D,F);E.setListenerStacks(C);E.fire(B,J);return !E.isInterrupted()},dispatchDirectEvent:function(C,E,D,F){var B=this.getDirectListenerStack(C,E,D),A;if(B&&B.length){A=this.getController(C,E,D);A.setListenerStacks([B]);A.fire(F);return !A.isInterrupted()}},getWildcardListenerStacks:function(F,G,C,A){var E=[],B=this.wildcard,H=C!==B,D=G!==B,I;if(H&&(I=this.getListenerStack(F,G,B,A))){E.push(I)}if(D&&(I=this.getListenerStack(F,B,C,A))){E.push(I)}return E},getPublisher:function(A){return this.getPublishers()[A]},destroy:function(){var A=this.getPublishers(),B;for(B in A){A[B].destroy()}}});
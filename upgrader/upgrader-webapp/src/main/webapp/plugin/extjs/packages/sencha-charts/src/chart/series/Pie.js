Ext.define("Ext.chart.series.Pie",{extend:"Ext.chart.series.Polar",requires:["Ext.chart.series.sprite.PieSlice"],type:"pie",alias:"series.pie",seriesType:"pieslice",config:{labelField:false,lengthField:false,donut:0,field:null,rotation:0,clockwise:true,totalAngle:2*Math.PI,hidden:[],radiusFactor:100,highlightCfg:{margin:20},style:{}},directions:["X"],setField:function(A){return this.setXField(A)},getField:function(){return this.getXField()},applyRadius:function(A){return A*this.getRadiusFactor()*0.01},updateLabelData:function(){var F=this,C=F.getStore(),H=C.getData().items,G=F.getSprites(),I=F.getLabel().getTemplate().getField(),A=F.getHidden(),E,B,J,D;if(G.length>0&&I){J=[];for(E=0,B=H.length;E<B;E++){J.push(H[E].get(I))}for(E=0,B=G.length;E<B;E++){D=G[E];D.setAttributes({label:J[E]});D.putMarker("labels",{hidden:A[E]},D.attr.attributeId)}}},coordinateX:function(){var F=this,G=F.getStore(),M=G.getData().items,K=M.length,C=F.getXField(),J=F.getLengthField(),P,I=0,A,B=0,H=F.getHidden(),Q=[],E,O=0,N=F.getTotalAngle(),D=F.getClockwise()?1:-1,L=F.getSprites();if(!L){return}for(E=0;E<K;E++){P=Math.abs(Number(M[E].get(C)))||0;A=J&&Math.abs(Number(M[E].get(J)))||0;if(!H[E]){I+=P;if(A>B){B=A}}Q[E]=I;if(E>=H.length){H[E]=false}}F.maxLength=B;if(I!==0){I=N/I}for(E=0;E<K;E++){L[E].setAttributes({startAngle:O,endAngle:O=(I?D*Q[E]*I:0),globalAlpha:1})}for(;E<F.sprites.length;E++){L[E].setAttributes({startAngle:N,endAngle:N,globalAlpha:0})}F.getChart().refreshLegendStore()},updateCenter:function(A){this.setStyle({translationX:A[0]+this.getOffsetX(),translationY:A[1]+this.getOffsetY()});this.doUpdateStyles()},updateRadius:function(A){this.setStyle({startRho:A*this.getDonut()*0.01,endRho:A});this.doUpdateStyles()},getStyleByIndex:function(D){var G=this,H=G.getStore().getData().items,A=G.getLengthField(),F=G.getRadius(),E,C,B,I;C=A&&Math.abs(Number(H[D].get(A)))||0;B=F*G.getDonut()*0.01;I=F;E=this.callParent([D]);E.startRho=B;E.endRho=G.maxLength?(B+(I-B)*C/G.maxLength):I;return E},updateDonut:function(B){var A=this.getRadius();this.setStyle({startRho:A*B*0.01,endRho:A});this.doUpdateStyles()},rotationOffset:-0.5*Math.PI,updateRotation:function(A){this.setStyle({rotationRads:A+this.rotationOffset});this.doUpdateStyles()},updateTotalAngle:function(A){this.processData()},getSprites:function(){var K=this,C=K.getChart(),A=K.getStore();if(!C||!A){return[]}K.getColors();K.getSubStyle();var M=A.getData().items,E=M.length,N=K.getAnimation()||C&&C.getAnimation(),L=K.sprites,F,H=0,B,G,I=false,J=K.getLabel(),D=J.getTemplate();B={store:A,field:K.getField(),series:K};for(G=0;G<E;G++){F=L[G];if(!F){F=K.createSprite();if(K.getHighlight()){F.config.highlight=K.getHighlight();F.addModifier("highlight",true)}if(D.getField()){D.setAttributes({labelOverflowPadding:K.getLabelOverflowPadding()});D.fx.setCustomDuration({"callout":200});F.bindMarker("labels",J)}F.setAttributes(K.getStyleByIndex(G));F.rendererData=B;F.rendererIndex=H++;I=true}F.fx.setConfig(N)}if(I){K.doUpdateStyles()}return K.sprites},betweenAngle:function(C,E,D){var B=Math.PI*2,A=this.rotationOffset;if(!this.getClockwise()){C*=-1;E*=-1;D*=-1;E-=A;D-=A}else{E+=A;D+=A}D-=E;C-=E;C%=B;D%=B;C+=B;D+=B;C%=B;D%=B;return C<D},getItemForAngle:function(G){var A=this,H=A.getSprites(),D;G%=Math.PI*2;while(G<0){G+=Math.PI*2}if(H){var E=A.getStore(),I=E.getData().items,B=A.getHidden(),F=0,C=E.getCount();for(;F<C;F++){if(!B[F]){D=H[F].attr;if(D.startAngle<=G&&D.endAngle>=G){return{series:A,sprite:H[F],index:F,record:I[F],field:A.getXField()}}}}}return null},getItemForPoint:function(Q,R){var H=this,O=H.getSprites();if(O){var S=H.getCenter(),C=H.getOffsetX(),D=H.getOffsetY(),T=Q-S[0]+C,A=R-S[1]+D,I=H.getStore(),E=H.getDonut(),L=I.getData().items,G=Math.atan2(A,T)-H.getRotation(),K=Math.sqrt(T*T+A*A),F=H.getRadius(),M=E/100*F,B=H.getHidden(),P,N,J;for(P=0,N=L.length;P<N;P++){if(!B[P]){J=O[P].attr;if(K>=M+J.margin&&K<=J.endRho+J.margin){if(H.betweenAngle(G,J.startAngle,J.endAngle)){return{series:H,sprite:O[P],index:P,record:L[P],field:H.getXField()}}}}}return null}},provideLegendInfo:function(F){var B=this.getStore();if(B){var G=B.getData().items,H=this.getLabel().getTemplate().getField(),E=this.getField(),A=this.getHidden(),D;for(var C=0;C<G.length;C++){D=this.getStyleByIndex(C);F.push({name:H?String(G[C].get(H)):E+" "+C,mark:D.fillStyle||D.strokeStyle||"black",disabled:A[C],series:this.getId(),index:C})}}}});
Ext.define("Ext.data.writer.Json",{extend:"Ext.data.writer.Writer",alternateClassName:"Ext.data.JsonWriter",alias:"writer.json",config:{rootProperty:undefined,encode:false,allowSingle:true,expandData:false},constructor:function(A){if(A&&A.hasOwnProperty("root")){A=Ext.apply({},A);A.rootProperty=A.root;delete A.root;Ext.log.warn('Ext.data.writer.Json: Using the deprecated "root" configuration. Use "rootProperty" instead.')}this.callParent([A])},getExpandedData:function(B){var E=B.length,F=0,I,A,D,C,H,G=function(K,L){var J={};J[K]=L;return J};for(;F<E;F++){I=B[F];for(A in I){if(I.hasOwnProperty(A)){D=A.split(".");C=D.length-1;if(C>0){H=I[A];for(;C>0;C--){H=G(D[C],H)}I[D[0]]=I[D[0]]||{};Ext.Object.merge(I[D[0]],H);delete I[A]}}}}return B},writeRecords:function(C,G){var E=this,B=E.getRootProperty(),D,A,F;if(E.getExpandData()){G=E.getExpandedData(G)}if(E.getAllowSingle()&&G.length===1){G=G[0];A=true}F=this.getTransform();if(F){G=F(G,C);C.setJsonData(G)}if(E.getEncode()){if(B){C.setParam(B,Ext.encode(G))}else{Ext.Error.raise("Must specify a root when using encode")}}else{if(A||(G&&G.length)){D=C.getJsonData()||{};if(B){D[B]=G}else{D=G}C.setJsonData(D)}}return C}});
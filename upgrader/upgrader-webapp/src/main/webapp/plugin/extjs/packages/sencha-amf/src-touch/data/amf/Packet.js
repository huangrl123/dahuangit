Ext.define("Ext.data.amf.Packet",{config:{headers:[],messages:[],version:0},typeMap:{0:{0:"readDouble",1:"readBoolean",2:"readAmf0String",3:"readAmf0Object",5:"readNull",6:"readUndefined",7:"readReference",8:"readEcmaArray",10:"readStrictArray",11:"readAmf0Date",12:"readLongString",13:"readUnsupported",15:"readAmf0Xml",16:"readTypedObject"},3:{0:"readUndefined",1:"readNull",2:"readFalse",3:"readTrue",4:"readUInt29",5:"readDouble",6:"readAmf3String",7:"readAmf3Xml",8:"readAmf3Date",9:"readAmf3Array",10:"readAmf3Object",11:"readAmf3Xml",12:"readByteArray"}},decode:function(F){var D=this,A=[],B=[],C,E;D.twoPowN52=Math.pow(2,-52);D.twoPow8=Math.pow(2,8);D.setHeaders(A);D.setMessages(B);D.pos=0;if(F instanceof ArrayBuffer){F=new Uint8Array(F)}D.bytes=F;D.strings=[];D.objects=[];D.traits=[];D.setVersion(D.readUInt(2));for(C=D.readUInt(2);C--;){D.getHeaders().push({name:D.readAmf0String(),mustUnderstand:D.readBoolean(),byteLength:D.readUInt(4),value:D.readValue()});D.strings=[];D.objects=[];D.traits=[]}for(E=D.readUInt(2);E--;){D.getMessages().push({targetURI:D.readAmf0String(),responseURI:D.readAmf0String(),byteLength:D.readUInt(4),body:D.readValue()});D.strings=[];D.objects=[];D.traits=[]}D.pos=0;D.bytes=D.strings=D.objects=D.traits=null;return D},decodeValue:function(B){var A=this;A.bytes=B;A.pos=0;A.setVersion(3);A.strings=[];A.objects=[];A.traits=[];return A.readValue()},parseXml:function(A){var B;if(window.DOMParser){B=(new DOMParser()).parseFromString(A,"text/xml")}else{B=new ActiveXObject("Microsoft.XMLDOM");B.loadXML(A)}return B},readAmf0Date:function(){var A=new Date(this.readDouble());this.pos+=2;return A},readAmf0Object:function(B){var C=this,A;B=B||{};C.objects.push(B);while((A=C.readAmf0String())||C.bytes[C.pos]!==9){B[A]=C.readValue()}C.pos++;return B},readAmf0String:function(){return this.readUtf8(this.readUInt(2))},readAmf0Xml:function(){return this.parseXml(this.readLongString())},readAmf3Array:function(){var E=this,B=E.readUInt29(),C,A,F,D;if(B&1){C=(B>>1);A=E.readAmf3String();if(A){F={};E.objects.push(F);do{F[A]=E.readValue()}while((A=E.readAmf3String()));for(D=0;D<C;D++){F[D]=E.readValue()}}else{F=[];E.objects.push(F);for(D=0;D<C;D++){F.push(E.readValue())}}}else{F=E.objects[B>>1]}return F},readAmf3Date:function(){var B=this,A=B.readUInt29(),C;if(A&1){C=new Date(B.readDouble());B.objects.push(C)}else{C=B.objects[A>>1]}return C},readAmf3Object:function(){var G=this,J=G.readUInt29(),A=[],K,C,I,L,B,D,H,F,E;if(J&1){K=(J&7);if(K===3){I=G.readAmf3String();L=!!(J&8);C=(J>>4);for(E=0;E<C;E++){A.push(G.readAmf3String())}B={className:I,dynamic:L,members:A};G.traits.push(B)}else{if((J&3)===1){B=G.traits[J>>2];I=B.className;L=B.dynamic;A=B.members;C=A.length}else{if(K===7){}}}if(I){F=Ext.ClassManager.getByAlias("amf."+I);D=F?new F():{$className:I}}else{D={}}G.objects.push(D);for(E=0;E<C;E++){D[A[E]]=G.readValue()}if(L){while((H=G.readAmf3String())){D[H]=G.readValue()}}if((!F)&&this.converters[I]){D=this.converters[I](D)}}else{D=G.objects[J>>1]}return D},readAmf3String:function(){var B=this,A=B.readUInt29(),C;if(A&1){C=B.readUtf8(A>>1);if(C){B.strings.push(C)}return C}else{return B.strings[A>>1]}},readAmf3Xml:function(){var B=this,A=B.readUInt29(),C;if(A&1){C=B.parseXml(B.readUtf8(A>>1));B.objects.push(C)}else{C=B.objects[A>>1]}return C},readBoolean:function(){return !!this.bytes[this.pos++]},readByteArray:function(){var B=this.readUInt29(),C,A;if(B&1){A=this.pos+(B>>1);C=Array.prototype.slice.call(this.bytes,this.pos,A);this.objects.push(C);this.pos=A}else{C=this.objects[B>>1]}return C},readDouble:function(){var D=this.bytes[this.pos++],E=this.bytes[this.pos++],C=(D>>7)?-1:1,A=(((D&127)<<4)|(E>>4)),F=(E&15),G=A?1:0,B=6;while(B--){F=(F*this.twoPow8)+this.bytes[this.pos++]}if(!A){if(!F){return 0}A=1}if(A===2047){return F?NaN:(Infinity*C)}return C*Math.pow(2,A-1023)*(G+this.twoPowN52*F)},readEcmaArray:function(){this.pos+=4;return this.readAmf0Object()},readFalse:function(){return false},readLongString:function(){return this.readUtf8(this.readUInt(4))},readNull:function(){return null},readReference:function(){return this.objects[this.readUInt(2)]},readStrictArray:function(){var A=this,B=A.readUInt(4),C=[];A.objects.push(C);while(B--){C.push(A.readValue())}return C},readTrue:Ext.returnTrue,readTypedObject:function(){var D=this,A=D.readAmf0String(),E,C,B;E=Ext.ClassManager.getByAlias("amf."+A);C=E?new E():{$className:A};B=D.readAmf0Object(C);if((!E)&&this.converters[A]){B=this.converters[A](C)}return B},readUInt:function(C){var A=1,B;B=this.bytes[this.pos++];for(;A<C;++A){B=(B<<8)|this.bytes[this.pos++]}return B},readUInt29:function(){var B=this.bytes[this.pos++],A;if(B&128){A=this.bytes[this.pos++];B=((B&127)<<7)|(A&127);if(A&128){A=this.bytes[this.pos++];B=(B<<7)|(A&127);if(A&128){A=this.bytes[this.pos++];B=(B<<8)|A}}}return B},readUndefined:Ext.emptyFn,readUnsupported:Ext.emptyFn,readUtf8:function(E){var H=this.pos+E,B=[],D=0,J=65535,F=1,A=[],G=0,K,C,I;K=[B];while(this.pos<H){I=this.bytes[this.pos++];if(I>127){if(I>239){C=4;I=(I&7)}else{if(I>223){C=3;I=(I&15)}else{C=2;I=(I&31)}}while(--C){I=((I<<6)|(this.bytes[this.pos++]&63))}}B.push(I);if(++D===J){K.push(B=[]);D=0;F++}}for(;G<F;G++){A.push(String.fromCharCode.apply(String,K[G]))}return A.join("")},readValue:function(){var B=this,A=B.bytes[B.pos++];if(A===17){B.setVersion(3);A=B.bytes[B.pos++]}return B[B.typeMap[B.getVersion()][A]]()},converters:{"flex.messaging.io.ArrayCollection":function(A){return A.source||[]}}});
Ext.define("Ext.chart.series.Bar",{extend:"Ext.chart.series.Cartesian",alternateClassName:["Ext.chart.BarSeries","Ext.chart.BarChart","Ext.chart.StackedBarChart"],requires:["Ext.chart.axis.Axis","Ext.fx.Anim"],type:"bar",alias:"series.bar",column:false,style:{},gutter:38.2,groupGutter:38.2,xPadding:0,yPadding:10,defaultRotate:{x:0,y:0,degrees:0},constructor:function(C){this.callParent(arguments);var D=this,F=D.chart.surface,A=D.chart.shadow,B,E;C.highlightCfg=Ext.Object.merge({lineWidth:3,stroke:"#55c",opacity:0.8,color:"#f00"},C.highlightCfg);Ext.apply(D,C,{shadowAttributes:[{"stroke-width":6,"stroke-opacity":0.05,stroke:"rgb(200, 200, 200)",translate:{x:1.2,y:1.2}},{"stroke-width":4,"stroke-opacity":0.1,stroke:"rgb(150, 150, 150)",translate:{x:0.9,y:0.9}},{"stroke-width":2,"stroke-opacity":0.15,stroke:"rgb(100, 100, 100)",translate:{x:0.6,y:0.6}}]});D.group=F.getGroup(D.seriesId+"-bars");if(A){for(B=0,E=D.shadowAttributes.length;B<E;B++){D.shadowGroups.push(F.getGroup(D.seriesId+"-shadows"+B))}}},getPadding:function(){var B=this,D=B.xPadding,C=B.yPadding,A={};if(Ext.isNumber(D)){A.left=D;A.right=D}else{if(Ext.isObject(D)){A.left=D.left;A.right=D.right}else{A.left=0;A.right=0}}A.width=A.left+A.right;if(Ext.isNumber(C)){A.bottom=C;A.top=C}else{if(Ext.isObject(C)){A.bottom=C.bottom;A.top=C.top}else{A.bottom=0;A.top=0}}A.height=A.bottom+A.top;return A},getBarGirth:function(){var D=this,A=D.chart.getChartStore(),G=D.column,B=A.getCount(),C=D.gutter/100,F,E;E=(G?"width":"height");if(D.style&&D.style[E]){D.configuredColumnGirth=true;return +D.style[E]}F=D.getPadding();return(D.chart.chartBBox[E]-F[E])/(B*(C+1)-C)},getGutters:function(){var E=this,F=E.column,B=E.getPadding(),A=E.getBarGirth()/2,D=Math.ceil((F?B.left:B.bottom)+A),C=Math.ceil((F?B.right:B.top)+A);return{lower:D,upper:C,verticalAxis:!F}},getBounds:function(){var O=this,N=O.chart,c=N.getChartStore(),n=c.data.items,o,f,J,p=[].concat(O.yField),S=[],r=p.length,B=r,L=O.groupGutter/100,V=O.column,E=O.getPadding(),T=O.stacked,W=O.getBarGirth(),I=V?"width":"height",g=Math,k=g.min,C=g.max,R=g.abs,P=O.getAxesForXAndYFields(),e=P.yAxis,D,U,Y,a,q,d,H,F,M,K,X,b,Z,v,Q,l,s,m,t,G,A,u,h;O.setBBox(true);M=O.bbox;if(O.__excludes){for(m=0,l=O.__excludes.length;m<l;m++){if(O.__excludes[m]){B--}}}b=N.axes.get(e);if(b){d=b.applyData();K=d.from;X=d.to}if(O.yField&&!Ext.isNumber(K)){Z=O.getMinMaxYValues();K=Z[0];X=Z[1]}if(!Ext.isNumber(K)){K=0}if(!Ext.isNumber(X)){X=0}v=(V?M.height-E.height:M.width-E.width)/(X-K);H=W;F=(W/((T?1:B)*(L+1)-L));if(I in O.style){F=k(F,O.style[I]);H=F*((T?1:B)*(L+1)-L)}Q=(V)?M.y+M.height-E.bottom:M.x+E.left;if(T){l=[[],[]];for(o=0,f=n.length;o<f;o++){J=n[o];l[0][o]=l[0][o]||0;l[1][o]=l[1][o]||0;for(m=0;m<r;m++){if(O.__excludes&&O.__excludes[m]){continue}s=J.get(p[m]);l[+(s>0)][o]+=R(s)}}l[+(X>0)].push(R(X));l[+(K>0)].push(R(K));G=C.apply(g,l[0]);t=C.apply(g,l[1]);v=(V?M.height-E.height:M.width-E.width)/(t+G);Q=Q+G*v*(V?-1:1)}else{if(K/X<0){Q=Q-K*v*(V?-1:1)}}if(O.boundColumn){b=N.axes.get(P.xAxis);if(b){d=b.applyData();D=d.from;U=d.to}if(O.xField&&!Ext.isNumber(D)){Z=O.getMinMaxYValues();D=Z[0];U=Z[1]}if(!Ext.isNumber(D)){D=0}if(!Ext.isNumber(U)){U=0}q=O.getGutters();Y=(M.width-(q.lower+q.upper))/((U-D)||1);a=M.x+q.lower;S=[];for(o=0,f=n.length;o<f;o++){J=n[o];s=J.get(O.xField);S[o]=a+(s-D)*Y-(F/2)}}else{if(O.configuredColumnGirth){b=N.axes.get(P.xAxis);if(b){A=b.inflections;if(b.isCategoryAxis||A.length==n.length){S=[];for(o=0,f=n.length;o<f;o++){u=A[o];h=V?u[0]:u[1];S[o]=h-(H/2)}}}}}return{bars:p,barsLoc:S,bbox:M,shrunkBarWidth:H,barsLen:r,groupBarsLen:B,barWidth:W,groupBarWidth:F,scale:v,zero:Q,padding:E,signed:K/X<0,minY:K,maxY:X}},getPaths:function(){var S=this,Q=S.chart,m=Q.getChartStore(),y=m.data.items,Aa,w,L,b=S.bounds=S.getBounds(),a=S.items=[],t=Ext.isArray(S.yField)?S.yField:[S.yField],Y=S.gutter/100,N=S.groupGutter/100,q=Q.animate,d=S.column,F=S.group,X=Q.shadow,G=S.shadowGroups,T=S.shadowAttributes,Ad=G.length,O=b.bbox,e=b.barWidth,J=b.shrunkBarWidth,E=S.getPadding(),Z=S.stacked,Ac=b.barsLen,f=S.colorArrayStyle,z=f&&f.length||0,k=S.themeIdx,l=S.reverse,r=Math,D=r.max,u=r.min,V=r.abs,x,Af,Ae,K,A,v,c,B,Ab,U,W,H,C,R,I,g,o,P,s,p,h,M,Ah,n,Ag;for(Aa=0,w=y.length;Aa<w;Aa++){L=y[Aa];v=b.zero;c=b.zero;K=0;A=0;H=C=0;B=false;n=0;for(x=0,W=0;x<Ac;x++){if(S.__excludes&&S.__excludes[x]){continue}Af=L.get(b.bars[x]);if(Af>=0){H+=Af}else{C+=Af}Ae=Math.round((Af-D(b.minY,0))*b.scale);s=k+(Ac>1?x:0);Ab={fill:f[s%z]};if(d){s=l?(w-Aa-1):Aa;Ag=l?(Ac-W-1):W;if(S.boundColumn){h=b.barsLoc[s]}else{if(S.configuredColumnGirth&&b.barsLoc.length){h=b.barsLoc[s]+Ag*b.groupBarWidth*(1+N)*!Z}else{h=O.x+E.left+(e-J)*0.5+s*e*(1+Y)+Ag*b.groupBarWidth*(1+N)*!Z}}Ext.apply(Ab,{height:Ae,width:D(b.groupBarWidth,0),x:h,y:v-Ae})}else{o=(w-1)-Aa;Ah=Ae+(v==b.zero);h=v+(v!=b.zero);if(l){h=b.zero+O.width-Ah-(n===0?1:0);if(Z){h-=n;n+=Ah}}if(S.configuredColumnGirth&&b.barsLoc.length){M=b.barsLoc[Aa]+W*b.groupBarWidth*(1+N)*!Z}else{M=O.y+E.top+(e-J)*0.5+o*e*(1+Y)+W*b.groupBarWidth*(1+N)*!Z+1}Ext.apply(Ab,{height:D(b.groupBarWidth,0),width:Ah,x:h,y:M})}if(Ae<0){if(d){Ab.y=c;Ab.height=V(Ae)}else{Ab.x=c+Ae;Ab.width=V(Ae)}}if(Z){if(Ae<0){c+=Ae*(d?-1:1)}else{v+=Ae*(d?-1:1)}K+=V(Ae);if(Ae<0){A+=V(Ae)}}Ab.x=Math.floor(Ab.x)+1;P=Math.floor(Ab.y);if(Ext.isIE8&&Ab.y>P){P--}Ab.y=P;Ab.width=Math.floor(Ab.width);Ab.height=Math.floor(Ab.height);a.push({series:S,yField:t[x],storeItem:L,value:[L.get(S.xField),Af],attr:Ab,point:d?[Ab.x+Ab.width/2,Af>=0?Ab.y:Ab.y+Ab.height]:[Af>=0?Ab.x+Ab.width:Ab.x,Ab.y+Ab.height/2]});if(q&&Q.resizing){U=d?{x:Ab.x,y:b.zero,width:Ab.width,height:0}:{x:b.zero,y:Ab.y,width:0,height:Ab.height};if(X&&(Z&&!B||!Z)){B=true;for(R=0;R<Ad;R++){I=G[R].getAt(Z?Aa:(Aa*Ac+x));if(I){I.setAttributes(U,true)}}}g=F.getAt(Aa*Ac+x);if(g){g.setAttributes(U,true)}}W++}if(Z&&a.length){a[Aa*W].totalDim=K;a[Aa*W].totalNegDim=A;a[Aa*W].totalPositiveValues=H;a[Aa*W].totalNegativeValues=C}}if(Z&&W==0){for(Aa=0,w=y.length;Aa<w;Aa++){for(R=0;R<Ad;R++){I=G[R].getAt(Aa);if(I){I.hide(true)}}}}},renderShadows:function(T,R,S,P){var G=this,X=G.chart,L=X.surface,N=X.animate,I=G.stacked,Y=G.shadowGroups,Q=G.shadowAttributes,E=Y.length,H=X.getChartStore(),A=G.column,U=G.items,B=[],F=G.reverse,V=P.zero,O,W,J,M,C,D,K;if((I&&(T%P.groupBarsLen===0))||!I){D=T/P.groupBarsLen;for(O=0;O<E;O++){W=Ext.apply({},Q[O]);J=Y[O].getAt(I?D:T);Ext.copyTo(W,R,"x,y,width,height");if(!J){J=L.add(Ext.apply({type:"rect",isShadow:true,group:Y[O]},Ext.apply({},S,W)))}if(I){M=U[T].totalDim;C=U[T].totalNegDim;if(A){W.y=V+C-M-1;W.height=M}else{if(F){W.x=V+P.bbox.width-M}else{W.x=V-C}W.width=M}}K=G.renderer(J,H.getAt(D),W,T,H);K.hidden=!!R.hidden;if(N){G.onAnimate(J,{zero:P.zero+(F?P.bbox.width:0),to:K})}else{J.setAttributes(K,true)}B.push(J)}}return B},drawSeries:function(){var H=this,a=H.chart,I=a.getChartStore(),N=a.surface,O=a.animate,X=H.stacked,B=H.column,K=a.axes,A=H.getAxesForXAndYFields(),L=A.xAxis,C=A.yAxis,Q=a.shadow,d=H.shadowGroups,G=d.length,R=H.group,T=H.seriesStyle,F,V,Z,W,Y,P,M,c,J,S,U,D,E,b;if(!I||!I.getCount()||H.seriesIsHidden){H.hide();H.items=[];return}U=Ext.apply({},this.style,T);delete U.fill;delete U.x;delete U.y;delete U.width;delete U.height;H.unHighlightItem();H.cleanHighlights();H.boundColumn=(L&&Ext.Array.contains(H.axis,L)&&K.get(L)&&K.get(L).isNumericAxis);H.getPaths();S=H.bounds;F=H.items;Y=B?{y:S.zero,height:0}:{x:S.zero,width:0};V=F.length;for(Z=0;Z<V;Z++){P=R.getAt(Z);D=F[Z].attr;if(Q){F[Z].shadows=H.renderShadows(Z,D,Y,S)}if(!P){E=Ext.apply({},Y,D);E=Ext.apply(E,U||{});P=N.add(Ext.apply({},{type:"rect",group:R},E))}if(O){M=H.renderer(P,I.getAt(Z),D,Z,I);P._to=M;b=H.onAnimate(P,{zero:S.zero+(H.reverse?S.bbox.width:0),to:Ext.apply(M,U)});if(Q&&X&&(Z%S.barsLen===0)){W=Z/S.barsLen;for(c=0;c<G;c++){b.on("afteranimate",function(){this.show(true)},d[c].getAt(W))}}}else{M=H.renderer(P,I.getAt(Z),Ext.apply(D,{hidden:false}),Z,I);P.setAttributes(Ext.apply(M,U),true)}F[Z].sprite=P}V=R.getCount();for(W=Z;W<V;W++){R.getAt(W).hide(true)}if(H.stacked){Z=I.getCount()}if(Q){for(c=0;c<G;c++){J=d[c];V=J.getCount();for(W=Z;W<V;W++){J.getAt(W).hide(true)}}}H.renderLabels()},onCreateLabel:function(C,J,F,I){var H=this,D=H.chart.surface,G=H.labelsGroup,A=H.label,B=Ext.apply({},A,H.seriesLabelStyle||{}),E;return D.add(Ext.apply({type:"text",group:G},B||{}))},onPlaceLabel:function(P,e,H,l,N,d,C){var M=this,k=M.bounds,D=k.groupBarWidth,p=M.column,J=M.chart,U=J.chartBBox,a=J.resizing,m=H.value[0],o=H.value[1],Z=H.attr,V=M.label,R=M.stacked,T=V.stackedDisplay,h=(V.orientation=="vertical"),n=[].concat(V.field),j=V.renderer,W,Q,I,O,G=k.zero,K="insideStart",X="insideEnd",B="outside",c="over",E="under",F=4,S=2,A=k.signed,Y=M.reverse,f,g,b;if(N==K||N==X||N==B){if(R&&(N==B)){P.hide(true);return}P.setAttributes({style:undefined});W=(Ext.isNumber(C)?j(e.get(n[C]),P,e,H,l,N,d,C):"");P.setAttributes({text:W});Q=M.getLabelSize(W,P.attr.style);I=Q.width;O=Q.height;if(p){if(!I||!O||(R&&(Z.height<O))){P.hide(true);return}f=Z.x+(h?D/2:(D-I)/2);if(N==B){var L=(o>=0?(Z.y-U.y):(U.y+U.height-Z.y-Z.height));if(L<O+S){N=X}}if(!R&&(N!=B)){if(O+S>Z.height){N=B}}if(!g){g=Z.y;if(o>=0){switch(N){case K:g+=Z.height+(h?-S:-O/2);break;case X:g+=(h?O+F:O/2);break;case B:g+=(h?-S:-O/2);break}}else{switch(N){case K:g+=(h?O+S:O/2);break;case X:g+=(h?Z.height-S:Z.height-O/2);break;case B:g+=(h?Z.height+O+S:Z.height+O/2);break}}}}else{if(!I||!O||(R&&!Z.width)){P.hide(true);return}g=Z.y+(h?(D+O)/2:D/2);if(N==B){var L=(o>=0?(U.x+U.width-Z.x-Z.width):(Z.x-U.x));if(L<I+F){N=X}}if((N!=B)&&!h){if(I+F*2>=Z.width){if(R){if(O>Z.width){P.hide(true);return}f=Z.x+Z.width/2;h=true}else{N=B}}}if(!f){f=Z.x;if(o>=0){switch(N){case K:if(Y){f+=Z.width+(h?-I/2:-I-F)}else{f+=(h?I/2:F)}break;case X:if(Y){f-=h?-I/2:-I-F}else{f+=Z.width+(h?-I/2:-I-F)}break;case B:if(Y){f-=I+(h?I/2:F)}else{f+=Z.width+(h?I/2:F)}break}}else{switch(N){case K:if(Y){f-=h?-I/2:-I-F}else{f+=Z.width+(h?-I/2:-I-F)}break;case X:if(Y){f+=Z.width+(h?-I/2:-I-F)}else{f+=(h?I/2:F)}break;case B:if(Y){f-=I+(h?I/2:F)}else{f+=(h?-I/2:-I-F)}break}}}}}else{if(N==c||N==E){if(R&&T){W=P.attr.text;P.setAttributes({style:Ext.applyIf((P.attr&&P.attr.style)||{},{"font-weight":"bold","font-size":"14px"})});Q=M.getLabelSize(W,P.attr.style);I=Q.width;O=Q.height;switch(N){case c:if(p){f=Z.x+(h?D/2:(D-I)/2);g=G-(H.totalDim-H.totalNegDim)-O/2-S}else{f=G+(H.totalDim-H.totalNegDim)+F;g=Z.y+(h?(D+O)/2:D/2)}break;case E:if(p){f=Z.x+(h?D/2:(D-I)/2);g=G+H.totalNegDim+O/2}else{f=G-H.totalNegDim-I-F;g=Z.y+(h?(D+O)/2:D/2)}break}}}}if(f==undefined||g==undefined){P.hide(true);return}P.isOutside=(N==B);P.setAttributes({text:W});b={x:f,y:g};b.rotate=h?{x:f,y:g,degrees:270}:M.defaultRotate;if(d&&a){if(p){f=Z.x+Z.width/2;g=G}else{f=G;g=Z.y+Z.height/2}P.setAttributes({x:f,y:g},true);if(h){P.setAttributes({rotate:{x:f,y:g,degrees:270}},true)}}if(d){M.onAnimate(P,{zero:H.point[0],to:b})}else{P.setAttributes(Ext.apply(b,{hidden:false}),true)}},getLabelSize:function(F,A){var D=this.testerLabel,B=this.label,H=Ext.apply({},B,A,this.seriesLabelStyle||{}),E=B.orientation==="vertical",J,C,G,I;if(!D){D=this.testerLabel=this.chart.surface.add(Ext.apply({type:"text",opacity:0},H))}D.setAttributes({style:A,text:F},true);J=D.getBBox();C=J.width;G=J.height;return{width:E?G:C,height:E?C:G}},onAnimate:function(A,E){var I=this,K=E.to,F=I.stacked,C=I.reverse,H=0,G,B,J,D;A.show();if(!I.column){if(C){B=A.getBBox();G=A.type=="text";if(!I.inHighlight){if(!F){if(G){J=B.x>=5?J:E.zero}else{if(B.width){H=B.width}J=B.width?B.x:K.x+K.width}}else{J=E.zero}}E.from={x:J,width:H}}if(F){D=E.from;if(!D){D=E.from={}}D.y=K.y;if(!C){D.x=E.zero;if(A.isShadow){D.width=0}}}}return this.callParent(arguments)},isItemInPoint:function(B,C,A){var D=A.sprite.getBBox();return D.x<=B&&D.y<=C&&(D.x+D.width)>=B&&(D.y+D.height)>=C},hideAll:function(D){var A=this.chart.axes,C=A.items,E=C.length,B=0;D=(isNaN(this._index)?D:this._index)||0;if(!this.__excludes){this.__excludes=[]}this.__excludes[D]=true;this.drawSeries();for(B;B<E;B++){C[B].drawAxis()}},showAll:function(D){var A=this.chart.axes,C=A.items,E=C.length,B=0;D=(isNaN(this._index)?D:this._index)||0;if(!this.__excludes){this.__excludes=[]}this.__excludes[D]=false;this.drawSeries();for(B;B<E;B++){C[B].drawAxis()}},getLegendColor:function(C){var B=this,D=B.colorArrayStyle,A=D&&D.length;if(B.style&&B.style.fill){return B.style.fill}else{return(D?D[(B.themeIdx+C)%A]:"#000")}},highlightItem:function(A){this.callParent(arguments);this.inHighlight=true;this.renderLabels();delete this.inHighlight},unHighlightItem:function(){this.callParent(arguments);this.inHighlight=true;this.renderLabels();delete this.inHighlight},cleanHighlights:function(){this.callParent(arguments);this.inHighlight=true;this.renderLabels();delete this.inHighlight}});
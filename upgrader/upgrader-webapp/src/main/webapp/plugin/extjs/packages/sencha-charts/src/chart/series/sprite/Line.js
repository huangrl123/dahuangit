Ext.define("Ext.chart.series.sprite.Line",{alias:"sprite.lineSeries",extend:"Ext.chart.series.sprite.Aggregative",inheritableStatics:{def:{processors:{smooth:"bool",fillArea:"bool",step:"bool",preciseStroke:"bool"},defaults:{smooth:false,fillArea:false,step:false,preciseStroke:true},dirtyTriggers:{dataX:"dataX,bbox,smooth",dataY:"dataY,bbox,smooth",smooth:"smooth"},updaters:{smooth:function(A){if(A.smooth&&A.dataX&&A.dataY&&A.dataX.length>2&&A.dataY.length>2){this.smoothX=Ext.draw.Draw.spline(A.dataX);this.smoothY=Ext.draw.Draw.spline(A.dataY)}else{delete this.smoothX;delete this.smoothY}}}}},list:null,updatePlainBBox:function(B){var D=this.attr,C=Math.min(0,D.dataMinY),A=Math.max(0,D.dataMaxY);B.x=D.dataMinX;B.y=C;B.width=D.dataMaxX-D.dataMinX;B.height=A-C},drawStroke:function(S,L,e,O,A,B){var I=this.attr,N=I.matrix,W=N.getXX(),F=N.getYY(),J=N.getDX(),X=N.getDY(),V=I.smooth,D=I.step,T=Math.pow(2,U(I.dataX.length,O)),c=this.smoothX,d=this.smoothY,Z,Y,G,Q,b,M,H,P,a,R,K,E,C;function U(f,i){var g=0,h=f;while(h<i){g++;h+=f>>g}return g>0?g-1:g}L.beginPath();if(V&&c&&d){L.moveTo(c[e*3]*W+J,d[e*3]*F+X);for(Z=0,Y=e*3+1;Z<A.length-3;Z+=3,Y+=3*T){b=c[Y]*W+J;M=d[Y]*F+X;H=c[Y+1]*W+J;P=d[Y+1]*F+X;a=A[Z+3];R=A[Z+4];K=A[Z];E=A[Z+1];if(I.renderer){G={type:"line",smooth:true,step:D,cx1:b,cy1:M,cx2:H,cy2:P,x:a,y:R,x0:K,y0:E};Q=I.renderer.call(this,this,G,{store:this.getStore()},(e+Z/3+1));L.save();Ext.apply(L,Q);if(I.fillArea){C=L.strokeOpacity;L.save();L.strokeOpacity=0;L.moveTo(K,E);L.bezierCurveTo(b,M,H,P,a,R);L.lineTo(a,B);L.lineTo(K,B);L.lineTo(K,E);L.closePath();L.fillStroke(I,true);L.restore();L.strokeOpacity=C;L.beginPath()}L.moveTo(K,E);L.bezierCurveTo(b,M,H,P,a,R);L.moveTo(K,E);L.closePath();L.stroke();L.restore();L.beginPath();L.moveTo(a,R)}else{L.bezierCurveTo(b,M,H,P,a,R)}}}else{L.moveTo(A[0],A[1]);for(Z=3;Z<A.length;Z+=3){a=A[Z];R=A[Z+1];K=A[Z-3];E=A[Z-2];if(I.renderer){G={type:"line",smooth:false,step:D,x:a,y:R,x0:K,y0:E};Q=I.renderer.call(this,this,G,{store:this.getStore()},e+Z/3);L.save();Ext.apply(L,Q);if(I.fillArea){C=L.strokeOpacity;L.save();L.strokeOpacity=0;if(D){L.lineTo(a,E)}else{L.lineTo(a,R)}L.lineTo(a,B);L.lineTo(K,B);L.lineTo(K,E);L.closePath();L.fillStroke(I,true);L.restore();L.strokeOpacity=C;L.beginPath()}L.moveTo(K,E);if(D){L.lineTo(a,E);L.closePath();L.stroke();L.beginPath();L.moveTo(a,E)}L.lineTo(a,R);L.closePath();L.stroke();L.restore();L.beginPath();L.moveTo(a,R)}else{if(D){L.lineTo(a,E)}L.lineTo(a,R)}}}},drawLabel:function(L,W,A,I,J){var G=this,E=G.attr,T=G.getBoundMarker("labels")[0],F=T.getTemplate(),C=G.labelCfg||(G.labelCfg={}),D=G.surfaceMatrix,R,H,M=E.labelOverflowPadding,S=E.flipXY,Q=S?J[1]:J[0],P=S?J[0]:J[1],N=S?J[3]:J[2],U=S?J[2]:J[3],O,V,B,K;C.text=L;B=G.getMarkerBBox("labels",I,true);if(!B){G.putMarker("labels",C,I);B=G.getMarkerBBox("labels",I,true)}if(S){C.rotationRads=Math.PI*0.5}else{C.rotationRads=0}O=B.width/2;V=B.height/2;R=W;switch(F.attr.display){case"under":H=A-V-M;break;case"rotate":R+=M;H=A-M;C.rotationRads=-Math.PI/4;break;default:H=A+V+M}if(R<=Q+O){R=Q+O}else{if(R>=N-O){R=N-O}}if(H<=P+V){H=P+V}else{if(H>=U-V){H=U-V}}C.x=D.x(R,H);C.y=D.y(R,H);if(F.attr.renderer){K=F.attr.renderer.call(G,L,T,C,{store:G.getStore()},I);if(typeof K==="string"){C.text=K}else{Ext.apply(C,K)}}G.putMarker("labels",C,I)},renderAggregates:function(K,d,A,o,J,Q,T){var L=this,Y=L.attr,Z=Y.dataX,a=Y.dataY,N=Y.labels,F=N&&L.getBoundMarker("labels"),V=Y.matrix,e=o.matrix,U=o.devicePixelRatio,W=V.getXX(),P=V.getYY(),j=V.getDX(),b=V.getDY(),f={},H=this.list||(this.list=[]),g,h,l,D,R=K.minX,k=K.maxX,X=K.minY,n=K.maxY,m=K.startIdx;H.length=0;for(l=d;l<A;l++){var C=R[l],B=k[l],G=X[l],O=n[l];if(C<B){H.push(C*W+j,G*P+b,m[l]);H.push(B*W+j,O*P+b,m[l])}else{if(C>B){H.push(B*W+j,O*P+b,m[l]);H.push(C*W+j,G*P+b,m[l])}else{H.push(B*W+j,O*P+b,m[l])}}}if(H.length){for(l=0;l<H.length;l+=3){g=H[l];h=H[l+1];D=H[l+2];if(Y.renderer){f={type:"marker",x:g,y:h};f=Y.renderer.call(this,this,f,{store:this.getStore()},d+l/3)||{}}f.translationX=e.x(g,h);f.translationY=e.y(g,h);L.putMarker("markers",f,D,!Y.renderer);if(F&&N[D]){L.drawLabel(N[D],g,h,D,T)}}L.drawStroke(o,J,d,A,H,T[1]-U);if(!Y.renderer){var I=Z[Z.length-1]*W+j+U,E=a[a.length-1]*P+b,M=T[1]-U,c=Z[0]*W+j-U,S=a[0]*P+b;J.lineTo(I,E);J.lineTo(I,M);J.lineTo(c,M);J.lineTo(c,S)}J.closePath();if(Y.transformFillStroke){Y.matrix.toContext(J)}if(Y.preciseStroke){if(Y.fillArea){J.fill()}if(Y.transformFillStroke){Y.inverseMatrix.toContext(J)}L.drawStroke(o,J,d,A,H,T[1]-U);if(Y.transformFillStroke){Y.matrix.toContext(J)}J.stroke()}else{if(Y.fillArea){J.fillStroke(Y,true)}else{J.stroke(true)}}}}});
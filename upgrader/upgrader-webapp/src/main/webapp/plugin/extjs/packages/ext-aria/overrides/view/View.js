Ext.define("Ext.aria.view.View",{override:"Ext.view.View",initComponent:function(){var A=this,B;A.callParent(arguments);B=A.getSelectionModel();B.on({scope:A,select:A.ariaSelect,deselect:A.ariaDeselect,focuschange:A.ariaFocusChanged});A.on({scope:A,refresh:A.ariaInitViewItems,itemadd:A.ariaItemAdd,itemremove:A.ariaItemRemove})},ariaGetFocusCls:function(){return this.ariaFocusCls},ariaGetRenderAttributes:function(){var C=this,B,A;B=C.callParent();A=C.getSelectionModel().getSelectionMode();if(A!=="SINGLE"){B["aria-multiselectable"]=true}if(C.title){B["aria-label"]=C.title}return B},ariaInitViewItems:function(){var F=this,A=F.pageSize||F.store.buffered,E=F.store.requestStart+1,H,D,B,C,G;H=F.getNodes();B=F.store.getTotalCount();for(C=0,G=H.length;C<G;C++){D=H[C];if(!D.id){D.setAttribute("id",Ext.id())}D.setAttribute("role",F.itemAriaRole);D.setAttribute("aria-selected",false);if(A){D.setAttribute("aria-setsize",B);D.setAttribute("aria-posinset",E+C)}}},processItemEvent:function(E,D,A,C){var B=this;if(C.type=="keydown"&&(C.keyCode===Ext.EventObject.ENTER)){B.fireEvent("itemclick",B,E,D,A,C)}},onBlur:function(){var A=this;A.ariaStepOut();A.callParent(arguments)},onFocus:function(){var A=this;A.callParent(arguments);if(A.hasFocus){A.ariaStepIn()}},ariaStepOut:function(){var A=this,B;B=A.getSelectionModel().getLastFocused();if(B){A.ariaRemoveFocus(A.getNode(B))}},ariaStepIn:function(){var A=this,B;B=A.getSelectionModel().getLastSelected();if(B){A.ariaAddFocus(A.getNode(B))}},refresh:function(){var A=this;A.callParent(arguments);if(!A.isDestroyed&&A.hasFocus){A.focus()}},ariaSelect:function(D,C){var A=this,B;B=A.getNode(C);if(B){B.setAttribute("aria-selected",true);A.ariaUpdate({"aria-activedescendant":B.id})}},ariaDeselect:function(D,C){var A=this,B;B=A.getNode(C);if(B){B.removeAttribute("aria-selected");A.ariaUpdate({"aria-activedescendant":undefined})}},ariaRemoveFocus:function(A){if(A){Ext.fly(A).removeCls(this.ariaItemFocusCls)}},ariaAddFocus:function(B){var C=this,A;A=C.el.selectNode("."+C.ariaItemFocusCls);if(A){if(A===B){return}Ext.fly(A).removeCls(C.ariaItemFocusCls)}if(B){Ext.fly(B).addCls(C.ariaItemFocusCls)}},ariaItemRemove:function(B,E,D){if(!D){return}var C=this,F,A,G;F=C.el.getAttribute("aria-activedescendant");for(A=0,G=D.length;A<G;A++){if(F===D[A].id){C.ariaUpdate({"aria-activedescendant":undefined});break}}if(C.hasFocus&&C.getNodes().length>1){C.getSelectionModel().selectByPosition({row:E===0?0:E-1,column:0})}},ariaItemAdd:function(A,C,B){this.ariaInitViewItems(A,C,B)},setTitle:function(B){var A=this;A.title=B;A.ariaUpdate({"aria-label":B})},ariaFocusChanged:function(E,A,D){var C=this,B;if(A){B=C.getNode(A);C.ariaRemoveFocus(B)}if(D){B=C.getNode(D);C.ariaAddFocus(B)}}});
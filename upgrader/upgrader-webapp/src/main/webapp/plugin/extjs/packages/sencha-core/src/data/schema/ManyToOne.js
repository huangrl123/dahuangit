Ext.define("Ext.data.schema.ManyToOne",{extend:"Ext.data.schema.Association",isManyToOne:true,isToOne:true,kind:"many-to-one",Left:Ext.define(null,{extend:"Ext.data.schema.Role",isMany:true,processUpdate:function(B,D){var F=this,C=F.inverse.cls,H=D.R,E,G,A;if(H){for(E in H){G=B.peekRecord(C,E);if(G){records=B.getEntityList(F.cls,H[E]);A=F.getAssociatedItem(G);if(A){records=F.validateAssociationRecords(B,G,records);A.loadRecords(records);A.complete=true}else{G[F.getterName](null,null,records)}}else{B.onInvalidAssociationEntity(C,E)}}}},validateAssociationRecords:function(E,D,C){var B=E.getEntry(D.self,D.id).refs,I=[],H=this.association.getFieldName(),F,A,G;B=B&&B[this.role];if(B){if(C){F={};for(i=0,len=C.length;i<len;++i){A=C[i];G=A.id;if(B[G]){I.push(A)}F[G]=true}}for(G in B){if(!F||!F[G]){I.push(B[G])}}}return I},createGetter:function(){var A=this;return function(D,E,C){var B=this.session,F;if(B){F=!!C;C=A.validateAssociationRecords(B,this,C);if(!F&&!C.length){C=null}}return A.getAssociatedStore(this,D,E,C,F)}},createSetter:null,onAddToMany:function(A,B){this.syncFK(B,A.associatedEntity,false)},onRemoveFromMany:function(A,B){this.syncFK(B,A.associatedEntity,true)},read:function(J,G,C,D){var H=this,I=H.inverse.role,B=H.callParent([J,G,C,D]),A,K,E,F;if(B.getReadRoot()){A=J[H.getterName](null,null,B.getRecords());K=A.data.items;E=K.length;for(F=0;F<E;++F){K[F][I]=J}}},syncFK:function(E,B,D){var F=this.association.getFieldName(),I=this.inverse.setterName,G=E.length,A=D?null:B.getId(),C,H;while(G-->0){H=E[G];C=!H.isEqual(B.getId(),H.get(F));if(C!==D){H.changingKey=true;if(I){H[I](A)}else{H.set(F,A)}H.changingKey=false}}}}),Right:Ext.define(null,{extend:"Ext.data.schema.Role",left:false,side:"right",createGetter:function(){var A=this;return function(B,C){return A.doGetFK(this,B,C)}},createSetter:function(){var A=this;return function(B,C,D){return A.doSetFK(this,B,C,D)}},onValueChange:function(B,G,C,H){var D,A,F,I,E;if(B.changingKey){return}if(G){A=this.getSessionStore(G,H);if(A){A.remove(B)}if(C||C===0){A=this.getSessionStore(G,C);if(A&&!A.isLoading()){A.add(B)}}}else{D=B.joined;if(D){for(F=0,I=D.length;F<I;++F){A=D[F];if(A.isStore){E=A.getAssociatedEntity();if(E&&E.self===this.cls&&E.getId()===H){A.remove(B)}}}}}},getSessionStore:function(A,C){var B=A.peekRecord(this.cls,C);if(B){return this.inverse.getAssociatedItem(B)}},read:function(C,B,A,E){var D=this.callParent([C,B,A,E]),F=D.getRecords()[0];if(F){C[this.role]=F}}})});
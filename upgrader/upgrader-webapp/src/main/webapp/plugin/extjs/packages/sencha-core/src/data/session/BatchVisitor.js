Ext.define("Ext.data.session.BatchVisitor",{map:null,constructor:function(A){this.batch=A},getBatch:function(B){var H=this.map,F=this.batch,D,C,A,E,G;if(H){if(!F){F=new Ext.data.Batch()}for(A in H){D=H[A];C=D.entity;G=C.getProxy();delete D.entity;for(E in D){E=G.createOperation(E,{records:D[E]});E.entityType=C;F.add(E)}}}if(F&&B!==false){F.sort()}return F},onDirtyRecord:function(D){var B=this,F=D.phantom?"create":(D.dropped?"destroy":"update"),E=D.$className,C=(B.map||(B.map={})),A=(C[E]||(C[E]={entity:D.self}));A=A[F]||(A[F]=[]);A.push(D)}});
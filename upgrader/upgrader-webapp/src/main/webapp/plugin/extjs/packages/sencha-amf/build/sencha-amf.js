Ext.define("Ext.data.amf.Encoder",{alias:"data.amf.Encoder",config:{format:3,bytes:[]},constructor:function(A){this.initConfig(A);this.clear()},clear:function(){this.setBytes([])},applyFormat:function(A){var B={0:{writeUndefined:this.write0Undefined,writeNull:this.write0Null,writeBoolean:this.write0Boolean,writeNumber:this.write0Number,writeString:this.write0String,writeXml:this.write0Xml,writeDate:this.write0Date,writeArray:this.write0Array,writeGenericObject:this.write0GenericObject},3:{writeUndefined:this.write3Undefined,writeNull:this.write3Null,writeBoolean:this.write3Boolean,writeNumber:this.write3Number,writeString:this.write3String,writeXml:this.write3Xml,writeDate:this.write3Date,writeArray:this.write3Array,writeGenericObject:this.write3GenericObject}}[A];if(B){Ext.apply(this,B);return A}else{return}},writeObject:function(A){var B=typeof(A);if(B==="undefined"){this.writeUndefined()}else{if(A===null){this.writeNull()}else{if(Ext.isBoolean(A)){this.writeBoolean(A)}else{if(Ext.isString(A)){this.writeString(A)}else{if(B==="number"||A instanceof Number){this.writeNumber(A)}else{if(B==="object"){if(A instanceof Date){this.writeDate(A)}else{if(Ext.isArray(A)){this.writeArray(A)}else{if(this.isXmlDocument(A)){this.writeXml(A)}else{this.writeGenericObject(A)}}}}else{}}}}}}},write3Undefined:function(){this.writeByte(0)},write0Undefined:function(){this.writeByte(6)},write3Null:function(){this.writeByte(1)},write0Null:function(){this.writeByte(5)},write3Boolean:function(A){if(A){this.writeByte(3)}else{this.writeByte(2)}},write0Boolean:function(A){this.writeByte(1);if(A){this.writeByte(1)}else{this.writeByte(0)}},encode29Int:function(A){var B=[],E=A,D,C;if(E==0){return[0]}if(E>2097151){D=E&255;B.unshift(D);E=E>>8}while(E>0){D=E&127;B.unshift(D);E=E>>7}for(C=0;C<B.length-1;C++){B[C]=B[C]|128}return B},write3Number:function(C){var A;var D=536870911,B=-268435455;if(C instanceof Number){C=C.valueOf()}if(C%1===0&&C>=B&&C<=D){C=C&D;A=this.encode29Int(C);A.unshift(4);this.writeBytes(A)}else{A=this.encodeDouble(C);A.unshift(5);this.writeBytes(A)}},write0Number:function(B){var A;if(B instanceof Number){B=B.valueOf()}A=this.encodeDouble(B);A.unshift(0);this.writeBytes(A)},encodeUtf8Char:function(A){var F=[],C,E,D,B;if(A<=127){F.push(A)}else{if(A<=2047){E=2}else{if(A<=65535){E=3}else{E=4}}B=128;for(D=1;D<E;D++){C=(A&63)|128;F.unshift(C);A=A>>6;B=(B>>1)|128}C=A|B;F.unshift(C)}return F},encodeUtf8String:function(A){var D,C=[];for(D=0;D<A.length;D++){var B=this.encodeUtf8Char(A.charCodeAt(D));C.push.apply(C,B)}return C},encode3Utf8StringLen:function(B){var C=B.length,A=[];if(C<=268435455){C=C<<1;C=C|1;A=this.encode29Int(C)}else{}return A},write3String:function(A){if(A==""){this.writeByte(6);this.writeByte(1)}else{var B=this.encodeUtf8String(A);var C=this.encode3Utf8StringLen(B);this.writeByte(6);this.writeBytes(C);this.writeBytes(B)}},encodeXInt:function(C,A){var B=[],D;for(D=0;D<A;D++){B.unshift(C&255);C=C>>8}return B},write0String:function(C){if(C==""){this.writeByte(2);this.writeBytes([0,0])}else{var A=this.encodeUtf8String(C);var B;var D;if(A.length<=65535){B=2;D=this.encodeXInt(A.length,2)}else{B=12;D=this.encodeXInt(A.length,4)}this.writeByte(B);this.writeBytes(D);this.writeBytes(A)}},write3XmlWithType:function(D,E){var B=this.convertXmlToString(D);if(B==""){this.writeByte(E);this.writeByte(1)}else{var A=this.encodeUtf8String(B);var C=this.encode3Utf8StringLen(A);this.writeByte(E);this.writeBytes(C);this.writeBytes(A)}},write3XmlDocument:function(A){this.write3XmlWithType(A,7)},write3Xml:function(A){this.write3XmlWithType(A,11)},write0Xml:function(B){var A=this.convertXmlToString(B);this.writeByte(15);var C=this.encodeUtf8String(A);var D=this.encodeXInt(C.length,4);this.writeBytes(D);this.writeBytes(C)},write3Date:function(A){this.writeByte(8);this.writeBytes(this.encode29Int(1));this.writeBytes(this.encodeDouble(new Number(A)))},write0Date:function(A){this.writeByte(11);this.writeBytes(this.encodeDouble(new Number(A)));this.writeBytes([0,0])},write3Array:function(A){this.writeByte(9);var B=A.length;B=B<<1;B=B|1;this.writeBytes(this.encode29Int(B));this.writeByte(1);Ext.each(A,function(C){this.writeObject(C)},this)},write0ObjectProperty:function(B,A){if(!(B instanceof String)&&(typeof(B)!=="string")){B=B+""}var C=this.encodeUtf8String(B);var D;D=this.encodeXInt(C.length,2);this.writeBytes(D);this.writeBytes(C);this.writeObject(A)},write0Array:function(C){var A;this.writeByte(8);var B=0;for(A in C){B++}this.writeBytes(this.encodeXInt(B,4));for(A in C){this.write0ObjectProperty(A,C[A])}this.writeBytes([0,0,9])},write0StrictArray:function(A){this.writeByte(10);var B=A.length;this.writeBytes(this.encodeXInt(B,4));Ext.each(A,function(C){this.writeObject(C)},this)},write3ByteArray:function(A){this.writeByte(12);var B=A.length;B=B<<1;B=B|1;this.writeBytes(this.encode29Int(B));this.writeBytes(A)},write3GenericObject:function(A){var C;this.writeByte(10);var D=11;this.writeByte(D);this.writeByte(1);for(C in A){var E=new String(C).valueOf();if(E==""){}var B=(this.encodeUtf8String(C));this.writeBytes(this.encode3Utf8StringLen(C));this.writeBytes(B);this.writeObject(A[C])}this.writeByte(1)},write0GenericObject:function(A){var C,D,B;C=!!A.$flexType;D=C?16:3;this.writeByte(D);if(C){this.write0ShortUtf8String(A.$flexType)}for(B in A){if(B!="$flexType"){this.write0ObjectProperty(B,A[B])}}this.writeBytes([0,0,9])},writeByte:function(A){this.getBytes().push(A)},writeBytes:function(B){var A;this.getBytes().push.apply(this.getBytes(),B)},convertXmlToString:function(B){var A;if(window.XMLSerializer){A=new window.XMLSerializer().serializeToString(B)}else{A=B.xml}return A},isXmlDocument:function(A){if(window.DOMParser){if(Ext.isDefined(A.doctype)){return true}}if(Ext.isString(A.xml)){return true}return false},encodeDouble:function(H){var K=11,M=52;var N=(1<<(K-1))-1,A,E,F,J,O,C,G,L=[];var D=[127,240,0,0,0,0,0,0],B=[255,240,0,0,0,0,0,0],I=[255,248,0,0,0,0,0,0];if(isNaN(H)){L=I}else{if(H===Infinity){L=D}else{if(H==-Infinity){L=B}else{if(H===0){E=0;F=0;A=(1/H===-Infinity)?1:0}else{A=H<0;H=Math.abs(H);if(H>=Math.pow(2,1-N)){J=Math.min(Math.floor(Math.log(H)/Math.LN2),N);E=J+N;F=Math.round(H*Math.pow(2,M-J)-Math.pow(2,M))}else{E=0;F=Math.round(H/Math.pow(2,1-N-M))}}C=[];for(O=M;O;O-=1){C.push(F%2?1:0);F=Math.floor(F/2)}for(O=K;O;O-=1){C.push(E%2?1:0);E=Math.floor(E/2)}C.push(A?1:0);C.reverse();G=C.join("");L=[];while(G.length){L.push(parseInt(G.substring(0,8),2));G=G.substring(8)}}}}return L},write0ShortUtf8String:function(B){var A=this.encodeUtf8String(B),C;C=this.encodeXInt(A.length,2);this.writeBytes(C);this.writeBytes(A)},writeAmfPacket:function(B,A){var C;this.writeBytes([0,0]);this.writeBytes(this.encodeXInt(B.length,2));for(C in B){this.writeAmfHeader(B[C].name,B[C].mustUnderstand,B[C].value)}this.writeBytes(this.encodeXInt(A.length,2));for(C in A){this.writeAmfMessage(A[C].targetUri,A[C].responseUri,A[C].body)}},writeAmfHeader:function(A,B,C){this.write0ShortUtf8String(A);var D=B?1:0;this.writeByte(D);this.writeBytes(this.encodeXInt(-1,4));this.writeObject(C)},writeAmfMessage:function(B,A,C){this.write0ShortUtf8String(B);this.write0ShortUtf8String(A);this.writeBytes(this.encodeXInt(-1,4));this.write0StrictArray(C)}});Ext.define("Ext.data.amf.Packet",{config:{headers:[],messages:[],version:0},typeMap:{0:{0:"readDouble",1:"readBoolean",2:"readAmf0String",3:"readAmf0Object",5:"readNull",6:"readUndefined",7:"readReference",8:"readEcmaArray",10:"readStrictArray",11:"readAmf0Date",12:"readLongString",13:"readUnsupported",15:"readAmf0Xml",16:"readTypedObject"},3:{0:"readUndefined",1:"readNull",2:"readFalse",3:"readTrue",4:"readUInt29",5:"readDouble",6:"readAmf3String",7:"readAmf3Xml",8:"readAmf3Date",9:"readAmf3Array",10:"readAmf3Object",11:"readAmf3Xml",12:"readByteArray"}},decode:function(C){var B=this,F=[],A=[],D,E;B.twoPowN52=Math.pow(2,-52);B.twoPow8=Math.pow(2,8);B.setHeaders(F);B.setMessages(A);B.pos=0;if(C instanceof ArrayBuffer){C=new Uint8Array(C)}B.bytes=C;B.strings=[];B.objects=[];B.traits=[];B.setVersion(B.readUInt(2));for(D=B.readUInt(2);D--;){B.getHeaders().push({name:B.readAmf0String(),mustUnderstand:B.readBoolean(),byteLength:B.readUInt(4),value:B.readValue()});B.strings=[];B.objects=[];B.traits=[]}for(E=B.readUInt(2);E--;){B.getMessages().push({targetURI:B.readAmf0String(),responseURI:B.readAmf0String(),byteLength:B.readUInt(4),body:B.readValue()});B.strings=[];B.objects=[];B.traits=[]}B.pos=0;B.bytes=B.strings=B.objects=B.traits=null;return B},decodeValue:function(B){var A=this;A.bytes=B;A.pos=0;A.setVersion(3);A.strings=[];A.objects=[];A.traits=[];return A.readValue()},parseXml:function(B){var A;if(window.DOMParser){A=(new DOMParser()).parseFromString(B,"text/xml")}else{A=new ActiveXObject("Microsoft.XMLDOM");A.loadXML(B)}return A},readAmf0Date:function(){var A=new Date(this.readDouble());this.pos+=2;return A},readAmf0Object:function(B){var A=this,C;B=B||{};A.objects.push(B);while((C=A.readAmf0String())||A.bytes[A.pos]!==9){B[C]=A.readValue()}A.pos++;return B},readAmf0String:function(){return this.readUtf8(this.readUInt(2))},readAmf0Xml:function(){return this.parseXml(this.readLongString())},readAmf3Array:function(){var A=this,F=A.readUInt29(),D,C,B,E;if(F&1){D=(F>>1);C=A.readAmf3String();if(C){B={};A.objects.push(B);do{B[C]=A.readValue()}while((C=A.readAmf3String()));for(E=0;E<D;E++){B[E]=A.readValue()}}else{B=[];A.objects.push(B);for(E=0;E<D;E++){B.push(A.readValue())}}}else{B=A.objects[F>>1]}return B},readAmf3Date:function(){var A=this,B=A.readUInt29(),C;if(B&1){C=new Date(A.readDouble());A.objects.push(C)}else{C=A.objects[B>>1]}return C},readAmf3Object:function(){var C=this,J=C.readUInt29(),H=[],F,D,B,G,I,A,E,K,L;if(J&1){F=(J&7);if(F===3){B=C.readAmf3String();G=!!(J&8);D=(J>>4);for(L=0;L<D;L++){H.push(C.readAmf3String())}I={className:B,dynamic:G,members:H};C.traits.push(I)}else{if((J&3)===1){I=C.traits[J>>2];B=I.className;G=I.dynamic;H=I.members;D=H.length}else{if(F===7){}}}if(B){K=Ext.ClassManager.getByAlias("amf."+B);A=K?new K():{$className:B}}else{A={}}C.objects.push(A);for(L=0;L<D;L++){A[H[L]]=C.readValue()}if(G){while((E=C.readAmf3String())){A[E]=C.readValue()}}if((!K)&&this.converters[B]){A=this.converters[B](A)}}else{A=C.objects[J>>1]}return A},readAmf3String:function(){var C=this,B=C.readUInt29(),A;if(B&1){A=C.readUtf8(B>>1);if(A){C.strings.push(A)}return A}else{return C.strings[B>>1]}},readAmf3Xml:function(){var C=this,B=C.readUInt29(),A;if(B&1){A=C.parseXml(C.readUtf8(B>>1));C.objects.push(A)}else{A=C.objects[B>>1]}return A},readBoolean:function(){return !!this.bytes[this.pos++]},readByteArray:function(){var B=this.readUInt29(),A,C;if(B&1){C=this.pos+(B>>1);A=Array.prototype.slice.call(this.bytes,this.pos,C);this.objects.push(A);this.pos=C}else{A=this.objects[B>>1]}return A},readDouble:function(){var B=this.bytes[this.pos++],F=this.bytes[this.pos++],E=(B>>7)?-1:1,A=(((B&127)<<4)|(F>>4)),D=(F&15),C=A?1:0,G=6;while(G--){D=(D*this.twoPow8)+this.bytes[this.pos++]}if(!A){if(!D){return 0}A=1}if(A===2047){return D?NaN:(Infinity*E)}return E*Math.pow(2,A-1023)*(C+this.twoPowN52*D)},readEcmaArray:function(){this.pos+=4;return this.readAmf0Object()},readFalse:function(){return false},readLongString:function(){return this.readUtf8(this.readUInt(4))},readNull:function(){return null},readReference:function(){return this.objects[this.readUInt(2)]},readStrictArray:function(){var B=this,A=B.readUInt(4),C=[];B.objects.push(C);while(A--){C.push(B.readValue())}return C},readTrue:function(){return true},readTypedObject:function(){var B=this,A=B.readAmf0String(),C,E,D;C=Ext.ClassManager.getByAlias("amf."+A);E=C?new C():{$className:A};D=B.readAmf0Object(E);if((!C)&&this.converters[A]){D=this.converters[A](E)}return D},readUInt:function(B){var A=1,C;C=this.bytes[this.pos++];for(;A<B;++A){C=(C<<8)|this.bytes[this.pos++]}return C},readUInt29:function(){var A=this.bytes[this.pos++],B;if(A&128){B=this.bytes[this.pos++];A=((A&127)<<7)|(B&127);if(B&128){B=this.bytes[this.pos++];A=(A<<7)|(B&127);if(B&128){B=this.bytes[this.pos++];A=(A<<8)|B}}}return A},readUndefined:Ext.emptyFn,readUnsupported:Ext.emptyFn,readUtf8:function(C){var K=this.pos+C,J=[],F=0,D=65535,G=1,E=[],I=0,A,H,B;A=[J];while(this.pos<K){B=this.bytes[this.pos++];if(B>127){if(B>239){H=4;B=(B&7)}else{if(B>223){H=3;B=(B&15)}else{H=2;B=(B&31)}}while(--H){B=((B<<6)|(this.bytes[this.pos++]&63))}}J.push(B);if(++F===D){A.push(J=[]);F=0;G++}}for(;I<G;I++){E.push(String.fromCharCode.apply(String,A[I]))}return E.join("")},readValue:function(){var A=this,B=A.bytes[A.pos++];if(B===17){A.setVersion(3);B=A.bytes[A.pos++]}return A[A.typeMap[A.getVersion()][B]]()},converters:{"flex.messaging.io.ArrayCollection":function(A){return A.source||[]}}});Ext.define("Ext.data.amf.RemotingMessage",{alias:"data.amf.remotingmessage",config:{$flexType:"flex.messaging.messages.RemotingMessage",body:[],clientId:"",destination:"",headers:[],messageId:"",operation:"",source:"",timestamp:[],timeToLive:[]},constructor:function(A){this.initConfig(A)},encodeMessage:function(){var B=Ext.create("Ext.data.amf.XmlEncoder"),A;A=Ext.copyTo({},this.getCurrentConfig(),"$flexType,body,clientId,destination,headers,messageId,operation,source,timestamp,timeToLive",true);B.writeObject(A);return B.getBody()}});Ext.define("Ext.data.amf.XmlDecoder",{alias:"data.amf.xmldecoder",statics:{readXml:function(B){var A;if(window.DOMParser){A=(new DOMParser()).parseFromString(B,"text/xml")}else{A=new ActiveXObject("Microsoft.XMLDOM");A.loadXML(B)}return A},readByteArray:function(A){var D=[],E,C,B;B=A.firstChild.nodeValue;for(C=0;C<B.length;C=C+2){E=B.substr(C,2);D.push(parseInt(E,16))}return D},readAMF3Value:function(B){var A;A=Ext.create("Ext.data.amf.Packet");return A.decodeValue(B)},decodeTidFromFlexUID:function(B){var A;A=B.substr(0,8);return parseInt(A,16)}},constructor:function(A){this.initConfig(A);this.clear()},clear:function(){this.objectReferences=[];this.traitsReferences=[];this.stringReferences=[]},readAmfxMessage:function(C){var B,A,E,D,F={};this.clear();B=Ext.data.amf.XmlDecoder.readXml(C);A=B.getElementsByTagName("amfx")[0];E=A.getElementsByTagName("body")[0];F.targetURI=E.getAttribute("targetURI");F.responseURI=E.getAttribute("responseURI");for(D=0;D<E.childNodes.length;D++){if(E.childNodes.item(D).nodeType!=1){continue}F.message=this.readValue(E.childNodes.item(D));break}return F},readValue:function(B){var A;if(typeof B.normalize==="function"){B.normalize()}if(B.tagName=="null"){return null}else{if(B.tagName=="true"){return true}else{if(B.tagName=="false"){return false}else{if(B.tagName=="string"){return this.readString(B)}else{if(B.tagName=="int"){return parseInt(B.firstChild.nodeValue)}else{if(B.tagName=="double"){return parseFloat(B.firstChild.nodeValue)}else{if(B.tagName=="date"){A=new Date(parseFloat(B.firstChild.nodeValue));this.objectReferences.push(A);return A}else{if(B.tagName=="dictionary"){return this.readDictionary(B)}else{if(B.tagName=="array"){return this.readArray(B)}else{if(B.tagName=="ref"){return this.readObjectRef(B)}else{if(B.tagName=="object"){return this.readObject(B)}else{if(B.tagName=="xml"){return Ext.data.amf.XmlDecoder.readXml(B.firstChild.nodeValue)}else{if(B.tagName=="bytearray"){return Ext.data.amf.XmlDecoder.readAMF3Value(Ext.data.amf.XmlDecoder.readByteArray(B))}}}}}}}}}}}}}return null},readString:function(B){var A;if(B.getAttributeNode("id")){return this.stringReferences[parseInt(B.getAttribute("id"))]}A=(B.firstChild?B.firstChild.nodeValue:"")||"";this.stringReferences.push(A);return A},readTraits:function(B){var C=[],D,A;if(B===null){return null}if(B.getAttribute("externalizable")=="true"){return null}if(B.getAttributeNode("id")){return this.traitsReferences[parseInt(B.getAttributeNode("id").value)]}A=B.childNodes;for(D=0;D<A.length;D++){if(A.item(D).nodeType!=1){continue}C.push(this.readValue(A.item(D)))}this.traitsReferences.push(C);return C},readObjectRef:function(B){var A;A=parseInt(B.getAttribute("id"));return this.objectReferences[A]},readObject:function(G){var A,D=[],B,I,K,F,E,H,J=null,C;C=G.getAttribute("type");if(C){J=Ext.ClassManager.getByAlias("amfx."+C)}A=J?new J():(C?{$className:C}:{});if((!J)&&this.converters[C]){A=this.converters[C](this,G);return A}B=G.getElementsByTagName("traits")[0];D=this.readTraits(B);this.objectReferences.push(A);K=0;for(I=0;I<G.childNodes.length;I++){F=G.childNodes.item(I);if(F.nodeType!=1){continue}if(F.tagName=="traits"){continue}E=D[K];H=this.readValue(F);K=K+1;A[E]=H}return A},readArray:function(A){var B=[],G,C,J,I,H,K,E,F,D;this.objectReferences.push(B);E=parseInt(A.getAttributeNode("length").value);C=0;for(I=0;I<A.childNodes.length;I++){G=A.childNodes.item(I);if(G.nodeType!=1){continue}if(G.tagName=="item"){H=G.getAttributeNode("name").value;F=G.childNodes;for(J=0;J<F.length;J++){D=F.item(J);if(D.nodeType!=1){continue}K=this.readValue(D);break}B[H]=K}else{B[C]=this.readValue(G);C++}}return B},readDictionary:function(A){var B={},H,F,D,C,G,E;E=parseInt(A.getAttribute("length"));this.objectReferences.push(B);H=null;F=null;C=0;for(D=0;D<A.childNodes.length;D++){G=A.childNodes.item(D);if(G.nodeType!=1){continue}if(!H){H=this.readValue(G);continue}F=this.readValue(G);C=C+1;B[H]=F;H=null;F=null}return B},convertObjectWithSourceField:function(B){var D,A,C;for(D=0;D<B.childNodes.length;D++){A=B.childNodes.item(D);if(A.tagName=="bytearray"){C=this.readValue(A);this.objectReferences.push(C);return C}}return null},converters:{"flex.messaging.io.ArrayCollection":function(A,B){return A.convertObjectWithSourceField(B)},"mx.collections.ArrayList":function(A,B){return A.convertObjectWithSourceField(B)},"mx.collections.ArrayCollection":function(A,B){return A.convertObjectWithSourceField(B)}}});Ext.define("Ext.data.amf.XmlEncoder",{alias:"data.amf.xmlencoder",config:{body:""},statics:{generateFlexUID:function(B){var A="",D,E,C;if(B===undefined){B=this.randomInt(0,4294967295)}C=(B+4294967296).toString(16).toUpperCase();A=C.substr(C.length-8,8);for(E=0;E<3;E++){A+="-";for(D=0;D<4;D++){A+=this.randomInt(0,15).toString(16).toUpperCase()}}A+="-";C=new Number(new Date()).valueOf().toString(16).toUpperCase();E=0;if(C.length<8){for(D=0;D<C.length-8;D++){E++;A+="0"}}A+=C.substr(-(8-E));for(D=0;D<4;D++){A+=this.randomInt(0,15).toString(16).toUpperCase()}return A},randomInt:function(A,B){return Math.floor(Math.random()*(B-A+1)+A)}},constructor:function(A){this.initConfig(A);this.clear()},clear:function(){this.setBody("")},encodeUndefined:function(){return this.encodeNull()},writeUndefined:function(){this.write(this.encodeUndefined())},encodeNull:function(){return"<null />"},writeNull:function(){this.write(this.encodeNull())},encodeBoolean:function(A){var B;if(A){B="<true />"}else{B="<false />"}return B},writeBoolean:function(A){this.write(this.encodeBoolean(A))},encodeString:function(A){var B;if(A===""){B="<string />"}else{B="<string>"+A+"</string>"}return B},writeString:function(A){this.write(this.encodeString(A))},encodeInt:function(A){return"<int>"+A.toString()+"</int>"},writeInt:function(A){this.write(this.encodeInt(A))},encodeDouble:function(A){return"<double>"+A.toString()+"</double>"},writeDouble:function(A){this.write(this.encodeDouble(A))},encodeNumber:function(A){var C=536870911,B=-268435455;if(A instanceof Number){A=A.valueOf()}if(A%1===0&&A>=B&&A<=C){return this.encodeInt(A)}else{return this.encodeDouble(A)}},writeNumber:function(A){this.write(this.encodeNumber(A))},encodeDate:function(A){return"<date>"+(new Number(A)).toString()+"</date>"},writeDate:function(A){this.write(this.encodeDate(A))},encodeEcmaElement:function(C,A){var B='<item name="'+C.toString()+'">'+this.encodeObject(A)+"</item>";return B},encodeArray:function(A){var C=[],F,B=[],E=A.length,D,G;for(D in A){if(Ext.isNumeric(D)&&(D%1==0)){C[D]=this.encodeObject(A[D])}else{B.push(this.encodeEcmaElement(D,A[D]))}}F=C.length;for(D=0;D<C.length;D++){if(C[D]===undefined){F=D;break}}if(F<C.length){for(D=firstNonOrdinals;D<C.length;D++){if(C[D]!==undefined){B.push(this.encodeEcmaElement(D,C[D]))}}C=C.slice(0,F)}G='<array length="'+C.length+'"';if(B.length>0){G+=' ecma="true"'}G+=">";for(D=0;D<C.length;D++){G+=C[D]}for(D in B){G+=B[D]}G+="</array>";return G},writeArray:function(A){this.write(this.encodeArray(A))},encodeXml:function(B){var A=this.convertXmlToString(B);return"<xml><![CDATA["+A+"]]></xml>"},writeXml:function(A){this.write(this.encodeXml(A))},encodeGenericObject:function(A){var D=[],E=[],F=null,C,B;for(C in A){if(C=="$flexType"){F=A[C]}else{D.push(this.encodeString(new String(C)));E.push(this.encodeObject(A[C]))}}if(F){B='<object type="'+F+'">'}else{B="<object>"}if(D.length>0){B+="<traits>";B+=D.join("");B+="</traits>"}else{B+="<traits />"}B+=E.join("");B+="</object>";return B},writeGenericObject:function(A){this.write(this.encodeGenericObject(A))},encodeByteArray:function(A){var C,D,B;if(A.length>0){C="<bytearray>";for(D=0;D<A.length;D++){B=A[D].toString(16).toUpperCase();if(A[D]<16){B="0"+B}C+=B}C+="</bytearray>"}else{C="<bytearray />"}return C},writeByteArray:function(A){this.write(this.encodeByteArray(A))},encodeObject:function(A){var B=typeof(A);if(B==="undefined"){return this.encodeUndefined()}else{if(A===null){return this.encodeNull()}else{if(Ext.isBoolean(A)){return this.encodeBoolean(A)}else{if(Ext.isString(A)){return this.encodeString(A)}else{if(B==="number"||A instanceof Number){return this.encodeNumber(A)}else{if(B==="object"){if(A instanceof Date){return this.encodeDate(A)}else{if(Ext.isArray(A)){return this.encodeArray(A)}else{if(this.isXmlDocument(A)){return this.encodeXml(A)}else{return this.encodeGenericObject(A)}}}}else{}}}}}}return null},writeObject:function(A){this.write(this.encodeObject(A))},encodeAmfxRemotingPacket:function(C){var B,A;A='<amfx ver="3" xmlns="http://www.macromedia.com/2005/amfx"><body>';A+=C.encodeMessage();A+="</body></amfx>";return A},writeAmfxRemotingPacket:function(A){this.write(this.encodeAmfxRemotingPacket(A))},convertXmlToString:function(B){var A;if(window.XMLSerializer){A=new window.XMLSerializer().serializeToString(B)}else{A=B.xml}return A},isXmlDocument:function(A){if(window.DOMParser){if(Ext.isDefined(A.doctype)){return true}}if(Ext.isString(A.xml)){return true}return false},write:function(A){this.setBody(this.getBody()+A)}});Ext.define("Ext.direct.AmfRemotingProvider",{alias:"direct.amfremotingprovider",extend:Ext.direct.JsonProvider,config:{namespace:undefined,url:null,endpoint:null,enableUrlEncode:null,binary:false,enableBuffer:10,maxRetries:1,timeout:undefined,actions:{},clientId:null,DSId:null},constructor:function(B){var A=this;A.callParent(arguments);A.transactions=Ext.create("Ext.util.Collection",function(C){return C.getId()});A.callBuffer=[]},applyNamespace:function(A){if(Ext.isString(A)){return Ext.ns(A)}return A||window},initAPI:function(){var G=this.getActions(),H=this.getNamespace(),F,E,C,D,A,B;for(F in G){if(G.hasOwnProperty(F)){E=H[F];if(!E){E=H[F]={}}C=G[F];for(D=0,A=C.length;D<A;++D){B=Ext.create("Ext.direct.RemotingMethod",C[D]);E[B.getName()]=this.createHandler(F,B)}}}},createHandler:function(C,A){var B=this,D;if(!A.getFormHandler()){D=function(){B.configureRequest(C,A,Array.prototype.slice.call(arguments,0))}}else{D=function(G,E,F){B.configureFormRequest(C,A,G,E,F)}}D.directCfg={action:C,method:A};return D},isConnected:function(){return !!this.connected},connect:function(){var A=this;if(A.getUrl()){A.setClientId(Ext.data.amf.XmlEncoder.generateFlexUID());A.initAPI();A.connected=true;A.fireEvent("connect",A);A.setDSId(null)}else{}},disconnect:function(){var A=this;if(A.connected){A.connected=false;A.fireEvent("disconnect",A)}},runCallback:function(B,C){var A=!!C.getStatus(),D=A?"success":"failure",F=B&&B.getCallback(),E;if(F){E=C.getResult();if(Ext.isFunction(F)){F(E,C,A)}else{Ext.callback(F[D],F.scope,[E,C,A]);Ext.callback(F.callback,F.scope,[E,C,A])}}},onData:function(C,D,F){var H=this,J=0,A,B,G,E,I;if(D){B=H.createEvents(F);for(A=B.length;J<A;++J){G=B[J];E=H.getTransaction(G);H.fireEvent("data",H,G);if(E){H.runCallback(E,G,true);Ext.direct.Manager.removeTransaction(E)}}}else{I=[].concat(C.transaction);for(A=I.length;J<A;++J){E=H.getTransaction(I[J]);if(E&&E.getRetryCount()<H.getMaxRetries()){E.retry()}else{G=Ext.create("Ext.direct.ExceptionEvent",{data:null,transaction:E,code:Ext.direct.Manager.exceptions.TRANSPORT,message:"Unable to connect to the server.",xhr:F});H.fireEvent("data",H,G);if(E){H.runCallback(E,G,false);Ext.direct.Manager.removeTransaction(E)}}}}},getTransaction:function(A){return A&&A.getTid?Ext.direct.Manager.getTransaction(A.getTid()):null},configureRequest:function(I,F,G){var H=this,E=F.getCallData(G),A=E.data,B=E.callback,C=E.scope,D;D=Ext.create("Ext.direct.Transaction",{provider:H,args:G,action:I,method:F.getName(),data:A,callback:C&&Ext.isFunction(B)?Ext.Function.bind(B,C):B});if(H.fireEvent("beforecall",H,D,F)!==false){Ext.direct.Manager.addTransaction(D);H.queueTransaction(D);H.fireEvent("call",H,D,F)}},getCallData:function(A){if(this.getBinary()){return{targetUri:A.getAction()+"."+A.getMethod(),responseUri:"/"+A.getId(),body:A.getData()||[]}}else{return new Ext.data.amf.RemotingMessage({body:A.data||[],clientId:this.getClientId(),destination:A.getAction(),headers:{DSEndpoint:this.getEndpoint(),DSId:this.getDSId()||"nil"},messageId:Ext.data.amf.XmlEncoder.generateFlexUID(A.getId()),operation:A.getMethod(),timestamp:0,timeToLive:0})}},sendRequest:function(K){var C=this,G={url:C.getUrl(),callback:C.onData,scope:C,transaction:K,timeout:C.getTimeout()},H,E=C.getEnableUrlEncode(),A=0,D,F,B,J=[],I=[];if(Ext.isArray(K)){for(A=0,D=K.length;A<D;++A){J.push(C.getCallData(K[A]))}}else{J.push(C.getCallData(K))}if(C.getBinary()){B=new Ext.data.amf.Encoder({format:0});B.writeAmfPacket(I,J);G.binaryData=B.getBytes();G.binary=true;G.headers={"Content-Type":"application/x-amf"}}else{B=new Ext.data.amf.XmlEncoder();B.writeAmfxRemotingPacket(J[0]);G.xmlData=B.getBody()}Ext.Ajax.request(G)},queueTransaction:function(B){var A=this,C=false;if(B.getForm()){A.sendFormRequest(B);return}A.callBuffer.push(B);if(C){if(!A.callTask){A.callTask=Ext.create("Ext.util.DelayedTask",A.combineAndSend,A)}A.callTask.delay(Ext.isNumber(C)?C:10)}else{A.combineAndSend()}},combineAndSend:function(){var B=this.callBuffer,A=B.length;if(A>0){this.sendRequest(A==1?B[0]:B);this.callBuffer=[]}},createEvents:function(E){var I=null,H=[],B=[],F,G=0,C,D;try{if(this.getBinary()){D=new Ext.data.amf.Packet();I=D.decode(E.responseBytes)}else{D=new Ext.data.amf.XmlDecoder();I=D.readAmfxMessage(E.responseText)}}catch(A){F=new Ext.direct.ExceptionEvent({data:A,xhr:E,code:Ext.direct.Manager.exceptions.PARSE,message:"Error parsing AMF response: \n\n "+I});return[F]}if(this.getBinary()){for(G=0;G<I.getMessages().length;G++){B.push(this.createEvent(I.getMessages()[G]))}}else{B.push(this.createEvent(I))}return B},createEvent:function(E){var D=E.targetURI.split("/"),A,C,G,F,B=this;if(B.getBinary()){A=D[1];F=2}else{A=Ext.data.amf.XmlDecoder.decodeTidFromFlexUID(E.message.correlationId);F=1}if(D[F]=="onStatus"){G={tid:A,data:(B.getBinary()?E.body:E.message),code:(B.getBinary()?E.body.code:E.message.faultCode),message:(B.getBinary()?E.body.message:E.message.faultString)};C=Ext.create("direct.exception",G)}else{if(D[F]=="onResult"){G={tid:A,data:(B.getBinary()?E.body:E.message),result:(B.getBinary()?E.body:E.message.body)};C=Ext.create("direct.rpc",G)}else{}}return C}});
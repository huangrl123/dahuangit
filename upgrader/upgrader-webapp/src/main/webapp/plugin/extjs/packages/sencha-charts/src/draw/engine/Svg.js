Ext.define("Ext.draw.engine.Svg",{extend:"Ext.draw.Surface",requires:["Ext.draw.engine.SvgContext"],statics:{BBoxTextCache:{}},config:{highPrecision:false},getElementConfig:function(){return{reference:"element",style:{position:"absolute"},children:[{reference:"innerElement",style:{width:"100%",height:"100%",position:"relative"},children:[{tag:"svg",reference:"svgElement",namespace:"http://www.w3.org/2000/svg",version:1.1}]}]}},constructor:function(A){var B=this;B.callParent([A]);B.mainGroup=B.createSvgNode("g");B.defElement=B.createSvgNode("defs");B.svgElement.appendChild(B.mainGroup);B.svgElement.appendChild(B.defElement);B.ctx=new Ext.draw.engine.SvgContext(B)},createSvgNode:function(A){var B=document.createElementNS("http://www.w3.org/2000/svg",A);return Ext.get(B)},getSvgElement:function(B,A,C){var D;if(B.dom.childNodes.length>C){D=B.dom.childNodes[C];if(D.tagName===A){return Ext.get(D)}else{Ext.destroy(D)}}D=Ext.get(this.createSvgNode(A));if(C===0){B.insertFirst(D)}else{D.insertAfter(Ext.fly(B.dom.childNodes[C-1]))}D.cache={};return D},setElementAttributes:function(F,C){var A=F.dom,B=F.cache,D,E;for(D in C){E=C[D];if(B[D]!==E){B[D]=E;A.setAttribute(D,E)}}},getNextDef:function(A){return this.getSvgElement(this.defElement,A,this.defPosition++)},clearTransform:function(){var A=this;A.mainGroup.set({transform:A.matrix.toSvg()})},clear:function(){this.ctx.clear();this.defPosition=0},renderSprite:function(E){var C=this,B=C.getRect(),D=C.ctx;if(E.attr.hidden||E.attr.opacity===0){D.save();D.restore();return}try{E.element=D.save();E.preRender(this);E.useAttributes(D,B);if(false===E.render(this,D,[0,0,B[2],B[3]])){return false}E.setDirty(false)}catch(A){Ext.log.error(this.$className+": Unhandled Exception: ",A.description||A.message);throw A}finally{D.restore()}},flatten:function(A,E){var F='<?xml version="1.0" standalone="yes"?>',B=Ext.getClassName(this),G,D,C;F+='<svg version="1.1" baseProfile="full" xmlns="http://www.w3.org/2000/svg" width="'+A.width+'" height="'+A.height+'">';for(C=0;C<E.length;C++){G=E[C];if(Ext.getClassName(G)!==B){continue}D=G.getRect();F+='<g transform="translate('+D[0]+","+D[1]+')">';F+=this.serializeNode(G.svgElement.dom);F+="</g>"}F+="</svg>";return{data:"data:image/svg+xml;utf8,"+encodeURIComponent(F),type:"svg"}},serializeNode:function(E){var D="",B,C,F,A;if(E.nodeType===document.TEXT_NODE){return E.nodeValue}D+="<"+E.nodeName;if(E.attributes.length){for(B=0,C=E.attributes.length;B<C;B++){F=E.attributes[B];D+=" "+F.name+'="'+F.value+'"'}}D+=">";if(E.childNodes&&E.childNodes.length){for(B=0,C=E.childNodes.length;B<C;B++){A=E.childNodes[B];D+=this.serializeNode(A)}}D+="</"+E.nodeName+">";return D},destroy:function(D,A,B){var C=this;C.ctx.destroy();C.mainGroup.destroy();delete C.mainGroup;delete C.ctx;C.callParent(arguments)},remove:function(B,A){if(B&&B.element){if(this.ctx){this.ctx.removeElement(B.element)}else{B.element.destroy()}B.element=null}this.callParent(arguments)}});
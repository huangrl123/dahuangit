Ext.define("Ext.direct.PollingProvider",{extend:"Ext.direct.JsonProvider",alias:"direct.pollingprovider",requires:["Ext.Ajax","Ext.util.DelayedTask"],uses:["Ext.direct.ExceptionEvent","Ext.direct.Manager"],interval:3000,isConnected:function(){return !!this.pollTask},connect:function(){var B=this,A=B.url;if(A&&!B.pollTask){B.pollTask=Ext.TaskManager.start({run:B.runPoll,interval:B.interval,scope:B});B.fireEvent("connect",B)}else{if(!A){Ext.Error.raise("Error initializing PollingProvider, no url configured.")}}},disconnect:function(){var A=this;if(A.pollTask){Ext.TaskManager.stop(A.pollTask);delete A.pollTask;A.fireEvent("disconnect",A)}},runPoll:function(){var B=this,A=B.url;if(B.fireEvent("beforepoll",B)!==false){if(Ext.isFunction(A)){A(B.baseParams)}else{Ext.Ajax.request({url:A,callback:B.onData,scope:B,params:B.baseParams})}B.fireEvent("poll",B)}},onData:function(C,A,G){var D=this,B,E,F;if(A){F=D.createEvents(G);for(B=0,E=F.length;B<E;++B){D.fireEvent("data",D,F[B])}}else{F=new Ext.direct.ExceptionEvent({data:null,code:Ext.direct.Manager.exceptions.TRANSPORT,message:"Unable to connect to the server.",xhr:G});D.fireEvent("data",D,F)}}});
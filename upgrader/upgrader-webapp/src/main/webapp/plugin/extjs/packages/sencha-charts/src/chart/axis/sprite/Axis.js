Ext.define("Ext.chart.axis.sprite.Axis",{extend:"Ext.draw.sprite.Sprite",type:"axis",mixins:{markerHolder:"Ext.chart.MarkerHolder"},requires:["Ext.draw.sprite.Text"],inheritableStatics:{def:{processors:{grid:"bool",axisLine:"bool",minorTicks:"bool",minorTickSize:"number",majorTicks:"bool",majorTickSize:"number",length:"number",startGap:"number",endGap:"number",dataMin:"number",dataMax:"number",visibleMin:"number",visibleMax:"number",position:"enums(left,right,top,bottom,angular,radial,gauge)",minStepSize:"number",estStepSize:"number",titleOffset:"number",textPadding:"number",min:"number",max:"number",centerX:"number",centerY:"number",radius:"number",totalAngle:"number",baseRotation:"number",data:"default",enlargeEstStepSizeByText:"bool"},defaults:{grid:false,axisLine:true,minorTicks:false,minorTickSize:3,majorTicks:true,majorTickSize:5,length:0,startGap:0,endGap:0,visibleMin:0,visibleMax:1,dataMin:0,dataMax:1,position:"",minStepSize:0,estStepSize:20,min:0,max:1,centerX:0,centerY:0,radius:1,baseRotation:0,data:null,titleOffset:0,textPadding:5,scalingCenterY:0,scalingCenterX:0,strokeStyle:"black",enlargeEstStepSizeByText:false},dirtyTriggers:{minorTickSize:"bbox",majorTickSize:"bbox",position:"bbox,layout",axisLine:"bbox,layout",min:"layout",max:"layout",length:"layout",minStepSize:"layout",estStepSize:"layout",data:"layout",dataMin:"layout",dataMax:"layout",visibleMin:"layout",visibleMax:"layout",enlargeEstStepSizeByText:"layout"},updaters:{layout:function(){this.doLayout()}}}},config:{label:null,layout:null,segmenter:null,renderer:null,layoutContext:null,axis:null},thickness:0,stepSize:0,getBBox:function(){return null},doLayout:function(){var H=this,C=H.getAxis().getChart();if(C.isInitializing){return}var D=H.attr,G=H.getLayout(),F=C.getInherited().rtl,A=D.dataMin+(D.dataMax-D.dataMin)*D.visibleMin,B=D.dataMin+(D.dataMax-D.dataMin)*D.visibleMax,E={attr:D,segmenter:H.getSegmenter()};if(D.position==="left"||D.position==="right"){D.translationX=0;D.translationY=B*D.length/(B-A);D.scalingX=1;D.scalingY=-D.length/(B-A);D.scalingCenterY=0;D.scalingCenterX=0;H.applyTransformations(true)}else{if(D.position==="top"||D.position==="bottom"){if(F){D.translationX=D.length+A*D.length/(B-A)+1}else{D.translationX=-A*D.length/(B-A)}D.translationY=0;D.scalingX=(F?-1:1)*D.length/(B-A);D.scalingY=1;D.scalingCenterY=0;D.scalingCenterX=0;H.applyTransformations(true)}}if(G){G.calculateLayout(E);H.setLayoutContext(E)}},iterate:function(I,F){var E,G,H,K,A,D=Ext.Array.some,C=Math.abs,J;if(I.getLabel){if(I.min<I.from){F.call(this,I.min,I.getLabel(I.min),-1,I)}for(E=0;E<=I.steps;E++){F.call(this,I.get(E),I.getLabel(E),E,I)}if(I.max>I.to){F.call(this,I.max,I.getLabel(I.max),I.steps+1,I)}}else{K=this.getAxis().floatingAxes;A=[];J=(I.to-I.from)/(I.steps+1);for(H in K){A.push(K[H])}function B(L){return !A.length||D(A,function(M){return C(M-L)>J})}if(I.min<I.from&&B(I.min)){F.call(this,I.min,I.min,-1,I)}for(E=0;E<=I.steps;E++){G=I.get(E);if(B(G)){F.call(this,G,G,E,I)}}if(I.max>I.to&&B(I.max)){F.call(this,I.max,I.max,I.steps+1,I)}}},renderTicks:function(M,H,I,O){var F=this,E=F.attr,K=E.position,J=E.matrix,G=0.5*E.lineWidth,Q=J.getXX(),L=J.getDX(),C=J.getYY(),T=J.getDY(),U=I.majorTicks,A=E.majorTickSize,V=I.minorTicks,D=E.minorTickSize;if(U){switch(K){case"right":function B(W){return function(Y,Z,X){Y=M.roundPixel(Y*C+T)+G;H.moveTo(0,Y);H.lineTo(W,Y)}}F.iterate(U,B(A));V&&F.iterate(V,B(D));break;case"left":function S(W){return function(Y,Z,X){Y=M.roundPixel(Y*C+T)+G;H.moveTo(O[2]-W,Y);H.lineTo(O[2],Y)}}F.iterate(U,S(A));V&&F.iterate(V,S(D));break;case"bottom":function P(W){return function(Y,Z,X){Y=M.roundPixel(Y*Q+L)-G;H.moveTo(Y,0);H.lineTo(Y,W)}}F.iterate(U,P(A));V&&F.iterate(V,P(D));break;case"top":function N(W){return function(Y,Z,X){Y=M.roundPixel(Y*Q+L)-G;H.moveTo(Y,O[3]);H.lineTo(Y,O[3]-W)}}F.iterate(U,N(A));V&&F.iterate(V,N(D));break;case"angular":F.iterate(U,function(X,Y,W){X=X/(E.max+1)*Math.PI*2+E.baseRotation;H.moveTo(E.centerX+(E.length)*Math.cos(X),E.centerY+(E.length)*Math.sin(X));H.lineTo(E.centerX+(E.length+A)*Math.cos(X),E.centerY+(E.length+A)*Math.sin(X))});break;case"gauge":var R=F.getGaugeAngles();F.iterate(U,function(X,Y,W){X=(X-E.min)/(E.max-E.min+1)*E.totalAngle-E.totalAngle+R.start;H.moveTo(E.centerX+(E.length)*Math.cos(X),E.centerY+(E.length)*Math.sin(X));H.lineTo(E.centerX+(E.length+A)*Math.cos(X),E.centerY+(E.length+A)*Math.sin(X))});break}}},renderLabels:function(h,H,d,F){var I=this,S=I.attr,a=0.5*S.lineWidth,M=S.position,O=S.matrix,Y=S.textPadding,P=O.getXX(),Z=O.getDX(),N=O.getYY(),R=O.getDY(),W=0,C=d.majorTicks,K=Math.max(S.majorTickSize,S.minorTickSize)+S.lineWidth,L=I.getLabel(),A,e,X=null,D=0,U=0,J=d.segmenter,f=I.getRenderer(),E=I.getAxis().getTitle(),T=E&&E.attr.text!==""&&E.getBBox(),g,V=null,G,B,Q,b;if(C&&L&&!L.attr.hidden){A=L.attr.font;if(H.font!==A){H.font=A}L.setAttributes({translationX:0,translationY:0},true,true);L.applyTransformations();g=L.attr.inverseMatrix.elements.slice(0);switch(M){case"left":b=T?T.x+T.width:0;L.setAttributes({translationX:h.roundPixel(b+(F[2]-b-K)/2+Z)-a},true,true);break;case"right":b=T?F[2]-T.x:0;L.setAttributes({translationX:h.roundPixel(K+(F[2]-K-b)/2+Z)+a},true,true);break;case"top":b=T?T.y+T.height:0;L.setAttributes({translationY:h.roundPixel(b+(F[3]-b-K)/2)-a},true,true);break;case"bottom":b=T?F[3]-T.y:0;L.setAttributes({translationY:h.roundPixel(K+(F[3]-K-b)/2)+a},true,true);break;case"radial":L.setAttributes({translationX:S.centerX},true,true);break;case"angular":L.setAttributes({translationY:S.centerY},true,true);break;case"gauge":L.setAttributes({translationY:S.centerY},true,true);break}if(M==="left"||M==="right"){I.iterate(C,function(k,l,j){if(l===undefined){return}Q=f?f.call(I,l,d,X):J.renderer(l,d,X);X=l;L.setAttributes({text:String(Q),translationY:h.roundPixel(k*N+R)},true,true);L.applyTransformations();W=Math.max(W,L.getBBox().width+K);if(W<=I.thickness){B=Ext.draw.Matrix.fly(L.attr.matrix.elements.slice(0));G=B.prepend.apply(B,g).transformBBox(L.getBBox(true));if(V&&!Ext.draw.Draw.isBBoxIntersect(G,V,Y)){return}h.renderSprite(L);V=G;D+=G.height;U++}})}else{if(M==="top"||M==="bottom"){I.iterate(C,function(k,l,j){if(l===undefined){return}Q=f?f.call(this,l,d,X):J.renderer(l,d,X);X=l;L.setAttributes({text:String(Q),translationX:h.roundPixel(k*P+Z)},true,true);L.applyTransformations();W=Math.max(W,L.getBBox().height+K);if(W<=I.thickness){B=Ext.draw.Matrix.fly(L.attr.matrix.elements.slice(0));G=B.prepend.apply(B,g).transformBBox(L.getBBox(true));if(V&&!Ext.draw.Draw.isBBoxIntersect(G,V,Y)){return}h.renderSprite(L);V=G;D+=G.width;U++}})}else{if(M==="radial"){I.iterate(C,function(k,l,j){if(l===undefined){return}Q=f?f.call(I,l,d,X):J.renderer(l,d,X);X=l;if(typeof Q!=="undefined"){L.setAttributes({text:String(Q),translationX:S.centerX-h.roundPixel(k)/S.max*S.length*Math.cos(S.baseRotation+Math.PI/2),translationY:S.centerY-h.roundPixel(k)/S.max*S.length*Math.sin(S.baseRotation+Math.PI/2)},true,true);L.applyTransformations();G=L.attr.matrix.transformBBox(L.getBBox(true));if(V&&!Ext.draw.Draw.isBBoxIntersect(G,V)){return}h.renderSprite(L);V=G;D+=G.width;U++}})}else{if(M==="angular"){e=S.majorTickSize+S.lineWidth*0.5+(parseInt(L.attr.fontSize,10)||10)/2;I.iterate(C,function(k,l,j){if(l===undefined){return}Q=f?f.call(I,l,d,X):J.renderer(l,d,X);X=l;W=Math.max(W,Math.max(S.majorTickSize,S.minorTickSize)+(S.lineCap!=="butt"?S.lineWidth*0.5:0));if(typeof Q!=="undefined"){var m=k/(S.max+1)*Math.PI*2+S.baseRotation;L.setAttributes({text:String(Q),translationX:S.centerX+(S.length+e)*Math.cos(m),translationY:S.centerY+(S.length+e)*Math.sin(m)},true,true);L.applyTransformations();G=L.attr.matrix.transformBBox(L.getBBox(true));if(V&&!Ext.draw.Draw.isBBoxIntersect(G,V)){return}h.renderSprite(L);V=G;D+=G.width;U++}})}else{if(M==="gauge"){var c=I.getGaugeAngles();I.iterate(C,function(k,l,j){if(l===undefined){return}Q=f?f.call(I,l,d,X):J.renderer(l,d,X);X=l;if(typeof Q!=="undefined"){var m=(k-S.min)/(S.max-S.min+1)*S.totalAngle-S.totalAngle+c.start;L.setAttributes({text:String(Q),translationX:S.centerX+(S.length+10)*Math.cos(m),translationY:S.centerY+(S.length+10)*Math.sin(m)},true,true);L.applyTransformations();G=L.attr.matrix.transformBBox(L.getBBox(true));if(V&&!Ext.draw.Draw.isBBoxIntersect(G,V)){return}h.renderSprite(L);V=G;D+=G.width;U++}})}}}}}if(S.enlargeEstStepSizeByText&&U){D/=U;D+=K;D*=2;if(S.estStepSize<D){S.estStepSize=D}}if(Math.abs(I.thickness-(W))>1){I.thickness=W;S.bbox.plain.dirty=true;S.bbox.transform.dirty=true;I.doThicknessChanged();return false}}},renderAxisLine:function(B,D,E,C){var I=this,A=I.attr,H=A.lineWidth*0.5,J=A.position,G,F;if(A.axisLine&&A.length){switch(J){case"left":G=B.roundPixel(C[2])-H;D.moveTo(G,-A.endGap);D.lineTo(G,A.length+A.startGap);break;case"right":D.moveTo(H,-A.endGap);D.lineTo(H,A.length+A.startGap);break;case"bottom":D.moveTo(-A.startGap,H);D.lineTo(A.length+A.endGap,H);break;case"top":G=B.roundPixel(C[3])-H;D.moveTo(-A.startGap,G);D.lineTo(A.length+A.endGap,G);break;case"angular":D.moveTo(A.centerX+A.length,A.centerY);D.arc(A.centerX,A.centerY,A.length,0,Math.PI*2,true);break;case"gauge":F=I.getGaugeAngles();D.moveTo(A.centerX+Math.cos(F.start)*A.length,A.centerY+Math.sin(F.start)*A.length);D.arc(A.centerX,A.centerY,A.length,F.start,F.end,true);break}}},getGaugeAngles:function(){var B=this,C=B.attr.totalAngle,A;if(C<=Math.PI){A=(Math.PI-C)*0.5}else{A=-(Math.PI*2-C)*0.5}A=Math.PI*2-A;return{start:A,end:A-C}},renderGridLines:function(K,F,G,L){var D=this,C=D.attr,H=C.matrix,E=C.startGap,O=C.endGap,N=H.getXX(),B=H.getYY(),J=H.getDX(),P=H.getDY(),Q=C.position,R=G.majorTicks,A,I,M;if(C.grid){if(R){if(Q==="left"||Q==="right"){M=C.min*B+P+O+E;D.iterate(R,function(T,U,S){A=T*B+P+O;D.putMarker("horizontal-"+(S%2?"odd":"even"),{y:A,height:M-A},I=S,true);M=A});I++;A=0;D.putMarker("horizontal-"+(I%2?"odd":"even"),{y:A,height:M-A},I,true)}else{if(Q==="top"||Q==="bottom"){M=C.min*N+J+E;if(E){D.putMarker("vertical-even",{x:0,width:M},-1,true)}D.iterate(R,function(T,U,S){A=T*N+J+E;D.putMarker("vertical-"+(S%2?"odd":"even"),{x:A,width:M-A},I=S,true);M=A});I++;A=C.length+C.startGap+C.endGap;D.putMarker("vertical-"+(I%2?"odd":"even"),{x:A,width:M-A},I,true)}else{if(Q==="radial"){D.iterate(R,function(T,U,S){if(!T){return}A=T/C.max*C.length;D.putMarker("circular-"+(S%2?"odd":"even"),{scalingX:A,scalingY:A},S,true);M=A})}else{if(Q==="angular"){D.iterate(R,function(T,U,S){if(!C.length){return}A=T/(C.max+1)*Math.PI*2+C.baseRotation;D.putMarker("radial-"+(S%2?"odd":"even"),{rotationRads:A,rotationCenterX:0,rotationCenterY:0,scalingX:C.length,scalingY:C.length},S,true);M=A})}}}}}}},renderLimits:function(){var D=this,J=D.getAxis(),L=Ext.Array.from(J.getLimits());if(!L.length){return}var Q=J.limits.surface.getRect(),H=D.attr,F=H.matrix,M=H.position,G=Ext.Object.chain,A=J.limits.titles,C,K,B,R,O,N,E,I,P;A.instances=[];A.position=0;if(M==="left"||M==="right"){for(N=0,E=L.length;N<E;N++){R=G(L[N]);!R.line&&(R.line={});O=Ext.isString(R.value)?J.getCoordFor(R.value):R.value;O=O*F.getYY()+F.getDY();R.line.y=O;D.putMarker("horizontal-limit-lines",R.line,N,true);if(R.line.title){A.createInstance(R.line.title);C=A.getBBoxFor(A.position-1);K=R.line.title.position||(M==="left"?"start":"end");switch(K){case"start":I=10;break;case"end":I=Q[2]-10;break;case"middle":I=Q[2]/2;break}A.setAttributesFor(A.position-1,{x:I,y:O-C.height/2,textAlign:K,fillStyle:R.line.title.fillStyle||R.line.strokeStyle})}}}else{if(M==="top"||M==="bottom"){for(N=0,E=L.length;N<E;N++){R=G(L[N]);!R.line&&(R.line={});O=Ext.isString(R.value)?J.getCoordFor(R.value):R.value;O=O*F.getXX()+F.getDX();R.line.x=O;D.putMarker("vertical-limit-lines",R.line,N,true);if(R.line.title){A.createInstance(R.line.title);C=A.getBBoxFor(A.position-1);K=R.line.title.position||(M==="top"?"end":"start");switch(K){case"start":P=Q[3]-C.width/2-10;break;case"end":P=C.width/2+10;break;case"middle":P=Q[3]/2;break}A.setAttributesFor(A.position-1,{x:O+C.height/2,y:P,fillStyle:R.line.title.fillStyle||R.line.strokeStyle,rotationRads:Math.PI/2})}}}else{if(M==="radial"){for(N=0,E=L.length;N<E;N++){R=G(L[N]);!R.line&&(R.line={});O=Ext.isString(R.value)?J.getCoordFor(R.value):R.value;if(O>H.max){continue}O=O/H.max*H.length;R.line.cx=H.centerX;R.line.cy=H.centerY;R.line.scalingX=O;R.line.scalingY=O;D.putMarker("circular-limit-lines",R.line,N,true);if(R.line.title){A.createInstance(R.line.title);C=A.getBBoxFor(A.position-1);A.setAttributesFor(A.position-1,{x:H.centerX,y:H.centerY-O-C.height/2,fillStyle:R.line.title.fillStyle||R.line.strokeStyle})}}}else{if(M==="angular"){for(N=0,E=L.length;N<E;N++){R=G(L[N]);!R.line&&(R.line={});O=Ext.isString(R.value)?J.getCoordFor(R.value):R.value;O=O/(H.max+1)*Math.PI*2+H.baseRotation;R.line.translationX=H.centerX;R.line.translationY=H.centerY;R.line.rotationRads=O;R.line.rotationCenterX=0;R.line.rotationCenterY=0;R.line.scalingX=H.length;R.line.scalingY=H.length;D.putMarker("radial-limit-lines",R.line,N,true);if(R.line.title){A.createInstance(R.line.title);C=A.getBBoxFor(A.position-1);B=((O>-0.5*Math.PI&&O<0.5*Math.PI)||(O>1.5*Math.PI&&O<2*Math.PI))?1:-1;A.setAttributesFor(A.position-1,{x:H.centerX+0.5*H.length*Math.cos(O)+B*C.height/2*Math.sin(O),y:H.centerY+0.5*H.length*Math.sin(O)-B*C.height/2*Math.cos(O),rotationRads:B===1?O:O-Math.PI,fillStyle:R.line.title.fillStyle||R.line.strokeStyle})}}}else{if(M==="gauge"){}}}}}},doThicknessChanged:function(){var A=this.getAxis();if(A){A.onThicknessChanged()}},render:function(E,D,A){var B=this,C=B.getLayoutContext();if(C){if(false===B.renderLabels(E,D,C,A)){return false}D.beginPath();B.renderTicks(E,D,C,A);B.renderAxisLine(E,D,C,A);B.renderGridLines(E,D,C,A);B.renderLimits();D.stroke()}}});
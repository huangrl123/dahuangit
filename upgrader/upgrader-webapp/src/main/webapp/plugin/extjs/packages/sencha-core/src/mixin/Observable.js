Ext.define("Ext.mixin.Observable",{requires:["Ext.event.Dispatcher"],extend:"Ext.Mixin",mixins:["Ext.mixin.Identifiable"],mixinConfig:{id:"observable",after:{destroy:"destroy"}},isObservable:true,observableType:"observable",validIdRe:Ext.validIdRe,observableIdPrefix:"#",listenerOptionsRegex:/^(?:delegate|delegated|single|delay|buffer|args|prepend|capture|destroyable|translate)$/,eventFiringSuspended:0,config:{listeners:{$value:null,merge:function(D,A,C){var B=D;if(C.isInstance){if(C._hasDeclaredListeners){B=[C.self.getDeclaredListeners(),D]}}else{if(!C.listeners){C.listeners=C.getDeclaredListeners()}if(D){C.prototype._hasDeclaredListeners=true;C.listeners.push(D)}}return B}},bubbleEvents:null},inheritableStatics:{getDeclaredListeners:function(){var D=this,G=D.superclass,F=D.listeners,C=D.prototype,A,E,B;if(!F){F=D.listeners=[];if(G.isObservable){F.push(G.self.getDeclaredListeners())}if(C.hasOwnProperty("mixins")){A=C.mixins;for(E in A){B=A[E];if(B.isObservable){F.push(B.self.getDeclaredListeners())}}}}return F}},afterClassMixedIn:function(A){var B=A.prototype,C=B.listeners;if(C){delete B.listeners;A.getConfigurator().add({listeners:C})}},constructor:function(A){var B=this;B.initConfig(A);B.getEventDispatcher().getHasListeners(B.observableType,B)},applyListeners:function(A){if(A){if(A instanceof Array){Ext.each(A,this.applyListeners,this)}else{this.addListener(A)}}return A},resolveListenerScope:function(A){if(A==="controller"){Ext.Error.raise('scope: "controller" can only be specified on components that derive from component')}if(A==="this"){A=null}return A||this},applyBubbleEvents:function(A){if(A){this.enableBubble(A)}},getOptimizedObservableId:function(){return this.observableId},getObservableId:function(){var A=this,C,B;if(!A.observableId){C=A.getUniqueId();B=A.validIdRe;if(B&&!B.test(C)){Ext.Error.raise('Invalid unique id "'+C+'" for object of type '+A.$className)}A.observableId=A.observableIdPrefix+C;A.getObservableId=A.getOptimizedObservableId}return A.observableId},getOptimizedEventDispatcher:function(){return this.eventDispatcher},createEventDispatcher:function(){var B=this,A;B.eventDispatcher=A=Ext.event.Dispatcher.getInstance();B.getEventDispatcher=B.getOptimizedEventDispatcher;B.getListeners();B.getBubbleEvents();return A},getEventDispatcher:function(){var A=this.eventDispatcher;if(!A){A=this.createEventDispatcher()}return A},getManagedListeners:function(A,B){var D=A.getUniqueId(),C=this.managedListeners;if(!C){this.managedListeners=C={}}if(!C[D]){C[D]={};A.doAddListener("destroy","clearManagedListeners",this,{single:true,args:[A]})}if(!C[D][B]){C[D][B]=[]}return C[D][B]},getUsedSelectors:function(){var A=this.usedSelectors;if(!A){A=this.usedSelectors=[];A.$map={}}return A},fireEvent:function(A){var B=Array.prototype.slice.call(arguments,1);return this.doFireEvent(A,B)},fireEventArgs:function(A,B){return this.doFireEvent(A,B)},fireAction:function(C,A,F,B,E,G){var D=typeof F,H;if(A===undefined){A=[]}if(D!=="undefined"){H={fn:F,isLateBinding:D==="string",scope:B||this,options:E||{},order:G}}return this.doFireEvent(C,A,H)},doFireEvent:function(B,A,I,F){var H=this,D=H.eventQueue,G=Ext.$eventNameMap,E=H.suspendedEvents,C=true;B=G[B]||(G[B]=B.toLowerCase());if(H.eventFiringSuspended||(E&&E[B])){if(D){D.push([B,A,I,F])}}else{C=H.getEventDispatcher().dispatchEvent(H.observableType,H.getObservableId(),B,A,I,F)}return C},doAddListener:function(B,I,D,H,K){var E=this,A=(D&&D!==E&&D.isIdentifiable),G=E.getUsedSelectors(),J=G.$map,L=E.getObservableId(),F,C,M;if(!H){H={}}if(!D&&typeof I==="function"){D=E}if(H.delegate){M=H.delegate;L+=" "+M}if(!(L in J)){J[L]=true;G.push(L)}F=E.addDispatcherListener(L,B,I,D,H,K);if(F&&A){C=E.getManagedListeners(D,B);C.push({delegate:M,scope:D,fn:I,order:K})}return F},addDispatcherListener:function(E,D,C,B,A,F){return this.getEventDispatcher().addListener(this.observableType,E,D,C,B,A,F,this)},doRemoveListener:function(B,I,D,G,K){var F=this,A=(D&&D!==F&&D.isIdentifiable),L=F.getObservableId(),M,C,H,E,J,N;if(!G){G={}}if(!D&&typeof I==="function"){D=F}if(G.delegate){N=G.delegate;L+=" "+N}M=F.removeDispatcherListener(L,B,I,D,G,K);if(M&&A){C=F.getManagedListeners(D,B);for(H=0,E=C.length;H<E;H++){J=C[H];if(J.fn===I&&J.scope===D&&J.delegate===N&&J.order===K){C.splice(H,1);break}}}return M},removeDispatcherListener:function(E,D,C,B,A,F){return this.getEventDispatcher().removeListener(this.observableType,E,D,C,B,A,F,this)},clearManagedListeners:function(I){var A=this,C=A.managedListeners,J,F,K,E,G,D,B,H;if(!C){return A}if(I){if(typeof I!=="string"){J=I.getUniqueId()}else{J=I}F=C[J];for(E in F){if(F.hasOwnProperty(E)){K=F[E];for(G=0,D=K.length;G<D;G++){B=K[G];H={};if(B.delegate){H.delegate=B.delegate}if(A.doRemoveListener(E,B.fn,B.scope,H,B.order)){G--;D--}}}}delete C[J];return A}for(J in C){if(C.hasOwnProperty(J)){A.clearManagedListeners(J)}}},changeListener:function(B,H,P,F,L,G){var E=this,J=Ext.$eventNameMap,K,C,A,N,Q,O,D,M,I,R;if(typeof P!=="undefined"){if(typeof H!=="string"){for(D=0,M=H.length;D<M;D++){Q=H[D];Q=J[Q]||(J[Q]=Q.toLowerCase());B.call(E,Q,P,F,L,G)}return E}H=J[H]||(J[H]=H.toLowerCase());B.call(E,H,P,F,L,G)}else{if(Ext.isArray(H)){C=H;for(D=0,M=C.length;D<M;D++){I=C[D];H=I.event;H=J[H]||(J[H]=H.toLowerCase());B.call(E,H,I.fn,I.scope,I,I.order)}}else{A=E.listenerOptionsRegex;L=H;K=[];C=[];N={};for(Q in L){O=L[Q];if(Q==="scope"){F=O;continue}else{if(Q==="order"){G=O;continue}}if(!A.test(Q)){Q=J[Q]||(J[Q]=Q.toLowerCase());R=typeof O;if(R!=="string"&&R!=="function"){B.call(this,Q,O.fn,O.scope||F,O,O.order||G);continue}K.push(Q);C.push(O)}else{N[Q]=O}}for(D=0,M=K.length;D<M;D++){B.call(E,K[D],C[D],F,N,G)}}}return E},addListener:function(D,F,C,E,G){var A=this,H,B;if(E){H=E.destroyable}else{if(typeof D==="object"){H=D.destroyable}}B=A.changeListener(A.doAddListener,D,F,C,E,G);if(H){B=new Ext.mixin.Observable.$ListenerRemover(A,D,F,C,E,G)}return B},toggleListener:function(D,B,C,E,A,F){return this.changeListener(D?this.doAddListener:this.doRemoveListener,B,C,E,A,F)},addBeforeListener:function(C,B,D,A){return this.addListener(C,B,D,A,"before")},addAfterListener:function(C,B,D,A){return this.addListener(C,B,D,A,"after")},removeListener:function(C,B,D,A,E){return this.changeListener(this.doRemoveListener,C,B,D,A,E)},removeBeforeListener:function(C,B,D,A){return this.removeListener(C,B,D,A,"before")},removeAfterListener:function(C,B,D,A){return this.removeListener(C,B,D,A,"after")},clearListeners:function(){var D=this,F=D.getUsedSelectors(),C=D.getEventDispatcher(),A,B,E;for(A=0,B=F.length;A<B;A++){E=F[A];C.clearListeners(D.observableType,E,D)}},hasListener:function(A){return this.getEventDispatcher().hasListener(this.observableType,this.getObservableId(),A)},isSuspended:function(B){var C=Ext.$eventNameMap,A=this.suspendedEvents;if(B){B=C[B]||(C[B]=B.toLowerCase())}return !!(this.eventFiringSuspended||(A&&A[B]))},suspendEvents:function(A){++this.eventFiringSuspended;if(A&&!this.eventQueue){this.eventQueue=[]}},suspendEvent:function(){var F=arguments,B=this.suspendedEvents,D=Ext.$eventNameMap,E=F.length,A,C;if(!B){B=this.suspendedEvents={}}for(A=0;A<E;A++){C=F[A];C=D[C]||(D[C]=C.toLowerCase());if(!(C in B)){B[C]=0}++B[C]}},resumeEvents:function(B){var C=this,G=C.eventQueue||[],D=C.suspendedEvents,E,A,F;if(C.eventFiringSuspended&&!--C.eventFiringSuspended){if(!B){for(A=0,F=G.length;A<F;A++){E=G[A];if(!(D&&D[E[0]])){C.doFireEvent.apply(C,E)}}}C.eventQueue=null}},resumeEvent:function(){var D=this,G=arguments,C=D.suspendedEvents,E=Ext.$eventNameMap,F=G.length,A,B;for(A=0;A<F;A++){B=G[A];B=E[B]||(E[B]=B.toLowerCase());if(C&&C[B]){--C[B]}}if(!D.eventFiringSuspended){D.resumeEvents()}},relayEvents:function(E,G,A){var F=Ext.$eventNameMap,D,B,H,C;if(typeof A==="undefined"){A=""}A=A.toLowerCase();if(typeof G==="string"){G=[G]}if(Ext.isArray(G)){for(D=0,B=G.length;D<B;D++){H=G[D];H=F[H]||(F[H]=H.toLowerCase());C=A+H;E.addListener(H,this.createEventRelayer(C),this)}}else{for(H in G){if(G.hasOwnProperty(H)){H=F[H]||(F[H]=H.toLowerCase());C=A+G[H];E.addListener(H,this.createEventRelayer(C),this)}}}return this},relayEvent:function(A,G,B,F,H){var D=typeof G,E=A[A.length-1],C=E.getInfo().eventName,I;A=Array.prototype.slice.call(A,0,-2);A[0]=this;if(D!=="undefined"){I={fn:G,scope:B||this,options:F||{},order:H,isLateBinding:D==="string"}}return this.doFireEvent(C,A,I,E)},createEventRelayer:function(A){return function(){return this.doFireEvent(A,Array.prototype.slice.call(arguments,0,-2))}},enableBubble:function(D){var E=this.isBubblingEnabled,C=Ext.$eventNameMap,A,F,B;if(!E){E=this.isBubblingEnabled={}}if(typeof D==="string"){D=Ext.Array.clone(arguments)}for(A=0,F=D.length;A<F;A++){B=D[A];B=C[B]||(C[B]=B.toLowerCase());if(!E[B]){E[B]=true;this.addListener(B,this.createEventBubbler(B),this)}}},createEventBubbler:function(A){return function B(){var C=("getBubbleTarget" in this)?this.getBubbleTarget():null;if(C&&C!==this&&C.isObservable){C.fireAction(A,Array.prototype.slice.call(arguments,0,-2),B,C,null,"after")}}},getBubbleTarget:function(){return false},destroy:function(){var A=this;if(A.observableId){A.fireEvent("destroy",A);A.clearListeners();A.clearManagedListeners()}},deprecated:{"2.0":{methods:{addEvents:null,addManagedListener:function(){var A=arguments[0];A.addListener.apply(A,Ext.Array.slice(arguments,1))},removeManagedListener:function(){var A=arguments[0];A.removeListener.apply(A,Ext.Array.slice(arguments,1))},mon:function(){var A=arguments[0];A.addListener.apply(A,Ext.Array.slice(arguments,1))},mun:function(){var A=arguments[0];A.removeListener.apply(A,Ext.Array.slice(arguments,1))}}}}},function(A){var B=function(C){if(C instanceof B){return C}this.observable=C;this.args=Array.prototype.slice.call(arguments,1)};B.prototype.destroy=function(){var C=this.observable;C.un.apply(C,this.args)};A.$ListenerRemover=B;A.createAlias({on:"addListener",un:"removeListener",onBefore:"addBeforeListener",onAfter:"addAfterListener",unBefore:"removeBeforeListener",unAfter:"removeAfterListener"})});
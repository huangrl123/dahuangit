Ext.define("Ext.data.amf.XmlDecoder",{alias:"data.amf.xmldecoder",statics:{readXml:function(A){var B;if(window.DOMParser){B=(new DOMParser()).parseFromString(A,"text/xml")}else{B=new ActiveXObject("Microsoft.XMLDOM");B.loadXML(A)}return B},readByteArray:function(B){var D=[],E,A,C;C=B.firstChild.nodeValue;for(A=0;A<C.length;A=A+2){E=C.substr(A,2);D.push(parseInt(E,16))}return D},readAMF3Value:function(A){var B;B=Ext.create("Ext.data.amf.Packet");return B.decodeValue(A)},decodeTidFromFlexUID:function(A){var B;B=A.substr(0,8);return parseInt(B,16)}},constructor:function(A){this.initConfig(A);this.clear()},clear:function(){this.objectReferences=[];this.traitsReferences=[];this.stringReferences=[]},readAmfxMessage:function(D){var F,C,B,A,E={};this.clear();F=Ext.data.amf.XmlDecoder.readXml(D);C=F.getElementsByTagName("amfx")[0];if(!C){Ext.warn.log("No AMFX tag in message")}if(C.getAttribute("ver")!="3"){Ext.Error.raise("Unsupported AMFX version: "+C.getAttribute("ver"))}B=C.getElementsByTagName("body")[0];E.targetURI=B.getAttribute("targetURI");E.responseURI=B.getAttribute("responseURI");for(A=0;A<B.childNodes.length;A++){if(B.childNodes.item(A).nodeType!=1){continue}E.message=this.readValue(B.childNodes.item(A));break}return E},readValue:function(A){var B;if(typeof A.normalize==="function"){A.normalize()}if(A.tagName=="null"){return null}else{if(A.tagName=="true"){return true}else{if(A.tagName=="false"){return false}else{if(A.tagName=="string"){return this.readString(A)}else{if(A.tagName=="int"){return parseInt(A.firstChild.nodeValue)}else{if(A.tagName=="double"){return parseFloat(A.firstChild.nodeValue)}else{if(A.tagName=="date"){B=new Date(parseFloat(A.firstChild.nodeValue));this.objectReferences.push(B);return B}else{if(A.tagName=="dictionary"){return this.readDictionary(A)}else{if(A.tagName=="array"){return this.readArray(A)}else{if(A.tagName=="ref"){return this.readObjectRef(A)}else{if(A.tagName=="object"){return this.readObject(A)}else{if(A.tagName=="xml"){return Ext.data.amf.XmlDecoder.readXml(A.firstChild.nodeValue)}else{if(A.tagName=="bytearray"){return Ext.data.amf.XmlDecoder.readAMF3Value(Ext.data.amf.XmlDecoder.readByteArray(A))}}}}}}}}}}}}}Ext.Error.raise("Unknown tag type: "+A.tagName);return null},readString:function(A){var B;if(A.getAttributeNode("id")){return this.stringReferences[parseInt(A.getAttribute("id"))]}B=(A.firstChild?A.firstChild.nodeValue:"")||"";this.stringReferences.push(B);return B},readTraits:function(B){var D=[],A,C;if(B===null){return null}if(B.getAttribute("externalizable")=="true"){return null}if(B.getAttributeNode("id")){return this.traitsReferences[parseInt(B.getAttributeNode("id").value)]}C=B.childNodes;for(A=0;A<C.length;A++){if(C.item(A).nodeType!=1){continue}D.push(this.readValue(C.item(A)))}this.traitsReferences.push(D);return D},readObjectRef:function(A){var B;B=parseInt(A.getAttribute("id"));return this.objectReferences[B]},readObject:function(G){var I,J=[],C,E,D,F,A,H,B=null,K;K=G.getAttribute("type");if(K){B=Ext.ClassManager.getByAlias("amfx."+K)}I=B?new B():(K?{$className:K}:{});if((!B)&&this.converters[K]){I=this.converters[K](this,G);return I}C=G.getElementsByTagName("traits")[0];J=this.readTraits(C);if(J===null){Ext.Error.raise("No support for externalizable object: "+K)}this.objectReferences.push(I);D=0;for(E=0;E<G.childNodes.length;E++){F=G.childNodes.item(E);if(F.nodeType!=1){continue}if(F.tagName=="traits"){continue}A=J[D];H=this.readValue(F);D=D+1;I[A]=H;if(D>J.length){Ext.Error.raise("Too many items for object, not enough traits: "+K)}}return I},readArray:function(F){var I=[],E,D,B,G,A,H,J,K,C;this.objectReferences.push(I);J=parseInt(F.getAttributeNode("length").value);D=0;for(G=0;G<F.childNodes.length;G++){E=F.childNodes.item(G);if(E.nodeType!=1){continue}if(E.tagName=="item"){A=E.getAttributeNode("name").value;K=E.childNodes;for(B=0;B<K.length;B++){C=K.item(B);if(C.nodeType!=1){continue}H=this.readValue(C);break}I[A]=H}else{I[D]=this.readValue(E);D++;if(D>J){Ext.Error.raise("Array has more items than declared length: "+D+" > "+J)}}}if(D<J){Ext.Error.raise("Array has less items than declared length: "+D+" < "+J)}return I},readDictionary:function(E){var H={},G,C,F,B,D,A;A=parseInt(E.getAttribute("length"));this.objectReferences.push(H);G=null;C=null;B=0;for(F=0;F<E.childNodes.length;F++){D=E.childNodes.item(F);if(D.nodeType!=1){continue}if(!G){G=this.readValue(D);continue}C=this.readValue(D);B=B+1;H[G]=C;G=null;C=null}if(B!=A){Ext.Error.raise("Incorrect number of dictionary values: "+B+" != "+A)}return H},convertObjectWithSourceField:function(C){var A,B,D;for(A=0;A<C.childNodes.length;A++){B=C.childNodes.item(A);if(B.tagName=="bytearray"){D=this.readValue(B);this.objectReferences.push(D);return D}}return null},converters:{"flex.messaging.io.ArrayCollection":function(B,A){return B.convertObjectWithSourceField(A)},"mx.collections.ArrayList":function(B,A){return B.convertObjectWithSourceField(A)},"mx.collections.ArrayCollection":function(B,A){return B.convertObjectWithSourceField(A)}}});
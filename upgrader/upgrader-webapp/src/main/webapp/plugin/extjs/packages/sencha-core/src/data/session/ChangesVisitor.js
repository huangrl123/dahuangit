Ext.define("Ext.data.session.ChangesVisitor",{constructor:function(A){var B=this,C;B.session=A;C=A.getCrudProperties();B.result=null;B.writerOptions={};B.createKey=C.create;B.readKey=C.read;B.updateKey=C.update;B.dropKey=C.drop},onDirtyRecord:function(L){var J=this,N=J.crud,M=L.phantom,K=L.dropped,A=!M&&!K,E=L.$className,F=(M||K)?"allDataOptions":"partialDataOptions",I=J.writerOptions,C=L.entityName,H,G,D,B;if(M&&K){return false}N=M?J.createKey:(K?J.dropKey:J.updateKey);I=I[E]||(I[E]={});if(K){if(!(H=I.drop)){I.drop=H={all:L.getProxy().getWriter().getWriteAllFields()}}if(!H.all){D=L.id}}if(!D){if(!(H=I[F])){H=L.getProxy().getWriter().getConfig(F);I[F]=H=Ext.Object.chain(H);H.serialize=true}D=L.getData(H)}B=J.result||(J.result={});G=B[C]||(B[C]={});G=G[N]||(G[N]=[]);G.push(D)},onMatrixChange:function(G,J,B,E){var H=this,I=G.left.type,C=G.right.role,F=E<0?H.dropKey:H.createKey,D,A;A=H.result||(H.result={});D=A[I]||(A[I]={});D=D[C]||(D[C]={});D=D[F]||(D[F]={});D=D[J]||(D[J]=[]);D.push(B)}});
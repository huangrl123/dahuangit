Ext.define("Ext.chart.series.Area",{extend:"Ext.chart.series.Cartesian",alias:"series.area",requires:["Ext.chart.axis.Axis","Ext.draw.Color","Ext.fx.Anim"],type:"area",stacked:true,style:{},constructor:function(B){this.callParent(arguments);var C=this,E=C.chart.surface,A,D;B.highlightCfg=Ext.Object.merge({},{lineWidth:3,stroke:"#55c",opacity:0.8,color:"#f00"},B.highlightCfg);Ext.apply(C,B,{__excludes:[]});if(C.highlight){C.highlightSprite=E.add({type:"path",path:["M",0,0],zIndex:1000,opacity:0.3,lineWidth:5,hidden:true,stroke:"#444"})}C.group=E.getGroup(C.seriesId)},shrink:function(L,G,E){var H=L.length,A=Math.floor(H/E),F,C,I=0,B=this.areas.length,K=[],D=[],J=[];for(C=0;C<B;++C){K[C]=0}for(F=0;F<H;++F){I+=+L[F];for(C=0;C<B;++C){K[C]+=+G[F][C]}if(F%A==0){D.push(I/A);for(C=0;C<B;++C){K[C]/=A}J.push(K);I=0;for(C=0,K=[];C<B;++C){K[C]=0}}}return{x:D,y:J}},getBounds:function(){var J=this,I=J.chart,V=I.getChartStore(),g=V.data.items,h,j,E,m=[].concat(J.yField),N=m.length,M=[],D=[],K=Infinity,B=K,G=K,O=-K,S=-K,a=Math,c=a.min,A=a.max,e=J.getAxesForXAndYFields(),F=e.xAxis,X=e.yAxis,W,b,d,f,H,R,k,n,L,P,Y,Q,Z,C,U,T;J.setBBox();f=J.bbox;if(U=I.axes.get(F)){if(U.type==="Time"){b=true}W=U.applyData();B=W.from;O=W.to}if(U=I.axes.get(X)){W=U.applyData();G=W.from;S=W.to}if(J.xField&&!Ext.isNumber(B)){U=J.getMinMaxXValues();b=true;B=U[0];O=U[1]}if(J.yField&&!Ext.isNumber(G)){U=J.getMinMaxYValues();G=U[0];S=U[1]}if(!Ext.isNumber(G)){G=0}if(!Ext.isNumber(S)){S=0}j=g.length;if(j>0&&b){d=g[0].get(J.xField);if(typeof d!="number"){d=+d;if(isNaN(d)){b=false}}}for(h=0;h<j;h++){E=g[h];k=E.get(J.xField);n=[];if(typeof k!="number"){if(b){k=+k}else{k=h}}M.push(k);P=0;for(L=0;L<N;L++){if(J.__excludes[L]){continue}C=E.get(m[L]);if(typeof C=="number"){n.push(C)}}D.push(n)}H=f.width/((O-B)||1);R=f.height/((S-G)||1);Y=M.length;if((Y>f.width)&&J.areas){Q=J.shrink(M,D,f.width);M=Q.x;D=Q.y}return{bbox:f,minX:B,minY:G,xValues:M,yValues:D,xScale:H,yScale:R,areasLen:N}},getPaths:function(){var H=this,Y=H.chart,I=Y.getChartStore(),B=true,Q=H.getBounds(),M=Q.bbox,R=H.items=[],J=[],A,E=0,P=[],G=H.reverse,F,S,U,V,T,L,K,C,O,X,N,D,W;S=Q.xValues.length;for(F=0;F<S;F++){T=Q.xValues[F];W=G?S-F-1:F;L=Q.yValues[W];U=M.x+(T-Q.minX)*Q.xScale;if(D===undefined){D=U}K=0;E=0;for(C=0;C<Q.areasLen;C++){if(H.__excludes[C]){continue}if(!J[C]){J[C]=[]}X=L[E];K+=X;V=M.y+M.height-(K-Q.minY)*Q.yScale;if(!P[C]){P[C]=["M",U,V];J[C].push(["L",U,V])}else{P[C].push("L",U,V);J[C].push(["L",U,V])}if(!R[C]){R[C]={pointsUp:[],pointsDown:[],series:H}}R[C].pointsUp.push([U,V]);E++}}for(C=0;C<Q.areasLen;C++){if(H.__excludes[C]){continue}N=P[C];if(C==0||B){B=false;N.push("L",U,M.y+M.height,"L",D,M.y+M.height,"Z")}else{A=J[O];A.reverse();N.push("L",U,A[0][2]);for(F=0;F<S;F++){N.push(A[F][0],A[F][1],A[F][2]);R[C].pointsDown[S-F-1]=[A[F][1],A[F][2]]}N.push("L",D,N[2],"Z")}O=C}return{paths:P,areasLen:Q.areasLen}},drawSeries:function(){var O=this,H=O.chart,B=H.getChartStore(),J=H.surface,G=H.animate,L=O.group,P=Ext.apply(O.seriesStyle,O.style),D=O.colorArrayStyle,A=D&&D.length||0,C=O.themeIdx,K,E,F,N,M,I;O.unHighlightItem();O.cleanHighlights();if(!B||!B.getCount()||O.seriesIsHidden){O.hide();O.items=[];return}F=O.getPaths();if(!O.areas){O.areas=[]}for(K=0;K<F.areasLen;K++){if(O.__excludes[K]){continue}I=C+K;if(!O.areas[K]){O.items[K].sprite=O.areas[K]=J.add(Ext.apply({},{type:"path",group:L,path:F.paths[K],stroke:P.stroke||D[I%A],fill:D[I%A]},P||{}))}E=O.areas[K];N=F.paths[K];if(G){M=O.renderer(E,false,{path:N,fill:D[K%A],stroke:P.stroke||D[K%A]},K,B);O.animation=O.onAnimate(E,{to:M})}else{M=O.renderer(E,false,{path:N,hidden:false,fill:D[I%A],stroke:P.stroke||D[I%A]},K,B);O.areas[K].setAttributes(M,true)}}O.renderLabels();O.renderCallouts()},onAnimate:function(A,B){A.show();return this.callParent(arguments)},onCreateLabel:function(C,I,E,H){return null;var G=this,F=G.labelsGroup,A=G.label,B=G.bbox,D=Ext.apply({},A,G.seriesLabelStyle||{});return G.chart.surface.add(Ext.apply({"type":"text","text-anchor":"middle","group":F,"x":Number(I.point[0]),"y":B.y+B.height/2},D||{}))},onPlaceLabel:function(M,N,C,E,K,H,D){var F=this,S=F.chart,R=S.resizing,A=F.label,J=A.renderer,B=A.field,G=F.bbox,O=Number(C.point[E][0]),P=Number(C.point[E][1]),L,I,Q;M.setAttributes({text:J(N.get(B[D]),M,N,C,E,K,H,D),hidden:true},true);L=M.getBBox();I=L.width/2;Q=L.height/2;if(O<G.x+I){O=G.x+I}else{if(O+I>G.x+G.width){O=G.x+G.width-I}}P=P-Q;if(P<G.y+Q){P+=2*Q}else{if(P+Q>G.y+G.height){P-=2*Q}}if(F.chart.animate&&!F.chart.resizing){M.show(true);F.onAnimate(M,{to:{x:O,y:P}})}else{M.setAttributes({x:O,y:P},true);if(R&&F.animation){F.animation.on("afteranimate",function(){M.show(true)})}else{M.show(true)}}},onPlaceCallout:function(b,W,O,g,J,U,B){var I=this,G=I.chart,j=G.surface,Q=G.resizing,N=I.callouts,K=I.items,C=(g==0)?false:K[g-1].point,A=(g==K.length-1)?false:K[g+1].point,d=O.point,Y,R,D,h,V,S,F=(b&&b.label?b.label.getBBox():{width:0,height:0}),f=30,M=10,X=3,L,P,e,T,c,E=I.clipRect,H,Z;if(!F.width||!F.height){return}if(!C){C=d}if(!A){A=d}h=(A[1]-C[1])/(A[0]-C[0]);V=(d[1]-C[1])/(d[0]-C[0]);S=(A[1]-d[1])/(A[0]-d[0]);R=Math.sqrt(1+h*h);Y=[1/R,h/R];D=[-Y[1],Y[0]];if(V>0&&S<0&&D[1]<0||V<0&&S>0&&D[1]>0){D[0]*=-1;D[1]*=-1}else{if(Math.abs(V)<Math.abs(S)&&D[0]<0||Math.abs(V)>Math.abs(S)&&D[0]>0){D[0]*=-1;D[1]*=-1}}H=d[0]+D[0]*f;Z=d[1]+D[1]*f;L=H+(D[0]>0?0:-(F.width+2*X));P=Z-F.height/2-X;e=F.width+2*X;T=F.height+2*X;if(L<E[0]||(L+e)>(E[0]+E[2])){D[0]*=-1}if(P<E[1]||(P+T)>(E[1]+E[3])){D[1]*=-1}H=d[0]+D[0]*f;Z=d[1]+D[1]*f;L=H+(D[0]>0?0:-(F.width+2*X));P=Z-F.height/2-X;e=F.width+2*X;T=F.height+2*X;b.lines.setAttributes({path:["M",d[0],d[1],"L",H,Z,"Z"]},true);b.box.setAttributes({x:L,y:P,width:e,height:T},true);b.label.setAttributes({x:H+(D[0]>0?X:-(F.width+X)),y:Z},true);for(c in b){b[c].show(true)}},isItemInPoint:function(L,M,O,F){var K=this,C=O.pointsUp,E=O.pointsDown,I=Math.abs,B=false,G=false,D=K.reverse,J=Infinity,A,H,N;for(A=0,H=C.length;A<H;A++){N=[C[A][0],C[A][1]];B=false;G=A==H-1;if(J>I(L-N[0])){J=I(L-N[0]);B=true;if(G){++A}}if(!B||(B&&G)){N=C[A-1];if(M>=N[1]&&(!E.length||M<=(E[A-1][1]))){idx=D?H-A:A-1;O.storeIndex=idx;O.storeField=K.yField[F];O.storeItem=K.chart.getChartStore().getAt(idx);O._points=E.length?[N,E[A-1]]:[N];return true}else{break}}}return false},highlightSeries:function(){var C,A,B;if(this._index!==undefined){C=this.areas[this._index];if(C.__highlightAnim){C.__highlightAnim.paused=true}C.__highlighted=true;C.__prevOpacity=C.__prevOpacity||C.attr.opacity||1;C.__prevFill=C.__prevFill||C.attr.fill;C.__prevLineWidth=C.__prevLineWidth||C.attr.lineWidth;B=Ext.draw.Color.fromString(C.__prevFill);A={lineWidth:(C.__prevLineWidth||0)+2};if(B){A.fill=B.getLighter(0.2).toString()}else{A.opacity=Math.max(C.__prevOpacity-0.3,0)}if(this.chart.animate){C.__highlightAnim=new Ext.fx.Anim(Ext.apply({target:C,to:A},this.chart.animate))}else{C.setAttributes(A,true)}}},unHighlightSeries:function(){var A;if(this._index!==undefined){A=this.areas[this._index];if(A.__highlightAnim){A.__highlightAnim.paused=true}if(A.__highlighted){A.__highlighted=false;A.__highlightAnim=new Ext.fx.Anim({target:A,to:{fill:A.__prevFill,opacity:A.__prevOpacity,lineWidth:A.__prevLineWidth}})}}},highlightItem:function(C){var A=this,B,D;if(!C){this.highlightSeries();return}B=C._points;if(B.length===2){D=["M",B[0][0],B[0][1],"L",B[1][0],B[1][1]]}else{D=["M",B[0][0],B[0][1],"L",B[0][0],A.bbox.y+A.bbox.height]}A.highlightSprite.setAttributes({path:D,hidden:false},true)},unHighlightItem:function(A){if(!A){this.unHighlightSeries()}if(this.highlightSprite){this.highlightSprite.hide(true)}},hideAll:function(B){var A=this;B=(isNaN(A._index)?B:A._index)||0;A.__excludes[B]=true;A.areas[B].hide(true);A.redraw()},showAll:function(B){var A=this;B=(isNaN(A._index)?B:A._index)||0;A.__excludes[B]=false;A.areas[B].show(true);A.redraw()},redraw:function(){var B=this,A;A=B.chart.legend.rebuild;B.chart.legend.rebuild=false;B.chart.redraw();B.chart.legend.rebuild=A},hide:function(){if(this.areas){var E=this,B=E.areas,C,G,D,F,A;if(B&&B.length){for(C=0,F=B.length;C<F;++C){if(B[C]){B[C].hide(true)}}E.hideLabels()}}},getLegendColor:function(B){var A=this;B+=A.themeIdx;return A.colorArrayStyle[B%A.colorArrayStyle.length]}});
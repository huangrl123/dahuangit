Ext.define("Ext.util.XTemplateParser",{requires:["Ext.String"],constructor:function(A){Ext.apply(this,A)},doTpl:Ext.emptyFn,parse:function(A){var H=this,C=A.length,O={elseif:"elif"},M=H.topRe,K=H.actionsRe,F,N,B,I,E,P,G,J,L,S,D,Q,R;H.level=0;H.stack=N=[];for(F=0;F<C;F=S){M.lastIndex=F;I=M.exec(A);if(!I){H.doText(A.substring(F,C));break}L=I.index;S=M.lastIndex;if(F<L){B=A.substring(F,L);if(!(R&&Ext.String.trim(B)==="")){H.doText(B)}}R=false;if(I[1]){S=A.indexOf("%}",L+2);H.doEval(A.substring(L+2,S));S+=2}else{if(I[2]){S=A.indexOf("]}",L+2);H.doExpr(A.substring(L+2,S));S+=2}else{if(I[3]){H.doTag(I[3])}else{if(I[4]){D=null;while((J=K.exec(I[4]))!==null){B=J[2]||J[3];if(B){B=Ext.String.htmlDecode(B);E=J[1];E=O[E]||E;D=D||{};P=D[E];if(typeof P=="string"){D[E]=[P,B]}else{if(P){D[E].push(B)}else{D[E]=B}}}}if(!D){if(H.elseRe.test(I[4])){H.doElse()}else{if(H.defaultRe.test(I[4])){H.doDefault()}else{H.doTpl();N.push({type:"tpl"})}}}else{if(D["if"]){H.doIf(D["if"],D);N.push({type:"if"})}else{if(D["switch"]){H.doSwitch(D["switch"],D);N.push({type:"switch"});R=true}else{if(D["case"]){H.doCase(D["case"],D)}else{if(D["elif"]){H.doElseIf(D["elif"],D)}else{if(D["for"]){++H.level;if(Q=H.propRe.exec(I[4])){D.propName=Q[1]||Q[2]}H.doFor(D["for"],D);N.push({type:"for",actions:D})}else{if(D["foreach"]){++H.level;if(Q=H.propRe.exec(I[4])){D.propName=Q[1]||Q[2]}H.doForEach(D["foreach"],D);N.push({type:"foreach",actions:D})}else{if(D.exec){H.doExec(D.exec,D);N.push({type:"exec",actions:D})}}}}}}}}}else{if(I[0].length===5){N.push({type:"tpl"})}else{G=N.pop();H.doEnd(G.type,G.actions);if(G.type=="for"||G.type=="foreach"){--H.level}}}}}}}},topRe:/(?:(\{\%)|(\{\[)|\{([^{}]+)\})|(?:<tpl([^>]*)\>)|(?:<\/tpl>)/g,actionsRe:/\s*(elif|elseif|if|for|foreach|exec|switch|case|eval|between)\s*\=\s*(?:(?:"([^"]*)")|(?:'([^']*)'))\s*/g,propRe:/prop=(?:(?:"([^"]*)")|(?:'([^']*)'))/,defaultRe:/^\s*default\s*$/,elseRe:/^\s*else\s*$/});
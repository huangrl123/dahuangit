Ext.define("Ext.chart.series.Series",{requires:["Ext.chart.Markers","Ext.chart.label.Label","Ext.tip.ToolTip"],mixins:{observable:"Ext.mixin.Observable"},type:null,seriesType:"sprite",identifiablePrefix:"ext-line-",observableType:"series",darkerStrokeRatio:0.15,config:{chart:null,title:null,renderer:null,showInLegend:true,triggerAfterDraw:false,style:{},subStyle:{},themeStyle:{},colors:null,useDarkerStrokeColor:true,store:null,label:{textBaseline:"middle",textAlign:"center",font:"14px Helvetica"},labelOverflowPadding:5,labelField:null,showMarkers:true,marker:null,markerSubStyle:null,itemInstancing:null,background:null,highlightItem:null,surface:null,overlaySurface:null,hidden:false,highlight:false,highlightCfg:{merge:function(A){return A},$value:{fillStyle:"yellow",strokeStyle:"red"}},animation:null,tooltip:{lazy:true,$value:null}},directions:[],sprites:null,themeColorCount:function(){return 1},themeMarkerCount:function(){return 0},getFields:function(D){var B=this,F=[],C,A,E;for(A=0,E=D.length;A<E;A++){C=B["get"+D[A]+"Field"]();F.push(C)}return F},applyAnimation:function(B,A){if(!B){B={duration:0}}else{if(B===true){B={easing:"easeInOut",duration:500}}}return A?Ext.apply({},B,A):B},updateTitle:function(H){if(!this._chart){return}var F=this,H=Ext.Array.from(H),B=F.getChart(),G=B.getSeries(),E=Ext.Array.indexOf(G,F),C=B.getLegendStore(),A=Math.min(H.length,F.getYField().length),D,J,I;if(E!==-1){for(D=0;D<A;D++){I=H[D];if(I){J=C.getAt(E+D);J.set("name",I)}}}},applyHighlight:function(B,A){if(Ext.isObject(B)){B=Ext.merge({},this.config.highlightCfg,B)}else{if(B===true){B=this.config.highlightCfg}}return Ext.apply(A||{},B)},applyItemInstancing:function(A,B){return Ext.merge(B||{},A)},setAttributesForItem:function(B,A){if(B&&B.sprite){if(B.sprite.itemsMarker&&B.category==="items"){B.sprite.putMarker(B.category,A,B.index,false,true)}if(B.sprite.isMarkerHolder&&B.category==="markers"){B.sprite.putMarker(B.category,A,B.index,false,true)}else{if(B.sprite instanceof Ext.draw.sprite.Instancing){B.sprite.setAttributesFor(B.index,A)}else{B.sprite.setAttributes(A)}}}},getBBoxForItem:function(A){if(A&&A.sprite){if(A.sprite.itemsMarker&&A.category==="items"){return A.sprite.getMarkerBBox(A.category,A.index)}else{if(A.sprite instanceof Ext.draw.sprite.Instancing){return A.sprite.getBBoxFor(A.index)}else{return A.sprite.getBBox()}}}return null},applyHighlightItem:function(A,B){if(A===B){return}if(Ext.isObject(A)&&Ext.isObject(B)){if(A.sprite===B.sprite&&A.index===B.index){return}}return A},updateHighlightItem:function(A,B){this.setAttributesForItem(B,{highlighted:false});this.setAttributesForItem(A,{highlighted:true})},constructor:function(A){var B=this;B.getId();B.sprites=[];B.dataRange=[];Ext.ComponentManager.register(B);if(A){if(A.tips){A=Ext.apply({tooltip:A.tips},A)}if(A.highlightCfg){A=Ext.apply({highlight:A.highlightCfg},A)}}B.mixins.observable.constructor.call(B,A)},applyTooltip:function(C,A){var B=Ext.apply({},C,{renderer:Ext.emptyFn,constrainPosition:true,shrinkWrapDock:true,autoHide:true,offsetX:10,offsetY:10});return new Ext.tip.ToolTip(B)},showTip:function(N,E){var J=this,A=J.getTooltip(),B,F,C,I,M,G,K,L,D,H;if(!A){return}clearTimeout(J.tooltipTimeout);D=A.config;if(A.trackMouse){E[0]+=D.offsetX;E[1]+=D.offsetY}else{B=N.sprite;F=B.getSurface();C=Ext.get(F.getId());if(C){G=N.series.getBBoxForItem(N);K=G.x+G.width/2;L=G.y+G.height/2;M=F.matrix.transformPoint([K,L]);I=C.getXY();H=F.getInherited().rtl;K=H?I[0]+C.getWidth()-M[0]:I[0]+M[0];L=I[1]+M[1];E=[K,L]}}A.config.renderer.call(A,N.record,N);A.show(E)},hideTip:function(B){var A=this,C=A.getTooltip();if(!C){return}clearTimeout(A.tooltipTimeout);A.tooltipTimeout=setTimeout(function(){C.hide()},0)},applyStore:function(A){return A&&Ext.StoreManager.lookup(A)},getStore:function(){return this._store||this.getChart()&&this.getChart().getStore()},updateStore:function(C,A){var F=this,H=this.getChart()&&this.getChart().getStore(),G=F.getSprites(),D=G.length,E,B;C=C||H;A=A||H;if(A){A.un("updaterecord","onUpdateRecord",F);A.un("refresh","refresh",F)}if(C){C.on("updaterecord","onUpdateRecord",F);C.on("refresh","refresh",F);for(E=0;E<D;E++){B=G[E];if(B.setStore){B.setStore(C)}}F.refresh()}},onStoreChange:function(A,B){if(!this._store){this.updateStore(A,B)}},coordinateStacked:function(J,N,K){var B=this,L=B.getStore(),V=L.getData().items,P=B["get"+J+"Axis"](),R=B.getHidden(),E={min:0,max:0},O=B["fieldCategory"+J],F,I,G,H,Q,C,T,X={},S=[],W,A=[],D=[],M=B.getStacked(),U=B.getSprites();if(U.length>0){for(I=0;I<O.length;I++){F=O[I];Q=B.getFields([F]);for(G=0;G<V.length;G++){S[G]=0;A[G]=0;D[G]=0}for(G=0;G<Q.length;G++){X={};C=Q[G];if(R[G]){X["dataStart"+F]=S;X["data"+F]=S;U[G].setAttributes(X);continue}T=B.coordinateData(V,C,P);if(M){W=[];for(H=0;H<V.length;H++){if(!T[H]){T[H]=0}if(T[H]>=0){S[H]=A[H];A[H]+=T[H];W[H]=A[H]}else{S[H]=D[H];D[H]+=T[H];W[H]=D[H]}}X["dataStart"+F]=S;X["data"+F]=W;B.getRangeOfData(S,E);B.getRangeOfData(W,E)}else{X["dataStart"+F]=S;X["data"+F]=T;B.getRangeOfData(T,E)}U[G].setAttributes(X)}}B.dataRange[N]=E.min;B.dataRange[N+K]=E.max;X={};X["dataMin"+J]=E.min;X["dataMax"+J]=E.max;for(I=0;I<U.length;I++){U[I].setAttributes(X)}}},coordinate:function(B,L,P){var E=this,G=E.getStore(),A=E.getHidden(),O=G.getData().items,C=E["get"+B+"Axis"](),N={min:Infinity,max:-Infinity},M=E["fieldCategory"+B]||[B],K=E.getFields(M),H,J,D,I={},F=E.getSprites();if(F.length>0){if(!Ext.isBoolean(A)||!A){for(H=0;H<M.length;H++){J=K[H];D=E.coordinateData(O,J,C);E.getRangeOfData(D,N);I["data"+M[H]]=D}}E.dataRange[L]=N.min;E.dataRange[L+P]=N.max;I["dataMin"+B]=N.min;I["dataMax"+B]=N.max;if(C){C.range=null;I["range"+B]=C.getRange()}for(H=0;H<F.length;H++){F[H].setAttributes(I)}}},coordinateData:function(H,F,A){var B=[],C=H.length,E=A&&A.getLayout(),I=A?function(L,M,J,K){return E.getCoordFor(L,M,J,K)}:function(J){return +J},D,G;for(D=0;D<C;D++){G=H[D].data[F];B[D]=!Ext.isEmpty(G)?I(G,F,D,H):G}return B},getRangeOfData:function(G,F){var B,C=G.length,D,A=F.min,E=F.max;for(B=0;B<C;B++){D=G[B];if(D<A){A=D}if(D>E){E=D}}F.min=A;F.max=E},updateLabelData:function(){var I=this,A=I.getStore(),K=A.getData().items,J=I.getSprites(),H=I.getLabel().getTemplate(),C=Ext.Array.from(H.getField()||I.getLabelField()),F,D,B,L,E,G;if(!J.length||!C.length){return}for(F=0;F<J.length;F++){L=[];E=J[F];G=E.getField();if(Ext.Array.indexOf(C,G)<0){G=C[F]}for(D=0,B=K.length;D<B;D++){L.push(K[D].get(G))}E.setAttributes({labels:L})}},updateLabelField:function(B){var A=this.getLabel().getTemplate();if(!A.config.field){A.setField(B)}},processData:function(){if(!this.getStore()){return}var D=this,C=this.directions,A,E=C.length,B,F;for(A=0;A<E;A++){B=C[A];if(D["get"+B+"Axis"]){F=D["get"+B+"Axis"]();if(F){F.processData(D);continue}}if(D["coordinate"+B]){D["coordinate"+B]()}}D.updateLabelData()},applyBackground:function(A){if(this.getChart()){this.getSurface().setBackground(A);return this.getSurface().getBackground()}else{return A}},updateChart:function(C,B){var A=this;if(B){B.un("axeschange","onAxesChange",A);A.sprites=[];A.setSurface(null);A.setOverlaySurface(null);A.onChartDetached(B)}if(C){A.setSurface(C.getSurface("series"));A.setOverlaySurface(C.getSurface("overlay"));C.on("axeschange","onAxesChange",A);if(C.getAxes()){A.onAxesChange(C)}A.onChartAttached(C)}A.updateStore(A._store,null)},onAxesChange:function(F){var J=this,I=F.getAxes(),C,A={},G={},D=false,K=this.directions,B,H,E;for(H=0,E=K.length;H<E;H++){B=K[H];G[B]=J.getFields(J["fieldCategory"+B])}for(H=0,E=I.length;H<E;H++){C=I[H];if(!A[C.getDirection()]){A[C.getDirection()]=[C]}else{A[C.getDirection()].push(C)}}for(H=0,E=K.length;H<E;H++){B=K[H];if(J["get"+B+"Axis"]()){continue}if(A[B]){C=J.findMatchingAxis(A[B],G[B]);if(C){J["set"+B+"Axis"](C);if(C.getNeedHighPrecision()){D=true}}}}this.getSurface().setHighPrecision(D)},findMatchingAxis:function(D,E){var F,B,C,A;for(C=0;C<D.length;C++){F=D[C];B=F.getFields();if(!B.length){return F}else{if(E){for(A=0;A<E.length;A++){if(Ext.Array.indexOf(B,E[A])>=0){return F}}}}}},onChartDetached:function(B){var A=this;A.fireEvent("chartdetached",B,A);B.un("storechange","onStoreChange",A)},onChartAttached:function(A){var B=this;B.setBackground(B.getBackground());B.fireEvent("chartattached",A,B);A.on("storechange","onStoreChange",B);B.processData()},updateOverlaySurface:function(A){var B=this;if(A){if(B.getLabel()){B.getOverlaySurface().add(B.getLabel())}}},applyLabel:function(A,B){if(!B){B=new Ext.chart.Markers({zIndex:10});B.setTemplate(new Ext.chart.label.Label(A))}else{B.getTemplate().setAttributes(A)}return B},createItemInstancingSprite:function(F,B){var C=this,D,A=new Ext.chart.Markers();A.setAttributes({zIndex:Number.MAX_VALUE});var E=Ext.apply({},B);if(C.getHighlight()){E.highlight=C.getHighlight();E.modifiers=["highlight"]}A.setTemplate(E);D=A.getTemplate();D.setAttributes(C.getStyle());D.fx.on("animationstart","onSpriteAnimationStart",this);D.fx.on("animationend","onSpriteAnimationEnd",this);F.bindMarker("items",A);C.getSurface().add(A);return A},getDefaultSpriteConfig:function(){return{type:this.seriesType,renderer:this.getRenderer()}},createSprite:function(){var B=this,F=B.getSurface(),A=B.getItemInstancing(),C,D,E=F.add(B.getDefaultSpriteConfig());E.setAttributes(this.getStyle());if(A){E.itemsMarker=B.createItemInstancingSprite(E,A)}if(E.bindMarker){if(B.getShowMarkers()&&B.getMarker()){C=new Ext.chart.Markers();D=Ext.merge({},B.getMarker());if(B.getHighlight()){D.highlight=B.getHighlight();D.modifiers=["highlight"]}C.setTemplate(D);C.getTemplate().fx.setCustomDuration({translationX:0,translationY:0});E.dataMarker=C;E.bindMarker("markers",C);B.getOverlaySurface().add(C)}if(B.getLabel().getTemplate().getField()||B.getLabelField()){E.bindMarker("labels",B.getLabel())}}if(E.setStore){E.setStore(B.getStore())}E.fx.on("animationstart","onSpriteAnimationStart",B);E.fx.on("animationend","onSpriteAnimationEnd",B);B.sprites.push(E);return E},getSprites:Ext.emptyFn,onUpdateRecord:function(){this.processData()},refresh:function(){this.processData()},isXType:function(A){return A==="series"},getItemId:function(){return this.getId()},applyThemeStyle:function(E,C){var D=this,A,B;A=E&&E.subStyle&&E.subStyle.fillStyle;B=A&&E.subStyle.strokeStyle;if(A&&!B){E.subStyle.strokeStyle=D.getStrokeColorsFromFillColors(A)}A=E&&E.markerSubStyle&&E.markerSubStyle.fillStyle;B=A&&E.markerSubStyle.strokeStyle;if(A&&!B){E.markerSubStyle.strokeStyle=D.getStrokeColorsFromFillColors(A)}return Ext.apply(C||{},E)},applyStyle:function(C,A){var B=Ext.ClassManager.get(Ext.ClassManager.getNameByAlias("sprite."+this.seriesType));if(B&&B.def){C=B.def.normalize(C)}return Ext.apply(A||{},C)},applySubStyle:function(A,B){var C=Ext.ClassManager.get(Ext.ClassManager.getNameByAlias("sprite."+this.seriesType));if(C&&C.def){A=C.def.batchedNormalize(A,true)}return Ext.merge(B||{},A)},applyMarker:function(C,B){var A=(C&&C.type)||(B&&B.type)||"circle",D=Ext.ClassManager.get(Ext.ClassManager.getNameByAlias("sprite."+A));if(D&&D.def){C=D.def.normalize(C,true);C.type=A}return Ext.merge(B||{},C)},applyMarkerSubStyle:function(C,B){var A=(C&&C.type)||(B&&B.type)||"circle",D=Ext.ClassManager.get(Ext.ClassManager.getNameByAlias("sprite."+A));if(D&&D.def){C=D.def.batchedNormalize(C,true)}return Ext.merge(B||{},C)},updateHidden:function(A){this.getColors();this.getSubStyle();this.setSubStyle({hidden:A});this.processData();this.doUpdateStyles()},setHiddenByIndex:function(B,A){if(Ext.isArray(this.getHidden())){this.getHidden()[B]=A;this.updateHidden(this.getHidden())}else{this.setHidden(A)}},getStrokeColorsFromFillColors:function(D){var B=this,C=B.getUseDarkerStrokeColor(),A=(Ext.isNumber(C)?C:B.darkerStrokeRatio),E;if(C){E=Ext.Array.map(D,function(F){var G=Ext.draw.Color.fromString(F);return G.getDarker(A).toString()})}else{E=Ext.Array.clone(D)}return E},updateThemeColors:function(D){var B=this,E=B.getThemeStyle(),A=Ext.Array.clone(D),F=B.getStrokeColorsFromFillColors(D),C={fillStyle:A,strokeStyle:F};E.subStyle=Ext.apply(E.subStyle||{},C);E.markerSubStyle=Ext.apply(E.markerSubStyle||{},C);B.doUpdateStyles()},updateChartColors:function(B){var A=this;if(!A.getColors()){A.updateThemeColors(B)}},updateColors:function(A){this.updateThemeColors(A)},updateStyle:function(){this.doUpdateStyles()},updateSubStyle:function(){this.doUpdateStyles()},updateThemeStyle:function(){this.doUpdateStyles()},doUpdateStyles:function(){var C=this.sprites,D=this.getItemInstancing(),B=0,F=C&&C.length,A=this.getMarker(),E;for(;B<F;B++){E=this.getStyleByIndex(B);if(D){C[B].itemsMarker.getTemplate().setAttributes(E)}C[B].setAttributes(E);if(A&&C[B].dataMarker){C[B].dataMarker.getTemplate().setAttributes(this.getMarkerStyleByIndex(B))}}},getStyleWithTheme:function(){var B=this,D=B.getThemeStyle(),A=(D&&D.style)||{},C=Ext.applyIf(Ext.apply({},B.getStyle()),A);return C},getSubStyleWithTheme:function(){var B=this,D=B.getThemeStyle(),C=(D&&D.subStyle)||{},A=Ext.applyIf(Ext.apply({},B.getSubStyle()),C);return A},getStyleByIndex:function(F){var H=this,D=H.getThemeStyle(),G,E,C,A,B={};G=H.getStyle();E=(D&&D.style)||{};C=H.styleDataForIndex(H.getSubStyle(),F);A=H.styleDataForIndex((D&&D.subStyle),F);Ext.apply(B,E);Ext.apply(B,A);Ext.apply(B,G);Ext.apply(B,C);return B},getMarkerStyleByIndex:function(H){var J=this,E=J.getThemeStyle(),I,G,C,A,L,D,F,K,B={};I=J.getStyle();G=(E&&E.style)||{};C=J.styleDataForIndex(J.getSubStyle(),H);A=J.styleDataForIndex((E&&E.subStyle),H);L=J.getMarker();D=(E&&E.marker)||{};F=J.getMarkerSubStyle();K=J.styleDataForIndex((E&&E.markerSubStyle),H);Ext.apply(B,G);Ext.apply(B,A);Ext.apply(B,D);Ext.apply(B,K);Ext.apply(B,I);Ext.apply(B,C);Ext.apply(B,L);Ext.apply(B,F);return B},styleDataForIndex:function(C,A){var E,D,B={};if(C){for(D in C){E=C[D];if(Ext.isArray(E)){B[D]=E[A%E.length]}else{B[D]=E}}}return B},getItemForPoint:Ext.emptyFn,getItemByIndex:function(D){if(this.getSprites()){var C=this,E=C.getSprites()[0],A=C.getStore(),B;if(E){B={series:this,category:this.getItemInstancing()?"items":"markers",index:D,record:A.getData().items[D],field:this.getYField(),sprite:E};return B}}},onSpriteAnimationStart:function(A){this.fireEvent("animationstart",A)},onSpriteAnimationEnd:function(A){this.fireEvent("animationend",A)},provideLegendInfo:function(A){A.push({name:this.getTitle()||this.getId(),mark:"black",disabled:false,series:this.getId(),index:0})},destroy:function(){var B=this,A=B.getStore(),C=B.getConfig("tooltip",true);B.clearListeners();Ext.ComponentManager.unregister(B);if(A&&A.getAutoDestroy()){Ext.destroy(A)}B.setStore(null);if(C){Ext.destroy(C);clearTimeout(B.tooltipTimeout)}B.callParent()}});
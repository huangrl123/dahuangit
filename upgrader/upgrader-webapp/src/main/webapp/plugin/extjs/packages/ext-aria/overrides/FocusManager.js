Ext.define("Ext.aria.FocusManager",{singleton:true,requires:["Ext.FocusManager","Ext.util.KeyNav","Ext.util.Observable"],mixins:{observable:"Ext.util.Observable"},enabled:false,whitelist:["textfield"],windows:[],constructor:function(D){var E=this,C=E.whitelist,A,B,F;E.mixins.observable.constructor.call(E,D);E.whitelistCache=A={};for(B=0,F=C.length;B<F;B++){A[C[B]]=true}},addXTypeToWhitelist:function(A){var D=this,C=D.whitelist,B=D.whitelistCache;if(Ext.isArray(A)){Ext.Array.forEach(A,D.addXTypeToWhitelist,D);return}if(!B[A]){C.push(A);B[A]=true}},removeXTypeFromWhitelist:function(A){var D=this,C=D.whitelist,B=D.whitelistCache;if(Ext.isArray(A)){Ext.Array.forEach(A,D.removeXTypeFromWhitelist,D);return}Ext.Array.remove(C,A);delete B[A]},isWhitelisted:function(C){if(!C){return false}var B=this.whitelistCache,A=C.getXType(),D;if(B[A]){return true}for(D in B){if(B.hasOwnProperty(D)){if(C.isXType(D)){B[D]=true;return true}}}return false},clearComponent:function(A){if(!A.isDestroyed){A.blur()}},enable:function(){var A=this,B=Ext.getDoc();if(A.enabled){return}A.enabled=Ext.enableFocusManager=true;A.initDOM();A.keyNav=new Ext.util.KeyNav({target:B,scope:A,backspace:A.focusLast,enter:A.navigateIn,esc:A.navigateOut,tab:A.navigateSiblings,space:A.navigateIn,del:A.focusLast,left:A.navigateSiblings,right:A.navigateSiblings,down:A.navigateSiblings,up:A.navigateSiblings});A.toggleKeyMap=new Ext.util.KeyMap({target:B,scope:A,defaultEventAction:"stopEvent",key:Ext.event.Event.F6,fn:A.toggleWindow});A.fireEvent("enable",A)},initViewport:function(){var B=this,C,A;C=Ext.ComponentQuery.query("container[ariaRole=application]")[0];if(!C){C=Ext.ComponentQuery.query("viewport")[0];if(C){C.ariaUpdate({role:"application"})}}if(!C){Ext.Error.raise('Failed to initialize ARIA support. No viewport or component with ariaRole of "application" was found.');return}B.defaultFocusCmp=C;B.addStepOutDiv(C);if(Ext.isIE){A=C.getFocusEl();A=A?A.dom:null;if(Ext.Element.getActiveElement()===A){B.stepOutDiv.focus()}}B.addWindow(C,C)},focusLast:function(A){var B=this;if(B.isWhitelisted(B.focusedCmp)){return true}if(B.previousFocusedCmp){B.previousFocusedCmp.focus()}},initDOM:function(){var B=this,E,A,C,D;if(!Ext.isReady){return Ext.onReady(B.initDOM,B)}E=Ext.ComponentQuery.query("{getFocusEl()}:not([focusListenerAdded])");C=E.length;for(A=0;A<C;A++){D=E[A];D.addFocusListener()}},getFocusedCmp:function(){return this.focusedCmp||this.defaultFocusCmp},navigateIn:function(B,D,A){var C=this,F=D||C.focusedCmp,E;if(!F){C.focusDefault();return false}if(!F.ariaIsSection()||C.isWhitelisted(F)){return true}else{E=A?F.ariaLastChild(B):F.ariaFirstChild(B);if(E){E.focus()}else{return true}}return false},navigateOut:function(A,D){var B=this,F=D||B.focusedCmp,E,C;if(!F){B.focusDefault();return false}E=F.ariaGetFocusableSection();if(E&&E!==F){if(E.isTabPanel){C=E.ariaFirstChild();if(!E.ariaIsOwnTab(F)){E=C}}else{if(F.triggerBlur){F.triggerBlur()}}E.focus();return false}return true},navigateSiblings:function(A,G){var H=this,C=G||H,I=A.getKey(),D=A.shiftKey||I===A.LEFT||I===A.UP,B=I===A.LEFT||I===A.RIGHT||I===A.UP||I===A.DOWN,F=C.focusedCmp,J,E;if(I===Ext.EventObject.TAB&&A.ctrlKey){return true}if(!F){H.focusDefault();return false}E=H.isWhitelisted(F);if(B&&E){return true}if(!B&&E){B=!F.up("form")}if(B){if(D){J=F.ariaPreviousSibling("{isFocusable()}",true)}else{J=F.ariaNextSibling("{isFocusable()}",true)}}if(!J){if(D){J=F.ariaPreviousNode()}else{J=F.ariaNextNode()}}if(!J&&F.ariaIsSection()&&!F.isWindow){if(!D){H.stepOutOfApp(A)}return true}else{if(J){J.focus()}}return false},onComponentBlur:function(C,A){var B=this;if(B.focusedCmp===C){B.previousFocusedCmp=C}Ext.globalEvents.fireEvent("componentblur",B,C,B.previousFocusedCmp);return false},onComponentFocus:function(C,A){var B=this;if(Ext.globalEvents.fireEvent("beforecomponentfocus",B,C,B.previousFocusedCmp)===false){B.clearComponent(C);return}B.focusedCmp=C;return false},onComponentHide:function(C){var B=this,A=false,E=B.focusedCmp,D;if(E){A=C.hasFocus||(C.isContainer&&C.isAncestor(B.focusedCmp))}B.clearComponent(C);if(A){D=C.ariaGetFocusFallback();if(D){D.focus();return}B.focusDefault()}},onComponentDestroy:Ext.emptyFn,focusDefault:function(A){this.defaultFocusCmp.focus(false,A)},addStepOutDiv:function(A){var C=A.getEl(),B;B=C.createChild({tag:"div",title:"Step Out of Application",tabIndex:0});C.set({tabIndex:0});this.stepOutDiv=B},stepOutOfApp:function(A){var B=this;delete B.focusedCmp;B.stepOutDiv.focus()},toggleWindow:function(H,A){var G=this,B=G.windows,D=B.length,E=G.focusedCmp,C=0,F=0,I;if(D===1){return}I=E.isWindow?E:E.up("window");if(I){C=G.findWindowIndex(I)}if(A.shiftKey){F=C-1;if(F<0){F=D-1}}else{F=C+1;if(F===D){F=0}}I=B[F];if(I.cmp.isWindow){I.cmp.toFront()}I.cmp.focus(false,100);return false},addWindow:function(A,D){var B=this,C={cmp:A};B.windows.push(C);D.focus(false,100)},removeWindow:function(A){var C=this,B=C.windows,D;if(B.length===1){return}D=C.findWindowIndex(A);if(D>=0){Ext.Array.erase(B,D,1)}},findWindowIndex:function(A){var E=this,D=E.windows,B=D.length,F=-1,C;for(C=0;C<B;C++){if(D[C].cmp===A){F=C;break}}return F}},function(){var A=Ext.FocusManager=Ext.aria.FocusManager;Ext.onReady(function(){A.enable()})});
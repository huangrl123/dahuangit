Ext.define("Ext.chart.series.Line",{extend:"Ext.chart.series.Cartesian",alternateClassName:["Ext.chart.LineSeries","Ext.chart.LineChart"],requires:["Ext.chart.axis.Axis","Ext.chart.Shape","Ext.draw.Draw","Ext.fx.Anim"],type:"line",alias:"series.line",selectionTolerance:20,showMarkers:true,markerConfig:{},style:{},smooth:false,defaultSmoothness:3,fill:false,constructor:function(C){this.callParent(arguments);var D=this,F=D.chart.surface,A=D.chart.shadow,B,E;C.highlightCfg=Ext.Object.merge({"stroke-width":3},C.highlightCfg);Ext.apply(D,C,{shadowAttributes:[{"stroke-width":6,"stroke-opacity":0.05,stroke:"rgb(0, 0, 0)",translate:{x:1,y:1}},{"stroke-width":4,"stroke-opacity":0.1,stroke:"rgb(0, 0, 0)",translate:{x:1,y:1}},{"stroke-width":2,"stroke-opacity":0.15,stroke:"rgb(0, 0, 0)",translate:{x:1,y:1}}]});D.group=F.getGroup(D.seriesId);if(D.showMarkers){D.markerGroup=F.getGroup(D.seriesId+"-markers")}if(A){for(B=0,E=D.shadowAttributes.length;B<E;B++){D.shadowGroups.push(F.getGroup(D.seriesId+"-shadows"+B))}}},shrink:function(J,F,D){var G=J.length,A=Math.floor(G/D),E=1,B=0,I=0,C=[+J[0]],H=[+F[0]];for(;E<G;++E){B+=+J[E]||0;I+=+F[E]||0;if(E%A==0){C.push(B/A);H.push(I/A);B=0;I=0}}return{x:C,y:H}},drawSeries:function(){var O=this,P=O.chart,AE=P.axes,A=P.getChartStore(),AF=A.data.items,Az,Ac=A.getCount(),a=O.chart.surface,As={},w=O.group,Z=O.showMarkers,D=O.markerGroup,J=P.shadow,AG=O.shadowGroups,H=O.shadowAttributes,z=O.smooth,r=AG.length,Ao=["M"],R=["M"],G=["M"],T=["M"],M=P.markerIndex,F=[].concat(O.axis),X,AB=[],Ap=[],V=false,AI=O.reverse,E=[],Av=Ext.apply({},O.markerStyle),Ay=O.seriesStyle,Ab=O.colorArrayStyle,AA=Ab&&Ab.length||0,Q=Ext.isNumber,b=O.seriesIdx,p=O.getAxesForXAndYFields(),Ai=p.xAxis,Al=p.yAxis,Y=AE&&AE.get(Ai),C=AE&&AE.get(Al),e=Ai?Y&&Y.type:"",W=Al?C&&C.type:"",c,t,U,Aq,Af,AH,K,Aj,Ak,g,f,AD,d,Ax,An,Am,At,B,Aa,o,AC,Ar,Ah,Ag,Au,v,k,Aw,S,Ae,N,Ad,n,q,I,h,s,L,m,l,u;if(O.fireEvent("beforedraw",O)===false){return}if(!Ac||O.seriesIsHidden){O.hide();O.items=[];if(O.line){O.line.hide(true);if(O.line.shadows){c=O.line.shadows;for(Am=0,r=c.length;Am<r;Am++){t=c[Am];t.hide(true)}}if(O.fillPath){O.fillPath.hide(true)}}O.line=null;O.fillPath=null;return}q=Ext.apply(Av||{},O.markerConfig,{fill:O.seriesStyle.fill||Ab[O.themeIdx%Ab.length]});h=q.type;delete q.type;I=Ay;if(!I["stroke-width"]){I["stroke-width"]=0.5}L="opacity" in I?I.opacity:1;u="opacity" in I?I.opacity:0.3;m="lineOpacity" in I?I.lineOpacity:L;l="fillOpacity" in I?I.fillOpacity:u;if(M&&D&&D.getCount()){for(An=0;An<M;An++){o=D.getAt(An);D.remove(o);D.add(o);AC=D.getAt(D.getCount()-2);o.setAttributes({x:0,y:0,translate:{x:AC.attr.translation.x,y:AC.attr.translation.y}},true)}}O.unHighlightItem();O.cleanHighlights();O.setBBox();As=O.bbox;O.clipRect=[As.x,As.y,As.width,As.height];if(Y){Aa=Y.applyData();Aw=Aa.from;S=Aa.to}if(C){Aa=C.applyData();Ae=Aa.from;N=Aa.to}if(O.xField&&!Ext.isNumber(Aw)){B=O.getMinMaxXValues();Aw=B[0];S=B[1]}if(O.yField&&!Ext.isNumber(Ae)){B=O.getMinMaxYValues();Ae=B[0];N=B[1]}if(isNaN(Aw)){Aw=0;v=As.width/((Ac-1)||1)}else{v=As.width/((S-Aw)||(Ac-1)||1)}if(isNaN(Ae)){Ae=0;k=As.height/((Ac-1)||1)}else{k=As.height/((N-Ae)||(Ac-1)||1)}for(An=0,At=AF.length;An<At;An++){Az=AF[An];Ah=Az.get(O.xField);if(e==="Time"&&typeof Ah==="string"){Ah=Date.parse(Ah)}if(typeof Ah==="string"||typeof Ah==="object"&&!Ext.isDate(Ah)||e==="Category"){Ah=An}Ag=Az.get(O.yField);if(W==="Time"&&typeof Ag==="string"){Ag=Date.parse(Ag)}if(typeof Ag==="undefined"||(typeof Ag==="string"&&!Ag)){if(Ext.isDefined(Ext.global.console)){Ext.global.console.warn("[Ext.chart.series.Line]  Skipping a store element with an undefined value at ",Az,Ah,Ag)}continue}if(typeof Ag==="string"||typeof Ag==="object"&&!Ext.isDate(Ag)||W==="Category"){Ag=An}E.push(An);AB.push(Ah);Ap.push(Ag)}At=AB.length;if(At>As.width){Au=O.shrink(AB,Ap,As.width);AB=Au.x;Ap=Au.y}O.items=[];s=0;At=AB.length;for(An=0;An<At;An++){Ah=AB[An];Ag=Ap[An];if(Ag===false){if(R.length==1){R=[]}V=true;O.items.push(false);continue}else{if(AI){Aj=As.x+As.width-((Ah-Aw)*v)}else{Aj=(As.x+(Ah-Aw)*v)}Aj=Ext.Number.toFixed(Aj,2);Ak=Ext.Number.toFixed((As.y+As.height)-(Ag-Ae)*k,2);if(V){V=false;R.push("M")}R=R.concat([Aj,Ak])}if((typeof d=="undefined")&&(typeof Ak!="undefined")){d=Ak;AD=Aj}if(!O.line||P.resizing){Ao=Ao.concat([Aj,As.y+As.height/2])}if(P.animate&&P.resizing&&O.line){O.line.setAttributes({path:Ao,opacity:m},true);if(O.fillPath){O.fillPath.setAttributes({path:Ao,opacity:l},true)}if(O.line.shadows){c=O.line.shadows;for(Am=0,r=c.length;Am<r;Am++){t=c[Am];t.setAttributes({path:Ao},true)}}}if(Z){o=D.getAt(s++);if(!o){o=Ext.chart.Shape[h](a,Ext.apply({group:[w,D],x:0,y:0,translate:{x:+(g||Aj),y:f||(As.y+As.height/2)},value:'"'+Ah+", "+Ag+'"',zIndex:4000},q));o._to={translate:{x:+Aj,y:+Ak}}}else{o.setAttributes({value:'"'+Ah+", "+Ag+'"',x:0,y:0,hidden:false},true);o._to={translate:{x:+Aj,y:+Ak}}}}O.items.push({series:O,value:[Ah,Ag],point:[Aj,Ak],sprite:o,storeItem:A.getAt(E[An])});g=Aj;f=Ak}if(R.length<=1){return}if(O.smooth){T=Ext.draw.Draw.smooth(R,Q(z)?z:O.defaultSmoothness)}G=z?T:R;if(P.markerIndex&&O.previousPath){Aq=O.previousPath;if(!z){Ext.Array.erase(Aq,1,2)}}else{Aq=R}if(!O.line){O.line=a.add(Ext.apply({type:"path",group:w,path:Ao,stroke:I.stroke||I.fill},I||{}));O.line.setAttributes({opacity:m},true);if(J){O.line.setAttributes(Ext.apply({},O.shadowOptions),true)}O.line.setAttributes({fill:"none",zIndex:3000});if(!I.stroke&&AA){O.line.setAttributes({stroke:Ab[O.themeIdx%AA]},true)}if(J){c=O.line.shadows=[];for(U=0;U<r;U++){X=H[U];X=Ext.apply({},X,{path:Ao});t=a.add(Ext.apply({},{type:"path",group:AG[U]},X));c.push(t)}}}if(O.fill){AH=G.concat([["L",Aj,As.y+As.height],["L",AD,As.y+As.height],["L",AD,d]]);if(!O.fillPath){O.fillPath=a.add({group:w,type:"path",fill:I.fill||Ab[O.themeIdx%AA],path:Ao})}}Ax=Z&&D.getCount();if(P.animate){Af=O.fill;Ad=O.line;K=O.renderer(Ad,false,{path:G},An,A);Ext.apply(K,I||{},{stroke:I.stroke||I.fill});delete K.fill;Ad.show(true);if(P.markerIndex&&O.previousPath){O.animation=n=O.onAnimate(Ad,{to:K,from:{path:Aq}})}else{O.animation=n=O.onAnimate(Ad,{to:K})}if(J){c=Ad.shadows;for(Am=0;Am<r;Am++){c[Am].show(true);if(P.markerIndex&&O.previousPath){O.onAnimate(c[Am],{to:{path:G},from:{path:Aq}})}else{O.onAnimate(c[Am],{to:{path:G}})}}}if(Af){O.fillPath.show(true);O.onAnimate(O.fillPath,{to:Ext.apply({},{path:AH,fill:I.fill||Ab[O.themeIdx%AA],"stroke-width":0,opacity:l},I||{})})}if(Z){s=0;for(An=0;An<At;An++){if(O.items[An]){Ar=D.getAt(s++);if(Ar){K=O.renderer(Ar,A.getAt(An),Ar._to,An,A);O.onAnimate(Ar,{to:Ext.applyIf(K,q||{})});Ar.show(true)}}}for(;s<Ax;s++){Ar=D.getAt(s);Ar.hide(true)}}}else{K=O.renderer(O.line,false,{path:G,hidden:false},An,A);Ext.apply(K,I||{},{stroke:I.stroke||I.fill});delete K.fill;O.line.setAttributes(K,true);O.line.setAttributes({opacity:m},true);if(J){c=O.line.shadows;for(Am=0;Am<r;Am++){c[Am].setAttributes({path:G,hidden:false},true)}}if(O.fill){O.fillPath.setAttributes({path:AH,hidden:false,opacity:l},true)}if(Z){s=0;for(An=0;An<At;An++){if(O.items[An]){Ar=D.getAt(s++);if(Ar){K=O.renderer(Ar,A.getAt(An),Ar._to,An,A);Ar.setAttributes(Ext.apply(q||{},K||{}),true);if(!Ar.attr.hidden){Ar.show(true)}}}}for(;s<Ax;s++){Ar=D.getAt(s);Ar.hide(true)}}}if(P.markerIndex){if(O.smooth){Ext.Array.erase(R,1,2)}else{Ext.Array.splice(R,1,0,R[1],R[2])}O.previousPath=R}O.renderLabels();O.renderCallouts();O.fireEvent("draw",O)},onCreateLabel:function(C,I,E,H){var G=this,F=G.labelsGroup,A=G.label,B=G.bbox,D=Ext.apply({},A,G.seriesLabelStyle||{});return G.chart.surface.add(Ext.apply({"type":"text","text-anchor":"middle","group":F,"x":Number(I.point[0]),"y":B.y+B.height/2},D||{}))},onPlaceLabel:function(Q,R,D,F,O,L,E){var H=this,W=H.chart,V=W.resizing,A=H.label,N=A.renderer,C=A.field,K=H.bbox,S=Number(D.point[0]),T=Number(D.point[1]),G=D.sprite.attr.radius,P,J,M,U,I,B;Q.setAttributes({text:N(R.get(C),Q,R,D,F,O,L,E),hidden:true},true);J=D.sprite.getBBox();J.width=J.width||(G*2);J.height=J.height||(G*2);P=Q.getBBox();M=P.width/2;U=P.height/2;if(O=="rotate"){I=J.width/2+M+U/2;if(S+I+M>K.x+K.width){S-=I}else{S+=I}Q.setAttributes({"rotation":{x:S,y:T,degrees:-45}},true)}else{if(O=="under"||O=="over"){Q.setAttributes({"rotation":{degrees:0}},true);if(S<K.x+M){S=K.x+M}else{if(S+M>K.x+K.width){S=K.x+K.width-M}}B=J.height/2+U;T=T+(O=="over"?-B:B);if(T<K.y+U){T+=2*B}else{if(T+U>K.y+K.height){T-=2*B}}}}if(H.chart.animate&&!H.chart.resizing){Q.show(true);H.onAnimate(Q,{to:{x:S,y:T}})}else{Q.setAttributes({x:S,y:T},true);if(V&&H.animation){H.animation.on("afteranimate",function(){Q.show(true)})}else{Q.show(true)}}},highlightItem:function(){var A=this,B=A.line;A.callParent(arguments);if(B&&!A.highlighted){if(!("__strokeWidth" in B)){B.__strokeWidth=parseFloat(B.attr["stroke-width"])||0}if(B.__anim){B.__anim.paused=true}B.__anim=new Ext.fx.Anim({target:B,to:{"stroke-width":B.__strokeWidth+3}});A.highlighted=true}},unHighlightItem:function(){var B=this,C=B.line,A;B.callParent(arguments);if(C&&B.highlighted){A=C.__strokeWidth||parseFloat(C.attr["stroke-width"])||0;C.__anim=new Ext.fx.Anim({target:C,to:{"stroke-width":A}});B.highlighted=false}},onPlaceCallout:function(b,W,O,g,J,U,B){if(!J){return}var I=this,G=I.chart,j=G.surface,Q=G.resizing,N=I.callouts,K=I.items,C=g==0?false:K[g-1].point,A=(g==K.length-1)?false:K[g+1].point,d=[+O.point[0],+O.point[1]],Y,R,D,h,V,S,f=N.offsetFromViz||30,M=N.offsetToSide||10,X=N.offsetBox||3,L,P,e,T,c,E=I.clipRect,F={width:N.styles.width||10,height:N.styles.height||10},H,Z;if(!C){C=d}if(!A){A=d}h=(A[1]-C[1])/(A[0]-C[0]);V=(d[1]-C[1])/(d[0]-C[0]);S=(A[1]-d[1])/(A[0]-d[0]);R=Math.sqrt(1+h*h);Y=[1/R,h/R];D=[-Y[1],Y[0]];if(V>0&&S<0&&D[1]<0||V<0&&S>0&&D[1]>0){D[0]*=-1;D[1]*=-1}else{if(Math.abs(V)<Math.abs(S)&&D[0]<0||Math.abs(V)>Math.abs(S)&&D[0]>0){D[0]*=-1;D[1]*=-1}}H=d[0]+D[0]*f;Z=d[1]+D[1]*f;L=H+(D[0]>0?0:-(F.width+2*X));P=Z-F.height/2-X;e=F.width+2*X;T=F.height+2*X;if(L<E[0]||(L+e)>(E[0]+E[2])){D[0]*=-1}if(P<E[1]||(P+T)>(E[1]+E[3])){D[1]*=-1}H=d[0]+D[0]*f;Z=d[1]+D[1]*f;L=H+(D[0]>0?0:-(F.width+2*X));P=Z-F.height/2-X;e=F.width+2*X;T=F.height+2*X;if(G.animate){I.onAnimate(b.lines,{to:{path:["M",d[0],d[1],"L",H,Z,"Z"]}});if(b.panel){b.panel.setPosition(L,P,true)}}else{b.lines.setAttributes({path:["M",d[0],d[1],"L",H,Z,"Z"]},true);if(b.panel){b.panel.setPosition(L,P)}}for(c in b){b[c].show(true)}},isItemInPoint:function(Q,R,A,C){var D=this,K=D.items,M=K.length,P=D.selectionTolerance,B,G,E,H,N,S,O,T,J,L,I,F=Math.sqrt;G=K[C];B=C&&K[C-1];if(C>=M){B=K[M-1]}E=B&&B.point;H=G&&G.point;N=B?E[0]:H[0]-P;O=B?E[1]:H[1];S=G?H[0]:E[0]+P;T=G?H[1]:E[1];J=F((Q-N)*(Q-N)+(R-O)*(R-O));L=F((Q-S)*(Q-S)+(R-T)*(R-T));I=Math.min(J,L);if(I<=P){return I==J?B:G}return false},toggleAll:function(C){var D=this,B,F,A,E;if(!C){Ext.chart.series.Cartesian.prototype.hideAll.call(D)}else{Ext.chart.series.Cartesian.prototype.showAll.call(D)}if(D.line){D.line.setAttributes({hidden:!C},true);if(D.line.shadows){for(B=0,E=D.line.shadows,F=E.length;B<F;B++){A=E[B];A.setAttributes({hidden:!C},true)}}}if(D.fillPath){D.fillPath.setAttributes({hidden:!C},true)}},hideAll:function(){this.toggleAll(false)},showAll:function(){this.toggleAll(true)}});
Ext.define("Ext.scroll.Scroller",{extend:"Ext.Evented",requires:["Ext.fx.easing.BoundMomentum","Ext.fx.easing.EaseOut","Ext.util.Translatable"],config:{element:null,direction:"auto",fps:"auto",disabled:null,directionLock:false,momentumEasing:{momentum:{acceleration:30,friction:0.5},bounce:{acceleration:30,springTension:0.3},minVelocity:1},bounceEasing:{duration:400},outOfBoundRestrictFactor:0.5,startMomentumResetTime:300,maxAbsoluteVelocity:6,containerSize:"auto",size:"auto",autoRefresh:true,initialOffset:{x:0,y:0},slotSnapSize:{x:0,y:0},slotSnapOffset:{x:0,y:0},slotSnapEasing:{duration:150},translatable:{translationMethod:"auto",useWrapper:false},mouseEnabled:false,snapToBoundary:true},statics:{instances:{}},cls:Ext.baseCSSPrefix+"scroll-scroller",containerCls:Ext.baseCSSPrefix+"scroll-container",dragStartTime:0,dragEndTime:0,isDragging:false,isAnimating:false,isMouseEvent:{mousedown:1,mousemove:1,mouseup:1},constructor:function(A){var B=this,D=A&&A.element,C="onEvent";B.listenerMap={touchstart:"onTouchStart",touchend:"onTouchEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd"};B.listeners={touchstart:C,touchend:C,dragstart:C,drag:C,dragend:C,scope:B};B.minPosition={x:0,y:0};B.startPosition={x:0,y:0};B.velocity={x:0,y:0};B.isAxisEnabledFlags={x:false,y:false};B.flickStartPosition={x:0,y:0};B.flickStartTime={x:0,y:0};B.lastDragPosition={x:0,y:0};B.dragDirection={x:0,y:0};B.initialConfig=A;if(D){B.setElement(D)}B.self.instances[B.id]=B;return this},initialize:function(){var A=this;if(!A.initialized){A.mixins.observable.constructor.call(A,A.initialConfig);A.initialized=true}},applyElement:function(A){if(!A){return}return Ext.get(A)},updateElement:function(F){var D=this;D.initialize();if(!D.FixedHBoxStretching){F.addCls(D.cls)}if(!D.getDisabled()){D.attachListeners()}var C=function(){D.refreshMaxPosition()},B=Ext.Function.createSequence,A=D.updateContainerSize,E=D.updateSize;D.updateContainerSize=A?B(A,C):C;D.updateSize=E?B(E,C):C;D.on({maxpositionchange:"snapToBoundary",minpositionchange:"snapToBoundary",scope:D});return D},applyTranslatable:function(A,B){return Ext.factory(A,Ext.util.Translatable,B)},updateTranslatable:function(A){A.setConfig({element:this.getElement(),listeners:{animationframe:"onAnimationFrame",animationend:"onAnimationEnd",scope:this}})},updateFps:function(A){if(A!=="auto"){this.getTranslatable().setFps(A)}},attachListeners:function(){this.getContainer().on(this.listeners)},detachListeners:function(){this.getContainer().un(this.listeners)},updateDisabled:function(A){if(A){this.detachListeners()}else{this.attachListeners()}},updateInitialOffset:function(A){if(typeof A=="number"){A={x:A,y:A}}this.getTranslatable().translate(-A.x,-A.y)},applyDirection:function(E){var A=this.getMinPosition(),B=this.getMaxPosition(),D,C;this.givenDirection=E;if(E==="auto"){D=B.x>A.x;C=B.y>A.y;if(D&&C){E="both"}else{if(D){E="horizontal"}else{E="vertical"}}}return E},updateDirection:function(E,B){var A=this.isAxisEnabledFlags,C=this.cls+"-vertical",F=this.cls+"-horizontal",D=this.getElement();if(B==="both"||B==="horizontal"){D.removeCls(F)}if(B==="both"||B==="vertical"){D.removeCls(C)}A.x=A.y=false;if(E==="both"||E==="horizontal"){A.x=true;D.addCls(F)}if(E==="both"||E==="vertical"){A.y=true;D.addCls(C)}},isAxisEnabled:function(A){this.getDirection();return this.isAxisEnabledFlags[A]},applyMomentumEasing:function(A){var B=Ext.fx.easing.BoundMomentum;return{x:Ext.factory(A,B),y:Ext.factory(A,B)}},applyBounceEasing:function(A){var B=Ext.fx.easing.EaseOut;return{x:Ext.factory(A,B),y:Ext.factory(A,B)}},updateBounceEasing:function(A){this.getTranslatable().setEasingX(A.x).setEasingY(A.y)},applySlotSnapEasing:function(A){var B=Ext.fx.easing.EaseOut;return{x:Ext.factory(A,B),y:Ext.factory(A,B)}},getPosition:function(){return this.getTranslatable().getPosition()},getMinPosition:function(){var A=this.minPosition;if(!A){this.minPosition=A={x:0,y:0};this.fireEvent("minpositionchange",this,A)}return A},getMaxPosition:function(){var B=this.maxPosition,A,C;if(!B){A=this.getSize();C=this.getContainerSize();this.maxPosition=B={x:Math.max(0,A.x-C.x),y:Math.max(0,A.y-C.y)};this.fireEvent("maxpositionchange",this,B)}return B},refreshMaxPosition:function(){this.maxPosition=null;this.getMaxPosition()},applyContainerSize:function(A){var D=this.getContainer().dom,B,C;if(!D){return}this.givenContainerSize=A;if(A==="auto"){B=D.clientWidth;C=D.clientHeight}else{B=A.x;C=A.y}return{x:B,y:C}},applySize:function(A){var B=this.getElement().dom,D=this.getContainer().dom,C,E;if(!B){return}this.givenSize=A;if(A==="auto"){C=Math.max(B.offsetWidth,D.clientWidth);E=Math.max(B.offsetHeight,D.clientHeight)}else{if(typeof A=="number"){C=A;E=A}else{C=A.x;E=A.y}}return{x:C,y:E}},updateAutoRefresh:function(A){this.getElement().toggleListener(A,"resize","onElementResize",this);this.getContainer().toggleListener(A,"resize","onContainerResize",this)},applySlotSnapSize:function(A){if(typeof A=="number"){return{x:A,y:A}}return A},applySlotSnapOffset:function(A){if(typeof A=="number"){return{x:A,y:A}}return A},getContainer:function(){var A=this.container,B;if(!A){B=this.getElement().getParent();this.container=A=this.FixedHBoxStretching?B.getParent():B;if(!A){Ext.Logger.error("Making an element scrollable that doesn't have any container")}A.addCls(this.containerCls)}return A},refresh:function(){this.stopAnimation();this.getTranslatable().refresh();this.setSize(this.givenSize);this.setContainerSize(this.givenContainerSize);this.setDirection(this.givenDirection);this.fireEvent("refresh",this);return this},onElementResize:function(A,B){this.setSize({x:B.width,y:B.height});this.refresh()},onContainerResize:function(A,B){this.setContainerSize({x:B.width,y:B.height});this.refresh()},scrollTo:function(E,I,H){var D=this,B;if(D.isDestroyed){return D}if(typeof E!="number"&&arguments.length===1){Ext.Logger.deprecate("Calling scrollTo() with an object argument is deprecated, please pass x and y arguments instead",D);I=E.y;E=E.x}var F=D.getTranslatable(),C=D.getPosition(),A=false,G,J;if(D.isAxisEnabled("x")){if(isNaN(E)||typeof E!="number"){E=C.x}else{if(C.x!==E){A=true}}G=this.convertX(-E)}if(D.isAxisEnabled("y")){if(isNaN(I)||typeof I!="number"){I=C.y}else{if(C.y!==I){A=true}}J=-I}if(A){if(H!==undefined&&H!==false){B=function(){D.fireEvent("scroll",D,E,I)};if(H===true){H={callback:B}}else{if(H.callback){H.callback=Ext.Function.createSequence(H.callback,B)}else{H.callback=B}}F.translateAnimated(G,J,H)}else{F.translate(G,J);D.fireEvent("scroll",D,E,I)}}return this},scrollToTop:function(A){var B=this.getInitialOffset();return this.scrollTo(B.x,B.y,A)},scrollToEnd:function(B){var A=this.getSize(),C=this.getContainerSize();return this.scrollTo(A.x-C.x,A.y-C.y,B)},scrollBy:function(C,D,A){var B=this.getPosition();C=(typeof C=="number")?C+B.x:null;D=(typeof D=="number")?D+B.y:null;return this.scrollTo(C,D,A)},onEvent:function(A){var B=this,C=A.browserEvent;if(!Ext.supports.Touch||B.getMouseEnabled()||(!B.isMouseEvent[C.type]&&C.pointerType!=="mouse")){B[B.listenerMap[A.type]](A)}},onTouchStart:function(){this.isTouching=this.self.isTouching=true;this.stopAnimation()},onTouchEnd:function(){var A=this.getPosition();this.isTouching=this.self.isTouching=false;if(!this.isDragging&&this.snapToSlot()){this.fireEvent("scrollstart",this,A.x,A.y)}},onDragStart:function(A){var B=this.getDirection(),N=A.absDeltaX,M=A.absDeltaY,I=this.getDirectionLock(),D=this.startPosition,K=this.flickStartPosition,E=this.flickStartTime,F=this.lastDragPosition,H=this.getPosition(),C=this.dragDirection,J=H.x,G=H.y,L=Ext.Date.now();this.isDragging=true;if(I&&B!=="both"){if((B==="horizontal"&&N>M)||(B==="vertical"&&M>N)){A.stopPropagation()}else{this.isDragging=false;return}}F.x=J;F.y=G;K.x=J;K.y=G;D.x=J;D.y=G;E.x=L;E.y=L;C.x=0;C.y=0;this.dragStartTime=L;this.isDragging=true;this.fireEvent("scrollstart",this,J,G)},onAxisDrag:function(H,E){if(!this.isAxisEnabled(H)){return}var L=this.flickStartPosition,D=this.flickStartTime,A=this.lastDragPosition,J=this.dragDirection,K=this.getPosition()[H],F=this.getMinPosition()[H],N=this.getMaxPosition()[H],Q=this.startPosition[H],I=A[H],C=Q-E,O=J[H],P=this.getOutOfBoundRestrictFactor(),B=this.getStartMomentumResetTime(),G=Ext.Date.now(),M;if(C<F){C*=P}else{if(C>N){M=C-N;C=N+M*P}}if(C>I){J[H]=1}else{if(C<I){J[H]=-1}}if((O!==0&&(J[H]!==O))||(G-D[H])>B){L[H]=K;D[H]=G}A[H]=C},onDrag:function(B){if(!this.isDragging){return}var A=this.lastDragPosition;this.onAxisDrag("x",this.convertX(B.deltaX));this.onAxisDrag("y",B.deltaY);this.scrollTo(A.x,A.y)},onDragEnd:function(A){var B,C;if(!this.isDragging){return}this.dragEndTime=Ext.Date.now();this.onDrag(A);this.isDragging=false;B=this.getAnimationEasing("x",A);C=this.getAnimationEasing("y",A);if(B||C){this.getTranslatable().animate(B,C)}else{this.onScrollEnd()}},getAnimationEasing:function(B,A){if(!this.isAxisEnabled(B)){return null}var F=this.getPosition()[B],K=this.getMinPosition()[B],I=this.getMaxPosition()[B],J=this.getMaxAbsoluteVelocity(),G=null,E=this.dragEndTime,C=A.flick.velocity[B],D=B==="x",L,H;if(F<K){G=K}else{if(F>I){G=I}}if(D){F=this.convertX(F);G=this.convertX(G)}if(G!==null){H=this.getBounceEasing()[B];H.setConfig({startTime:E,startValue:-F,endValue:-G});return H}if(C===0){return null}if(C<-J){C=-J}else{if(C>J){C=J}}if(Ext.browser.is.IE){C*=2}H=this.getMomentumEasing()[B];L={startTime:E,startValue:-F,startVelocity:C*1.5,minMomentumValue:-I,maxMomentumValue:0};if(D){this.convertEasingConfig(L)}H.setConfig(L);return H},onAnimationFrame:function(D,B,C){var A=this.getPosition();this.fireEvent("scroll",this,this.convertX(A.x),A.y)},onAnimationEnd:function(){this.snapToBoundary();this.onScrollEnd()},stopAnimation:function(){this.getTranslatable().stopAnimation()},onScrollEnd:function(){var A=this.getPosition();if(this.isTouching||!this.snapToSlot()){this.fireEvent("scrollend",this,A.x,A.y)}},snapToSlot:function(){var C=this.getSnapPosition("x"),A=this.getSnapPosition("y"),B=this.getSlotSnapEasing();if(C!==null||A!==null){this.scrollTo(C,A,{easingX:B.x,easingY:B.y});return true}return false},getSnapPosition:function(G){var E=this.getSlotSnapSize()[G],B=null,A,C,D,F;if(E!==0&&this.isAxisEnabled(G)){A=this.getPosition()[G];C=this.getSlotSnapOffset()[G];D=this.getMaxPosition()[G];F=Math.floor((A-C)%E);if(F!==0){if(A!==D){if(Math.abs(F)>E/2){B=Math.min(D,A+((F>0)?E-F:F-E))}else{B=A-F}}else{B=A-F}}}return B},snapToBoundary:function(){if(!this.getSnapToBoundary()){return}var E=this.getPosition(),I=this.getMinPosition(),C=this.getMaxPosition(),D=I.x,F=I.y,A=C.x,B=C.y,G=Math.round(E.x),H=Math.round(E.y);if(G<D){G=D}else{if(G>A){G=A}}if(H<F){H=F}else{if(H>B){H=B}}this.scrollTo(G,H)},destroy:function(){var B=this.getElement(),C=this.sizeMonitors,A;if(C){C.element.destroy();C.container.destroy()}if(B&&!B.isDestroyed){B.removeCls(this.cls);A=this.getContainer();if(A&&!A.isDestroyed){A.removeCls(this.containerCls)}}Ext.destroy(this.getTranslatable());delete this.self.instances[this.id];this.callParent(arguments)},convertX:function(A){return A},convertEasingConfig:function(A){return A}},function(){this.override({constructor:function(D){var F,B,A,E,C,G;if(!D){D={}}if(typeof D=="string"){D={direction:D}}if(arguments.length==2){Ext.Logger.deprecate("Passing element as the first argument is deprecated, pass it as the 'element' property of the config object instead");F=D;D=arguments[1];if(!D){D={}}D.element=F}if(D.hasOwnProperty("acceleration")){B=D.acceleration;delete D.acceleration;Ext.Logger.deprecate("'acceleration' config is deprecated, set momentumEasing.momentum.acceleration and momentumEasing.bounce.acceleration configs instead");Ext.merge(D,{momentumEasing:{momentum:{acceleration:B},bounce:{acceleration:B}}})}if(D.hasOwnProperty("snap")){D.slotSnapOffset=D.snap;Ext.Logger.deprecate("'snap' config is deprecated, please use the 'slotSnapOffset' config instead")}if(D.hasOwnProperty("friction")){E=D.friction;delete D.friction;Ext.Logger.deprecate("'friction' config is deprecated, set momentumEasing.momentum.friction config instead");Ext.merge(D,{momentumEasing:{momentum:{friction:E}}})}if(D.hasOwnProperty("springTension")){C=D.springTension;delete D.springTension;Ext.Logger.deprecate("'springTension' config is deprecated, set momentumEasing.momentum.springTension config instead");Ext.merge(D,{momentumEasing:{momentum:{springTension:C}}})}if(D.hasOwnProperty("minVelocityForAnimation")){G=D.minVelocityForAnimation;delete D.minVelocityForAnimation;Ext.Logger.deprecate("'minVelocityForAnimation' config is deprecated, set momentumEasing.minVelocity config instead");Ext.merge(D,{momentumEasing:{minVelocity:G}})}this.callOverridden(arguments)},scrollToAnimated:function(B,C,A){Ext.Logger.deprecate("scrollToAnimated() is deprecated, please use `scrollTo()` and pass 'animation' as the third argument instead");return this.scrollTo.apply(this,arguments)},scrollBy:function(B,C,A){if(Ext.isObject(B)){Ext.Logger.deprecate("calling `scrollBy()` with an object of `x` and `y` properties is no longer supported. Please pass `x` and `y` values as two separate arguments instead");C=B.y;B=B.x}return this.callOverridden([B,C,A])},setOffset:function(A){return this.scrollToAnimated(-A.x,-A.y)}})});
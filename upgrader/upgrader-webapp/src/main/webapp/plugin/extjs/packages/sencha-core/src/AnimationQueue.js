Ext.define("Ext.AnimationQueue",{singleton:true,constructor:function(){var A=Ext.Function.bind;this.queue=[];this.taskQueue=[];this.runningQueue=[];this.idleQueue=[];this.isRunning=false;this.isIdle=true;this.run=A(this.run,this);this.whenIdle=A(this.whenIdle,this);this.processIdleQueueItem=A(this.processIdleQueueItem,this);this.processTaskQueueItem=A(this.processTaskQueueItem,this);if(Ext.os.is.iOS){setInterval(this.watch,500)}},start:function(A,B,C){this.queue.push(arguments);if(!this.isRunning){if(this.hasOwnProperty("idleTimer")){clearTimeout(this.idleTimer);delete this.idleTimer}if(this.hasOwnProperty("idleQueueTimer")){clearTimeout(this.idleQueueTimer);delete this.idleQueueTimer}this.isIdle=false;this.isRunning=true;this.startCountTime=Ext.now();this.count=0;this.doStart()}},watch:function(){if(this.isRunning&&Ext.now()-this.lastRunTime>=500){this.run()}},run:function(){if(!this.isRunning){return}var G=this.runningQueue,B,F;this.lastRunTime=Ext.now();this.frameStartTime=Ext.now();G.push.apply(G,this.queue);for(B=0,F=G.length;B<F;B++){this.invoke(G[B])}G.length=0;var A=this.frameStartTime,D=this.startCountTime,E=A-D,C=++this.count;if(E>=200){this.onFpsChanged(C*1000/E,C,E);this.startCountTime=A;this.count=0}this.doIterate()},onFpsChanged:Ext.emptyFn,onStop:Ext.emptyFn,doStart:function(){this.animationFrameId=Ext.Function.requestAnimationFrame(this.run);this.lastRunTime=Ext.now()},doIterate:function(){this.animationFrameId=Ext.Function.requestAnimationFrame(this.run)},doStop:function(){Ext.Function.cancelAnimationFrame(this.animationFrameId)},stop:function(B,E,G){if(!this.isRunning){return}var D=this.queue,F=D.length,A,C;for(A=0;A<F;A++){C=D[A];if(C[0]===B&&C[1]===E&&C[2]===G){D.splice(A,1);A--;F--}}if(F===0){this.doStop();this.onStop();this.isRunning=false;this.idleTimer=setTimeout(this.whenIdle,100)}},onIdle:function(C,E,G){var A=this.idleQueue,B,F,D;for(B=0,F=A.length;B<F;B++){D=A[B];if(C===D[0]&&E===D[1]&&G===D[2]){return}}A.push(arguments);if(this.isIdle){this.processIdleQueue()}},unIdle:function(C,E,G){var A=this.idleQueue,B,F,D;for(B=0,F=A.length;B<F;B++){D=A[B];if(C===D[0]&&E===D[1]&&G===D[2]){A.splice(B,1);return true}}return false},queueTask:function(A,B,C){this.taskQueue.push(arguments);this.processTaskQueue()},dequeueTask:function(C,E,G){var A=this.taskQueue,B,F,D;for(B=0,F=A.length;B<F;B++){D=A[B];if(C===D[0]&&E===D[1]&&G===D[2]){A.splice(B,1);B--;F--}}},invoke:function(B){var A=B[0],C=B[1],D=B[2];A=(typeof A=="string"?C[A]:A);if(Ext.isArray(D)){A.apply(C,D)}else{A.call(C,D)}},whenIdle:function(){this.isIdle=true;this.processIdleQueue()},processIdleQueue:function(){if(!this.hasOwnProperty("idleQueueTimer")){this.idleQueueTimer=setTimeout(this.processIdleQueueItem,1)}},processIdleQueueItem:function(){delete this.idleQueueTimer;if(!this.isIdle){return}var B=this.idleQueue,A;if(B.length>0){A=B.shift();this.invoke(A);this.processIdleQueue()}},processTaskQueue:function(){if(!this.hasOwnProperty("taskQueueTimer")){this.taskQueueTimer=setTimeout(this.processTaskQueueItem,15)}},processTaskQueueItem:function(){delete this.taskQueueTimer;var B=this.taskQueue,A;if(B.length>0){A=B.shift();this.invoke(A);this.processTaskQueue()}},showFps:function(){Ext.onReady(function(){Ext.Viewport.add([{xtype:"component",bottom:50,left:0,width:50,height:20,html:"Average",style:"background-color: black; color: white; text-align: center; line-height: 20px; font-size: 8px;"},{id:"__averageFps",xtype:"component",bottom:0,left:0,width:50,height:50,html:"0",style:"background-color: red; color: white; text-align: center; line-height: 50px;"},{xtype:"component",bottom:50,left:50,width:50,height:20,html:"Min (Last 1k)",style:"background-color: black; color: white; text-align: center; line-height: 20px; font-size: 8px;"},{id:"__minFps",xtype:"component",bottom:0,left:50,width:50,height:50,html:"0",style:"background-color: orange; color: white; text-align: center; line-height: 50px;"},{xtype:"component",bottom:50,left:100,width:50,height:20,html:"Max (Last 1k)",style:"background-color: black; color: white; text-align: center; line-height: 20px; font-size: 8px;"},{id:"__maxFps",xtype:"component",bottom:0,left:100,width:50,height:50,html:"0",style:"background-color: yellow; color: black; text-align: center; line-height: 50px;"},{xtype:"component",bottom:50,left:150,width:50,height:20,html:"Current",style:"background-color: black; color: white; text-align: center; line-height: 20px; font-size: 8px;"},{id:"__currentFps",xtype:"component",bottom:0,left:150,width:50,height:50,html:"0",style:"background-color: green; color: white; text-align: center; line-height: 50px;"}]);Ext.AnimationQueue.resetFps()})},resetFps:function(){var E=Ext.getCmp("__currentFps"),A=Ext.getCmp("__averageFps"),D=Ext.getCmp("__minFps"),G=Ext.getCmp("__maxFps"),H=1000,C=0,B=0,F=0;Ext.AnimationQueue.onFpsChanged=function(I){B++;if(!(B%10)){H=1000;C=0}F+=I;H=Math.min(H,I);C=Math.max(C,I);E.setHtml(Math.round(I));A.setHtml(Math.round(F/B));D.setHtml(Math.round(H));G.setHtml(Math.round(C))}}},function(){var A=window.location.search.substr(1),B=A.split("&");if(Ext.Array.contains(B,"showfps")){Ext.AnimationQueue.showFps()}});
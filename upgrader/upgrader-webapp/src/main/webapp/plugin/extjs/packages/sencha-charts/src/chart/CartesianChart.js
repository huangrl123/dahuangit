Ext.define("Ext.chart.CartesianChart",{extend:"Ext.chart.AbstractChart",requires:["Ext.chart.grid.HorizontalGrid","Ext.chart.grid.VerticalGrid"],config:{flipXY:false,innerRect:[0,0,1,1],innerPadding:{top:0,left:0,right:0,bottom:0}},xtype:["cartesian","chart"],applyInnerPadding:function(B,A){if(!Ext.isObject(B)){return Ext.util.Format.parseBox(B)}else{if(!A){return B}else{return Ext.apply(A,B)}}},getDirectionForAxis:function(A){var B=this.getFlipXY();if(A==="left"||A==="right"){if(B){return"X"}else{return"Y"}}else{if(B){return"Y"}else{return"X"}}},performLayout:function(){try{this.resizing++;this.callParent();this.suspendThicknessChanged();var I=this,Y=I.getSurface("chart").getRect(),R=Y[2],Z=Y[3],X=I.getAxes(),S,F=I.getSeries(),Q,L,a,C=I.getInsetPadding(),A=I.getInnerPadding(),O,D,H=Ext.apply({},C),W,N,T,K,P,V,B,G,J,E=I.getInherited().rtl,U=I.getFlipXY();if(R<=0||Z<=0){return}for(G=0;G<X.length;G++){S=X[G];L=S.getSurface();P=S.getFloating();V=P?P.value:null;a=S.getThickness();switch(S.getPosition()){case"top":L.setRect([0,H.top+1,R,a]);break;case"bottom":L.setRect([0,Z-(H.bottom+a),R,a]);break;case"left":L.setRect([H.left,0,a,Z]);break;case"right":L.setRect([R-(H.right+a),0,a,Z]);break}if(V===null){H[S.getPosition()]+=a}}R-=H.left+H.right;Z-=H.top+H.bottom;W=[H.left,H.top,R,Z];H.left+=A.left;H.top+=A.top;H.right+=A.right;H.bottom+=A.bottom;N=R-A.left-A.right;T=Z-A.top-A.bottom;I.setInnerRect([H.left,H.top,N,T]);if(N<=0||T<=0){return}I.setMainRect(W);I.getSurface().setRect(W);for(G=0,J=I.surfaceMap.grid&&I.surfaceMap.grid.length;G<J;G++){D=I.surfaceMap.grid[G];D.setRect(W);D.matrix.set(1,0,0,1,A.left,A.top);D.matrix.inverse(D.inverseMatrix)}for(G=0;G<X.length;G++){S=X[G];L=S.getSurface();B=L.matrix;K=B.elements;switch(S.getPosition()){case"top":case"bottom":K[4]=H.left;S.setLength(N);break;case"left":case"right":K[5]=H.top;S.setLength(T);break}S.updateTitleSprite();B.inverse(L.inverseMatrix)}for(G=0,J=F.length;G<J;G++){Q=F[G];O=Q.getSurface();O.setRect(W);if(U){if(E){O.matrix.set(0,-1,-1,0,A.left+N,A.top+T)}else{O.matrix.set(0,-1,1,0,A.left,A.top+T)}}else{O.matrix.set(1,0,0,-1,A.left,A.top+T)}O.matrix.inverse(O.inverseMatrix);Q.getOverlaySurface().setRect(W)}I.redraw();I.onPlaceWatermark(Y[2],Y[3])}catch(M){Ext.log.error(this.$className+": Unhandled Exception: ",M.description||M.message);throw M}finally{this.resizing--;this.resumeThicknessChanged()}},refloatAxes:function(){var M=this,K=M.getAxes(),C,A,E,L,G,J,H,O=M.innerElement.getSize(),B=M.getInsetPadding(),F=O.width-B.left-B.right,D=O.height-B.top-B.bottom,I;for(var N=0;N<K.length;N++){C=K[N];L=C.getFloating();G=L?L.value:null;if(G!==null){A=C.getSurface();E=A.getRect();if(!E){continue}E=E.slice();J=M.getAxis(L.alongAxis);if(J){I=J.getAlignment()==="horizontal";if(Ext.isString(G)){G=J.getCoordFor(G)}J.floatingAxes[C.getId()]=G;H=J.getSprites()[0].attr.matrix;if(I){G=G*H.getXX()+H.getDX()}else{G=G*H.getYY()+H.getDY()}}else{I=C.getAlignment()==="horizontal";G=A.roundPixel(0.01*G*(I?D:F))}switch(C.getPosition()){case"top":E[1]=B.top+G-E[3]+1;break;case"bottom":E[1]=B.top+(J?G:D-G);break;case"left":E[0]=B.left+G-E[2]+1;break;case"right":E[0]=B.left+(J?G:F-G)-1;break}A.setRect(E)}}},redraw:function(){var G=this,Q=G.getSeries(),X=G.getAxes(),L=G.getMainRect(),O,M,A=G.getInnerPadding(),W,I,b,J,E,N,D,T,S,U,B,Z,R=G.getFlipXY(),F,C,K=1000,P,H,V,Y,a;if(!L){return}O=L[2]-A.left-A.right;M=L[3]-A.top-A.bottom;for(N=0;N<Q.length;N++){if((S=Q[N].getXAxis())){Z=S.getVisibleRange();I=S.getRange();I=[I[0]+(I[1]-I[0])*Z[0],I[0]+(I[1]-I[0])*Z[1]]}else{I=Q[N].getXRange()}if((U=Q[N].getYAxis())){Z=U.getVisibleRange();b=U.getRange();b=[b[0]+(b[1]-b[0])*Z[0],b[0]+(b[1]-b[0])*Z[1]]}else{b=Q[N].getYRange()}E={visibleMinX:I[0],visibleMaxX:I[1],visibleMinY:b[0],visibleMaxY:b[1],innerWidth:O,innerHeight:M,flipXY:R};W=Q[N].getSprites();for(D=0;D<W.length;D++){F=W[D];C=(F.attr.zIndex||0);if(C<K){C+=(N+1)*100+K;F.attr.zIndex=C;P=F.boundMarkers;if(P){H=(P.items?P.items.length:0);if(H){for(V=0;V<H;V++){Y=P.items[V];a=(Y.attr.zIndex||0);if(a==Number.MAX_VALUE){Y.attr.zIndex=C}else{if(a<K){Y.attr.zIndex=C+a}}}}}}F.setAttributes(E,true)}}for(N=0;N<X.length;N++){T=X[N];J=T.isSide();W=T.getSprites();B=T.getRange();Z=T.getVisibleRange();E={dataMin:B[0],dataMax:B[1],visibleMin:Z[0],visibleMax:Z[1]};if(J){E.length=M;E.startGap=A.bottom;E.endGap=A.top}else{E.length=O;E.startGap=A.left;E.endGap=A.right}for(D=0;D<W.length;D++){W[D].setAttributes(E,true)}}G.renderFrame();G.callParent(arguments)},renderFrame:function(){this.refloatAxes();this.callParent(arguments)},onPlaceWatermark:function(E,A){var D=this,B=D.watermarkElement,C=B&&(D.getSurface?D.getSurface("main").getRect():D.getItems().get(0).getRect());if(C){B.setStyle({right:Math.round(E-(C[2]+C[0]))+"px",bottom:Math.round(A-(C[3]+C[1]))+"px"})}}});
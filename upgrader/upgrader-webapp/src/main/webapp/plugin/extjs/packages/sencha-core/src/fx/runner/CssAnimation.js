Ext.define("Ext.fx.runner.CssAnimation",{extend:"Ext.fx.runner.Css",constructor:function(){this.runningAnimationsMap={};this.elementEndStates={};this.animationElementMap={};this.keyframesRulesCache={};this.uniqueId=0;return this.callParent(arguments)},attachListeners:function(){var A=this.getEventDispatcher();this.listenersAttached=true;A.addListener("element","*","animationstart","onAnimationStart",this);A.addListener("element","*","animationend","onAnimationEnd",this)},onAnimationStart:function(C){var E=C.browserEvent.animationName,D=this.animationElementMap[E],B=this.runningAnimationsMap[D][E],A=this.elementEndStates,F=A[D],G={};console.log("START============= "+E);if(F){delete A[D];G[D]=F;this.applyStyles(G)}if(B.before){G[D]=B.before;this.applyStyles(G)}},onAnimationEnd:function(A){var B=A.target,C=A.browserEvent.animationName,E=this.animationElementMap,F=E[C],D=this.runningAnimationsMap,G=D[F],H=G[C];console.log("END============= "+C);if(H.onBeforeEnd){H.onBeforeEnd.call(H.scope||this,B)}if(H.onEnd){H.onEnd.call(H.scope||this,B)}delete E[C];delete G[C];this.removeKeyframesRule(C)},generateAnimationId:function(){return"animation-"+(++this.uniqueId)},run:function(L){var P={},K=this.elementEndStates,A=this.animationElementMap,S=this.runningAnimationsMap,F,G,D,I,R,O,M,T,C,B,J,H,N,E,Q;if(!this.listenersAttached){this.attachListeners()}L=Ext.Array.from(L);for(R=0,O=L.length;R<O;R++){M=L[R];M=Ext.factory(M,Ext.fx.Animation);D=M.getElement().getId();I=M.getName()||this.generateAnimationId();A[I]=D;M=M.getData();G=M.states;this.addKeyframesRule(I,G);F=S[D];if(!F){F=S[D]={}}F[I]=M;B=[];J=[];H=[];N=[];E=[];Q=[];for(T in F){if(F.hasOwnProperty(T)){C=F[T];B.push(T);J.push(C.duration);H.push(C.easing);N.push(C.delay);E.push(C.direction);Q.push(C.iteration)}}P[D]={"animation-name":B,"animation-duration":J,"animation-timing-function":H,"animation-delay":N,"animation-direction":E,"animation-iteration-count":Q};if(M.preserveEndState){K[D]=G["100%"]}}this.applyStyles(P)},addKeyframesRule:function(B,H){var G,J,A,C,F,D,K,I,E;C=this.getStyleSheet();F=C.cssRules;K=F.length;C.insertRule("@"+this.vendorPrefix+"keyframes "+B+"{}",K);A=F[K];for(G in H){J=H[G];F=A.cssRules;K=F.length;D=[];for(I in J){E=this.formatValue(J[I],I);I=this.formatName(I);D.push(I+":"+E)}A.insertRule(G+"{"+D.join(";")+"}",K)}return this},removeKeyframesRule:function(E){var C=this.getStyleSheet(),D=C.cssRules,B,F,A;for(B=0,F=D.length;B<F;B++){A=D[B];if(A.name===E){C.removeRule(B);break}}return this}});
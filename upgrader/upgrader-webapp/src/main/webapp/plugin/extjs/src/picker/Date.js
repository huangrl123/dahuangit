Ext.define("Ext.picker.Date",{extend:"Ext.Component",requires:["Ext.XTemplate","Ext.button.Button","Ext.button.Split","Ext.util.ClickRepeater","Ext.util.KeyNav","Ext.fx.Manager","Ext.picker.Month"],alias:"widget.datepicker",alternateClassName:"Ext.DatePicker",childEls:["innerEl","eventEl","prevEl","nextEl","middleBtnEl","footerEl"],border:true,renderTpl:['<div id="{id}-innerEl" data-ref="innerEl" role="grid">','<div role="presentation" class="{baseCls}-header">','<a id="{id}-prevEl" data-ref="prevEl" class="{baseCls}-prev {baseCls}-arrow" role="button" title="{prevText}" hidefocus="on" ></a>','<div id="{id}-middleBtnEl" data-ref="middleBtnEl" class="{baseCls}-month">{%this.renderMonthBtn(values, out)%}</div>','<a id="{id}-nextEl" data-ref="nextEl" class="{baseCls}-next {baseCls}-arrow" role="button" title="{nextText}" hidefocus="on" ></a>',"</div>",'<table id="{id}-eventEl" data-ref="eventEl" class="{baseCls}-inner" cellspacing="0" role="grid">','<thead role="presentation"><tr role="row">','<tpl for="dayNames">','<th role="columnheader" class="{parent.baseCls}-column-header" title="{.}">','<div class="{parent.baseCls}-column-header-inner">{.:this.firstInitial}</div>',"</th>","</tpl>","</tr></thead>",'<tbody role="presentation"><tr role="row">','<tpl for="days">',"{#:this.isEndOfWeek}",'<td role="gridcell" id="{[Ext.id()]}">','<a href="#" role="button" hidefocus="on" class="{parent.baseCls}-date"></a>',"</td>","</tpl>","</tr></tbody>","</table>",'<tpl if="showToday">','<div id="{id}-footerEl" data-ref="footerEl" role="presentation" class="{baseCls}-footer">{%this.renderTodayBtn(values, out)%}</div>',"</tpl>","</div>",{firstInitial:function(A){return Ext.picker.Date.prototype.getDayInitial(A)},isEndOfWeek:function(B){B--;var A=B%7===0&&B!==0;return A?'</tr><tr role="row">':""},renderTodayBtn:function(B,A){Ext.DomHelper.generateMarkup(B.$comp.todayBtn.getRenderTree(),A)},renderMonthBtn:function(B,A){Ext.DomHelper.generateMarkup(B.$comp.monthBtn.getRenderTree(),A)}}],todayText:"Today",ariaTitle:"Date Picker: {0}",ariaTitleDateFormat:"F d, Y",todayTip:"{0} (Spacebar)",minText:"This date is before the minimum date",maxText:"This date is after the maximum date",disabledDaysText:"Disabled",disabledDatesText:"Disabled",nextText:"Next Month (Control+Right)",prevText:"Previous Month (Control+Left)",monthYearText:"Choose a month (Control+Up/Down to move years)",monthYearFormat:"F Y",startDay:0,showToday:true,disableAnim:false,baseCls:Ext.baseCSSPrefix+"datepicker",longDayFormat:"F d, Y",focusOnShow:false,focusOnSelect:true,initHour:12,numDays:42,initComponent:function(){var A=this,B=Ext.Date.clearTime;A.selectedCls=A.baseCls+"-selected";A.disabledCellCls=A.baseCls+"-disabled";A.prevCls=A.baseCls+"-prevday";A.activeCls=A.baseCls+"-active";A.cellCls=A.baseCls+"-cell";A.nextCls=A.baseCls+"-prevday";A.todayCls=A.baseCls+"-today";if(!A.format){A.format=Ext.Date.defaultFormat}if(!A.dayNames){A.dayNames=Ext.Date.dayNames}A.dayNames=A.dayNames.slice(A.startDay).concat(A.dayNames.slice(0,A.startDay));A.callParent();A.value=A.value?B(A.value,true):B(new Date());A.initDisabledDays()},getRefOwner:function(){return this.pickerField||this.callParent()},getRefItems:function(){var A=[];if(this.rendered){A.push(this.monthBtn,this.todayBtn)}return A},beforeRender:function(){var C=this,B=new Array(C.numDays),A=Ext.Date.format(new Date(),C.format);if(C.padding&&!C.width){C.cacheWidth()}C.monthBtn=new Ext.button.Split({ownerCt:C,ownerLayout:C.getComponentLayout(),text:"",tooltip:C.monthYearText,listeners:{click:C.doShowMonthPicker,arrowclick:C.doShowMonthPicker,scope:C}});if(C.showToday){C.todayBtn=new Ext.button.Button({ownerCt:C,ownerLayout:C.getComponentLayout(),text:Ext.String.format(C.todayText,A),tooltip:Ext.String.format(C.todayTip,A),tooltipType:"title",handler:C.selectToday,scope:C})}C.callParent();Ext.applyIf(C,{renderData:{}});Ext.apply(C.renderData,{dayNames:C.dayNames,showToday:C.showToday,prevText:C.prevText,nextText:C.nextText,days:B});C.protoEl.unselectable()},cacheWidth:function(){var C=this,B=C.parseBox(C.padding),A=Ext.getBody().createChild({cls:C.baseCls+" "+C.borderBoxCls,style:"position:absolute;top:-1000px;left:-1000px;"});C.self.prototype.width=A.getWidth()+B.left+B.right;A.destroy()},onRender:function(C,A){var B=this;B.callParent(arguments);B.cells=B.eventEl.select("tbody td");B.textNodes=B.eventEl.query("tbody td a");B.mon(B.eventEl,{scope:B,mousewheel:B.handleMouseWheel,click:{fn:B.handleDateClick,delegate:"a."+B.baseCls+"-date"}})},initEvents:function(){var B=this,C=Ext.Date,A=C.DAY;B.callParent();B.prevRepeater=new Ext.util.ClickRepeater(B.prevEl,{handler:B.showPrevMonth,scope:B,preventDefault:true,stopDefault:true});B.nextRepeater=new Ext.util.ClickRepeater(B.nextEl,{handler:B.showNextMonth,scope:B,preventDefault:true,stopDefault:true});B.keyNav=new Ext.util.KeyNav(B.eventEl,Ext.apply({scope:B,left:function(D){if(D.ctrlKey){B.showPrevMonth()}else{B.update(C.add(B.activeDate,A,-1))}},right:function(D){if(D.ctrlKey){B.showNextMonth()}else{B.update(C.add(B.activeDate,A,1))}},up:function(D){if(D.ctrlKey){B.showNextYear()}else{B.update(C.add(B.activeDate,A,-7))}},down:function(D){if(D.ctrlKey){B.showPrevYear()}else{B.update(C.add(B.activeDate,A,7))}},pageUp:function(D){if(D.altKey){B.showPrevYear()}else{B.showPrevMonth()}},pageDown:function(D){if(D.altKey){B.showNextYear()}else{B.showNextMonth()}},tab:function(D){B.doCancelFieldFocus=true;B.handleTabClick(D);delete B.doCancelFieldFocus;return true},enter:function(D){D.stopPropagation();return true},home:function(D){B.update(C.getFirstDateOfMonth(B.activeDate))},end:function(D){B.update(C.getLastDateOfMonth(B.activeDate))}},B.keyNavConfig));if(B.showToday){B.todayKeyListener=B.eventEl.addKeyListener(Ext.event.Event.prototype.SPACE,B.selectToday,B)}B.update(B.value)},handleTabClick:function(A){var C=this,D=C.getSelectedDate(C.activeDate),B=C.handler;if(!C.disabled&&D.dateValue&&!Ext.fly(D.parentNode).hasCls(C.disabledCellCls)){if(C.pickerField){A.stopEvent()}C.doCancelFocus=true;C.setValue(new Date(D.dateValue));delete C.doCancelFocus;C.fireEvent("select",C,C.value);if(B){B.call(C.scope||C,C,C.value)}C.onSelect()}},getSelectedDate:function(I){var F=this,B=I.getTime(),H=F.cells,C=F.selectedCls,E=H.elements,G,A=E.length,D;H.removeCls(C);for(G=0;G<A;G++){D=Ext.fly(E[G]);if(D.dom.firstChild.dateValue==B){return D.dom.firstChild}}return null},initDisabledDays:function(){var E=this,G=E.disabledDates,A="(?:",F,C,D,B;if(!E.disabledDatesRE&&G){F=G.length-1;D=G.length;for(C=0;C<D;C++){B=G[C];A+=Ext.isDate(B)?"^"+Ext.String.escapeRegex(Ext.Date.dateFormat(B,E.format))+"$":B;if(C!=F){A+="|"}}E.disabledDatesRE=new RegExp(A+")")}},setDisabledDates:function(B){var A=this;if(Ext.isArray(B)){A.disabledDates=B;A.disabledDatesRE=null}else{A.disabledDatesRE=B}A.initDisabledDays();A.update(A.value,true);return A},setDisabledDays:function(A){this.disabledDays=A;return this.update(this.value,true)},setMinDate:function(A){this.minDate=A;return this.update(this.value,true)},setMaxDate:function(A){this.maxDate=A;return this.update(this.value,true)},setValue:function(A){this.value=Ext.Date.clearTime(A||new Date(),true);return this.update(this.value)},getValue:function(){return this.value},getDayInitial:function(A){return A.substr(0,1)},focus:function(){this.update(this.activeDate)},onEnable:function(){this.callParent();this.setDisabledStatus(false);this.update(this.activeDate)},onDisable:function(){this.callParent();this.setDisabledStatus(true)},setDisabledStatus:function(B){var A=this;A.keyNav.setDisabled(B);A.prevRepeater.setDisabled(B);A.nextRepeater.setDisabled(B);if(A.showToday){A.todayKeyListener.setDisabled(B);A.todayBtn.setDisabled(B)}},getActive:function(){return this.activeDate||this.value},runAnimation:function(A){var C=this.monthPicker,B={duration:200,callback:function(){C.setVisible(!A)}},D=C.isVisible();if(A){C.el.slideOut("t",B)}else{C.el.slideIn("t",B)}},hideMonthPicker:function(A){var B=this,C=B.monthPicker;if(C&&C.isVisible()){if(B.shouldAnimate(A)){B.runAnimation(true)}else{C.hide()}}return B},doShowMonthPicker:function(){this.showMonthPicker()},doHideMonthPicker:function(){this.hideMonthPicker()},showMonthPicker:function(B){var C=this,A=C.el,D;if(C.rendered&&!C.disabled){D=C.createMonthPicker();if(!D.isVisible()){D.setValue(C.getActive());D.setSize(A.getSize());D.setPosition(-A.getBorderWidth("l"),-A.getBorderWidth("t"));if(C.shouldAnimate(B)){C.runAnimation(false)}else{D.show()}}}return C},shouldAnimate:function(A){return Ext.isDefined(A)?A:!this.disableAnim},createMonthPicker:function(){var A=this,B=A.monthPicker;if(!B){A.monthPicker=B=new Ext.picker.Month({renderTo:A.el,floating:true,padding:A.padding,shadow:false,small:A.showToday===false,listeners:{scope:A,cancelclick:A.onCancelClick,okclick:A.onOkClick,yeardblclick:A.onOkClick,monthdblclick:A.onOkClick}});if(!A.disableAnim){B.el.setStyle("display","none")}B.hide();A.on("beforehide",A.doHideMonthPicker,A)}return B},onOkClick:function(D,E){var C=this,A=E[0],B=E[1],F=new Date(B,A,C.getActive().getDate());if(F.getMonth()!==A){F=Ext.Date.getLastDateOfMonth(new Date(B,A,1))}C.setValue(F);C.hideMonthPicker()},onCancelClick:function(){this.selectedUpdate(this.activeDate);this.hideMonthPicker()},showPrevMonth:function(A){return this.setValue(Ext.Date.add(this.activeDate,Ext.Date.MONTH,-1))},showNextMonth:function(A){return this.setValue(Ext.Date.add(this.activeDate,Ext.Date.MONTH,1))},showPrevYear:function(){return this.setValue(Ext.Date.add(this.activeDate,Ext.Date.YEAR,-1))},showNextYear:function(){return this.setValue(Ext.Date.add(this.activeDate,Ext.Date.YEAR,1))},handleMouseWheel:function(B){B.stopEvent();if(!this.disabled){var A=B.getWheelDelta();if(A>0){this.showPrevMonth()}else{if(A<0){this.showNextMonth()}}}},handleDateClick:function(A,D){var C=this,B=C.handler;A.stopEvent();if(!C.disabled&&D.dateValue&&!Ext.fly(D.parentNode).hasCls(C.disabledCellCls)){C.doCancelFocus=C.focusOnSelect===false;C.setValue(new Date(D.dateValue));delete C.doCancelFocus;C.fireEvent("select",C,C.value);if(B){B.call(C.scope||C,C,C.value)}C.onSelect()}},onSelect:function(){if(this.hideOnSelect){this.hide()}},selectToday:function(){var B=this,C=B.todayBtn,A=B.handler;if(C&&!C.disabled){B.setValue(Ext.Date.clearTime(new Date()));B.fireEvent("select",B,B.value);if(A){A.call(B.scope||B,B,B.value)}B.onSelect()}return B},selectedUpdate:function(I){var F=this,B=I.getTime(),H=F.cells,C=F.selectedCls,E=H.elements,G,A=E.length,D;H.removeCls(C);for(G=0;G<A;G++){D=Ext.fly(E[G]);if(D.dom.firstChild.dateValue==B){F.fireEvent("highlightitem",F,D);D.addCls(C);if(F.isVisible()&&!F.doCancelFocus){Ext.fly(D.dom.firstChild).focus(50)}break}}},fullUpdate:function(C){var I=this,a=I.cells.elements,R=I.textNodes,Q=I.disabledCellCls,A=Ext.Date,G=0,e=0,M=I.isVisible(),V=+A.clearTime(C,true),b=+A.clearTime(new Date()),U=I.minDate?A.clearTime(I.minDate,true):Number.NEGATIVE_INFINITY,c=I.maxDate?A.clearTime(I.maxDate,true):Number.POSITIVE_INFINITY,S=I.disabledDatesRE,Z=I.disabledDatesText,N=I.disabledDays?I.disabledDays.join(""):false,H=I.disabledDaysText,L=I.format,B=A.getDaysInMonth(C),W=A.getFirstDateOfMonth(C),O=W.getDay()-I.startDay,E=A.add(C,A.MONTH,-1),Y=I.longDayFormat,J,K,d,F,T,P,X,f,D;if(O<0){O+=7}B+=O;J=A.getDaysInMonth(E)-O;K=new Date(E.getFullYear(),E.getMonth(),J,I.initHour);if(I.showToday){F=A.clearTime(new Date());d=(F<U||F>c||(S&&L&&S.test(A.dateFormat(F,L)))||(N&&N.indexOf(F.getDay())!=-1));if(!I.disabled){I.todayBtn.setDisabled(d);I.todayKeyListener.setDisabled(d)}}T=function(h,g){D=+A.clearTime(K,true);h.title=A.format(K,Y);h.firstChild.dateValue=D;if(D==b){g+=" "+I.todayCls;h.title=I.todayText;I.todayElSpan=Ext.DomHelper.append(h.firstChild,{tag:"span",cls:Ext.baseCSSPrefix+"hidden-clip",html:I.todayText},true)}if(D==V){g+=" "+I.selectedCls;I.fireEvent("highlightitem",I,h);if(M&&I.floating){Ext.fly(h.firstChild).focus(50)}}if(D<U){g+=" "+Q;h.title=I.minText}else{if(D>c){g+=" "+Q;h.title=I.maxText}else{if(N&&N.indexOf(K.getDay())!==-1){h.title=H;g+=" "+Q}else{if(S&&L){f=A.dateFormat(K,L);if(S.test(f)){h.title=Z.replace("%0",f);g+=" "+Q}}}}}h.className=g+" "+I.cellCls};for(;G<I.numDays;++G){if(G<O){P=(++J);X=I.prevCls}else{if(G>=B){P=(++e);X=I.nextCls}else{P=G-O+1;X=I.activeCls}}R[G].innerHTML=P;K.setDate(K.getDate()+1);T(a[G],X)}I.monthBtn.setText(Ext.Date.format(C,I.monthYearFormat))},update:function(D,C){var B=this,A=B.activeDate;if(B.rendered){B.activeDate=D;if(!C&&A&&B.el&&A.getMonth()==D.getMonth()&&A.getFullYear()==D.getFullYear()){B.selectedUpdate(D,A)}else{B.fullUpdate(D,A)}}return B},beforeDestroy:function(){var A=this;if(A.rendered){Ext.destroy(A.todayKeyListener,A.keyNav,A.monthPicker,A.monthBtn,A.nextRepeater,A.prevRepeater,A.todayBtn);delete A.textNodes;delete A.cells.elements}A.callParent()},onShow:function(){this.callParent(arguments);if(this.focusOnShow){this.focus()}},privates:{finishRenderChildren:function(){var A=this;A.callParent();A.monthBtn.finishRender();if(A.showToday){A.todayBtn.finishRender()}}}});
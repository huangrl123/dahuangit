Ext.define("Ext.util.Floating",{mixinId:"floating",uses:["Ext.Layer","Ext.ZIndexManager"],focusOnToFront:true,shadow:"sides",constrain:false,constructor:function(A){var B=this;B.el=new Ext.dom.Layer(Ext.apply({preventSync:true,hideMode:B.hideMode,shadow:(typeof B.shadow!="undefined")?B.shadow:"sides",shadowOffset:B.shadowOffset,constrain:false,fixed:B.fixed,shim:(B.shim===false)?false:undefined},B.floating),A);if(B.modal&&!(Ext.enableFocusManager)){B.mon(B.el,{keydown:B.onKeyDown,scope:B})}B.mon(B.el,{mousedown:B.onMouseDown,scope:B,capture:true});B.floating=true;B.registerWithOwnerCt();B.initHierarchyEvents()},initHierarchyEvents:function(){var A=this,B=this.syncHidden;if(!A.hasHierarchyEventListeners){A.mon(Ext.GlobalEvents,{hide:B,collapse:B,show:B,expand:B,added:B,scope:A});A.hasHierarchyEventListeners=true}},registerWithOwnerCt:function(){var B=this,C=B.ownerCt,A=B.zIndexParent;if(A){A.unregisterFloatingItem(B)}A=B.zIndexParent=B.up("[floating]");B.setFloatParent(C||A);delete B.ownerCt;if(A){A.registerFloatingItem(B)}else{Ext.WindowManager.register(B)}},onKeyDown:function(A){var C=this,B,F,D,E;if(A.getKey()===A.TAB){B=A.shiftKey;F=C.query(":focusable");if(F.length){D=F[0];E=F[F.length-1];if(!B&&E.hasFocus){A.stopEvent();D.focus()}else{if(B&&D.hasFocus){A.stopEvent();E.focus()}}}}},onMouseDown:function(B){var C=this,F=C.focusTask,D=false,E,A;if(C.floating&&(!F||!F.id)){E=B.target;A=C.el.dom;while(E&&E!==A){if(Ext.fly(E).isFocusable()){D=true;break}E=E.parentNode}C.toFront(D)}},setFloatParent:function(B){var A=this;A.floatParent=B;if((A.constrain||A.constrainHeader)&&!A.constrainTo){A.constrainTo=B?B.getTargetEl():A.container}},syncShadow:function(){if(this.floating){this.el.sync(true)}},onBeforeFloatLayout:function(){this.el.preventSync=true},onAfterFloatLayout:function(){delete this.el.preventSync;this.syncShadow()},syncHidden:function(){var A=this,D=A.hidden||!A.rendered,B=A.hierarchicallyHidden=A.isHierarchicallyHidden(),C=A.pendingShow;if(D!==B){if(B){A.hide();A.pendingShow=true}else{if(C){delete A.pendingShow;if(C.length){A.show.apply(A,C)}else{A.show()}}}}},setZIndex:function(B){var A=this;A.el.setZIndex(B);B+=10;if(A.floatingDescendants){B=Math.floor(A.floatingDescendants.setBase(B)/100)*100+10000}return B},doConstrain:function(C){var B=this,A=B.calculateConstrainedPosition(C,null,true);if(A){B.setPosition(A)}},toFront:function(B){var A=this,C=A.zIndexParent,D=A.preventFocusOnActivate;if(C&&A.bringParentToFront!==false){C.toFront(true)}if(!Ext.isDefined(B)){B=!A.focusOnToFront}if(B){A.preventFocusOnActivate=true}if(A.zIndexManager.bringToFront(A,B)){if(!B){A.focus(false,true)}if(A.hasListeners.tofront){A.fireEvent("tofront",A,A.el.getZIndex())}}A.preventFocusOnActivate=D;return A},setActive:function(A,C){var B=this;if(A){if(B.el.shadow&&!B.maximized){B.el.enableShadow(true)}if(!B.preventFocusOnActivate){B.focus(false,true)}B.fireEvent("activate",B)}else{if(B.isWindow&&(C&&C.isWindow)&&B.hideShadowOnDeactivate){B.el.disableShadow()}B.fireEvent("deactivate",B)}},toBack:function(){this.zIndexManager.sendToBack(this);return this},center:function(){var B=this,A;if(B.isVisible()){A=B.getAlignToXY(B.container,"c-c");B.setPagePosition(A)}else{B.needsCenter=true}return B},onFloatShow:function(){if(this.needsCenter){this.center()}delete this.needsCenter;if(this.toFrontOnShow){this.toFront()}},fitContainer:function(B){var C=this,D=C.floatParent,E=D?D.getTargetEl():C.container,A=E.getViewSize(),F=D||(E.dom!==document.body)?[0,0]:E.getXY();A.x=F[0];A.y=F[1];C.setBox(A,B)}});
Ext.define("Ext.selection.RowModel",{extend:"Ext.selection.Model",alias:"selection.rowmodel",requires:["Ext.util.KeyNav"],deltaScroll:5,enableKeyNav:true,ignoreRightMouseSelection:false,isRowModel:true,constructor:function(){this.views=[];this.callParent(arguments)},bindComponent:function(B){var A=this;B.on({rowcontextmenu:A.onRowClick,rowclick:A.onRowClick,scope:A});if(A.enableKeyNav){A.initKeyNav(B)}},initKeyNav:function(B){var A=this;if(!B.rendered){B.on("render",Ext.Function.bind(A.initKeyNav,A,[B],0),A,{single:true});return}B.el.set({tabIndex:-1});A.keyNav=new Ext.util.KeyNav({target:B,ignoreInputFields:true,eventName:"itemkeydown",processEvent:function(D,G,C,F,E){E.record=G;E.recordIndex=F;return E},up:A.onKeyUp,down:A.onKeyDown,right:A.onKeyRight,left:A.onKeyLeft,pageDown:A.onKeyPageDown,pageUp:A.onKeyPageUp,home:A.onKeyHome,end:A.onKeyEnd,space:A.onKeySpace,enter:A.onKeyEnter,A:{ctrl:true,handler:A.selectAll},scope:A})},onUpdate:function(B){var A=this,D=A.view,C;if(D&&A.isSelected(B)){C=D.indexOf(B);D.onRowSelect(C);if(B===A.lastFocused){D.onRowFocus(C,true)}}},getRowsVisible:function(){var D=false,C=this.views[0],B=C.all.first(),E,A;if(B){E=B.getHeight();A=C.el.getHeight();D=Math.floor(A/E)}return D},onKeyEnd:function(A){var B=this,C=B.views[0];if(C.bufferedRenderer){C.bufferedRenderer.scrollTo(B.store.getCount()-1,false,function(D,E){B.afterKeyNavigate(A,E)})}else{B.afterKeyNavigate(A,C.walkRecs(A.record,C.dataSource.getCount()-1-C.dataSource.indexOf(A.record)))}},onKeyHome:function(A){var B=this,C=B.views[0];if(C.bufferedRenderer){C.bufferedRenderer.scrollTo(0,false,function(D,E){B.afterKeyNavigate(A,E)})}else{B.afterKeyNavigate(A,C.walkRecs(A.record,-C.dataSource.indexOf(A.record)))}},onKeyPageUp:function(B){var C=this,F=C.views[0],D=C.getRowsVisible(),A,E;if(D){if(F.bufferedRenderer){A=Math.max(B.recordIndex-D,0);C.lastKeyEvent=B;F.bufferedRenderer.scrollTo(A,false,C.afterBufferedScrollTo,C)}else{E=F.walkRecs(B.record,-D);C.afterKeyNavigate(B,E)}}},onKeyPageDown:function(B){var C=this,F=C.views[0],D=C.getRowsVisible(),A,E;if(D){if(F.bufferedRenderer){A=Math.min(B.recordIndex+D,C.store.getCount()-1);C.lastKeyEvent=B;F.bufferedRenderer.scrollTo(A,false,C.afterBufferedScrollTo,C)}else{E=F.walkRecs(B.record,D);C.afterKeyNavigate(B,E)}}},onKeySpace:function(A){var B=A.record||this.lastFocused;if(B){this.afterKeyNavigate(A,B)}},onKeyEnter:Ext.emptyFn,onKeyUp:function(A){var B=this.views[0].walkRecs(A.record,-1);if(B){this.afterKeyNavigate(A,B)}},onKeyDown:function(A){var B=A.record.isExpandingOrCollapsing?null:this.views[0].walkRecs(A.record,1);if(B){this.afterKeyNavigate(A,B)}},afterBufferedScrollTo:function(A,B){this.afterKeyNavigate(this.lastKeyEvent,B)},scrollByDeltaX:function(A){var C=this.views[0],D=C.up(),B=D.horizontalScroller;if(B){B.scrollByDeltaX(A)}},onKeyLeft:function(A){this.scrollByDeltaX(-this.deltaScroll)},onKeyRight:function(A){this.scrollByDeltaX(this.deltaScroll)},onRowClick:function(D,F,C,E,B){var A=this;if(E!==-1){if(!A.allowRightMouseSelection(B)){return}if(!(B.type==="contextmenu"&&this.isSelected(F))){A.processSelection(D,F,C,E,B)}}},processSelection:function(C,E,B,D,A){this.selectWithEvent(E,A)},allowRightMouseSelection:function(A){var B=this.ignoreRightMouseSelection&&A.button!==0;if(B){B=this.hasSelection()}return !B},onSelectChange:function(I,H,B,J){var G=this,A=G.views,D=A.length,C=A[0].indexOf(I),K=H?"select":"deselect",E,F;if((B||G.fireEvent("before"+K,G,I,C))!==false&&J()!==false){for(E=0;E<D;E++){F=A[E];if(H){F.onRowSelect(C,B)}else{F.onRowDeselect(C,B)}G.publishSelection(H?I:null)}if(!B){G.fireEvent(K,G,I,C)}}},publishSelection:function(C){var B=this,A=B.selectionMode==="SINGLE",E=B.views[0].ownerGrid,D;if(B.setupPublish||(A&&E.reference)){if(!B.setupPublish){B.setupPublish=true;D=E.getPublishes()||{};D.selection=1;E.setPublishes(D)}B.lastPublish=C;E.publishState("selection",C)}},onPrune:function(A){var B=this;if(B.lastPublish===A){B.publishSelection(null)}},onLastFocusChanged:function(C,B,D){var G=this.views,E=G.length,F,A=0;if(C){F=G[0].indexOf(C);if(F!==-1){for(;A<E;A++){G[A].onRowFocus(F,false,true)}}}if(B){F=G[0].indexOf(B);if(F!==-1){for(A=0;A<E;A++){G[A].onRowFocus(F,true,D)}}}this.callParent(arguments)},onEditorTab:function(F,C){var G=this,A=F.context.view,H=F.getActiveRecord(),I=F.getActiveColumn(),E=A.getPosition(H,I),B=C.shiftKey?"left":"right",D;do{D=E;E=A.walkCells(E,B,C,G.preventWrap);if(D&&D.isEqual(E)){return}}while(E&&(!E.columnHeader.getEditor(H)||!F.startEditByPosition(E)))},getCurrentPosition:function(){var A=this.selected.getAt(0);if(A){return new Ext.grid.CellContext(this.view).setPosition(this.store.indexOf(A),0)}},selectByPosition:function(B,C){var A=new Ext.grid.CellContext(this.view);A.setPosition(B.row,B.column);this.select(A.record,C)},selectNext:function(H,D){var G=this,A=G.store,E=G.getSelection(),F=E[E.length-1],C=G.views[0].indexOf(F)+1,B;if(C===A.getCount()||C===0){B=false}else{G.doSelect(C,H,D);B=true}return B},selectPrevious:function(E,B){var C=this,F=C.getSelection(),A=F[0],G=C.views[0].indexOf(A)-1,D;if(G<0){D=false}else{C.doSelect(G,E,B);D=true}return D},isRowSelected:function(A){return this.isSelected(A)},isCellSelected:function(A,B,C){return this.isSelected(B)}});
Ext.define("Ext.grid.column.Column",{extend:"Ext.grid.header.Container",xtype:"gridcolumn",requires:["Ext.util.KeyNav","Ext.grid.ColumnComponentLayout","Ext.grid.ColumnLayout","Ext.app.bind.Template"],alternateClassName:"Ext.grid.Column",config:{triggerVisible:false},baseCls:Ext.baseCSSPrefix+"column-header",hoverCls:Ext.baseCSSPrefix+"column-header-over",handleWidth:Ext.supports.Touch?10:4,ariaRole:"columnheader",sortState:null,possibleSortStates:["ASC","DESC"],childEls:["titleEl","triggerEl","textEl"],headerWrap:false,renderTpl:['<div id="{id}-titleEl" data-ref="titleEl" role="presentation" {tipMarkup}class="',Ext.baseCSSPrefix,"column-header-inner",'<tpl if="empty"> ',Ext.baseCSSPrefix,'column-header-inner-empty</tpl>">','<span id="{id}-textEl" data-ref="textEl" class="',Ext.baseCSSPrefix,"column-header-text",'{childElCls}">',"{text}","</span>",'<tpl if="!menuDisabled">','<div id="{id}-triggerEl" data-ref="triggerEl" role="presentation" class="',Ext.baseCSSPrefix,"column-header-trigger",'{childElCls}" style="{triggerStyle}"></div>',"</tpl>","</div>","{%this.renderContainer(out,values)%}"],dataIndex:null,text:"&#160;",menuText:null,emptyCellText:"&#160;",sortable:true,resizable:true,hideable:true,menuDisabled:false,renderer:false,align:"left",draggable:true,tooltipType:"qtip",initDraggable:Ext.emptyFn,tdCls:"",isHeader:true,isColumn:true,producesHTML:true,ascSortCls:Ext.baseCSSPrefix+"column-header-sort-ASC",descSortCls:Ext.baseCSSPrefix+"column-header-sort-DESC",componentLayout:"columncomponent",groupSubHeaderCls:Ext.baseCSSPrefix+"group-sub-header",groupHeaderCls:Ext.baseCSSPrefix+"group-header",clickTargetName:"titleEl",detachOnRemove:true,initResizable:Ext.emptyFn,rendererNames:{column:"renderer",edit:"editRenderer",summary:"summaryRenderer"},formatterNames:{column:"formatter",edit:"editFormatter",summary:"summaryFormatter"},initComponent:function(){var A=this;if(A.header!=null){A.text=A.header;A.header=null}if(A.cellWrap){A.tdCls=(A.tdCls||"")+" "+Ext.baseCSSPrefix+"wrap-cell"}if(A.columns!=null){A.isGroupHeader=true;if(A.dataIndex){Ext.Error.raise("Ext.grid.column.Column: Group header may not accept a dataIndex")}if((A.width&&A.width!==Ext.grid.header.Container.prototype.defaultWidth)||A.flex){Ext.Error.raise("Ext.grid.column.Column: Group header does not support setting explicit widths or flexs. The group header width is calculated by the sum of its children.")}A.items=A.columns;A.columns=A.flex=A.width=null;A.cls=(A.cls||"")+" "+A.groupHeaderCls;A.sortable=A.resizable=false;A.align="center"}else{if(A.flex){A.minWidth=A.minWidth||Ext.grid.plugin.HeaderResizer.prototype.minColWidth}}A.addCls(Ext.baseCSSPrefix+"column-header-align-"+A.align);A.setupRenderer();A.setupRenderer("edit");A.setupRenderer("summary");A.callParent(arguments)},bindFormatter:function(A){var B=this;return function(C){return A.format(C,A.scope||B.scope||B.resolveListenerScope())}},bindRenderer:function(B){var A=this;if(B in Ext.util.Format){Ext.log.warn('Use "formatter" config instead of "renderer" to use Ext.util.Format to format cell values')}A.hasCustomRenderer=true;return function(){return Ext.callback(B,A.scope,arguments,0,A)}},setupRenderer:function(A){A=A||"column";var D=this,B=D[D.formatterNames[A]],E=D[D.rendererNames[A]],C=A==="column",F;if(!B){if(E){if(typeof E==="string"){E=D[D.rendererNames[A]]=D.bindRenderer(E)}if(C){D.hasCustomRenderer=E.length>1}}else{if(C&&D.defaultRenderer){D.renderer=D.defaultRenderer;D.usingDefaultRenderer=true}}}else{F=B.indexOf("this.")===0;if(F){B=B.substring(5)}B=Ext.app.bind.Template.prototype.parseFormat(B);D[D.formatterNames[A]]=null;if(F){B.scope=null}else{if(!Ext.util.Format[B.fmt]){Ext.Error.raise('Invalid formatter specified: "'+B.fmt+'"')}}D[D.rendererNames[A]]=D.bindFormatter(B)}},getView:function(){var A=this.getOwnerHeaderCt();if(A){return A.view}},onResize:function(E,I,C,B){var A=this,H,F,D,G;A.callParent(arguments);if(C&&A.cellWrap){H=A.getView();if(H){F=H.store;D=H.bufferedRenderer;if(D){delete D.rowHeight;D.stretchView(H,D.getScrollHeight(true));D.viewSize=Math.ceil(H.getHeight()/D.rowHeight)+D.trailingBufferZone+D.leadingBufferZone;if(F.isBufferedStore){F.setViewSize(D.viewSize)}G=Math.min((F.isBufferedStore?F.getTotalCount():F.getCount())-D.viewSize,Math.max(0,Math.floor(D.bodyTop/D.rowHeight)));D.renderRange(G,G+D.viewSize-1);if(E>C&&D.bodyTop+H.body.dom.offsetHeight-1>D.scrollHeight){D.setBodyTop(Math.max(0,D.scrollHeight-H.body.dom.offsetHeight))}}}}},initItems:function(){var A=this;A.callParent(arguments);if(A.isGroupHeader){if(!A.hasVisibleChildColumns()){A.hide()}}},hasVisibleChildColumns:function(){var D=this.items.items,C=D.length,A,B;for(A=0;A<C;++A){B=D[A];if(B.isColumn&&!B.hidden){return true}}return false},onAdd:function(A){var B=this;if(A.isColumn){A.isSubHeader=true;A.addCls(this.groupSubHeaderCls)}if(B.hidden&&A.isColumn){if(B.constructing){A.hide()}else{if(!A.hidden){B.show()}}}B.callParent(arguments)},onRemove:function(A){var B=this;if(A.isSubHeader){A.isSubHeader=false;A.removeCls(B.groupSubHeaderCls)}B.callParent(arguments);if(!(B.isDestroyed||B.destroying)&&B.isGroupHeader&&!B.hasVisibleChildColumns()){B.hide()}},initRenderData:function(){var C=this,B="",A=C.tooltip,D=C.text,E=C.tooltipType=="qtip"?"data-qtip":"title";if(!Ext.isEmpty(A)){B=E+'="'+A+'" '}return Ext.applyIf(C.callParent(arguments),{text:D,empty:D==="&#160;"||D===" "||D==="",menuDisabled:C.menuDisabled,tipMarkup:B,triggerStyle:this.getTriggerVisible()?"display:block":""})},applyColumnState:function(B){var A=this;A.applyColumnsState(B.columns);if(B.hidden!=null){A.hidden=B.hidden}if(B.locked!=null){A.locked=B.locked}if(B.sortable!=null){A.sortable=B.sortable}if(B.width!=null){A.flex=null;A.width=B.width}else{if(B.flex!=null){A.width=null;A.flex=B.flex}}},getColumnState:function(){var D=this,E=D.items.items,A=E?E.length:0,B,F=[],C={id:D.getStateId()};D.savePropsToState(["hidden","sortable","locked","flex","width"],C);if(D.isGroupHeader){for(B=0;B<A;B++){F.push(E[B].getColumnState())}if(F.length){C.columns=F}}else{if(D.isSubHeader&&D.ownerCt.hidden){delete D.hidden}}if("width" in C){delete C.flex}return C},getStateId:function(){return this.stateId||this.headerId},setText:function(A){this.text=A;if(this.rendered){this.textEl.setHtml(A)}},getIndex:function(){return this.isGroupColumn?false:this.getOwnerHeaderCt().getHeaderIndex(this)},getVisibleIndex:function(){return this.visibleIndex!=null?this.visibleIndex:this.isGroupColumn?false:Ext.Array.indexOf(this.getOwnerHeaderCt().getVisibleGridColumns(),this)},beforeRender:function(){var A=this,B=A.up("tablepanel");A.callParent();if(B){if((!A.sortable||B.sortableColumns===false)&&!A.groupable&&!A.lockable&&(B.enableColumnHide===false||!A.getOwnerHeaderCt().getHideableColumns().length)){A.menuDisabled=true}}if(A.cellWrap){A.variableRowHeight=true}A.protoEl.unselectable()},afterRender:function(){var B=this,A=B.triggerEl;B.callParent(arguments);if(A&&B.self.triggerElWidth===undefined){A.setStyle("display","block");B.self.triggerElWidth=A.getWidth();A.setStyle("display","")}},afterComponentLayout:function(E,A,C,B){var D=this,F=D.getOwnerHeaderCt();D.callParent(arguments);if(F&&(C!=null||D.flex)&&E!==C){F.onHeaderResize(D,E)}},onDestroy:function(){var A=this;Ext.destroy(A.keyNav,A.field);A.field=A.keyNav=null;A.callParent(arguments)},onTitleMouseOver:function(){this.titleEl.addCls(this.hoverCls)},onTitleMouseOut:function(){this.titleEl.removeCls(this.hoverCls)},onDownKey:function(A){if(this.triggerEl){this.onTitleElClick(A,this.triggerEl.dom||this.el.dom)}},onEnterKey:function(A){this.onTitleElClick(A,this.el.dom)},onTitleElDblClick:function(A,D){var B=this,F,C,E;if(B.isOnLeftEdge(A)){F=B.previousNode("gridcolumn:not([hidden]):not([isGroupHeader])");if(F&&F.getOwnerHeaderCt()===B.getOwnerHeaderCt()){F.autoSize()}}else{if(B.isOnRightEdge(A)){if(B.isGroupHeader&&A.getPoint().isContainedBy(B.layout.innerCt)){C=B.query("gridcolumn:not([hidden]):not([isGroupHeader])");B.getOwnerHeaderCt().autoSizeColumn(C[C.length-1]);return}else{E=B.getOwnerHeaderCt();if(E.visibleColumnManager.getColumns().length===1&&E.forceFit){return}}B.autoSize()}}},autoSize:function(){var B=this,D,E,A,C;if(B.isGroupHeader){D=B.query("gridcolumn:not([hidden]):not([isGroupHeader])");E=D.length;C=this.getOwnerHeaderCt();Ext.suspendLayouts();for(A=0;A<E;A++){C.autoSizeColumn(D[A])}Ext.resumeLayouts(true);return}this.getOwnerHeaderCt().autoSizeColumn(this)},onTitleElClick:function(A,D){var C=this,E,B;if(Ext.supports.Touch){B=C.previousSibling(":not([hidden])");if(!C.menuDisabled&&C.isOnRightEdge(A,parseInt(C.triggerEl.getStyle("width")))){if(!C.menuDisabled){E=C}}else{if(B&&!B.menuDisabled&&C.isOnLeftEdge(A)){E=B}}}else{E=C.triggerEl&&(A.target===C.triggerEl.dom||D===C.triggerEl.dom||A.within(C.triggerEl))?C:null}if(!E&&!C.isOnLeftEdge(A)&&!C.isOnRightEdge(A)||A.getKey()){C.toggleSortState()}return E},processEvent:function(A,D,E,C,F,B){return this.fireEvent.apply(this,arguments)},toggleSortState:function(){var A=this,B,C;if(A.sortable){B=Ext.Array.indexOf(A.possibleSortStates,A.sortState);C=(B+1)%A.possibleSortStates.length;A.sort()}},sort:function(C){var B=this,D=B.up("tablepanel"),A=D.store;Ext.suspendLayouts();B.sorting=true;A.sort(B.getSortParam(),C,D.multiColumnSort?"multi":"replace");delete B.sorting;Ext.resumeLayouts(true)},getSortParam:function(){return this.dataIndex},setSortState:function(A){var C=this,E=A&&A.getDirection(),F=C.ascSortCls,D=C.descSortCls,B=C.getOwnerHeaderCt();switch(E){case"DESC":C.addCls(D);C.removeCls(F);break;case"ASC":C.addCls(F);C.removeCls(D);break;default:C.removeCls([F,D])}if(E){B.fireEvent("sortchange",B,C,E)}},isHideable:function(){var A={hideCandidate:this,result:this.hideable};if(A.result){this.ownerCt.bubble(this.hasOtherMenuEnabledChildren,null,[A])}return A.result},hasOtherMenuEnabledChildren:function(C){var A,B;if(!this.isXType("headercontainer")){C.result=false;return false}A=this.query(">:not([hidden]):not([menuDisabled])");B=A.length;if(Ext.Array.contains(A,C.hideCandidate)){B--}if(B){return false}C.hideCandidate=this},isLockable:function(){var A={result:this.lockable!==false};if(A.result){this.ownerCt.bubble(this.hasMultipleVisibleChildren,null,[A])}return A.result},isLocked:function(){return this.locked||!!this.up("[isColumn][locked]","[isRootHeader]")},hasMultipleVisibleChildren:function(A){if(!this.isXType("headercontainer")){A.result=false;return false}if(this.query(">:not([hidden])").length>1){return false}},hide:function(B){var D=this,H=D.getOwnerHeaderCt(),A=D.getRefOwner(),F,I,G,E,C;if(A.constructing){D.callParent();return D}if(D.rendered&&!D.isVisible()){return D}if(H.forceFit){D.visibleSiblingCount=H.getVisibleGridColumns().length-1;if(D.flex){D.savedWidth=D.getWidth();D.flex=null}}F=A.isGroupHeader;if(F&&!B){G=A.query(">:not([hidden])");if(G.length===1&&G[0]===D){D.ownerCt.hide();return}}Ext.suspendLayouts();if(D.isGroupHeader){G=D.items.items;for(C=0,E=G.length;C<E;C++){I=G[C];if(!I.hidden){I.hide(true)}}}D.callParent();H.onHeaderHide(D);Ext.resumeLayouts(true);return D},show:function(A,D){var E=this,H=E.getOwnerHeaderCt(),G=E.ownerCt,B,F,C,I;if(E.isVisible()){return E}if(E.rendered){if(H.forceFit){H.applyForceFit(E)}}Ext.suspendLayouts();if(E.isSubHeader&&G.hidden){G.show(false,true)}E.callParent(arguments);if(E.isGroupHeader&&D!==true&&!E.query(":not([hidden])").length){B=E.items.items;for(C=0,F=B.length;C<F;C++){I=B[C];if(I.hidden){I.show(true)}}}G=E.getOwnerHeaderCt();if(G){G.onHeaderShow(E)}Ext.resumeLayouts(true);return E},getCellWidth:function(){var B=this,A;if(B.rendered&&B.componentLayout&&B.componentLayout.lastComponentSize){A=B.componentLayout.lastComponentSize.width}else{if(B.width){A=B.width}else{if(!B.isColumn){A=B.getTableWidth()}}}return A},getCellId:function(){return Ext.baseCSSPrefix+"grid-cell-"+this.getItemId()},getCellSelector:function(){return"."+this.getCellId()},getCellInnerSelector:function(){return this.getCellSelector()+" ."+Ext.baseCSSPrefix+"grid-cell-inner"},isOnLeftEdge:function(A){return(A.getXY()[0]-this.getX()<this.handleWidth)},isOnRightEdge:function(B,A){return(this.getX()+this.getWidth()-B.getXY()[0]<=(A||this.handleWidth))},setMenuActive:function(A){this.titleEl[A?"addCls":"removeCls"](this.headerOpenCls)},deprecated:{5:{methods:{bindRenderer:function(A){return function(B){return Ext.util.Format[A](B)}}}}}});
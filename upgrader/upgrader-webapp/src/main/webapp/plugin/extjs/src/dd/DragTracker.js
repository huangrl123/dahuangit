Ext.define("Ext.dd.DragTracker",{uses:["Ext.util.Region"],mixins:{observable:"Ext.util.Observable"},active:false,trackOver:false,tolerance:5,autoStart:false,constructor:function(A){var B=this;Ext.apply(B,A);B.dragRegion=new Ext.util.Region(0,0,0,0);if(B.el){B.initEl(B.el)}B.mixins.observable.constructor.call(B);if(B.disabled){B.disable()}},initEl:function(A){var B=this,A=B.el=Ext.get(A),C=B.delegate;if(C){B.handle=C.isElement?C:A.selectNode(C,false)}B.delegate=B.handle?undefined:B.delegate;if(!B.handle){B.handle=A}B.handleListeners={scope:B,delegate:B.delegate,mousedown:B.onMouseDown,dragstart:B.onDragStart};if(!Ext.supports.TouchEvents&&(B.trackOver||B.overCls)){Ext.apply(B.handleListeners,{mouseover:B.onMouseOver,mouseout:B.onMouseOut})}B.mon(B.handle,B.handleListeners)},disable:function(){this.disabled=true},enable:function(){this.disabled=false},destroy:function(){var A=this;A.endDrag({});A.clearListeners();A.el=A.handle=null},onMouseOver:function(B,G){var A=this,C,D,E,H,F;if(!A.disabled){if(B.within(B.target,true,true)||A.delegate){C=A.handleCls;A.mouseIsOut=false;if(C){for(E=0,H=A.handleEls.length;E<H;E++){D=A.handleEls[E];F=D.delegateCls;if(!F){F=D.delegateCls=[C,"-",D.region,"-over"].join("")}D.addCls([F,A.overCls])}}A.fireEvent("mouseover",A,B,A.delegate?B.getTarget(A.delegate,G):A.handle)}}},onMouseOut:function(C){var D=this,A,B,E;if(D.mouseIsDown){D.mouseIsOut=true}else{if(D.handleCls){for(B=0,E=D.handleEls.length;B<E;B++){A=D.handleEls[B];A.removeCls([A.delegateCls,D.overCls])}}D.fireEvent("mouseout",D,C)}},onMouseDown:function(A,C){var B=this;if(B.disabled||A.dragTracked){return}B.dragTarget=B.delegate?C:B.handle.dom;B.startXY=B.lastXY=A.getXY();B.startRegion=Ext.fly(B.dragTarget).getRegion();if(B.fireEvent("mousedown",B,A)===false||B.fireEvent("beforedragstart",B,A)===false||B.onBeforeStart(A)===false){return}B.mouseIsDown=true;A.dragTracked=true;B.el.setCapture();A.stopPropagation();if(B.preventDefault!==false){A.preventDefault()}Ext.getDoc().on({scope:B,capture:true,mouseup:B.onMouseUp,mousemove:B.onMouseMove,selectstart:B.stopSelect});B.dragEnded=false;if(!B.tolerance){B.triggerStart()}else{if(B.autoStart){B.timer=Ext.defer(B.triggerStart,B.autoStart===true?1000:B.autoStart,B,[A])}}},onMouseMove:function(B,E){var D=this,A=B.getXY(),C=D.startXY;B.stopPropagation();if(D.preventDefault!==false){B.preventDefault()}if(D.dragEnded){return}D.lastXY=A;if(!D.active){if(Math.max(Math.abs(C[0]-A[0]),Math.abs(C[1]-A[1]))>D.tolerance){D.triggerStart(B)}else{return}}if(D.fireEvent("mousemove",D,B)===false){D.onMouseUp(B)}else{D.onDrag(B);D.fireEvent("drag",D,B)}},onMouseUp:function(A){var B=this;B.mouseIsDown=false;if(B.mouseIsOut){B.mouseIsOut=false;B.onMouseOut(A)}if(B.preventDefault!==false){A.preventDefault()}if(Ext.isIE&&document.releaseCapture){document.releaseCapture()}B.fireEvent("mouseup",B,A);B.endDrag(A)},endDrag:function(A){var B=this,C=B.active;Ext.getDoc().un({mousemove:B.onMouseMove,mouseup:B.onMouseUp,selectstart:B.stopSelect,capture:true,scope:B});B.clearStart();B.active=false;if(C){B.dragEnded=true;B.onEnd(A);B.fireEvent("dragend",B,A)}B._constrainRegion=null},triggerStart:function(A){var B=this;B.clearStart();B.active=true;B.onStart(A);B.fireEvent("dragstart",B,A)},clearStart:function(){var A=this.timer;if(A){clearTimeout(A);this.timer=null}},stopSelect:function(A){A.stopEvent();return false},onBeforeStart:function(A){},onStart:function(A){},onDrag:function(A){},onEnd:function(A){},getDragTarget:function(){return this.dragTarget},getDragCt:function(){return this.el},getConstrainRegion:function(){var A=this;if(A.constrainTo){if(A.constrainTo instanceof Ext.util.Region){return A.constrainTo}if(!A._constrainRegion){A._constrainRegion=Ext.fly(A.constrainTo).getViewRegion()}}else{if(!A._constrainRegion){A._constrainRegion=A.getDragCt().getViewRegion()}}return A._constrainRegion},getXY:function(A){return A?this.constrainModes[A](this,this.lastXY):this.lastXY},getOffset:function(C){var A=this.getXY(C),B=this.startXY;return[A[0]-B[0],A[1]-B[1]]},onDragStart:function(A){A.stopPropagation()},constrainModes:{point:function(B,A){var C=B.dragRegion,D=B.getConstrainRegion();if(!D){return A}C.x=C.left=C[0]=C.right=A[0];C.y=C.top=C[1]=C.bottom=A[1];C.constrainTo(D);return[C.left,C.top]},dragTarget:function(D,A){var C=D.startXY,E=D.startRegion.copy(),F=D.getConstrainRegion(),B;if(!F){return A}E.translateBy(A[0]-C[0],A[1]-C[1]);if(E.right>F.right){A[0]+=B=(F.right-E.right);E.left+=B}if(E.left<F.left){A[0]+=(F.left-E.left)}if(E.bottom>F.bottom){A[1]+=B=(F.bottom-E.bottom);E.top+=B}if(E.top<F.top){A[1]+=(F.top-E.top)}return A}}});
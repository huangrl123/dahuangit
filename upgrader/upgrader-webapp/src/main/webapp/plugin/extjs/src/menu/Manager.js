Ext.define("Ext.menu.Manager",{singleton:true,requires:["Ext.util.MixedCollection","Ext.util.KeyMap"],alternateClassName:"Ext.menu.MenuMgr",uses:["Ext.menu.Menu"],menuSelector:"."+Ext.baseCSSPrefix+"menu",menus:{},groups:{},attached:false,lastShow:new Date(),init:function(){var A=this;A.active=new Ext.util.MixedCollection();Ext.getDoc().addKeyListener(27,function(){if(A.active.length>0){A.hideAll()}},A)},hideAll:function(){var B=this.active,A,D,C;if(B&&B.length>0){A=Ext.Array.slice(B.items);C=A.length;for(D=0;D<C;D++){A[D].hide()}return true}return false},onHide:function(C){var A=this,B=A.active;B.remove(C);if(B.length<1){Ext.un("mousedown",A.onMouseDown,A);A.attached=false}},onShow:function(D){var A=this,B=A.active,C=A.attached;A.lastShow=new Date();B.add(D);if(!C){Ext.on("mousedown",A.onMouseDown,A,{buffer:Ext.isIE9m?10:undefined});A.attached=true}D.toFront()},onBeforeHide:function(A){if(A.activeChild){A.activeChild.hide()}if(A.autoHideTimer){clearTimeout(A.autoHideTimer);delete A.autoHideTimer}},onBeforeShow:function(B){var A=this.active,C=B.parentMenu;A.remove(B);if(!C&&!B.allowOtherMenus){this.hideAll()}else{if(C&&C.activeChild&&B!=C.activeChild){C.activeChild.hide()}}},onMouseDown:function(C){var E=this,D=E.active,F=D.length,A=E.lastShow,B;if(Ext.Date.getElapsed(A)>50&&F){if(Ext.isIE9m&&!Ext.getDoc().contains(C.target)){return}else{for(B=0;B<F;B++){if(D.items[B].owns(C.target)){return}}}E.hideAll()}},register:function(B){var A=this;if(!A.active){A.init()}if(B.floating){A.menus[B.id]=B;B.on({beforehide:A.onBeforeHide,hide:A.onHide,beforeshow:A.onBeforeShow,show:A.onShow,scope:A})}},get:function(B){var A=this.menus;if(typeof B=="string"){if(!A){return null}return A[B]}else{if(B.isMenu){return B}else{if(Ext.isArray(B)){return new Ext.menu.Menu({items:B})}else{return Ext.ComponentManager.create(B,"menu")}}}},unregister:function(D){var C=this,A=C.menus,B=C.active;delete A[D.id];B.remove(D);D.un({beforehide:C.onBeforeHide,hide:C.onHide,beforeshow:C.onBeforeShow,show:C.onShow,scope:C})},registerCheckable:function(C){var A=this.groups,B=C.group;if(B){if(!A[B]){A[B]=[]}A[B].push(C)}},unregisterCheckable:function(C){var A=this.groups,B=C.group;if(B){Ext.Array.remove(A[B],C)}},onCheckChange:function(G,C){var E=this.groups,A=G.group,F=0,D,B,H;if(A&&C){D=E[A];B=D.length;for(;F<B;F++){H=D[F];if(H!=G){H.setChecked(false)}}}}});
Ext.define("Ext.toolbar.Paging",{extend:"Ext.toolbar.Toolbar",xtype:"pagingtoolbar",alternateClassName:"Ext.PagingToolbar",requires:["Ext.toolbar.TextItem","Ext.form.field.Number"],mixins:["Ext.util.StoreHolder"],displayInfo:false,prependButtons:false,displayMsg:"Displaying {0} - {1} of {2}",emptyMsg:"没有可显示的数据",beforePageText:"第",afterPageText:"共 {0}",firstText:"首页",prevText:"上一页",nextText:"下一页",lastText:"末页",refreshText:"刷新",inputItemWidth:30,getPagingItems:function(){var A=this,B={scope:A,blur:A.onPagingBlur};B[Ext.supports.SpecialKeyDownRepeat?"keydown":"keypress"]=A.onPagingKeyDown;return[{itemId:"first",tooltip:A.firstText,overflowText:A.firstText,iconCls:Ext.baseCSSPrefix+"tbar-page-first",disabled:true,handler:A.moveFirst,scope:A},{itemId:"prev",tooltip:A.prevText,overflowText:A.prevText,iconCls:Ext.baseCSSPrefix+"tbar-page-prev",disabled:true,handler:A.movePrevious,scope:A},"-",A.beforePageText,{xtype:"numberfield",itemId:"inputItem",name:"inputItem",cls:Ext.baseCSSPrefix+"tbar-page-number",allowDecimals:false,minValue:1,hideTrigger:true,enableKeyEvents:true,keyNavEnabled:false,selectOnFocus:true,submitValue:false,isFormField:false,width:A.inputItemWidth,margin:"-1 2 3 2",listeners:B},{xtype:"tbtext",itemId:"afterTextItem",text:Ext.String.format(A.afterPageText,1)},"-",{itemId:"next",tooltip:A.nextText,overflowText:A.nextText,iconCls:Ext.baseCSSPrefix+"tbar-page-next",disabled:true,handler:A.moveNext,scope:A},{itemId:"last",tooltip:A.lastText,overflowText:A.lastText,iconCls:Ext.baseCSSPrefix+"tbar-page-last",disabled:true,handler:A.moveLast,scope:A},"-",{itemId:"refresh",tooltip:A.refreshText,overflowText:A.refreshText,iconCls:Ext.baseCSSPrefix+"tbar-loading",disabled:A.store.isLoading(),handler:A.doRefresh,scope:A}]},initComponent:function(){var B=this,C=B.items||B.buttons||[],A;B.bindStore(B.store||"ext-empty-store",true);A=B.getPagingItems();if(B.prependButtons){B.items=C.concat(A)}else{B.items=A.concat(C)}delete B.buttons;if(B.displayInfo){B.items.push("->");B.items.push({xtype:"tbtext",itemId:"displayItem"})}B.callParent()},beforeRender:function(){var A=this;A.callParent(arguments);if(!A.store.isLoading()){A.calledFromRender=true;A.onLoad();delete A.calledFromRender}},updateInfo:function(){var E=this,D=E.child("#displayItem"),B=E.store,C=E.getPageData(),A,F;if(D){A=B.getCount();if(A===0){F=E.emptyMsg}else{F=Ext.String.format(E.displayMsg,C.fromRecord,C.toRecord,C.total)}D.setText(F)}},onLoad:function(){var F=this,B,C,E,G,A,D,H;A=F.store.getCount();D=A===0;if(!D){B=F.getPageData();C=B.currentPage;E=B.pageCount;if(C>E){F.store.loadPage(E);return}G=Ext.String.format(F.afterPageText,isNaN(E)?1:E)}else{C=0;E=0;G=Ext.String.format(F.afterPageText,0)}Ext.suspendLayouts();H=F.child("#afterTextItem");if(H){H.setText(G)}H=F.getInputItem();if(H){H.setDisabled(D).setValue(C)}F.setChildDisabled("#first",C===1||D);F.setChildDisabled("#prev",C===1||D);F.setChildDisabled("#next",C===E||D);F.setChildDisabled("#last",C===E||D);F.setChildDisabled("#refresh",false);F.updateInfo();Ext.resumeLayouts(true);if(!F.calledFromRender){F.fireEvent("change",F,B)}},setChildDisabled:function(B,C){var A=this.child(B);if(A){A.setDisabled(C)}},getPageData:function(){var A=this.store,B=A.getTotalCount();return{total:B,currentPage:A.currentPage,pageCount:Math.ceil(B/A.pageSize),fromRecord:((A.currentPage-1)*A.pageSize)+1,toRecord:Math.min(A.currentPage*A.pageSize,B)}},onLoadError:function(){this.setChildDisabled("#refresh",false)},getInputItem:function(){return this.child("#inputItem")},readPageFromInput:function(C){var A=this.getInputItem(),B=false,D;if(A){D=A.getValue();B=parseInt(D,10);if(!D||isNaN(B)){A.setValue(C.currentPage);return false}}return B},onPagingBlur:function(B){var A=this.getInputItem(),C;if(A){C=this.getPageData().currentPage;A.setValue(C)}},onPagingKeyDown:function(B,A){this.processKeyEvent(B,A)},processKeyEvent:function(F,B){var E=this,G=B.getKey(),C=E.getPageData(),D=B.shiftKey?10:1,A;if(G==B.RETURN){B.stopEvent();A=E.readPageFromInput(C);if(A!==false){A=Math.min(Math.max(1,A),C.pageCount);if(A!==C.currentPage&&E.fireEvent("beforechange",E,A)!==false){E.store.loadPage(A)}}}else{if(G==B.HOME||G==B.END){B.stopEvent();A=G==B.HOME?1:C.pageCount;F.setValue(A)}else{if(G==B.UP||G==B.PAGE_UP||G==B.DOWN||G==B.PAGE_DOWN){B.stopEvent();A=E.readPageFromInput(C);if(A){if(G==B.DOWN||G==B.PAGE_DOWN){D*=-1}A+=D;if(A>=1&&A<=C.pageCount){F.setValue(A)}}}}}},beforeLoad:function(){this.setChildDisabled("#refresh",true)},moveFirst:function(){if(this.fireEvent("beforechange",this,1)!==false){this.store.loadPage(1);return true}return false},movePrevious:function(){var B=this,A=B.store,C=A.currentPage-1;if(C>0){if(B.fireEvent("beforechange",B,C)!==false){A.previousPage();return true}}return false},moveNext:function(){var D=this,A=D.store,B=D.getPageData().pageCount,C=A.currentPage+1;if(C<=B){if(D.fireEvent("beforechange",D,C)!==false){A.nextPage();return true}}return false},moveLast:function(){var A=this,B=A.getPageData().pageCount;if(A.fireEvent("beforechange",A,B)!==false){A.store.loadPage(B);return true}return false},doRefresh:function(){var B=this,A=B.store,C=A.currentPage;if(B.fireEvent("beforechange",B,C)!==false){A.loadPage(C);return true}return false},getStoreListeners:function(){return{beforeload:this.beforeLoad,load:this.onLoad,exception:this.onLoadError}},onDestroy:function(){this.bindStore(null);this.callParent()}});
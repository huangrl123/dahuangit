Ext.define("Ext.view.Table",{extend:"Ext.view.View",alias:"widget.tableview",requires:["Ext.grid.CellContext","Ext.view.TableLayout","Ext.view.NodeCache","Ext.util.DelayedTask","Ext.util.MixedCollection"],inheritableStatics:{events:["blur","focus","move","resize","destroy","beforedestroy","boxready","afterrender","render","beforerender","removed","hide","beforehide","show","beforeshow","enable","disable","added","deactivate","beforedeactivate","activate","beforeactivate","cellkeydown","beforecellkeydown","cellmouseup","beforecellmouseup","cellmousedown","beforecellmousedown","cellcontextmenu","beforecellcontextmenu","celldblclick","beforecelldblclick","cellclick","beforecellclick","refresh","itemremove","itemadd","itemupdate","viewready","beforerefresh","unhighlightitem","highlightitem","focuschange","deselect","select","beforedeselect","beforeselect","selectionchange","containerkeydown","containercontextmenu","containerdblclick","containerclick","containermouseout","containermouseover","containermouseup","containermousedown","beforecontainerkeydown","beforecontainercontextmenu","beforecontainerdblclick","beforecontainerclick","beforecontainermouseout","beforecontainermouseover","beforecontainermouseup","beforecontainermousedown","itemkeydown","itemcontextmenu","itemdblclick","itemclick","itemmouseleave","itemmouseenter","itemmouseup","itemmousedown","beforeitemkeydown","beforeitemcontextmenu","beforeitemdblclick","beforeitemclick","beforeitemmouseleave","beforeitemmouseenter","beforeitemmouseup","beforeitemmousedown","statesave","beforestatesave","staterestore","beforestaterestore","uievent","groupcollapse","groupexpand"]},componentLayout:"tableview",baseCls:Ext.baseCSSPrefix+"grid-view",unselectableCls:Ext.baseCSSPrefix+"unselectable",firstCls:Ext.baseCSSPrefix+"grid-cell-first",lastCls:Ext.baseCSSPrefix+"grid-cell-last",selectedItemCls:Ext.baseCSSPrefix+"grid-item-selected",selectedCellCls:Ext.baseCSSPrefix+"grid-cell-selected",focusedItemCls:Ext.baseCSSPrefix+"grid-item-focused",overItemCls:Ext.baseCSSPrefix+"grid-item-over",altRowCls:Ext.baseCSSPrefix+"grid-item-alt",dirtyCls:Ext.baseCSSPrefix+"grid-dirty-cell",rowClsRe:new RegExp("(?:^|\\s*)"+Ext.baseCSSPrefix+"grid-row-(first|last|alt)(?:\\s+|$)","g"),cellRe:new RegExp(Ext.baseCSSPrefix+"grid-cell-([^\\s]+)(?:\\s|$)",""),positionBody:true,positionCells:false,stripeOnUpdate:null,trackOver:true,getRowClass:null,stripeRows:true,markDirty:true,ariaRole:"grid",tpl:["{%","view = values.view;","if (!(columns = values.columns)) {","columns = values.columns = view.ownerCt.getVisibleColumnManager().getColumns();","}","values.fullWidth = 0;","for (i = 0, len = columns.length; i < len; i++) {","column = columns[i];","values.fullWidth += (column.cellWidth = column.lastBox ? column.lastBox.width : column.width || column.minWidth);","}","tableCls=values.tableCls=[];","%}",'<div class="'+Ext.baseCSSPrefix+'grid-item-container" style="width:{fullWidth}px">',"{[view.renderTHead(values, out, parent)]}","{%","view.renderRows(values.rows, values.columns, values.viewStartIndex, out);","%}","{[view.renderTFoot(values, out, parent)]}","</div>",{definitions:"var view, tableCls, columns, i, len, column;",priority:0}],outerRowTpl:['<table id="{rowId}" ','data-boundView="{view.id}" ','data-recordId="{record.internalId}" ','data-recordIndex="{recordIndex}" ','class="{[values.itemClasses.join(" ")]}" cellPadding="0" cellSpacing="0" {ariaTableAttr} style="width:0;{itemStyle}">',"{%","this.nextTpl.applyOut(values, out, parent)","%}","</table>",{priority:9999}],rowTpl:["{%",'var dataRowCls = values.recordIndex === -1 ? "" : " '+Ext.baseCSSPrefix+'grid-row";',"%}",'<tr class="{[values.rowClasses.join(" ")]} {[dataRowCls]}" {rowAttr:attributes} tabIndex="-1" {ariaRowAttr}>','<tpl for="columns">{%',"parent.view.renderCell(values, parent.record, parent.recordIndex, parent.rowIndex, xindex - 1, out, parent)","%}","</tpl>","</tr>",{priority:0}],cellTpl:['<td class="{tdCls}" {tdAttr} {[Ext.aria ? "id=\\"" + Ext.id() + "\\"" : ""]} style="width:{column.cellWidth}px;<tpl if="tdStyle">{tdStyle}</tpl>" {ariaCellAttr}>','<div {unselectableAttr} class="'+Ext.baseCSSPrefix+'grid-cell-inner {innerCls}" ','style="text-align:{align};<tpl if="style">{style}</tpl>" {ariaCellInnerAttr}>{value}</div>',"</td>",{priority:0}],refreshSelmodelOnRefresh:false,tableValues:{},rowValues:{itemClasses:[],rowClasses:[]},cellValues:{classes:[Ext.baseCSSPrefix+"grid-cell "+Ext.baseCSSPrefix+"grid-td"]},renderBuffer:document.createElement("div"),constructor:function(A){if(A.grid.isTree){A.baseCls=Ext.baseCSSPrefix+"tree-view"}this.callParent([A])},hasVariableRowHeight:function(){return this.variableRowHeight||this.store.isGrouped()||this.getVisibleColumnManager().hasVariableRowHeight()},initComponent:function(){var A=this,B=A.scroll;if(A.columnLines){A.addCls(A.grid.colLinesCls)}if(A.rowLines){A.addCls(A.grid.rowLinesCls)}A.body=new Ext.dom.Fly();A.body.id=A.id+"gridBody";A.autoScroll=undefined;if(!A.trackOver){A.overItemCls=null}if(B===true||B==="both"){A.autoScroll=true}else{if(B==="horizontal"){A.overflowX="auto"}else{if(B==="vertical"){A.overflowY="auto"}}}A.selModel.view=A.headerCt.view=A;A.grid.view=A;A.initFeatures(A.grid);A.itemSelector=A.getItemSelector();A.all=new Ext.view.NodeCache(A);A.callParent()},getVisibleColumnManager:function(){var B=this.ownerCt,A=B.ownerLockable;return A?A.getVisibleColumnManager():B.getVisibleColumnManager()},beforeLayout:function(){var A=this,B=!A.firstRefreshDone&&A.headerCt.layout.running;A.callParent(arguments);if(B&&A.body.dom){A.headerCt.layout.injectViewContext(A.headerCt.layout.ownerContext,A)}},moveColumn:function(A,P,R){var H=this,B=R>1,D=B&&document.createRange?document.createRange():null,J=B&&!D?document.createDocumentFragment():null,K=P,M=H.getGridColumns().length,F=M-1,I=(H.firstCls||H.lastCls)&&(P===0||P===M||A===0||A===F),G,E,Q,C,O,N,L;if(H.rendered&&P!==A){Q=H.el.query(H.rowSelector);if(P>A&&J){K-=1}for(G=0,C=Q.length;G<C;G++){O=Q[G];N=O.childNodes;if(I){if(N.length===1){Ext.fly(N[0]).addCls(H.firstCls);Ext.fly(N[0]).addCls(H.lastCls);continue}if(A===0){Ext.fly(N[0]).removeCls(H.firstCls);Ext.fly(N[1]).addCls(H.firstCls)}else{if(A===F){Ext.fly(N[F]).removeCls(H.lastCls);Ext.fly(N[F-1]).addCls(H.lastCls)}}if(P===0){Ext.fly(N[0]).removeCls(H.firstCls);Ext.fly(N[A]).addCls(H.firstCls)}else{if(P===M){Ext.fly(N[F]).removeCls(H.lastCls);Ext.fly(N[A]).addCls(H.lastCls)}}}if(B){if(D){D.setStartBefore(N[A]);D.setEndAfter(N[A+R-1]);J=D.extractContents()}else{for(E=0;E<R;E++){J.appendChild(N[A])}}O.insertBefore(J,N[K]||null)}else{O.insertBefore(N[A],N[K]||null)}}L=H.el.query("colgroup");for(G=0,C=L.length;G<C;G++){O=L[G];if(B){if(D){D.setStartBefore(O.childNodes[A]);D.setEndAfter(O.childNodes[A+R-1]);J=D.extractContents()}else{for(E=0;E<R;E++){J.appendChild(O.childNodes[A])}}O.insertBefore(J,O.childNodes[K]||null)}else{O.insertBefore(O.childNodes[A],O.childNodes[K]||null)}}}},scrollToTop:Ext.emptyFn,addElListener:function(B,A,C){this.mon(this,B,A,C,{element:"el"})},getGridColumns:function(){return this.ownerCt.getVisibleColumnManager().getColumns()},getHeaderAtIndex:function(A){return this.ownerCt.getVisibleColumnManager().getHeaderAtIndex(A)},getCell:function(B,C){var A=this.getRow(B);return Ext.fly(A).down(C.getCellSelector())},getFeature:function(B){var A=this.featuresMC;if(A){return A.get(B)}},findFeature:function(A){if(this.features){return Ext.Array.findBy(this.features,function(B){if(B.ftype===A){return true}})}},initFeatures:function(F){var C=this,B,A,E,D;C.tpl=Ext.XTemplate.getTpl(this,"tpl");C.rowTpl=Ext.XTemplate.getTpl(this,"rowTpl");C.addRowTpl(Ext.XTemplate.getTpl(this,"outerRowTpl"));C.cellTpl=Ext.XTemplate.getTpl(this,"cellTpl");C.featuresMC=new Ext.util.MixedCollection();A=C.features=C.constructFeatures();D=A?A.length:0;for(B=0;B<D;B++){E=A[B];E.view=C;E.grid=F;C.featuresMC.add(E);E.init(F)}},renderTHead:function(E,C,F){var A=E.view.headerFns,D,B;if(A){for(B=0,D=A.length;B<D;++B){A[B].call(this,E,C,F)}}},addHeaderFn:function(B){var A=this.headerFns;if(!A){A=this.headerFns=[]}A.push(B)},renderTFoot:function(E,C,F){var A=E.view.footerFns,D,B;if(A){for(B=0,D=A.length;B<D;++B){A[B].call(this,E,C,F)}}},addFooterFn:function(B){var A=this.footerFns;if(!A){A=this.footerFns=[]}A.push(B)},addTpl:function(A){return this.insertTpl("tpl",A)},addRowTpl:function(A){return this.insertTpl("rowTpl",A)},addCellTpl:function(A){return this.insertTpl("cellTpl",A)},insertTpl:function(E,D){var C=this,B,A;if(D.isTemplate){D=Ext.Object.chain(D)}else{D=new Ext.XTemplate("{%this.nextTpl.applyOut(values, out, parent);%}",D)}for(B=C[E];D.priority<B.priority;B=B.nextTpl){A=B}if(A){A.nextTpl=D}else{C[E]=D}D.nextTpl=B;return D},tplApplyOut:function(B,A,C){if(this.before){if(this.before(B,A,C)===false){return}}this.nextTpl.applyOut(B,A,C);if(this.after){this.after(B,A,C)}},constructFeatures:function(){var E=this,A=E.features,B,D,C=0,F;if(A){D=[];F=A.length;for(;C<F;C++){B=A[C];if(!B.isFeature){B=Ext.create("feature."+B.ftype,B)}D[C]=B}}return D},beforeRender:function(){var A=this;A.callParent();if(!A.enableTextSelection){A.protoEl.unselectable()}},onViewScroll:function(A,B){if(!this.ignoreScroll){this.callParent(arguments);this.fireEvent("bodyscroll",A,B)}},createRowElement:function(E,F,D){var A=this,C=A.renderBuffer,B=A.collectData([E],F);B.columns=D;A.tpl.overwrite(C,B);return Ext.fly(C).down(A.getNodeContainerSelector(),true).firstChild},bufferRender:function(A,D){var C=this,B=C.renderBuffer;C.tpl.overwrite(B,C.collectData(A,D));return Ext.Array.toArray(Ext.fly(B).down(C.getNodeContainerSelector(),true).childNodes)},collectData:function(B,C){var A=this;A.rowValues.view=A;A.tableValues.view=A;A.tableValues.rows=B;A.tableValues.columns=null;A.tableValues.viewStartIndex=C;A.tableValues.touchScroll=A.touchScroll;A.tableValues.tableStyle="width:"+A.headerCt.getTableWidth()+"px";return A.tableValues},collectNodes:function(A){this.all.fill(this.getNodeContainer().childNodes,this.all.startIndex)},refreshSize:function(A){var B=this,C=B.getBodySelector();if(C){B.body.attach(B.el.down(C,true))}if(!B.hasLoadingHeight){Ext.suspendLayouts();B.callParent(arguments);if(A||(B.hasVariableRowHeight()&&B.dataSource.getCount())){B.grid.updateLayout()}Ext.resumeLayouts(true)}},clearViewEl:function(C){var F=this,B=F.all,A=F.getStore(),E,H,D,G;for(E=B.startIndex;E<=B.endIndex;E++){H=B.item(E,true);F.fireEvent("itemremove",A.getByInternalId(H.getAttribute("data-recordId")),E,H,F)}F.clearEmptyEl();F.all.clear(true);D=Ext.fly(F.getNodeContainer());if(D&&!C){G=F.getTargetEl();if(G.dom!==D.dom){D.destroy()}}},getMaskTarget:function(){var A=this.ownerCt;if(A.ownerLockable){A=A.ownerLockable}return A.getMaskTarget()},statics:{getBoundView:function(A){return Ext.getCmp(A.getAttribute("data-boundView"))}},getRecord:function(A){var B=this,C;if(B.store.isDestroyed){return}if(A.isModel){return A}A=B.getNode(A);if(A){if(!B.hasActiveFeature()){C=A.getAttribute("data-recordIndex");if(C){C=parseInt(C,10);if(C>-1){return B.store.data.getAt(C)}}}return B.dataSource.getByInternalId(A.getAttribute("data-recordId"))}},indexOf:function(A){A=this.getNode(A);if(!A&&A!==0){return -1}return this.all.indexOf(A)},indexInStore:function(A){return A?this.dataSource.indexOf(this.getRecord(A)):-1},renderRows:function(D,G,F,E){var B=this.rowValues,C=D.length,A;B.view=this;B.columns=G;for(A=0;A<C;A++,F++){B.itemClasses.length=B.rowClasses.length=0;this.renderRow(D[A],F,E)}B.view=B.columns=B.record=null},renderColumnSizer:function(E,C){var G=E.columns||this.getGridColumns(),D=G.length,A,F,B;C.push('<colgroup role="presentation">');for(A=0;A<D;A++){F=G[A];B=F.cellWidth?F.cellWidth:Ext.grid.header.Container.prototype.defaultWidth;C.push('<col role="presentation" class="',Ext.baseCSSPrefix,"grid-cell-",G[A].getItemId(),'" style="width:'+B+'px">')}C.push("</colgroup>")},renderRow:function(I,J,B){var H=this,F=J===-1,A=H.selModel,G=H.rowValues,K=G.itemClasses,E=G.rowClasses,D,C=H.rowTpl;G.rowAttr={};G.record=I;G.recordId=I.internalId;G.recordIndex=H.store.indexOf(I);G.rowIndex=J;G.rowId=H.getRowId(I);G.itemCls=G.rowCls="";if(!G.columns){G.columns=H.ownerCt.getVisibleColumnManager().getColumns()}K.length=E.length=0;if(!F){K[0]=Ext.baseCSSPrefix+"grid-item";if(!H.ownerCt.disableSelection&&A.isRowSelected){if(A.isRowSelected(I)){K.push(H.selectedItemCls)}}if(H.stripeRows&&J%2!==0){K.push(H.altRowCls)}if(H.getRowClass){D=H.getRowClass(I,J,null,H.dataSource);if(D){E.push(D)}}}if(B){C.applyOut(G,B,H.tableValues)}else{return C.apply(G.me.tableValues)}},renderCell:function(D,M,G,A,B,C){var K=this,O,E=K.selModel,J=K.cellValues,F=J.classes,N=M.data[D.dataIndex],L=K.cellTpl,H,I;J.record=M;J.column=D;J.recordIndex=G;J.rowIndex=A;J.columnIndex=B;J.cellIndex=B;J.align=D.align;J.innerCls=D.innerCls;J.tdCls=J.tdStyle=J.tdAttr=J.style="";J.unselectableAttr=K.enableTextSelection?"":'unselectable="on"';F[1]=D.getCellId();I=2;if(D.renderer&&D.renderer.call){O=K.ownerCt.columnManager.getHeaderIndex(D);H=D.renderer.call(D.usingDefaultRenderer?D:D.scope||K.ownerCt,N,J,M,G,O,K.dataSource,K);if(J.css){M.cssWarning=true;J.tdCls+=" "+J.css;J.css=null}if(J.tdCls){F[I++]=J.tdCls}}else{H=N}J.value=(H==null||H==="")?D.emptyCellText:H;if(D.tdCls){F[I++]=D.tdCls}if(K.markDirty&&M.isModified(D.dataIndex)){F[I++]=K.dirtyCls}if(D.isFirstVisible){F[I++]=K.firstCls}if(D.isLastVisible){F[I++]=K.lastCls}if(!K.enableTextSelection){F[I++]=K.unselectableCls}if(E&&E.isCellModel&&E.isCellSelected(K,G,D)){F[I++]=(K.selectedCellCls)}F.length=I;J.tdCls=F.join(" ");L.applyOut(J,C);J.column=null},getRow:function(A){var B;if((!A&&A!==0)||!this.rendered){return null}if(A.target){A=A.target}if(Ext.isString(A)){return Ext.fly(A).down(this.rowSelector,true)}if(Ext.isNumber(A)){B=this.all.item(A);return B&&B.down(this.rowSelector,true)}if(A.isModel){return this.getRowByRecord(A)}B=Ext.fly(A);if(B.is(this.itemSelector)){return this.getRowFromItem(B)}return B.findParent(this.rowSelector,this.getTargetEl())},getRowId:function(A){return this.id+"-record-"+A.internalId},constructRowId:function(A){return this.id+"-record-"+A},getNodeById:function(A){A=this.constructRowId(A);return this.retrieveNode(A,false)},getRowById:function(A){A=this.constructRowId(A);return this.retrieveNode(A,true)},getNodeByRecord:function(A){return this.retrieveNode(this.getRowId(A),false)},getRowByRecord:function(A){return this.retrieveNode(this.getRowId(A),true)},getRowFromItem:function(B){var D=Ext.getDom(B).tBodies[0].childNodes,C=D.length,A;for(A=0;A<C;A++){if(Ext.fly(D[A]).is(this.rowSelector)){return D[A]}}},retrieveNode:function(C,B){var A=this.el.getById(C,true);if(B&&A){return Ext.fly(A).down(this.rowSelector,true)}return A},updateIndexes:Ext.emptyFn,bodySelector:"div."+Ext.baseCSSPrefix+"grid-item-container",nodeContainerSelector:"div."+Ext.baseCSSPrefix+"grid-item-container",itemSelector:"table."+Ext.baseCSSPrefix+"grid-item",rowSelector:"tr."+Ext.baseCSSPrefix+"grid-row",cellSelector:"td."+Ext.baseCSSPrefix+"grid-cell",sizerSelector:"."+Ext.baseCSSPrefix+"grid-cell",innerSelector:"div."+Ext.baseCSSPrefix+"grid-cell-inner",getBodySelector:function(){return this.bodySelector},getColumnSizerSelector:function(A){var B=this.sizerSelector+"-"+A.getItemId();return"td"+B+",col"+B},getItemSelector:function(){return this.itemSelector},getCellSelector:function(A){return A?A.getCellSelector():this.cellSelector},getCellInnerSelector:function(A){return this.getCellSelector(A)+" "+this.innerSelector},addRowCls:function(C,A){var B=this.getRow(C);if(B){Ext.fly(B).addCls(A)}},removeRowCls:function(C,A){var B=this.getRow(C);if(B){Ext.fly(B).removeCls(A)}},onRowSelect:function(B){var A=this;A.addItemCls(B,A.selectedItemCls);if(Ext.isIE8){A.repaintBorder(B+1)}},onRowDeselect:function(B){var A=this;A.removeItemCls(B,A.selectedItemCls);if(Ext.isIE8){A.repaintBorder(B+1)}},onCellSelect:function(A){var B=this.getCellByPosition(A);if(B){B.addCls(this.selectedCellCls)}},onCellDeselect:function(A){var B=this.getCellByPosition(A,true);if(B){Ext.fly(B).removeCls(this.selectedCellCls)}},getCellByPosition:function(D,A){if(D){var C=this.getRow(D.row),B=this.ownerCt.getColumnManager().getHeaderAtIndex(D.column);if(B&&C){return Ext.fly(C).down(this.getCellSelector(B),A)}}return false},onRowFocus:function(D,C,B){var A=this;if(C){A.addItemCls(D,A.focusedItemCls);if(!B){A.focusRow(D)}}else{A.removeItemCls(D,A.focusedItemCls)}if(Ext.isIE8){A.repaintBorder(D+1)}},focusRow:function(B,E){var A=this,D,C=A.getFocusTask();if(E){C.delay(Ext.isNumber(E)?E:10,A.focusRow,A,[B,false]);return}C.cancel();if(A.isVisible(true)&&(B=A.getRow(B))){A.scrollRowIntoView(B);D=A.getRecord(B);A.selModel.setLastFocused(D);A.doFocus(B);A.fireEvent("rowfocus",D,B,A.indexInStore(B))}},scrollRowIntoView:function(B,A){B=this.getRow(B);if(B){this.scrollElIntoView(B,false,A)}},focusCell:function(B,E){var A=this,D,C=A.getFocusTask();if(E){C.delay(Ext.isNumber(E)?E:10,A.focusCell,A,[B,false]);return}C.cancel();if(A.isVisible(true)&&(D=A.getCellByPosition(B))){A.scrollCellIntoView(D);A.doFocus(A.getRow(B.row));A.fireEvent("cellfocus",B.record,D,B)}},doFocus:function(B){var C=this,A=Ext.isIE,D;if(A){D=C.el.getScrollLeft();C.ignoreScroll=true}(C.focusEl=Ext.get(B)).focus();if(A){C.el.setScrollLeft(D);C.ignoreScroll=false}},scrollCellIntoView:function(B,A){if(B.row!=null&&B.column!=null){B=this.getCellByPosition(B)}if(B){this.scrollElIntoView(B,null,A)}},scrollElIntoView:function(A,E,C){var D=this,B=D.scrollManager;if(B){B.scrollIntoView(A,E,C)}else{Ext.fly(A).scrollIntoView(D.el,E,C)}},syncRowHeights:function(D,A){D.style.height=A.style.height="";var F=this,C=F.rowTpl,B=D.offsetHeight,E=A.offsetHeight;if(B!==E){while(C){if(C.syncRowHeights){if(C.syncRowHeights(D,A)===false){break}}C=C.nextTpl}B=D.offsetHeight;E=A.offsetHeight;if(B!==E){D=Ext.fly(D).down(F.rowSelector,true)||D;A=Ext.fly(A).down(F.rowSelector,true)||A;if(D&&A){D.style.height=A.style.height="";B=D.offsetHeight;E=A.offsetHeight;if(B>E){Ext.fly(D).setHeight(B);Ext.fly(A).setHeight(B)}else{if(E>B){Ext.fly(D).setHeight(E);Ext.fly(A).setHeight(E)}}}}}},onUpdate:function(A,C,D,B){var E=this;if(E.rendered&&E.throttledUpdate&&E.bufferedRenderer&&!E.getNode(C)){return}E.callParent(arguments)},handleUpdate:function(N,L,e,G){var K=this,E=K.rowTpl,A,Y,T,c,a,Q,D,P,B,V,O,U,W,b=[],C,J,X=K.variableRowHeight,R,I=0,F,S,d,H,M,Z=K.ownerCt;if(K.viewReady){Y=K.getNodeByRecord(L);if(Y){B=K.overItemCls;V=K.focusedItemCls;O=K.selectedItemCls;U=K.ownerCt.getVisibleColumnManager().getColumns();for(J=0,C=U.length;J<C;J++){W=U[J];R=K.shouldUpdateCell(L,W,G);if(R){I=I|R;b[b.length]=W;X=X||W.variableRowHeight}}if(!K.getRowFromItem(Y)||(I&1)||(Y.tBodies[0].childNodes.length>1)){A=Ext.fly(Y,"_internal");c=K.createRowElement(L,K.dataSource.indexOf(L),b);if(A.hasCls(B)){Ext.fly(c).addCls(B)}if(A.hasCls(V)){Ext.fly(c).addCls(V)}if(A.hasCls(O)){Ext.fly(c).addCls(O)}if(Ext.isIE9m&&Y.mergeAttributes){Y.mergeAttributes(c,true)}else{a=c.attributes;Q=a.length;for(P=0;P<Q;P++){D=a[P].name;if(D!=="id"){Y.setAttribute(D,a[P].value)}}}if(U.length&&(T=K.getRow(Y))){K.updateColumns(T,Ext.fly(c).down(K.rowSelector,true),b)}while(E){if(E.syncContent){if(E.syncContent(Y,c,G?b:null)===false){break}}E=E.nextTpl}}else{if(!K.cellFly){K.cellFly=new Ext.dom.Fly()}for(J=0,C=b.length;J<C;J++){W=b[J];S=W.dataIndex;d=L.get(S);F=Y.firstChild.firstChild.childNodes[W.getVisibleIndex()];if(K.markDirty){K.cellFly.attach(F);if(L.isModified(W.dataIndex)){K.cellFly.addCls(K.dirtyCls)}else{K.cellFly.removeCls(K.dirtyCls)}}H=W.usingDefaultRenderer;M=H?W:W.scope;if(W.updater){Ext.callback(W.updater,M,[F,d,L,K],0,W,Z)}else{if(W.renderer){d=Ext.callback(W.renderer,M,[d,null,L,0,0,K.dataSource,K],0,W,Z)}if(W.producesHTML){F.childNodes[0].innerHTML=d}else{F.childNodes[0].childNodes[0].data=d}}if(K.highlightClass){Ext.fly(F).addCls(K.highlightClass);if(!K.changedCells){K.self.prototype.changedCells=[];K.prototype.clearChangedTask=new Ext.util.DelayedTask(K.clearChangedCells,K.prototype);K.clearChangedTask.delay(K.unhighlightDelay)}K.changedCells.push({cell:F,cls:K.highlightClass,expires:Ext.Date.now()+1000})}}}if(X){Ext.suspendLayouts()}K.fireEvent("itemupdate",L,K.store.indexOf(L),Y);if(X){K.refreshSize();Ext.resumeLayouts(true)}}}},clearChangedCells:function(){var C=this,E=Ext.Date.now(),B;for(var A=0,D=C.changedCells.length;A<D;){B=C.changedCells[A];if(B.expires<=E){Ext.fly(B.cell).removeCls(B.highlightClass);Ext.Array.erase(C.changedCells,A,1);D--}else{break}}if(D){C.clearChangedTask.delay(C.unhighlightDelay)}},updateColumns:function(E,N,L){var K=this,A,H,D,B,M=L.length,J,C,F,G,I=K.getCellSelector();if(E.mergeAttributes){E.mergeAttributes(N,true)}else{A=N.attributes;H=A.length;for(B=0;B<H;B++){D=A[B].name;if(D!=="id"){E.setAttribute(D,A[B].value)}}}for(J=0;J<M;J++){C=L[J];I=K.getCellSelector(C);F=Ext.fly(E).selectNode(I);G=Ext.fly(N).selectNode(I);Ext.fly(F).syncContent(G)}},shouldUpdateCell:function(B,F,E){if(!F.preventUpdate){if(F.hasCustomRenderer){return 1}if(E){var C=E.length,A,D;for(A=0;A<C;++A){D=E[A];if(D===F.dataIndex||D===B.idProperty){return 2}}}else{return 2}}return 0},refresh:function(){var A=this,B;A.callParent(arguments);A.headerCt.setSortState();if(A.touchScroll&&A.el&&!A.all.getCount()&&A.headerCt&&A.headerCt.tooNarrow){B=A.scrollManager.scroller.getSize();B.x=A.headerCt.getTableWidth();A.scrollManager.scroller.setSize(B);A.scrollManager.refresh()}A.refreshSelection()},refreshSelection:function(){var C=this,E=C.selModel,B,D,A;if(E.isRowModel){B=E.selected.items;D=B.length;for(A=0;A<D;A++){C.onRowSelect(C.indexOf(C.getNode(B[A])))}}C.selModel.onLastFocusChanged(null,C.selModel.lastFocused,true)},processItemEvent:function(H,B,C,N){var G=this,R=G.self,M=R.EventMap,P=N.type,Q,K,J,O=G.features,A=O.length,F,E,D,L,I;if(Ext.isIE&&P==="mouseup"&&!N.within(G.el)){return false}if(G.indexInStore(B)!==-1){Q=Ext.fly(B).down(G.rowSelector,true);K=N.getTarget(G.getCellSelector(),Q);J=G.getSelectionModel();P=R.TouchEventMap[P]||P;if(P=="keydown"&&!K&&J.getCurrentPosition){K=G.getCellByPosition(J.getCurrentPosition(),true)}if(K){if(!K.parentNode){return false}I=G.getHeaderByCell(K);E=G.ownerCt.getColumnManager().getHeaderIndex(I)}else{E=-1}D=G.fireEvent("uievent",P,G,K,C,E,N,H,Q);if((D===false||G.callParent(arguments)===false)){if(J.onVetoUIEvent){J.onVetoUIEvent(P,G,K,C,E,N,H,Q)}return false}for(F=0;F<A;++F){L=O[F];if(L.wrapsItem){if(L.vetoEvent(H,Q,C,N)===false){G.processSpecialEvent(N);return false}}}if(K&&P!=="mouseover"&&P!=="mouseout"){D=!((G["onBeforeCell"+M[P]](K,E,H,Q,C,N)===false)||(G.fireEvent("beforecell"+P,G,K,E,H,Q,C,N)===false)||(G["onCell"+M[P]](K,E,H,Q,C,N)===false)||(G.fireEvent("cell"+P,G,K,E,H,Q,C,N)===false))}if(D!==false){D=G.fireEvent("row"+P,G,H,Q,C,N)}return D}else{this.processSpecialEvent(N);return false}},processSpecialEvent:function(A){var I=this,C=I.features,D=C.length,K=A.type,F,L,H,E,G,B,J=I.ownerCt;I.callParent(arguments);if(K=="mouseover"||K=="mouseout"){return}for(F=0;F<D;F++){L=C[F];if(L.hasFeatureEvent){E=A.getTarget(L.eventSelector,I.getTargetEl());if(E){H=L.eventPrefix;K=I.self.TouchEventMap[K]||K;G=L.getFireEventArgs("before"+H+K,I,E,A);B=L.getFireEventArgs(H+K,I,E,A);if((I.fireEvent.apply(I,G)===false)||(J.fireEvent.apply(J,G)===false)||(I.fireEvent.apply(I,B)===false)||(J.fireEvent.apply(J,B)===false)){return false}}}}return true},onCellMouseDown:Ext.emptyFn,onCellLongPress:Ext.emptyFn,onCellMouseUp:Ext.emptyFn,onCellClick:Ext.emptyFn,onCellDblClick:Ext.emptyFn,onCellContextMenu:Ext.emptyFn,onCellKeyDown:Ext.emptyFn,onBeforeCellMouseDown:Ext.emptyFn,onBeforeCellLongPress:Ext.emptyFn,onBeforeCellMouseUp:Ext.emptyFn,onBeforeCellClick:Ext.emptyFn,onBeforeCellDblClick:Ext.emptyFn,onBeforeCellContextMenu:Ext.emptyFn,onBeforeCellKeyDown:Ext.emptyFn,expandToFit:function(A){this.autoSizeColumn(A)},autoSizeColumn:function(A){if(Ext.isNumber(A)){A=this.getGridColumns[A]}if(A){if(A.isGroupHeader){A.autoSize();return}delete A.flex;A.setWidth(this.getMaxContentWidth(A))}},getMaxContentWidth:function(J){var A=this,I=A.el.query(J.getCellInnerSelector()),C=J.getWidth(),E=0,D=I.length,H=A.body.select(A.getColumnSizerSelector(J)),B=Math.max,G=0,F;if(D>0){if(Ext.supports.ScrollWidthInlinePaddingBug){G+=A.getCellPaddingAfter(I[0])}if(A.columnLines){G+=Ext.fly(I[0].parentNode).getBorderWidth("lr")}}H.setWidth(1);J.titleEl.setStyle("text-overflow","clip");F=J.textEl.dom.offsetWidth+J.titleEl.getPadding("lr");J.titleEl.setStyle("text-overflow","");for(;E<D;E++){F=B(F,I[E].scrollWidth)}F+=G;F=B(F,40);H.setWidth(C);return F},getPositionByEvent:function(B){var C=this,F=B.getTarget(C.cellSelector),E=B.getTarget(C.itemSelector),D=C.getRecord(E),A=C.getHeaderByCell(F);return C.getPosition(D,A)},getHeaderByCell:function(A){if(A){return this.ownerCt.getVisibleColumnManager().getHeaderAtIndex(A.cellIndex)}return false},walkCells:function(P,C,K,J,N,H){if(!P){return false}var G=this,Q=P.row,A=P.column,O=G.dataSource.getCount(),B=G.ownerCt.getColumnManager(),I=G.ownerCt.getVisibleColumnManager(),E=B.getHeaderIndex(I.getFirst()),D=B.getHeaderIndex(I.getLast()),L=Q,F=A,M=B.getHeaderAtIndex(A);if(!M||M.hidden||!O){return false}K=K||{};C=C.toLowerCase();switch(C){case"right":if(A===D){if(J||Q===O-1){return false}if(!K.ctrlKey){L=G.walkRows(Q,1);if(L!==Q){F=E}}}else{if(!K.ctrlKey){F=B.getHeaderIndex(I.getNextSibling(M))}else{F=D}}break;case"left":if(A===E){if(J||Q===0){return false}if(!K.ctrlKey){L=G.walkRows(Q,-1);if(L!==Q){F=D}}}else{if(!K.ctrlKey){F=B.getHeaderIndex(I.getPreviousSibling(M))}else{F=E}}break;case"up":if(Q===0){return false}else{if(!K.ctrlKey){L=G.walkRows(Q,-1)}else{L=G.walkRows(-1,1)}}break;case"down":if(Q===O-1){return false}else{if(!K.ctrlKey){L=G.walkRows(Q,1)}else{L=G.walkRows(O,-1)}}break}if(N&&N.call(H||G,{row:L,column:F})!==true){return false}F=B.getHeaderAtIndex(F);return new Ext.grid.CellContext(G).setPosition(L,F)},walkRows:function(H,F){var I=this,A=I.dataSource,E=0,C=H,G,B=(F<0)?0:(A.isBufferedStore?A.getTotalCount():A.getCount())-1,J=B?1:-1,D=H;do{if(B?D>=B:D<=B){return C||B}D+=J;if((G=Ext.fly(I.getRow(D)))&&G.isVisible(true)){E+=J;C=D}}while(E!==F);return D},walkRecs:function(H,E){var A=this,I=A.dataSource,D=0,C=H,F,B=(E<0)?0:(I.isBufferedStore?I.getTotalCount():I.getCount())-1,K=B?1:-1,J=I.indexOf(H),G;do{if(B?J>=B:J<=B){return C}J+=K;G=I.getAt(J);if(!G.isCollapsedPlaceholder&&(F=Ext.fly(A.getNodeByRecord(G)))&&F.isVisible(true)){D+=K;C=G}}while(D!==E);return C},getFirstVisibleRowIndex:function(){var C=this,A=(C.dataSource.isBufferedStore?C.dataSource.getTotalCount():C.dataSource.getCount()),B=C.indexOf(C.all.first())-1;do{B+=1;if(B===A){return}}while(!Ext.fly(C.getRow(B)).isVisible(true));return B},getLastVisibleRowIndex:function(){var B=this,A=B.indexOf(B.all.last());do{A-=1;if(A===-1){return}}while(!Ext.fly(B.getRow(A)).isVisible(true));return A},getHeaderCt:function(){return this.headerCt},getPosition:function(B,A){return new Ext.grid.CellContext(this).setPosition(B,A)},beforeDestroy:function(){var A=this;if(A.rendered){A.el.clearListeners()}A.callParent(arguments)},onDestroy:function(){var C=this,A=C.featuresMC,D,B;if(A){for(B=0,D=A.getCount();B<D;++B){A.getAt(B).destroy()}}C.featuresMC=null;this.callParent(arguments)},onReplace:function(A,C,E,B){var F=this,D=F.bufferedRenderer;if(F.rendered&&D){D.onReplace(A,C,E,B)}else{F.callParent(arguments);F.doStripeRows(C);F.selModel.onLastFocusChanged(null,F.selModel.lastFocused,true)}},onAdd:function(A,B,E){var C=this,D=C.bufferedRenderer;if(C.rendered&&D){D.onReplace(A,E,[],B)}else{C.callParent(arguments);C.setPendingStripe(E);C.selModel.onLastFocusChanged(null,C.selModel.lastFocused,true)}},onRemove:function(A,B,E){var C=this,D=C.bufferedRenderer;if(C.rendered&&D){D.onReplace(A,E,B,[])}else{C.callParent(arguments);C.setPendingStripe(E)}},onDataRefresh:function(){var A=this,B=A.ownerCt;if(B&&B.isCollapsingOrExpanding===2){B.on("expand",A.onDataRefresh,A,{single:true});return}if(A.bufferedRenderer){A.all.clear();A.bufferedRenderer.onStoreClear()}A.callParent()},getViewRange:function(){var A=this;if(A.bufferedRenderer){return A.bufferedRenderer.getViewRange()}return A.callParent()},setPendingStripe:function(B){var A=this.stripeOnUpdate;if(A===null){A=B}else{A=Math.min(A,B)}this.stripeOnUpdate=A},onEndUpdate:function(){var B=this,A=B.stripeOnUpdate;if(A||A===0){B.doStripeRows(A);B.stripeOnUpdate=null}B.callParent(arguments)},doStripeRows:function(F,D){var E=this,G,A,B,C;if(E.rendered&&E.stripeRows){G=E.getNodes(F,D);for(B=0,A=G.length;B<A;B++){C=G[B];C.className=C.className.replace(E.rowClsRe," ");F++;if(F%2===0){C.className+=(" "+E.altRowCls)}}}},hasActiveFeature:function(){return(this.isGrouping&&this.store.isGrouped())||this.isRowWrapped},getCellPaddingAfter:function(A){return Ext.fly(A).getPadding("r")},privates:{getFocusEl:function(){return this.focusEl},refreshScroll:function(){var A=this,B=A.bufferedRenderer;if(B){B.stretchView(A,B.getScrollHeight(true))}else{A.callParent()}}}});
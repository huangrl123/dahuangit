Ext.define("Ext.picker.Month",{extend:"Ext.Component",requires:["Ext.XTemplate","Ext.util.ClickRepeater","Ext.Date","Ext.button.Button"],alias:"widget.monthpicker",alternateClassName:"Ext.MonthPicker",childEls:["bodyEl","prevEl","nextEl","monthEl","yearEl"],renderTpl:['<div id="{id}-bodyEl" data-ref="bodyEl" class="{baseCls}-body">','<div id="{id}-monthEl" data-ref="monthEl" class="{baseCls}-months">','<tpl for="months">','<div class="{parent.baseCls}-item {parent.baseCls}-month">','<a style="{parent.monthStyle}" role="button" hidefocus="on" class="{parent.baseCls}-item-inner">{.}</a>',"</div>","</tpl>","</div>",'<div id="{id}-yearEl" data-ref="yearEl" class="{baseCls}-years">','<div class="{baseCls}-yearnav">','<div class="{baseCls}-yearnav-button-ct">','<a id="{id}-prevEl" data-ref="prevEl" class="{baseCls}-yearnav-button {baseCls}-yearnav-prev" hidefocus="on" role="button"></a>',"</div>",'<div class="{baseCls}-yearnav-button-ct">','<a id="{id}-nextEl" data-ref="nextEl" class="{baseCls}-yearnav-button {baseCls}-yearnav-next" hidefocus="on" role="button"></a>',"</div>","</div>",'<tpl for="years">','<div class="{parent.baseCls}-item {parent.baseCls}-year">','<a hidefocus="on" class="{parent.baseCls}-item-inner" role="button">{.}</a>',"</div>","</tpl>","</div>",'<div class="'+Ext.baseCSSPrefix+'clear"></div>','<tpl if="showButtons">','<div class="{baseCls}-buttons">{%',"var me=values.$comp, okBtn=me.okBtn, cancelBtn=me.cancelBtn;","okBtn.ownerLayout = cancelBtn.ownerLayout = me.componentLayout;","okBtn.ownerCt = cancelBtn.ownerCt = me;","Ext.DomHelper.generateMarkup(okBtn.getRenderTree(), out);","Ext.DomHelper.generateMarkup(cancelBtn.getRenderTree(), out);","%}</div>","</tpl>","</div>"],okText:"OK",cancelText:"Cancel",baseCls:Ext.baseCSSPrefix+"monthpicker",showButtons:true,measureWidth:35,measureMaxHeight:20,smallCls:Ext.baseCSSPrefix+"monthpicker-small",totalYears:10,yearOffset:5,monthOffset:6,initComponent:function(){var A=this;A.selectedCls=A.baseCls+"-selected";if(A.small){A.addCls(A.smallCls)}A.setValue(A.value);A.activeYear=A.getYear(new Date().getFullYear()-4,-4);if(A.showButtons){A.okBtn=new Ext.button.Button({text:A.okText,handler:A.onOkClick,scope:A});A.cancelBtn=new Ext.button.Button({text:A.cancelText,handler:A.onCancelClick,scope:A})}this.callParent()},beforeRender:function(){var C=this,B=0,G=[],D=Ext.Date.getShortMonthName,E=C.monthOffset,A=C.monthMargin,F="";if(C.padding&&!C.width){C.cacheWidth()}C.callParent();for(;B<E;++B){G.push(D(B),D(B+E))}if(Ext.isDefined(A)){F="margin: 0 "+A+"px;"}Ext.apply(C.renderData,{months:G,years:C.getYears(),showButtons:C.showButtons,monthStyle:F})},cacheWidth:function(){var C=this,B=C.parseBox(C.padding),A=Ext.getBody().createChild({cls:C.baseCls+" "+C.borderBoxCls,style:"position:absolute;top:-1000px;left:-1000px;",html:"&nbsp;"});C.self.prototype.width=A.getWidth()+B.left+B.right;A.destroy()},afterRender:function(){var B=this,A=B.bodyEl;B.callParent();B.mon(A,"click",B.onBodyClick,B);B.mon(A,"dblclick",B.onBodyClick,B);B.years=A.select("."+B.baseCls+"-year a");B.months=A.select("."+B.baseCls+"-month a");B.backRepeater=new Ext.util.ClickRepeater(B.prevEl,{handler:Ext.Function.bind(B.adjustYear,B,[-B.totalYears])});B.prevEl.addClsOnOver(B.baseCls+"-yearnav-prev-over");B.nextRepeater=new Ext.util.ClickRepeater(B.nextEl,{handler:Ext.Function.bind(B.adjustYear,B,[B.totalYears])});B.nextEl.addClsOnOver(B.baseCls+"-yearnav-next-over");B.updateBody();if(!Ext.isDefined(B.monthMargin)){Ext.picker.Month.prototype.monthMargin=B.calculateMonthMargin()}},calculateMonthMargin:function(){var C=this,E=C.monthEl,B=C.months,D=B.first(),A=D.getMargin("l");while(A&&C.getLargest()>C.measureMaxHeight){--A;B.setStyle("margin","0 "+A+"px")}return A},getLargest:function(B){var A=0;this.months.each(function(D){var C=D.getHeight();if(C>A){A=C}});return A},setValue:function(E){var D=this,B=D.activeYear,A=D.monthOffset,C,F;if(!E){D.value=[null,null]}else{if(Ext.isDate(E)){D.value=[E.getMonth(),E.getFullYear()]}else{D.value=[E[0],E[1]]}}if(D.rendered){C=D.value[1];if(C!==null){if((C<B||C>B+D.yearOffset)){D.activeYear=C-D.yearOffset+1}}D.updateBody()}return D},getValue:function(){return this.value},hasSelection:function(){var A=this.value;return A[0]!==null&&A[1]!==null},getYears:function(){var C=this,A=C.yearOffset,F=C.activeYear,D=F+A,B=F,E=[];for(;B<D;++B){E.push(B,B+A)}return E},updateBody:function(){var A=this,K=A.years,E=A.months,J=A.getYears(),G=A.selectedCls,F=A.getYear(null),C=A.value[0],D=A.monthOffset,I,H,M,B,L;if(A.rendered){K.removeCls(G);E.removeCls(G);H=K.elements;B=H.length;for(M=0;M<B;M++){L=Ext.fly(H[M]);I=J[M];L.dom.innerHTML=I;if(I==F){L.addCls(G)}}if(C!==null){if(C<D){C=C*2}else{C=(C-D)*2+1}E.item(C).addCls(G)}}},getYear:function(C,A){var B=this.value[1];A=A||0;return B===null?C:B+A},onBodyClick:function(A,D){var B=this,C=A.type=="dblclick";if(A.getTarget("."+B.baseCls+"-month")){A.stopEvent();B.onMonthClick(D,C)}else{if(A.getTarget("."+B.baseCls+"-year")){A.stopEvent();B.onYearClick(D,C)}}},adjustYear:function(A){if(typeof A!="number"){A=this.totalYears}this.activeYear+=A;this.updateBody()},onOkClick:function(){this.fireEvent("okclick",this,this.value)},onCancelClick:function(){this.fireEvent("cancelclick",this)},onMonthClick:function(C,B){var A=this;A.value[0]=A.resolveOffset(A.months.indexOf(C),A.monthOffset);A.updateBody();A.fireEvent("month"+(B?"dbl":"")+"click",A,A.value);A.fireEvent("select",A,A.value)},onYearClick:function(C,B){var A=this;A.value[1]=A.activeYear+A.resolveOffset(A.years.indexOf(C),A.yearOffset);A.updateBody();A.fireEvent("year"+(B?"dbl":"")+"click",A,A.value);A.fireEvent("select",A,A.value)},resolveOffset:function(B,A){if(B%2===0){return(B/2)}else{return A+Math.floor(B/2)}},beforeDestroy:function(){var A=this;A.years=A.months=null;Ext.destroyMembers(A,"backRepeater","nextRepeater","okBtn","cancelBtn");A.callParent()},onDestroy:function(){Ext.destroyMembers(this,"okBtn","cancelBtn");this.callParent()},privates:{finishRenderChildren:function(){var A=this;this.callParent(arguments);if(this.showButtons){A.okBtn.finishRender();A.cancelBtn.finishRender()}}}});
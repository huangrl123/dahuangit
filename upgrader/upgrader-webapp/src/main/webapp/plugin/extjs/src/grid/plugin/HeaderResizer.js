Ext.define("Ext.grid.plugin.HeaderResizer",{extend:"Ext.plugin.Abstract",requires:["Ext.dd.DragTracker","Ext.util.Region"],alias:"plugin.gridheaderresizer",disabled:false,config:{dynamic:false},colHeaderCls:Ext.baseCSSPrefix+"column-header",minColWidth:40,maxColWidth:1000,eResizeCursor:"col-resize",init:function(B){var A=this;A.headerCt=B;B.on("render",A.afterHeaderRender,A,{single:A});if(!A.minColWidth){A.self.prototype.minColWidth=Ext.grid.column.Column.prototype.minWidth}},destroy:function(){var A=this.tracker;if(A){delete A.onBeforeStart;delete A.onStart;delete A.onDrag;delete A.onEnd;A.destroy();this.tracker=null}},afterHeaderRender:function(){var B=this,C=B.headerCt,A=C.el;C.mon(A,"mousemove",B.onHeaderCtMouseMove,B);B.markerOwner=B.ownerGrid=B.headerCt.up("tablepanel");if(B.markerOwner.ownerLockable){B.markerOwner=B.markerOwner.ownerLockable}B.tracker=new Ext.dd.DragTracker({disabled:B.disabled,onBeforeStart:B.onBeforeStart.bind(B),onStart:B.onStart.bind(B),onDrag:B.onDrag.bind(B),onEnd:B.onEnd.bind(B),tolerance:3,autoStart:300,el:A})},onHeaderCtMouseMove:function(A){var B=this;if(B.headerCt.dragging||B.disabled){if(B.activeHd){B.activeHd.el.dom.style.cursor="";delete B.activeHd}}else{B.findActiveHeader(A)}},findActiveHeader:function(C){var E=this,F=C.getTarget("."+E.colHeaderCls,3,true),B,D,A;if(F){B=Ext.getCmp(F.id);if(B.isOnRightEdge(C)){if(E.headerCt.visibleColumnManager.getColumns().length===1&&E.headerCt.forceFit){return}D=B}else{if(B.isOnLeftEdge(C)){A=E.headerCt.visibleColumnManager.getColumns();D=A[Ext.Array.indexOf(A,B)-1];if(!D&&E.ownerGrid.ownerLockable&&!E.ownerGrid.isLocked){A=E.ownerGrid.ownerLockable.lockedGrid.headerCt.visibleColumnManager.getColumns();D=A[A.length-1]}}}if(D){if(D.isGroupHeader){A=D.getGridColumns();D=A[A.length-1]}if(D&&!(D.fixed||(D.resizable===false))){E.activeHd=D;B.el.dom.style.cursor=E.eResizeCursor;if(B.triggerEl){B.triggerEl.dom.style.cursor=E.eResizeCursor}}}else{B.el.dom.style.cursor="";if(B.triggerEl){B.triggerEl.dom.style.cursor=""}E.activeHd=null}}return E.activeHd},onBeforeStart:function(A){var B=this;B.dragHd=Ext.supports.Touch?B.findActiveHeader(A):B.activeHd;if(!!B.dragHd&&!B.headerCt.dragging){B.xDelta=B.dragHd.getX()+B.dragHd.getWidth()-B.tracker.getXY()[0];B.tracker.constrainTo=B.getConstrainRegion();return true}else{B.headerCt.dragging=false;return false}},getConstrainRegion:function(){var C=this,A=C.dragHd.el,F=0,E,B,D=C.headerCt.getWidth()-C.headerCt.visibleColumnManager.getColumns().length*C.minColWidth;if(C.headerCt.forceFit){E=C.dragHd.nextNode("gridcolumn:not([hidden]):not([isGroupHeader])");if(E&&C.headerInSameGrid(E)){F=E.getWidth()-C.minColWidth}}else{if((B=C.dragHd.up("tablepanel")).isLocked){F=C.dragHd.up("[scrollerOwner]").getTargetEl().getWidth()-B.getWidth()-(B.ownerLockable.normalGrid.visibleColumnManager.getColumns().length*C.minColWidth+Ext.getScrollbarSize().width)}else{F=D-A.getWidth()}}return C.adjustConstrainRegion(A.getRegion(),0,F-C.xDelta,0,C.minColWidth-C.xDelta)},onStart:function(B){var G=this,A=G.dragHd,F=A.el.getWidth(),K=A.getOwnerHeaderCt(),H,I,D,J,E,C;G.headerCt.dragging=true;G.origWidth=F;if(!G.dynamic){D=G.markerOwner;if(D.frame&&D.resizable){G.gridOverflowSetting=D.el.dom.style.overflow;D.el.dom.style.overflow="hidden"}H=G.getLeftMarkerX(D);J=D.getLhsMarker();E=D.getRhsMarker();C=G.ownerGrid.body.getHeight()+K.getHeight();I=K.getOffsetsTo(D)[1]-D.el.getBorderWidth("t");J.setLocalY(I);E.setLocalY(I);J.setHeight(C);E.setHeight(C);G.setMarkerX(J,H);G.setMarkerX(E,H+F)}},onDrag:function(A){var B=this;if(B.dynamic){B.doResize()}else{B.setMarkerX(B.getMovingMarker(B.markerOwner),B.calculateDragX(B.markerOwner))}},getMovingMarker:function(A){return A.getRhsMarker()},onEnd:function(A){var B=this,C;B.headerCt.dragging=false;if(B.dragHd){if(!B.dynamic){C=B.headerCt.up("tablepanel");if(C.ownerLockable){C=C.ownerLockable}if("gridOverflowSetting" in B){C.el.dom.style.overflow=B.gridOverflowSetting}B.setMarkerX(C.getLhsMarker(),-9999);B.setMarkerX(C.getRhsMarker(),-9999)}B.doResize()}B.onHeaderCtMouseMove(A)},doResize:function(){var C=this,B=C.dragHd,D,A=C.tracker.getOffset("point");if(B&&A[0]){if(B.flex){delete B.flex}Ext.suspendLayouts();C.adjustColumnWidth(A[0]);if(C.headerCt.forceFit){D=B.nextNode("gridcolumn:not([hidden]):not([isGroupHeader])");if(D&&!C.headerInSameGrid(D)){D=null}if(D){delete D.flex;D.setWidth(D.getWidth()-A[0])}}Ext.resumeLayouts(true)}},headerInSameGrid:function(A){var B=this.dragHd.up("tablepanel");return !!A.up(B)},disable:function(){var A=this.tracker;this.disabled=true;if(A){A.disable()}},enable:function(){var A=this.tracker;this.disabled=false;if(A){A.enable()}},calculateDragX:function(A){return this.tracker.getXY("point")[0]+this.xDelta-A.getX()-A.el.getBorderWidth("l")},getLeftMarkerX:function(A){return this.dragHd.getX()-A.getX()-A.el.getBorderWidth("l")-1},setMarkerX:function(A,B){A.setLocalX(B)},adjustConstrainRegion:function(E,D,A,C,B){return E.adjust(D,A,C,B)},adjustColumnWidth:function(A){this.dragHd.setWidth(this.origWidth+A)}});
Ext.define("Ext.slider.Multi",{extend:"Ext.form.field.Base",alias:"widget.multislider",alternateClassName:"Ext.slider.MultiSlider",requires:["Ext.slider.Thumb","Ext.slider.Tip","Ext.Number","Ext.util.Format","Ext.Template"],childEls:["endEl","innerEl"],fieldSubTpl:['<div id="{id}" role="{role}" {inputAttrTpl} class="'+Ext.baseCSSPrefix+"slider {fieldCls} {vertical}",'{childElCls}"','<tpl if="tabIdx != null"> tabIndex="{tabIdx}"</tpl>','<tpl if="isVertical"> aria-orientation="vertical"<tpl else> aria-orientation="horizontal"</tpl>',">",'<div id="{cmpId}-endEl" data-ref="endEl" class="'+Ext.baseCSSPrefix+'slider-end" role="presentation">','<div id="{cmpId}-innerEl" data-ref="innerEl" class="'+Ext.baseCSSPrefix+'slider-inner" role="presentation">',"{%this.renderThumbs(out, values)%}","</div>","</div>","</div>",{renderThumbs:function(B,F){var A=F.$comp,E=0,C=A.thumbs,G=C.length,H,D;for(;E<G;E++){H=C[E];D=H.getElConfig();D.id=A.id+"-thumb-"+E;Ext.DomHelper.generateMarkup(D,B)}},disableFormats:true}],horizontalProp:"left",vertical:false,minValue:0,maxValue:100,decimalPrecision:0,keyIncrement:1,increment:0,clickRange:[5,15],clickToChange:true,animate:true,dragging:false,constrainThumbs:true,useTips:true,tipText:null,ariaRole:"slider",initValue:function(){var B=this,E=Ext.valueFrom,D=E(B.values,[E(B.value,E(B.minValue,0))]),A=0,C=D.length;B.originalValue=D;for(;A<C;A++){B.addThumb(B.normalizeValue(D[A]))}},initComponent:function(){var F=this,E,B,D,A,C;F.thumbs=[];F.keyIncrement=Math.max(F.increment,F.keyIncrement);F.extraFieldBodyCls=Ext.baseCSSPrefix+"slider-ct-"+(F.vertical?"vert":"horz");F.callParent();if(F.useTips){if(Ext.isObject(F.useTips)){E=Ext.apply({},F.useTips)}else{E=F.tipText?{getText:F.tipText}:{}}C=F.plugins=F.plugins||[];A=C.length;for(D=0;D<A;D++){if(C[D].isSliderTip){B=true;break}}if(!B){F.plugins.push(new Ext.slider.Tip(E))}}},addThumb:function(C){var B=this,A=new Ext.slider.Thumb({ownerCt:B,value:C,slider:B,index:B.thumbs.length,constrain:B.constrainThumbs,disabled:!!B.readOnly});B.thumbs.push(A);if(B.rendered){A.render()}return A},promoteThumb:function(C){var D=this.thumbStack||(this.thumbStack=Ext.Array.slice(this.thumbs)),E=D.length,B=10000,A;if(D[0]!==C){Ext.Array.remove(D,C);D.unshift(C)}for(A=0;A<E;A++){D[A].el.setStyle("zIndex",B);B-=1000}},getSubTplData:function(){var A=this;return Ext.apply(A.callParent(),{$comp:A,isVertical:A.vertical,vertical:A.vertical?Ext.baseCSSPrefix+"slider-vert":Ext.baseCSSPrefix+"slider-horz",minValue:A.minValue,maxValue:A.maxValue,value:A.value,tabIdx:A.tabIndex,childElCls:""})},onRender:function(){var C=this,E=C.thumbs,D=E.length,A=0,B;C.callParent(arguments);for(A=0;A<D;A++){B=E[A];B.el=C.el.getById(C.id+"-thumb-"+A);B.onRender()}},initEvents:function(){var A=this;A.mon(A.el,{scope:A,mousedown:A.onMouseDown,keydown:A.onKeyDown})},onDragStart:Ext.emptyFn,onDragEnd:Ext.emptyFn,getTrackpoint:function(A){var D=this,E=D.vertical,G=D.innerEl,F,B,C;if(E){C="top";F=G.getHeight()}else{C=D.horizontalProp;F=G.getWidth()}A=D.transformTrackPoints(G.translatePoints(A));B=Ext.Number.constrain(A[C],0,F);return E?F-B:B},transformTrackPoints:Ext.identityFn,onMouseDown:function(B){var C=this,D=false,A=0,E=C.thumbs,F=E.length,G;if(C.disabled){return}for(;!D&&A<F;A++){D=D||B.target==E[A].el.dom}if(C.clickToChange&&!D){G=C.getTrackpoint(B.getXY());if(G!==undefined){C.onClickChange(G)}}C.focus()},onClickChange:function(D){var B=this,A,C;A=B.getNearest(D);if(!A.disabled){C=A.index;B.setValue(C,Ext.util.Format.round(B.reversePixelValue(D),B.decimalPrecision),undefined,true)}},getNearest:function(B){var I=this,C=I.reversePixelValue(B),G=I.getRange()+5,D=null,A=I.thumbs,F=0,J=A.length,K,E,H;for(;F<J;F++){K=I.thumbs[F];E=K.value;H=Math.abs(E-C);if(Math.abs(H)<=G){D=K;G=H}}return D},onKeyDown:function(A){var B=this,D,C;if(B.disabled||B.thumbs.length!==1){A.preventDefault();return}D=A.getKey();switch(D){case A.UP:case A.RIGHT:A.stopEvent();C=A.ctrlKey?B.maxValue:B.getValue(0)+B.keyIncrement;B.setValue(0,C,undefined,true);break;case A.DOWN:case A.LEFT:A.stopEvent();C=A.ctrlKey?B.minValue:B.getValue(0)-B.keyIncrement;B.setValue(0,C,undefined,true);break;default:A.preventDefault()}},normalizeValue:function(B){var A=this,C=A.zeroBasedSnapping?"snap":"snapInRange";B=Ext.Number[C](B,A.increment,A.minValue,A.maxValue);B=Ext.util.Format.round(B,A.decimalPrecision);B=Ext.Number.constrain(B,A.minValue,A.maxValue);return B},setMinValue:function(F){var C=this,E=C.thumbs,D=E.length,B,A;C.minValue=F;for(A=0;A<D;++A){B=E[A];if(B.value<F){C.setValue(A,F,false)}}C.syncThumbs()},setMaxValue:function(F){var C=this,E=C.thumbs,D=E.length,B,A;C.maxValue=F;for(A=0;A<D;++A){B=E[A];if(B.value>F){C.setValue(A,F,false)}}C.syncThumbs()},setValue:function(C,E,D,H){var I=this,B=I.thumbs,A=I.publishOnComplete,K,J,F,G;if(Ext.isArray(C)){G=C;D=E;for(F=0,J=G.length;F<J;++F){K=B[F];if(K){I.setValue(F,G[F],D)}}return I}K=I.thumbs[C];E=I.normalizeValue(E);if(E!==K.value&&I.fireEvent("beforechange",I,E,K.value,K)!==false){K.value=E;if(I.rendered){K.move(I.calculateThumbPosition(E),Ext.isDefined(D)?D!==false:I.animate);I.fireEvent("change",I,E,K);I.checkDirty();if(H){I.fireEvent("changecomplete",I,E,K);if(A){I.publishValue(E)}}else{if(A===false){I.publishValue(E)}}}}return I},calculateThumbPosition:function(C){var A=this,D=A.minValue,B=(C-D)/A.getRange()*100;if(isNaN(B)){B=0}return B},getRatio:function(){var A=this,D=A.innerEl,B=A.vertical?D.getHeight():D.getWidth(),C=A.getRange();return C===0?B:(B/C)},getRange:function(){return this.maxValue-this.minValue},reversePixelValue:function(A){return this.minValue+(A/this.getRatio())},reversePercentageValue:function(A){return this.minValue+this.getRange()*(A/100)},onDisable:function(){var D=this,B=0,F=D.thumbs,E=F.length,C,A,G;D.callParent();for(;B<E;B++){C=F[B];A=C.el;C.disable();if(Ext.isIE){G=A.getXY();A.hide();D.innerEl.addCls(D.disabledCls).dom.disabled=true;if(!D.thumbHolder){D.thumbHolder=D.endEl.createChild({role:"presentation",cls:Ext.baseCSSPrefix+"slider-thumb "+D.disabledCls})}D.thumbHolder.show().setXY(G)}}},onEnable:function(){var D=this,B=0,F=D.thumbs,E=F.length,C,A;this.callParent();for(;B<E;B++){C=F[B];A=C.el;C.enable();if(Ext.isIE){D.innerEl.removeCls(D.disabledCls).dom.disabled=false;if(D.thumbHolder){D.thumbHolder.hide()}A.show();D.syncThumbs()}}},syncThumbs:function(){if(this.rendered){var C=this.thumbs,A=C.length,B=0;for(;B<A;B++){C[B].move(this.calculateThumbPosition(C[B].value))}}},getValue:function(A){return Ext.isNumber(A)?this.thumbs[A].value:this.getValues()},getValues:function(){var D=[],A=0,C=this.thumbs,B=C.length;for(;A<B;A++){D.push(C[A].value)}return D},getSubmitValue:function(){var A=this;return(A.disabled||!A.submitValue)?null:A.getValue()},reset:function(){var B=this,C=[].concat(B.originalValue),E=0,A=C.length,D;for(;E<A;E++){D=C[E];B.setValue(E,D)}B.clearInvalid();delete B.wasValid},setReadOnly:function(B){var C=this,E=C.thumbs,D=E.length,A=0;C.callParent(arguments);B=C.readOnly;for(;A<D;++A){if(B){E[A].disable()}else{E[A].enable()}}},beforeDestroy:function(){var C=this,D=C.thumbs,E=0,B=D.length,A;for(;E<B;E++){A=D[E];Ext.destroy(A)}C.callParent()}});
Ext.define("Ext.app.bindinspector.Container",{extend:"Ext.container.Container",alias:"widget.bindinspector-container",requires:["Ext.layout.container.Border","Ext.tab.Panel","Ext.app.bindinspector.ComponentDetail","Ext.app.bindinspector.ComponentList","Ext.app.bindinspector.Environment","Ext.app.bindinspector.Util","Ext.app.bindinspector.ViewModelDetail","Ext.app.bindinspector.noconflict.BaseModel"],isBindInspector:true,referenceHolder:true,layout:"border",cls:Ext.baseCSSPrefix+"bindinspector-container",componentPreviewDefault:{xtype:"container",cls:Ext.baseCSSPrefix+"bindinspector-prev-default",padding:20,layout:{type:"hbox",align:"middle",pack:"center"},items:[{xtype:"component",flex:1,html:"Select a component with bindings from the ComponentList to view the bindings details along with the component's inherited ViewModel"}]},initComponent:function(){var A=this;Ext.data.schema.Schema.get("Ext_app_bindinspector").clear();A.items=[{xtype:"bindinspector-componentlist",reference:"componentList",region:"west",width:400,split:true,collapsible:true,components:A.env.rootComponents,listeners:{scope:A,componentdblclick:A.onComponentDblclick,componentselect:A.onComponentSelect}},{xtype:"tabpanel",region:"center",reference:"tabs",items:[{title:"Preview",reference:"preview",layout:"fit",items:[A.componentPreviewDefault]}],listeners:{add:function(){this.getTabBar().setVisible(this.items.getCount()>1)},remove:function(){this.getTabBar().setVisible(this.items.getCount()>1)}}}];A.callParent();A.on("vmSearchClick",A.onVMSearchClick,A)},onVMSearchClick:function(C){var D=this.lookupReference("componentList"),I=D.getStore(),H=C.get("ownerVMs"),F=[],A=C.get("bindCount"),K=[],J=[],E=[],G,B;I.suspendEvents();D.clearVMSearchIndicators();Ext.Array.forEach(H,function(L){G=I.getById(L.view);G.set("isSrcVM",C);F.push(G)});I.resumeEvents();D.getView().refresh();D.indicatedVM=F;if(A>0){C.bubble(function(L){var M=L.get("name");if(M){K.push(M)}});B=K.reverse().join(".");D.getStore().getRootNode().cascadeBy(function(L){if(L.get("hasBindings")){Ext.Array.forEach(L.get("bindData"),function(N){var M=[];if(N.tokens){Ext.Array.forEach(N.tokens,function(O){if(Ext.isArray(O)){Ext.Array.forEach(O,function(P){M.push(P)})}else{M.push(O)}})}if(M.join(".")===B){J.push(L)}})}})}Ext.Array.forEach(J.concat(F),function(L){E.push(L.getId())});D.expand();D.filterComponentTree(null,E);Ext.Array.forEach(F,function(L){if(!Ext.Array.contains(J)){L.set("filtervisible",false)}});D.down("#srcVMIndicator").show();D.down("#queryFieldTb").hide();D.down("#vmQueryResultsTb").show()},onComponentSelect:function(B,A,C){var D=this,F=A.getId(),E=D.lookupReference("preview");if(E.referringID!==F){Ext.suspendLayouts();E.removeAll();E.add({xtype:"bindinspector-componentdetail",env:D.env,component:D.env.getCmp(F)});Ext.resumeLayouts(true);E.referringID=F}E.show()},onComponentDblclick:function(I,B,G){var H=B.id,D="bindtab-"+H,A=this.lookupReference("tabs"),E=A.items.get(D),C,F;if(!E){C=this.env.getCmp(H);F=C.reference;E=A.add({xtype:"bindinspector-componentdetail",env:this.env,itemId:D,title:F?"["+F+"] "+H:H,closable:true,component:C})}A.setActiveTab(E)},buildVMDataMap:function(F){var A=this.env,B=F,G=F.dataMap,D=[],E,C;if(!G){G=F.dataMap={};while(B){D.push(B);B=A.getVM(B.parent)}Ext.Array.forEach(D,function(I){var H;E=I.data;if(E&&Ext.isObject(E)){for(H in E){C=E.hasOwnProperty(H);if(!G[H]){G[H]={isDirect:C}}G[H].ownerVMs=G[H].ownerVMs||[];if(C){G[H].ownerVMs.push(I)}}}})}return F}});
Ext.define("Ext.sparkline.Line",{extend:"Ext.sparkline.Base",requires:["Ext.sparkline.RangeMap"],alias:"widget.sparklineline",config:{spotColor:"#f80",highlightSpotColor:"#5f5",highlightLineColor:"#f22",spotRadius:1.5,minSpotColor:"#f80",maxSpotColor:"#f80",lineWidth:1,normalRangeMin:null,normalRangeMax:null,normalRangeColor:"#ccc",drawNormalOnTop:false,chartRangeMin:null,chartRangeMax:null,chartRangeMinX:null,chartRangeMaxX:null,tipTpl:new Ext.XTemplate("&#9679; {prefix}{y}{suffix}"),valueSpots:null},applyValueSpots:function(A){if(A&&!A.get){A=new Ext.sparkline.RangeMap(A)}return A},onUpdate:function(){this.vertices=[];this.regionMap=[];this.xvalues=[];this.yvalues=[];this.yminmax=[];this.hightlightSpotId=null},getRegion:function(C,D){var A,B=this.regionMap;for(A=B.length;A--;){if(B[A]!==null&&C>=B[A][0]&&C<=B[A][1]){return B[A][2]}}return undefined},getRegionFields:function(A){return{isNull:this.yvalues[A]===null,x:this.xvalues[A],y:this.yvalues[A],color:this.getLineColor(),fillColor:this.getFillColor(),offset:A}},renderHighlight:function(G){var F=this,A=F.canvas,E=F.vertices[G],C=F.getSpotRadius(),B=F.getHighlightSpotColor(),D=F.getHighlightLineColor();if(!E){return}if(C&&B){A.drawCircle(E[0],E[1],C,null,B).append()}if(D){A.drawLine(E[0],F.canvasTop,E[0],F.canvasTop+F.getHeight(),D).append()}},scanValues:function(){var A=this,J=A.values,H=J.length,C=A.xvalues,E=A.yvalues,K=A.yminmax,G,I,B,D,F;for(G=0;G<H;G++){I=J[G];B=typeof(J[G])==="string";D=typeof(J[G])==="object"&&J[G] instanceof Array;F=B&&J[G].split(":");if(B&&F.length===2){C.push(Number(F[0]));E.push(Number(F[1]));K.push(Number(F[1]))}else{if(D){C.push(I[0]);E.push(I[1]);K.push(I[1])}else{C.push(G);if(J[G]===null||J[G]==="null"){E.push(null)}else{E.push(Number(I));K.push(Number(I))}}}}if(A.xvalues){C=A.xvalues}A.maxy=A.maxyorg=Math.max.apply(Math,K);A.miny=A.minyorg=Math.min.apply(Math,K);A.maxx=Math.max.apply(Math,C);A.minx=Math.min.apply(Math,C);A.xvalues=C;A.yvalues=E;A.yminmax=K},processRangeOptions:function(){var D=this,F=D.getNormalRangeMin(),A=D.getNormalRangeMax(),B=D.getChartRangeMin(),E=D.getChartRangeMinX(),C=D.getChartRangeMax(),G=D.getChartRangeMaxX();if(F!=null){if(F<D.miny){D.miny=F}if(A>D.maxy){D.maxy=A}}if(B!=null&&(D.chartRangeClip||B<D.miny)){D.miny=B}if(C!=null&&(D.chartRangeClip||C>D.maxy)){this.maxy=C}if(E!=null&&(D.chartRangeClipX||E<D.minx)){D.minx=E}if(G!=null&&(D.chartRangeClipX||G>D.maxx)){D.maxx=G}},drawNormalRange:function(C,H,G,D,B){var F=this.getNormalRangeMin(),E=this.getNormalRangeMax(),A=H+Math.round(G-(G*((E-this.miny)/B))),I=Math.round((G*(E-F))/B);this.canvas.drawRect(C,A,D,I,undefined,this.normalRangeColor).append()},renderGraph:function(){var J=this,C=J.canvas,m=J.getWidth(),V=J.getHeight(),e=J.vertices,S=J.getSpotRadius(),H=J.regionMap,k,O,G,g,M,F,X,A,c,d,I,R,W,j,B,Z,h,T,a,K=J.getValueSpots(),E,U,L,D,l,f=J.getSpotColor(),P=J.getMinSpotColor(),N=J.getMaxSpotColor(),b=J.getNormalRangeMin(),Q=J.getDrawNormalOnTop();if(!J.callParent()){return}J.scanValues();J.processRangeOptions();L=J.xvalues;D=J.yvalues;if(!J.yminmax.length||J.yvalues.length<2){return}g=M=0;k=J.maxx-J.minx===0?1:J.maxx-J.minx;O=J.maxy-J.miny===0?1:J.maxy-J.miny;G=J.yvalues.length-1;if(S&&(m<(S*4)||V<(S*4))){S=0}if(S){E=J.getHighlightSpotColor()&&!J.disableInteraction;if(E||P||(f&&D[G]===J.miny)){V-=Math.ceil(S)}if(E||N||(f&&D[G]===J.maxy)){V-=Math.ceil(S);g+=Math.ceil(S)}if(E||((P||N)&&(D[0]===J.miny||D[0]===J.maxy))){M+=Math.ceil(S);m-=Math.ceil(S)}if(E||f||(P||N&&(D[G]===J.miny||D[G]===J.maxy))){m-=Math.ceil(S)}}V--;if(b!=null&&!Q){J.drawNormalRange(M,g,V,m,O)}X=[];A=[X];j=B=null;Z=D.length;for(l=0;l<Z;l++){c=L[l];I=L[l+1];d=D[l];R=M+Math.round((c-J.minx)*(m/k));W=l<Z-1?M+Math.round((I-J.minx)*(m/k)):m;B=R+((W-R)/2);H[l]=[j||0,B,l];j=B;if(d===null){if(l){if(D[l-1]!==null){X=[];A.push(X)}e.push(null)}}else{if(d<J.miny){d=J.miny}if(d>J.maxy){d=J.maxy}if(!X.length){X.push([R,g+V])}F=[R,g+Math.round(V-(V*((d-this.miny)/O)))];X.push(F);e.push(F)}}h=[];T=[];a=A.length;for(l=0;l<a;l++){X=A[l];if(X.length){if(J.fillColor){X.push([X[X.length-1][0],(g+V)]);T.push(X.slice(0));X.pop()}if(X.length>2){X[0]=[X[0][0],X[1][1]]}h.push(X)}}a=T.length;for(l=0;l<a;l++){C.drawShape(T[l],J.fillColor,J.fillColor).append()}if(b!=null&&Q){J.drawNormalRange(M,g,V,m,O)}a=h.length;for(l=0;l<a;l++){C.drawShape(h[l],J.getLineColor(),null,J.getLineWidth()).append()}if(S&&K){if(K.get==null){K=new Ext.sparkline.RangeMap(K)}for(l=0;l<Z;l++){U=K.get(D[l]);if(U){C.drawCircle(M+Math.round((L[l]-J.minx)*(m/k)),g+Math.round(V-(V*((D[l]-J.miny)/O))),S,null,U).append()}}}if(S&&f&&D[G]!=null){C.drawCircle(M+Math.round((L[L.length-1]-J.minx)*(m/k)),g+Math.round(V-(V*((D[G]-J.miny)/O))),S,null,f).append()}if(J.maxy!==J.minyorg){if(S&&P){c=L[Ext.Array.indexOf(D,J.minyorg)];C.drawCircle(M+Math.round((c-J.minx)*(m/k)),g+Math.round(V-(V*((J.minyorg-J.miny)/O))),S,null,P).append()}if(S&&N){c=L[Ext.Array.indexOf(D,J.maxyorg)];C.drawCircle(M+Math.round((c-J.minx)*(m/k)),g+Math.round(V-(V*((J.maxyorg-J.miny)/O))),S,null,N).append()}}J.canvasTop=g;if(J.currentPageXY&&J.el.getRegion().contains(J.currentPageXY)){J.updateDisplay()}C.render()}});
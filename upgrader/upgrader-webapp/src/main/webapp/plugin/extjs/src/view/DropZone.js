Ext.define("Ext.view.DropZone",{extend:"Ext.dd.DropZone",indicatorCls:Ext.baseCSSPrefix+"grid-drop-indicator",indicatorHtml:['<div class="',Ext.baseCSSPrefix,'grid-drop-indicator-left" role="presentation"></div>','<div class="'+Ext.baseCSSPrefix+'grid-drop-indicator-right" role="presentation"></div>'].join(""),constructor:function(A){var B=this;Ext.apply(B,A);if(!B.ddGroup){B.ddGroup="view-dd-zone-"+B.view.id}B.callParent([B.view.el])},fireViewEvent:function(){var B=this,A;B.lock();A=B.view.fireEvent.apply(B.view,arguments);B.unlock();return A},getTargetFromEvent:function(A){var F=A.getTarget(this.view.getItemSelector()),G,B,E,D,H,C;if(!F){G=A.getY();for(D=0,B=this.view.getNodes(),H=B.length;D<H;D++){E=B[D];C=Ext.fly(E).getBox();if(G<=C.bottom){return E}}}return F},getIndicator:function(){var A=this;if(!A.indicator){A.indicator=new Ext.Component({ariaRole:"presentation",html:A.indicatorHtml,cls:A.indicatorCls,ownerCt:A.view,floating:true,shadow:false})}return A.indicator},getPosition:function(A,B){var C=A.getXY()[1],D=Ext.fly(B).getRegion(),E;if((D.bottom-C)>=(D.bottom-D.top)/2){E="before"}else{E="after"}return E},containsRecordAtOffset:function(B,E,A){if(!E){return false}var F=this.view,D=F.indexOf(E),G=F.getNode(D+A),C=G?F.getRecord(G):null;return C&&Ext.Array.contains(B,C)},positionIndicator:function(E,D,C){var G=this,A=G.view,I=G.getPosition(C,E),F=A.getRecord(E),B=D.records,H;if(!Ext.Array.contains(B,F)&&(I==="before"&&!G.containsRecordAtOffset(B,F,-1)||I==="after"&&!G.containsRecordAtOffset(B,F,1))){G.valid=true;if(G.overRecord!==F||G.currentPosition!==I){H=Ext.fly(E).getY()-A.el.getY()-1;if(I==="after"){H+=Ext.fly(E).getHeight()}G.getIndicator().setWidth(Ext.fly(A.el).getWidth()).showAt(0,H);G.overRecord=F;G.currentPosition=I}}else{G.invalidateDrop()}},invalidateDrop:function(){if(this.valid){this.valid=false;this.getIndicator().hide()}},onNodeOver:function(C,E,A,B){var D=this;if(!Ext.Array.contains(B.records,D.view.getRecord(C))){D.positionIndicator(C,B,A)}return D.valid?D.dropAllowed:D.dropNotAllowed},notifyOut:function(C,E,A,B){var D=this;D.callParent(arguments);D.overRecord=D.currentPosition=null;D.valid=false;if(D.indicator){D.indicator.hide()}},onContainerOver:function(F,B,C){var D=this,E=D.view,A=E.dataSource.getCount();if(A){D.positionIndicator(E.all.last(),C,B)}else{D.overRecord=D.currentPosition=null;D.getIndicator().setWidth(Ext.fly(E.el).getWidth()).showAt(0,0);D.valid=true}return D.dropAllowed},onContainerDrop:function(C,A,B){return this.onNodeDrop(C,null,A,B)},onNodeDrop:function(D,B,A,C){var F=this,H=false,G={wait:false,processDrop:function(){F.invalidateDrop();F.handleNodeDrop(C,F.overRecord,F.currentPosition);H=true;F.fireViewEvent("drop",D,C,F.overRecord,F.currentPosition)},cancelDrop:function(){F.invalidateDrop();H=true}},E=false;if(F.valid){E=F.fireViewEvent("beforedrop",D,C,F.overRecord,F.currentPosition,G);if(G.wait){return}if(E!==false){if(!H){G.processDrop()}}}return E},destroy:function(){Ext.destroy(this.indicator);delete this.indicator;this.callParent()}});
Ext.define("Ext.grid.feature.GroupStore",{extend:"Ext.util.Observable",isStore:true,defaultViewSize:100,isFeatureStore:true,constructor:function(A,B){var C=this;C.callParent();C.groupingFeature=A;C.bindStore(B)},bindStore:function(A){var B=this;if(B.store){Ext.destroy(B.storeListeners);B.store=null}if(A){B.storeListeners=A.on({groupchange:B.onGroupChange,remove:B.onRemove,add:B.onAdd,update:B.onUpdate,refresh:B.onRefresh,clear:B.onClear,scope:B,destroyable:true});B.store=A;B.processStore(A)}},processStore:function(B){var A=this,J=B.getGroups(),D=J?J.length:0,H,I,L,E=A.data,K=A.groupingFeature.groupCache,G=A.groupingFeature.clearGroupCache(),C=A.groupingFeature.startCollapsed,F=B.getGroupField(),M,O,N;if(E){E.clear()}else{E=A.data=new Ext.util.Collection({rootProperty:"data",extraKeys:{byInternalId:{property:"internalId",rootProperty:""}}})}if(B.getCount()){A.groupingFeature.startCollapsed=false;if(D>0){for(H=0;H<D;H++){I=J.getAt(H);M=I.getGroupKey();G[M]=I;I.isCollapsed=C||(K[M]&&K[M].isCollapsed);if(I.isCollapsed){N=B.getModel();O={};O[N.idProperty]="group-"+M+"-placeholder";O[F]=M;I.placeholder=L=new N(O);L.isNonData=L.isCollapsedPlaceholder=true;E.add(L)}else{E.insert(A.data.length,I.items)}}}else{E.add(B.getRange())}}},isCollapsed:function(A){return this.groupingFeature.groupCache[A].isCollapsed},isInCollapsedGroup:function(C){var A=this.store,B;if(A.isGrouped()&&(B=this.groupingFeature.groupCache[C.get(A.getGroupField())])){return B.isCollapsed||false}return false},getCount:function(){return this.data.getCount()},getTotalCount:function(){return this.data.getCount()},rangeCached:function(B,A){return A<this.getCount()},getRange:function(D,C,B){var A=this.data.getRange(D,Ext.isNumber(C)?C+1:C);if(B&&B.callback){B.callback.call(B.scope||this,A,D,C,B)}return A},getAt:function(A){return this.data.getAt(A)},getById:function(A){return this.store.getById(A)},getByInternalId:function(A){return this.data.byInternalId.get(A)||null},expandGroup:function(A){var B=this,D,C;if(typeof A==="string"){A=B.groupingFeature.groupCache[A]}if(A){C=A.items}if(C.length&&(D=B.data.indexOf(A.placeholder))!==-1){A.isCollapsed=false;B.isExpandingOrCollapsing=1;B.data.removeAt(D);B.data.insert(D,A.items);B.fireEvent("replace",B,D,[A.placeholder],A.items);B.fireEvent("groupexpand",B,A);B.isExpandingOrCollapsing=0}},collapseGroup:function(A){var C=this,F,E,D,B;if(typeof A==="string"){A=C.groupingFeature.groupCache[A]}if(A){B=A.items}if(B&&(D=B.length)&&(F=C.data.indexOf(B[0]))!==-1){A.isCollapsed=true;C.isExpandingOrCollapsing=2;C.data.removeAt(F,D);C.data.insert(F,E=C.getGroupPlaceholder(A));C.fireEvent("replace",C,F,B,[E]);C.fireEvent("groupcollapse",C,A);C.isExpandingOrCollapsing=0}},getGroupPlaceholder:function(B){if(!B.placeholder){var C=this.store,A=C.getModel(),D={},F=B.getGroupKey(),E;D[A.idProperty]="group-"+F+"-placeholder";D[C.getGroupField()]=F;E=B.placeholder=new A(D);E.isNonData=E.isCollapsedPlaceholder=true}return B.placeholder},indexOf:function(A){if(!A.isCollapsedPlaceholder){return this.data.indexOf(A)}return -1},indexOfTotal:function(A){return this.store.indexOf(A)},onRefresh:function(A){this.processStore(this.store);this.fireEvent("refresh",this)},onRemove:function(A,B,C,D){this.processStore(this.store);this.fireEvent("refresh",this)},onClear:function(A,B,C){this.processStore(this.store);this.fireEvent("clear",this)},onAdd:function(A,B,C){this.processStore(this.store);this.fireEvent("replace",this,this.indexOf(B[0]),[],B)},onUpdate:function(A,H,C,D){var F=this,G,E,B,I;if(A.isGrouped()){G=H.group=F.groupingFeature.getRecordGroup(H);if(D&&Ext.Array.contains(D,F.groupingFeature.getGroupField())){return F.onRefresh(F.store)}if(G.isCollapsed){F.fireEvent("update",F,G.placeholder)}else{Ext.suspendLayouts();F.fireEvent("update",F,H,C,D);I=G.items;E=I[0];B=I[I.length-1];if(E!==H){E.group=G;F.fireEvent("update",F,E,"edit",D);delete E.group}if(B!==H&&B!==E&&F.groupingFeature.showSummaryRow){B.group=G;F.fireEvent("update",F,B,"edit",D);delete B.group}Ext.resumeLayouts(true)}delete H.group}else{F.fireEvent("update",F,H,C,D)}},onGroupChange:function(A){this.fireEvent("groupchange",A)}});
Ext.define("Ext.form.Basic",{extend:"Ext.util.Observable",alternateClassName:"Ext.form.BasicForm",requires:["Ext.util.MixedCollection","Ext.form.action.Load","Ext.form.action.Submit","Ext.window.MessageBox","Ext.data.ErrorCollection","Ext.util.DelayedTask"],taskDelay:10,constructor:function(D,B){var C=this,A;C.owner=D;C.checkValidityTask=new Ext.util.DelayedTask(C.checkValidity,C);C.checkDirtyTask=new Ext.util.DelayedTask(C.checkDirty,C);C.monitor=new Ext.container.Monitor({selector:"[isFormField]:not([excludeForm])",scope:C,addHandler:C.onFieldAdd,removeHandler:C.onFieldRemove,invalidateHandler:C.onMonitorInvalidate});C.monitor.bind(D);Ext.apply(C,B);if(Ext.isString(C.paramOrder)){C.paramOrder=C.paramOrder.split(/[\s,|]/)}A=C.reader;if(A&&!A.isReader){if(typeof A==="string"){A={type:A}}C.reader=Ext.createByAlias("reader."+A.type,A)}A=C.errorReader;if(A&&!A.isReader){if(typeof A==="string"){A={type:A}}C.errorReader=Ext.createByAlias("reader."+A.type,A)}C.callParent()},initialize:function(){this.initialized=true;this.onValidityChange(!this.hasInvalidField())},timeout:30,paramsAsHash:false,waitTitle:"Please Wait...",trackResetOnLoad:false,wasDirty:false,destroy:function(){var B=this,A=B.monitor;if(A){A.unbind();B.monitor=null}B.clearListeners();B.checkValidityTask.cancel();B.checkDirtyTask.cancel();B.isDestroyed=true},onFieldAdd:function(B){var A=this;A.mon(B,"validitychange",A.checkValidityDelay,A);A.mon(B,"dirtychange",A.checkDirtyDelay,A);A.onMonitorInvalidate()},onFieldRemove:function(B){var A=this;A.mun(B,"validitychange",A.checkValidityDelay,A);A.mun(B,"dirtychange",A.checkDirtyDelay,A);A.onMonitorInvalidate()},onMonitorInvalidate:function(){if(this.initialized){this.checkValidityDelay()}},getFields:function(){return this.monitor.getItems()},getBoundItems:function(){var A=this._boundItems;if(!A||A.getCount()===0){A=this._boundItems=new Ext.util.MixedCollection();A.addAll(this.owner.query("[formBind]"))}return A},hasInvalidField:function(){return !!this.getFields().findBy(function(C){var A=C.preventMark,B;C.preventMark=true;B=C.isValid();C.preventMark=A;return !B})},isValid:function(){var B=this,A;Ext.suspendLayouts();A=B.getFields().filterBy(function(C){return !C.validate()});Ext.resumeLayouts(true);return A.length<1},checkValidity:function(){var A=this,B;if(A.isDestroyed){return}B=!A.hasInvalidField();if(B!==A.wasValid){A.onValidityChange(B);A.fireEvent("validitychange",A,B);A.wasValid=B}},checkValidityDelay:function(){var A=this.taskDelay;if(A){this.checkValidityTask.delay(A)}else{this.checkValidity()}},onValidityChange:function(D){var C=this.getBoundItems(),E,A,F,B;if(C){E=C.items;F=E.length;for(A=0;A<F;A++){B=E[A];if(B.disabled===D){B.setDisabled(!D)}}}},isDirty:function(){return !!this.getFields().findBy(function(A){return A.isDirty()})},checkDirtyDelay:function(){var A=this.taskDelay;if(A){this.checkDirtyTask.delay(A)}else{this.checkDirty()}},checkDirty:function(){var A=this,B;if(A.isDestroyed){return}B=this.isDirty();if(B!==this.wasDirty){this.fireEvent("dirtychange",this,B);this.wasDirty=B}},hasUpload:function(){return !!this.getFields().findBy(function(A){return A.isFileUpload()})},doAction:function(A,B){if(Ext.isString(A)){A=Ext.ClassManager.instantiateByAlias("formaction."+A,Ext.apply({},B,{form:this}))}if(this.fireEvent("beforeaction",this,A)!==false){this.beforeAction(A);Ext.defer(A.run,100,A)}return this},submit:function(C){C=C||{};var B=this,A;if(C.standardSubmit||B.standardSubmit){A="standardsubmit"}else{A=B.api?"directsubmit":"submit"}return B.doAction(A,C)},load:function(A){return this.doAction(this.api?"directload":"load",A)},updateRecord:function(C){C=C||this._record;if(!C){Ext.Error.raise("A record is required.");return this}var G=C.self.fields,F=this.getFieldValues(),B={},A=0,D=G.length,E;for(;A<D;++A){E=G[A].name;if(F.hasOwnProperty(E)){B[E]=F[E]}}C.beginEdit();C.set(B);C.endEdit();return this},loadRecord:function(A){this._record=A;return this.setValues(A.getData())},getRecord:function(){return this._record},beforeAction:function(F){var H=this,G=F.waitMsg,B=Ext.baseCSSPrefix+"mask-loading",I=H.getFields().items,A,D=I.length,E,C;for(A=0;A<D;A++){E=I[A];if(E.isFormField&&E.syncValue){E.syncValue()}}if(G){C=H.waitMsgTarget;if(C===true){H.owner.el.mask(G,B)}else{if(C){C=H.waitMsgTarget=Ext.get(C);C.mask(G,B)}else{H.floatingAncestor=H.owner.up("[floating]");if(H.floatingAncestor){H.savePreventFocusOnActivate=H.floatingAncestor.preventFocusOnActivate;H.floatingAncestor.preventFocusOnActivate=true}Ext.MessageBox.wait(G,F.waitTitle||H.waitTitle)}}}},afterAction:function(A,D){var C=this;if(A.waitMsg){var E=Ext.MessageBox,B=C.waitMsgTarget;if(B===true){C.owner.el.unmask()}else{if(B){B.unmask()}else{E.hide()}}}if(C.floatingAncestor){C.floatingAncestor.preventFocusOnActivate=C.savePreventFocusOnActivate}if(D){if(A.reset){C.reset()}Ext.callback(A.success,A.scope||A,[C,A]);C.fireEvent("actioncomplete",C,A)}else{Ext.callback(A.failure,A.scope||A,[C,A]);C.fireEvent("actionfailed",C,A)}},findField:function(A){return this.getFields().findBy(function(B){return B.id===A||B.name===A||B.dataIndex===A})},markInvalid:function(E){var F=this,A,H,C,D,G;function B(I,K){var J=F.findField(I);if(J){J.markInvalid(K)}}if(Ext.isArray(E)){H=E.length;for(A=0;A<H;A++){C=E[A];B(C.id,C.msg)}}else{if(E instanceof Ext.data.ErrorCollection){H=E.items.length;for(A=0;A<H;A++){C=E.items[A];B(C.field,C.message)}}else{for(G in E){if(E.hasOwnProperty(G)){D=E[G];B(G,D,E)}}}}return this},setValues:function(F){var C=this,D,A,B;function E(G,I){var H=C.findField(G);if(H){H.setValue(I);if(C.trackResetOnLoad){H.resetOriginalValue()}}}Ext.suspendLayouts();if(Ext.isArray(F)){A=F.length;for(D=0;D<A;D++){B=F[D];E(B.id,B.value)}}else{Ext.iterate(F,E)}Ext.resumeLayouts(true);return this},getValues:function(M,B,A,E,J){var F={},O=this.getFields().items,I=O.length,D=Ext.isArray,K,N,L,H,C,G;for(G=0;G<I;G++){K=O[G];if(!B||K.isDirty()){N=K[E?"getModelData":"getSubmitData"](A,J);if(Ext.isObject(N)){for(C in N){if(N.hasOwnProperty(C)){L=N[C];if(A&&L===""){L=K.emptyText||""}if(!K.isRadio){if(F.hasOwnProperty(C)){H=F[C];if(!D(H)){H=F[C]=[H]}if(D(L)){F[C]=H.concat(L)}else{H.push(L)}}else{F[C]=L}}else{F[C]=F[C]||L}}}}}}if(M){F=Ext.Object.toQueryString(F)}return F},getFieldValues:function(A){return this.getValues(false,A,false,true)},clearInvalid:function(){Ext.suspendLayouts();var B=this,D=B.getFields().items,A,C=D.length;for(A=0;A<C;A++){D[A].clearInvalid()}Ext.resumeLayouts(true);return B},reset:function(D){Ext.suspendLayouts();var B=this,E=B.getFields().items,A,C=E.length;for(A=0;A<C;A++){E[A].reset()}Ext.resumeLayouts(true);if(D===true){delete B._record}return B},applyToFields:function(B){var D=this.getFields().items,A,C=D.length;for(A=0;A<C;A++){Ext.apply(D[A],B)}return this},applyIfToFields:function(B){var D=this.getFields().items,A,C=D.length;for(A=0;A<C;A++){Ext.applyIf(D[A],B)}return this}});
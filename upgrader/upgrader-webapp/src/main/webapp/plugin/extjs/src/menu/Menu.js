Ext.define("Ext.menu.Menu",{extend:"Ext.panel.Panel",alias:"widget.menu",requires:["Ext.layout.container.VBox","Ext.menu.CheckItem","Ext.menu.Item","Ext.menu.KeyNav","Ext.menu.Manager","Ext.menu.Separator"],enableKeyNav:true,allowOtherMenus:false,ariaRole:"menu",floating:true,constrain:true,hidden:true,hideMode:"visibility",ignoreParentClicks:false,isMenu:true,showSeparator:true,minWidth:undefined,defaultMinWidth:120,defaultAlign:"tl-bl?",baseCls:Ext.baseCSSPrefix+"menu",_iconSeparatorCls:Ext.baseCSSPrefix+"menu-icon-separator",_itemCmpCls:Ext.baseCSSPrefix+"menu-item-cmp",layout:{type:"vbox",align:"stretchmax",overflowHandler:"Scroller"},initComponent:function(){var C=this,B=[Ext.baseCSSPrefix+"menu"],A=C.bodyCls?[C.bodyCls]:[],D=C.floating!==false;Ext.menu.Manager.register(C);if(C.plain){B.push(Ext.baseCSSPrefix+"menu-plain")}C.cls=B.join(" ");A.push(Ext.baseCSSPrefix+"menu-body",Ext.dom.Element.unselectableCls);C.bodyCls=A.join(" ");if(D){if(C.minWidth===undefined){C.minWidth=C.defaultMinWidth}}else{C.hidden=!!C.initialConfig.hidden;C.constrain=false}C.callParent(arguments);Ext.override(C.getLayout(),{configureItem:C.configureItem})},initHierarchyEvents:Ext.emptyFn,getInherited:function(){var A=this.callParent();A.hidden=this.hidden;return A},beforeRender:function(){this.callParent(arguments);if(!this.getSizeModel().width.shrinkWrap){this.layout.align="stretch"}},onBoxReady:function(){var B=this,C={click:B.onClick,mouseover:B.onMouseOver,scope:B},A=B._iconSeparatorCls;if(Ext.supports.Touch){C.pointerdown=B.onMouseOver;B.mon(Ext.GlobalEvents,"mousedown",B.onDocMouseDown,B)}B.callParent(arguments);if(B.showSeparator){B.iconSepEl=B.body.insertFirst({role:"presentation",cls:A+" "+A+"-"+B.ui,html:"&#160;"})}B.mon(B.el,C);B.mouseMonitor=B.el.monitorMouseLeave(100,B.onMouseLeave,B);if(B.enableKeyNav){B.keyNav=new Ext.menu.KeyNav({target:B,keyMap:B.getKeyMap()})}},getRefOwner:function(){return this.ownerItem||this.ownerButton||this.callParent(arguments)},canActivateItem:function(A){return A&&!A.isDisabled()&&A.isVisible()&&(A.canActivate||!A.isMenuItem)},deactivateActiveItem:function(C){var A=this,B=A.activeItem,D=A.focusedItem;if(B){B.deactivate();if(!B.activated){delete A.activeItem}}if(D&&C){D.blur();delete A.focusedItem}},hide:function(){this.deactivateActiveItem(true);this.callParent(arguments)},getItemFromEvent:function(A){var C=this,D=C.layout.getRenderTarget().dom,B=A.getTarget();while(B.parentNode!==D){B=B.parentNode;if(!B){return}}return Ext.getCmp(B.id)},lookupComponent:function(B){var A=this;if(typeof B=="string"){B=A.lookupItemFromString(B)}else{if(Ext.isObject(B)){B=A.lookupItemFromObject(B)}}B.minWidth=B.minWidth||A.minWidth;return B},lookupItemFromObject:function(B){var A=this;if(!B.isComponent){if(!B.xtype){B=Ext.create("Ext.menu."+(Ext.isBoolean(B.checked)?"Check":"")+"Item",B)}else{B=Ext.ComponentManager.create(B,B.xtype)}}if(B.isMenuItem){B.parentMenu=A}return B},lookupItemFromString:function(A){return(A=="separator"||A=="-")?new Ext.menu.Separator():new Ext.menu.Item({canActivate:false,hideOnClick:false,plain:true,text:A})},configureItem:function(F){var E=this.owner,C=Ext.baseCSSPrefix,A=E.ui,D,B;if(F.isMenuItem){F.setUI(A)}else{if(E.items.getCount()>1&&!F.rendered&&!F.dock){B=E._itemCmpCls;D=[B+" "+B+"-"+A];if(!E.plain&&(F.indent!==false||F.iconCls==="no-icon")){D.push(C+"menu-item-indent-"+A)}if(F.rendered){F.el.addCls(D)}else{F.cls=(F.cls||"")+" "+D.join(" ")}}}this.callParent(arguments)},onClick:function(B){var D=this,A=B.type,C;if(D.disabled){B.stopEvent();return}C=(A!=="keydown")?D.getItemFromEvent(B):D.activeItem;if(C&&C.isMenuItem){if(!C.menu||!D.ignoreParentClicks){C.onClick(B)}else{B.stopEvent()}}if(!C||C.disabled){C=undefined}D.fireEvent("click",D,C,B)},onDestroy:function(){var A=this;Ext.menu.Manager.unregister(A);A.parentMenu=A.ownerButton=null;if(A.rendered){A.el.un(A.mouseMonitor);Ext.destroy(A.keyNav);A.keyNav=null}A.callParent(arguments)},onDocMouseDown:function(A){if(!this.owns(A.target)){this.deactivateActiveItem()}},onMouseLeave:function(A){var B=this;B.deactivateActiveItem();if(B.disabled){return}B.fireEvent("mouseleave",B,A)},onMouseOver:function(A){var D=this,G=A.getRelatedTarget(),F=!D.el.contains(G),C=D.getItemFromEvent(A),B=D.parentMenu,E=D.ownerItem;if(F&&B){B.setActiveItem(E);E.cancelDeferHide();B.mouseMonitor.mouseenter()}if(D.disabled){return}if(C&&!C.activated){D.setActiveItem(C);if(C.activated&&C.expandMenu){C.expandMenu()}}if(F){D.fireEvent("mouseenter",D,A)}D.fireEvent("mouseover",D,C,A)},setActiveItem:function(B){var A=this;if(B&&(B!=A.activeItem)){A.deactivateActiveItem();if(A.canActivateItem(B)){if(B.activate){B.activate(true);if(B.activated){A.activeItem=B;A.focusedItem=B}}else{B.focus();A.focusedItem=B}}}},beforeShow:function(){var B=this,A;if(B.floating){B.savedMaxHeight=B.maxHeight;A=B.container.getViewSize().height;B.maxHeight=Math.min(B.maxHeight||A,A)}B.callParent(arguments)},afterShow:function(){var A=this;A.callParent(arguments);if(A.floating){A.maxHeight=A.savedMaxHeight}},privates:{getFocusEl:function(){return this.focusedItem||this.items.items[0]}}});
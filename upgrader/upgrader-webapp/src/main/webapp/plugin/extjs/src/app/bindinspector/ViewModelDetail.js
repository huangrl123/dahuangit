Ext.define("Ext.app.bindinspector.ViewModelDetail",{extend:"Ext.tree.Panel",alias:"widget.bindinspector-viewmodeldetail",rootVisible:false,cls:Ext.baseCSSPrefix+"bindinspector-viewmodeldetail",inheritedCls:Ext.baseCSSPrefix+"bindinspector-inherited",notInheritedCls:Ext.baseCSSPrefix+"bindinspector-not-inherited",highlightedCls:Ext.baseCSSPrefix+"bindinspector-highlighted",unhighlightedCls:Ext.baseCSSPrefix+"bindinspector-unhighlighted",lastItemCls:Ext.baseCSSPrefix+"bindinspector-last-item",initComponent:function(){var B=this,D=B.vm,C="VM &nbsp;&nbsp;&nbsp;⇒ &nbsp;&nbsp;&nbsp;",A=B.up("bindinspector-container").env,E=A.getCmp(D.view);if(E.reference){C+="["+E.reference+"] &bull; "}B.title=C+=E.id;B.viewConfig={getRowClass:function(M,H,F,L){var I=M.get("hasData"),G=M.get("hasStub"),J=[],K=M.get("highlighted");if(M.get("inherited")){J.push(B.inheritedCls)}else{J.push(B.notInheritedCls)}if(K===true){J.push(B.highlightedCls)}else{if(K===-1){J.push(B.unhighlightedCls)}}if(H===L.getCount()-1){J.push(B.lastItemCls)}if(I&&(!G||M.get("cumulativeBindCount")===0)){J.push(B.dataOnlyCls)}return J.join(" ")}};B.store={model:B.Model,root:{text:"Root",expanded:true,children:B.setupData(D,D.data,D.rootStub)}};B.columns=[{width:40,tdCls:Ext.baseCSSPrefix+"bindinspector-indicator-col",align:"center",scope:B,renderer:B.renderIndicator},{flex:1,xtype:"treecolumn",dataIndex:"name",text:"Name",scope:B,renderer:B.renderName},{flex:1,dataIndex:"value",text:"Value",scope:B,renderer:Ext.app.bindinspector.Util.valueRenderer},{text:"Bind #",width:64,align:"center",renderer:B.renderBindCount,scope:B},{width:40,isSearch:true,renderer:B.dataSrcConsumerRenderer,scope:B}];B.callParent();B.on("cellclick",B.onSearchCellClick,B)},dataOnlyNode:"This item contains data but has nothing requesting the value",stubOnlyNode:"This item has the value requested but no data backing it",dataPointLoading:"Data point is loading (at the time the app snapshot was captured)",dataPointLoadingCls:Ext.baseCSSPrefix+"bindinspector-isloading",zeroBindingCls:Ext.baseCSSPrefix+"bi-zero-bind-count",dataOnlyCls:Ext.baseCSSPrefix+"bindinspector-data-only",stubOnlyCls:Ext.baseCSSPrefix+"bindinspector-stub-only",onSearchCellClick:function(D,B,G,A,C,F,E){if(D.getHeaderCt().getHeaderAtIndex(G).isSearch){this.up("bindinspector-container").fireEvent("vmSearchClick",A)}},getFirstTierRec:function(A){var B=A.parentNode.isRoot(),C;if(!B){A.bubble(function(D){if(D.parentNode.isRoot()){C=D;return false}})}return B?A:C},dataSrcConsumerRenderer:function(C,E,A){var B=this.getFirstTierRec(A),D=B.get("name");E.tdCls=Ext.baseCSSPrefix+"bindinspector-data-search-cell";E.tdAttr='data-qclass="'+Ext.baseCSSPrefix+'componentlist-tip" data-qtip="Click to indicate within the Component List all ViewModels with a data property of &nbsp;<b>'+D+'</b>"'},renderIndicator:function(D,E,C){var J=C.get("ownerVMs"),L=J.length,B=false,A=false,G="",K=this.getFirstTierRec(C),H=K===C,F=K.get("name"),I;Ext.Array.forEach(J,function(M){if(M.id===M.thisVM){B=true}if(M.id!==M.thisVM){A=true}});if(B&&A){G=Ext.util.Format.format('<span style="color:#DB7851;">{0}</span>',H?"◓":"-");I=L>1?"VMs":"VM";E.tdAttr='data-qclass="'+Ext.baseCSSPrefix+'componentlist-tip" data-qtip="<b>'+F+"</b>&nbsp; provided by this VM and "+(L-1)+" ancestor "+I+'"'}else{if(B){G=H?"●":"";E.tdAttr='data-qclass="'+Ext.baseCSSPrefix+'componentlist-tip" data-qtip="<b>'+F+'</b>&nbsp; is provided by this VM"'}else{if(A){G=H?"○":"";I=L>1?"VMs":"VM";E.tdAttr='data-qclass="'+Ext.baseCSSPrefix+'componentlist-tip" data-qtip="<b>'+F+"</b>&nbsp; is provided by "+L+" ancestor "+I+'"'}}}return G},renderBindCount:function(C,F,A){var D=A.get("children").length,G=A.get("bindCount")||0,B,E;C=G;if(C===0){C='<span class="'+this.zeroBindingCls+'">'+C+"</span>"}if(D){B=A.get("cumulativeBindCount")||"?";if(B===0||B==="?"){C+=' / <span class="'+this.zeroBindingCls+'">'+B+"</span>"}else{C+=" / "+B}}E="Bindings Count = <b>"+G+"</b>";if(B&&B!==0&&B!=="?"){E+="<br>Cumulative Bindings Count = <b>"+B+"</b>"}F.tdAttr='data-qclass="'+Ext.baseCSSPrefix+'componentlist-tip" data-qtip="'+E+'"';return C},renderName:function(D,F,A){var B=this,G=A.get("hasData"),C=A.get("hasStub"),E="";if(A.get("isLoading")){F.tdCls=B.dataPointLoadingCls;E+=B.dataPointLoading}else{if(G&&(!C||A.get("cumulativeBindCount")===0)){E+=B.dataOnlyNode}else{if(C&&!G){F.tdCls=B.stubOnlyCls;E+=B.stubOnlyNode}}}if(E!==""){F.tdAttr='data-qclass="'+Ext.baseCSSPrefix+'componentlist-tip" data-qtip="'+E+'"'}return D},setupData:function(K,E,B,C,J){var F={},A=[],N=K.dataMap,I=[],O,G,H,M,L,D;if(E&&Ext.isObject(E)){if(E.isModel){E=E.data;L=true}else{if(E.isStore){L=true;E=null}}if(E){for(M in E){if(!J){I=N[M]?N[M].ownerVMs:[]}O={name:M,value:E[M],inherited:Ext.isDefined(C)?C:!E.hasOwnProperty(M),ownerVMs:Ext.isDefined(J)?J:[],hasData:true};Ext.Array.forEach(I,function(P){O.ownerVMs.push({id:P.id,view:P.view,thisVM:K.id})});H=Ext.app.bindinspector.Util.getChildStub(M,B);if(H){O.hasStub=true;O.isLoading=H.isLoading;O.iconCls=H.isLoading?this.dataPointLoadingCls:"";O.bindCount=H.bindCount;O.cumulativeBindCount=H.cumulativeBindCount;O.stub=H}F[M]=O}}}if(B){G=B.children;for(M in G){H=G[M];O=F[M];if(!O){O={name:M,value:H.value||undefined,inherited:C||false,ownerVMs:J||[],hasData:false,hasStub:true,isLoading:H.isLoading,iconCls:H.isLoading?this.dataPointLoadingCls:"",bindCount:H.bindCount,cumulativeBindCount:H.cumulativeBindCount,stub:H};D=H.linkInfo;if(D&&D.sameTarget){O.value=D.value;O.hasData=O.value!==undefined}F[M]=O}}}for(M in F){O=F[M];O.children=this.setupData(K,O.value,O.stub,O.inherited,O.ownerVMs);delete O.stub;if(O.children&&O.children.length){O.expanded=true;O.leaf=false}else{O.leaf=true}A.push(F[M])}return A}},function(){this.prototype.Model=Ext.define(null,{extend:"Ext.data.TreeModel",fields:["name","value","inherited","hasData","hasStub","isLoading","bindCount","cumulativeBindCount","highlighted"]})});
Ext.define("Ext.grid.ColumnLayout",{extend:"Ext.layout.container.HBox",alias:"layout.gridcolumn",type:"gridcolumn",requires:["Ext.panel.Table"],reserveOffset:false,firstHeaderCls:Ext.baseCSSPrefix+"column-header-first",lastHeaderCls:Ext.baseCSSPrefix+"column-header-last",initLayout:function(){var A=this;if(A.scrollbarWidth===undefined){A.self.prototype.scrollbarWidth=Ext.getScrollbarSize().width}A.grid=A.owner.up("tablepanel");A.controllingGrid=A.owner.up("[scrollerOwner]");A.callParent()},beginLayout:function(B){var H=this,C=H.owner,K=H.controllingGrid,A=H.grid.view,J=H.getVisibleItems(),I=J.length,F=H.firstHeaderCls,E=H.lastHeaderCls,D=[F,E],G,L;if(!A.scrollFlags.y){H.scrollbarWidth=0}else{delete H.scrollbarWidth}for(G=0;G<I;G++){L=J[G];L.margin=null;L.removeCls(D);if(G===0){L.addCls(F)}if(G===I-1){L.addCls(E)}}H.scrollbarAdjustment=H.scrollbarWidth;H.callParent(arguments);if(!C.isColumn&&!K.collapsed&&A&&A.rendered&&(B.viewTable=A.body.dom)&&H.scrollbarWidth){B.viewContext=B.context.getCmp(A)}},injectViewContext:function(B,A){if(!this.controllingGrid.collapsed&&A.rendered&&(B.viewTable=A.body.dom)&&this.scrollbarWidth){B.viewContext=B.context.getCmp(A)}},roundFlex:function(A){return Math.floor(A)},calculate:function(B){var G=this,A=G.grid.view,D,H,F,C,E=false;G.viewScrollX=A.getScrollX();G.callParent(arguments);if(B.state.parallelDone&&G.owner.isRootHeader){D=B.target.getVisibleGridColumns();H=D.length;for(F=0;F<H;F++){C=B.context.getItem(null,D[F].el);if(!C.lastBox||C.props.width!==C.lastBox.width){(E||(E=[])).push(F)}}B.setProp("columnsChanged",E)}if(B.viewContext&&!B.state.tableHeight){B.state.tableHeight=B.viewTable?B.viewTable.offsetHeight:A.all.sumHeights()}},completeLayout:function(B){var A=this,C=A.owner,D=B.state;A.callParent(arguments);if(B.viewTable&&!D.flexesCalculated&&!B.flexedItems.length&&C.forceFit&&A.convertWidthsToFlexes(B)){A.cacheFlexes(B);B.invalidate({state:{flexesCalculated:true,tableHeight:B.viewTable.offsetHeight}})}else{delete B.props.columnChanged}},finishedLayout:function(B){var A=this.grid.getView();this.callParent(arguments);if(this.viewScrollX&&!this.owner.isColumn&&A.scrollFlags.x&&this.owner.tooNarrow&&this.owner.componentLayoutCounter){this.owner.setScrollX(this.viewScrollX)}},convertWidthsToFlexes:function(A){var G=this,E=0,I=G.sizeModels.calculated,C,H,D,B,F;C=A.childItems;H=C.length;for(D=0;D<H;D++){B=C[D];F=B.target;E+=B.props.width;if(!(F.fixed||F.resizable===false)){F.flex=A.childItems[D].flex=B.props.width;F.width=null;B.widthModel=I}}return E!==A.props.width},getContainerSize:function(G){var E=this,C,D=G.viewContext,A,F,B=D&&D.heightModel.shrinkWrap;if(E.owner.isColumn){C=E.getColumnContainerSize(G)}else{C=E.callParent(arguments);if(!C.gotAll){E.done=false;return C}if(E.scrollbarWidth&&!E.controllingGrid.reserveScrollbar&&D){F=D.target.componentLayout.ownerContext;if(!B&&D.target.scrollFlags.y&&(G.flexedItems&&G.flexedItems.length||E.owner.forceFit)&&F){A=D.getProp("height");if(isNaN(A)){E.done=false}else{if(G.state.tableHeight<=A&&D.target.scrollFlags.y){G.state.parallelDone=false;F.invalidate();return C}}}}}if(!B){C.width-=E.scrollbarWidth}return C},getColumnContainerSize:function(B){var C=B.paddingContext.getPaddingInfo(),A=0,D=0,F,H,E,G;if(!B.widthModel.shrinkWrap){++D;E=B.getProp("innerWidth");F=(typeof E=="number");if(F){++A;E-=C.width;if(E<0){E=0}}}if(!B.heightModel.shrinkWrap){++D;G=B.getProp("innerHeight");H=(typeof G=="number");if(H){++A;G-=C.height;if(G<0){G=0}}}return{width:E,height:G,needed:D,got:A,gotAll:A==D,gotWidth:F,gotHeight:H}},publishInnerCtSize:function(D){var C=this,E=C.owner,A=D.state.boxPlan.targetSize,B=D.peek("contentWidth");if((B!=null)&&!E.isColumn){A.width=B;if(E.ownerCt.view.scrollFlags.y){A.width+=C.scrollbarAdjustment}}return C.callParent(arguments)}});
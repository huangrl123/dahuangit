Ext.define("Ext.grid.feature.Summary",{extend:"Ext.grid.feature.AbstractSummary",alias:"feature.summary",dock:undefined,dockedSummaryCls:Ext.baseCSSPrefix+"docked-summary",summaryItemCls:Ext.baseCSSPrefix+"grid-item-summary",panelBodyCls:Ext.baseCSSPrefix+"summary-",scrollPadProperty:"padding-right",hasFeatureEvent:false,init:function(C){var A=this,B=A.view;A.callParent(arguments);if(A.dock){C.headerCt.on({add:A.onStoreUpdate,afterlayout:A.onStoreUpdate,scope:A});C.on({beforerender:function(){var D=[A.summaryTableCls];if(B.columnLines){D[D.length]=B.ownerCt.colLinesCls}A.summaryBar=C.addDocked({childEls:["innerCt","item"],renderTpl:['<div id="{id}-innerCt" data-ref="innerCt" role="presentation">','<table id="{id}-item" data-ref="item" cellPadding="0" cellSpacing="0" class="'+D.join(" ")+'">','<tr class="'+A.summaryRowCls+'"></tr>',"</table>","</div>"],style:"overflow:hidden",itemId:"summaryBar",cls:[A.dockedSummaryCls,A.dockedSummaryCls+"-"+A.dock],xtype:"component",dock:A.dock,weight:10000000})[0]},afterrender:function(){C.body.addCls(A.panelBodyCls+A.dock);B.on("scroll",A.onViewScroll,A);A.onStoreUpdate()},single:true});C.headerCt.afterComponentLayout=Ext.Function.createSequence(C.headerCt.afterComponentLayout,function(){var D=this.getTableWidth(),E=A.summaryBar.innerCt;A.summaryBar.item.setWidth(D);if(this.tooNarrow){D+=Ext.getScrollbarSize().width}E.setWidth(D)})}else{A.view.addFooterFn(A.renderSummaryRow)}C.on({columnmove:A.onStoreUpdate,scope:A});B.mon(B.store,{update:A.onStoreUpdate,datachanged:A.onStoreUpdate,scope:A})},renderSummaryRow:function(D,C,E){var A=D.view,B=A.findFeature("summary");if(B.showSummaryRow){C.push('<table class="'+Ext.baseCSSPrefix+"table-plain "+B.summaryItemCls+'">');B.outputSummaryRecord(B.createSummaryRecord(A),D,C,E);C.push("</table>")}},toggleSummaryRow:function(A){var B=this,C=B.summaryBar;B.callParent(arguments);if(C){C.setVisible(B.showSummaryRow);B.onViewScroll()}},vetoEvent:function(D,C,A,B){return !B.getTarget(this.summaryRowSelector)},onViewScroll:function(){this.summaryBar.setScrollX(this.view.getScrollX())},createSummaryRecord:function(A){var C=A.headerCt.getVisibleGridColumns(),E=this.summaryRecord,H=C.length,D,B,G,J,I,F;if(!E){I=A.store.getModel();F={};F[I.idProperty]=A.id+"-summary-record";E=this.summaryRecord=new I(F)}E.beginEdit();for(D=0;D<H;D++){B=C[D];G=B.dataIndex||B.id;J=this.getSummary(A.store,B.summaryType,G);E.set(G,J);this.setSummaryData(E,B.id,J)}E.endEdit(true);E.commit(true);E.isSummary=true;return E},onStoreUpdate:function(){var D=this,F=D.view,A=D.createSummaryRecord(F),G=F.createRowElement(A,-1).firstChild.firstChild,B,C,E;if(!F.rendered){return}if(D.dock){E=D.summaryBar.item.dom.firstChild;B=E.firstChild}else{B=D.view.getRow(A);E=B?B.parentNode:null}if(E){E.insertBefore(G,B);E.removeChild(B)}if(D.dock){D.onColumnHeaderLayout()}},onColumnHeaderLayout:function(){var D=this.view,G=D.headerCt.getVisibleGridColumns(),F,E=G.length,B,A=this.summaryBar.el,C;for(B=0;B<E;B++){F=G[B];C=A.down(D.getCellSelector(F));if(C){C.setWidth(F.width||(F.lastBox?F.lastBox.width:100))}}}});
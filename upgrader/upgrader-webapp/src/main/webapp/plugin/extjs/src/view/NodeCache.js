Ext.define("Ext.view.NodeCache",{statics:{importElementMethods:Ext.dom.CompositeElementLite.importElementMethods,range:document.createRange&&document.createRange()},constructor:function(A){this.view=A;this.clear();this.el=new Ext.dom.Fly()},clear:function(C){var E=this,D=this.elements,B,A,F=E.statics().range;if(E.count&&C){if(F){F.setStartBefore(D[E.startIndex]);F.setEndAfter(D[E.endIndex]);F.deleteContents()}else{for(B in D){A=D[B];A.parentNode.removeChild(A)}}}E.elements={};E.count=E.startIndex=0;E.endIndex=-1},fill:function(F,D,G){G=G||0;var A=this,C=A.elements={},B,E=F.length-G;if(!D){D=0}for(B=0;B<E;B++){C[D+B]=F[B+G]}A.startIndex=D;A.endIndex=D+E-1;A.count=E;return this},insert:function(F,E){var D=this,B=D.elements,A,C=E.length;if(D.count){if(F>D.endIndex+1||F+E.length-1<D.startIndex){Ext.Error.raise("Discontiguous range would result from inserting "+E.length+" nodes at "+F)}if(F<D.count){for(A=D.endIndex+C;A>=F+C;A--){B[A]=B[A-C];B[A].setAttribute("data-recordIndex",A)}}D.endIndex=D.endIndex+C}else{D.startIndex=F;D.endIndex=F+C-1}for(A=0;A<C;A++,F++){B[F]=E[A];B[F].setAttribute("data-recordIndex",F)}D.count+=C},invoke:function(B,E){var C=this,D,A;B=Ext.dom.Element.prototype[B];for(A=C.startIndex;A<=C.endIndex;A++){D=C.item(A);if(D){B.apply(D,E)}}return this},item:function(C,D){var A=this.elements[C],B=null;if(A){B=D?this.elements[C]:this.el.attach(this.elements[C])}return B},first:function(A){return this.item(this.startIndex,A)},last:function(A){return this.item(this.endIndex,A)},getCount:function(){return this.count},slice:function(E,D){var C=this.elements,A=[],B;if(!D){D=this.endIndex}else{D=Math.min(this.endIndex,D-1)}for(B=E||this.startIndex;B<=D;B++){A.push(C[B])}return A},replaceElement:function(A,D,C){var B=this.elements,E=(typeof A==="number")?A:this.indexOf(A);if(E>-1){D=Ext.getDom(D);if(C){A=B[E];A.parentNode.insertBefore(D,A);Ext.removeNode(A);D.setAttribute("data-recordIndex",E)}this.elements[E]=D}return this},indexOf:function(A){var B=this.elements,C;A=Ext.getDom(A);for(C=this.startIndex;C<=this.endIndex;C++){if(B[C]===A){return C}}return -1},removeRange:function(C,D,H){var G=this,B=G.elements,E,F,A,I;if(D==null){D=G.endIndex+1}else{D=Math.min(G.endIndex+1,D+1)}if(C==null){C=G.startIndex}A=D-C;for(F=C,I=D;F<=G.endIndex;F++,I++){if(H&&F<D){Ext.removeNode(B[F])}if(I<=G.endIndex){E=B[F]=B[I];E.setAttribute("data-recordIndex",F)}else{delete B[F]}}G.count-=A;G.endIndex-=A},removeElement:function(G,J){var H=this,F,I,A=H.elements,D,E,K=0,B,C;if(Ext.isArray(G)){F=G;G=[];E=F.length;for(K=0;K<E;K++){I=F[K];if(typeof I!=="number"){I=H.indexOf(I)}if(I>=H.startIndex&&I<=H.endIndex){G[G.length]=I}}Ext.Array.sort(G);E=G.length}else{if(G<H.startIndex||G>H.endIndex){return}E=1;G=[G]}for(B=C=G[0],K=0;B<=H.endIndex;B++,C++){if(K<E&&B===G[K]){C++;K++;if(J){Ext.removeNode(A[B])}}if(C<=H.endIndex&&C>=H.startIndex){D=A[B]=A[C];D.setAttribute("data-recordIndex",B)}else{delete A[B]}}H.endIndex-=E;H.count-=E},scroll:function(L,E,H){var F=this,J=F.view,G=J.store,I=F.elements,N=L.length,D,P,C,Q,B=J.getNodeContainer(),O=document.createDocumentFragment(),K=J.hasListeners.itemremove,M=J.hasListeners.itemadd,A=F.statics().range;if(E===-1){if(H){if(A){A.setStartBefore(I[(F.endIndex-H)+1]);A.setEndAfter(I[F.endIndex]);A.deleteContents();for(D=(F.endIndex-H)+1;D<=F.endIndex;D++){P=I[D];delete I[D];if(K){J.fireEvent("itemremove",G.getByInternalId(P.getAttribute("data-recordId")),D,P,J)}}}else{for(D=(F.endIndex-H)+1;D<=F.endIndex;D++){P=I[D];delete I[D];P.parentNode.removeChild(P);if(K){J.fireEvent("itemremove",G.getByInternalId(P.getAttribute("data-recordId")),D,P,J)}}}F.endIndex-=H}if(L.length){Q=J.bufferRender(L,F.startIndex-=N);for(D=0;D<N;D++){I[F.startIndex+D]=Q[D];O.appendChild(Q[D])}B.insertBefore(O,B.firstChild);if(M){J.fireEvent("itemadd",L,F.startIndex,Q)}}}else{if(H){C=F.startIndex+H;if(A){A.setStartBefore(I[F.startIndex]);A.setEndAfter(I[C-1]);A.deleteContents();for(D=F.startIndex;D<C;D++){P=I[D];delete I[D];if(K){J.fireEvent("itemremove",G.getByInternalId(P.getAttribute("data-recordId")),D,P,J)}}}else{for(D=F.startIndex;D<C;D++){P=I[D];delete I[D];P.parentNode.removeChild(P);if(K){J.fireEvent("itemremove",G.getByInternalId(P.getAttribute("data-recordId")),D,P,J)}}}F.startIndex=C}Q=J.bufferRender(L,F.endIndex+1);for(D=0;D<N;D++){I[F.endIndex+=1]=Q[D];O.appendChild(Q[D])}B.appendChild(O);if(M){J.fireEvent("itemadd",L,F.endIndex+1,Q)}}F.count=F.endIndex-F.startIndex+1},sumHeights:function(){var B=0,C=this.elements,A;for(A=this.startIndex;A<=this.endIndex;A++){B+=C[A].offsetHeight}return B}},function(){this.importElementMethods()});
Ext.define("Ext.util.KeyMap",{alternateClassName:"Ext.KeyMap",eventName:"keydown",constructor:function(A){var B=this;if((arguments.length!==1)||(typeof A==="string")||A.dom||A.tagName||A===document||A.isComponent){B.legacyConstructor.apply(B,arguments);return}Ext.apply(B,A);B.bindings=[];if(!B.target.isComponent){B.target=Ext.get(B.target)}if(B.binding){B.addBinding(B.binding)}else{if(A.key){B.addBinding(A)}}B.enable()},legacyConstructor:function(A,C,D){var B=this;Ext.apply(B,{target:Ext.get(A),eventName:D||B.eventName,bindings:[]});if(C){B.addBinding(C)}B.enable()},addBinding:function(B){var C=this,E=B.key,A,D;if(C.processing){C.bindings=bindings.slice(0)}if(Ext.isArray(B)){for(A=0,D=B.length;A<D;A++){C.addBinding(B[A])}return}C.bindings.push(Ext.apply({keyCode:C.processKeys(E)},B))},removeBinding:function(B){var D=this,E=D.bindings,F=E.length,A,C,G;if(D.processing){D.bindings=E.slice(0)}G=D.processKeys(B.key);for(A=0;A<F;++A){C=E[A];if((C.fn||C.handler)===(B.fn||B.handler)&&C.scope===B.scope){if(B.alt===C.alt&&B.crtl===C.crtl&&B.shift===C.shift){if(Ext.Array.equals(C.keyCode,G)){Ext.Array.erase(D.bindings,A,1);return}}}}},processKeys:function(D){var E=false,B,F,A,G,C;if(Ext.isString(D)){F=[];A=D.toUpperCase();for(C=0,G=A.length;C<G;++C){F.push(A.charCodeAt(C))}D=F;E=true}if(!Ext.isArray(D)){D=[D]}if(!E){for(C=0,G=D.length;C<G;++C){B=D[C];if(Ext.isString(B)){D[C]=B.toUpperCase().charCodeAt(0)}}}return D},handleTargetEvent:(function(){var A=/input|textarea/i;return function(F){var E=this,D,B,G,H,C;if(E.enabled){D=E.bindings;B=0;G=D.length;F=E.processEvent.apply(E||E.processEventScope,arguments);if(E.ignoreInputFields){H=F.target;C=H.contentEditable;if(A.test(H.tagName)||(C===""||C==="true")){return}}if(!F.getKey){return F}E.processing=true;for(;B<G;++B){E.processBinding(D[B],F)}E.processing=false}}}()),processEvent:Ext.identityFn,processBinding:function(B,D){if(this.checkModifiers(B,D)){var H=D.getKey(),F=B.fn||B.handler,C=B.scope||this,I=B.keyCode,G=B.defaultEventAction,E,A;for(E=0,A=I.length;E<A;++E){if(H===I[E]){if(F.call(C,H,D)!==true&&G){D[G]()}break}}}},checkModifiers:function(C,D){var E=["shift","ctrl","alt"],B=0,F=E.length,G,A;for(;B<F;++B){A=E[B];G=C[A];if(!(G===undefined||(G===D[A+"Key"]))){return false}}return true},on:function(A,D,F){var E,C,G,B;if(Ext.isObject(A)&&!Ext.isArray(A)){E=A.key;C=A.shift;G=A.ctrl;B=A.alt}else{E=A}this.addBinding({key:E,shift:C,ctrl:G,alt:B,fn:D,scope:F})},un:function(A,D,F){var E,C,G,B;if(Ext.isObject(A)&&!Ext.isArray(A)){E=A.key;C=A.shift;G=A.ctrl;B=A.alt}else{E=A}this.removeBinding({key:E,shift:C,ctrl:G,alt:B,fn:D,scope:F})},isEnabled:function(){return this.enabled},enable:function(){var A=this;if(!A.enabled){A.target.on(A.eventName,A.handleTargetEvent,A);A.enabled=true}},disable:function(){var A=this;if(A.enabled){A.target.removeListener(A.eventName,A.handleTargetEvent,A);A.enabled=false}},setDisabled:function(A){if(A){this.disable()}else{this.enable()}},destroy:function(B){var A=this,C=A.target;A.bindings=[];A.disable();if(B){C.destroy()}delete A.target}});
Ext.define("Ext.layout.ContextItem",{requires:["Ext.layout.ClassList"],heightModel:null,widthModel:null,sizeModel:null,optOut:false,ownerSizePolicy:null,boxChildren:null,boxParent:null,children:[],dirty:null,dirtyCount:0,hasRawContent:true,isContextItem:true,isTopLevel:false,consumersContentHeight:0,consumersContentWidth:0,consumersContainerHeight:0,consumersContainerWidth:0,consumersHeight:0,consumersWidth:0,ownerCtContext:null,remainingChildDimensions:0,props:null,state:null,wrapsComponent:false,constructor:function(Q){var I=this,D=Ext.layout.SizeModel.sizeModels,M=D.configured,O=D.shrinkWrap,R,B,L,S,C,E,N,F,A,G,P,H,K,J;Ext.apply(I,Q);R=I.el;I.id=R.id;I.flushedProps={};I.props=C={};I.styles={};N=I.target;if(!N.isComponent){B=R.lastBox}else{I.wrapsComponent=true;I.framing=N.frameSize||null;I.isComponentChild=N.ownerLayout&&N.ownerLayout.isComponentLayout;B=N.lastBox;L=N.ownerCt;if(L&&(S=L.el&&I.context.items[L.el.id])){I.ownerCtContext=S}I.sizeModel=E=N.getSizeModel(S&&S.widthModel.pairsByHeightOrdinal[S.heightModel.ordinal]);I.widthModel=H=E.width;I.heightModel=K=E.height;if(B&&B.invalid===false){G=(N.width===(F=B.width));P=(N.height===(A=B.height));if(H===O&&K===O){J=true}else{if(H===M&&G){J=K===O||(K===M&&P)}}if(J){I.optOut=true;C.width=F;C.height=A}}}I.lastBox=B},init:function(J,N){var G=this,H=G.props,O=G.dirty,T=G.ownerCtContext,A=G.target.ownerLayout,C=!G.state,S=J||C,K,E,F,I,D,P,Q=G.heightModel,R=G.widthModel,M,B,L=0;G.dirty=G.invalid=false;G.props={};G.remainingChildDimensions=0;if(G.boxChildren){G.boxChildren.length=0}if(!C){G.clearAllBlocks("blocks");G.clearAllBlocks("domBlocks")}if(!G.wrapsComponent){return S}P=G.target;G.state={};if(C){if(P.beforeLayout&&P.beforeLayout!==Ext.emptyFn){P.beforeLayout()}if(!T&&(I=P.ownerCt)){T=G.context.items[I.el.id]}if(T){G.ownerCtContext=T;G.isBoxParent=A&&A.isItemBoxParent(G)}else{G.isTopLevel=true}G.frameBodyContext=G.getEl("frameBody")}else{T=G.ownerCtContext;G.isTopLevel=!T;K=G.children;for(E=0,F=K.length;E<F;++E){K[E].init(true)}}G.hasRawContent=!(P.isContainer&&P.items.items.length>0);if(J){G.widthModel=G.heightModel=null;D=P.getSizeModel(T&&T.widthModel.pairsByHeightOrdinal[T.heightModel.ordinal]);if(C){G.sizeModel=D}G.widthModel=D.width;G.heightModel=D.height;if(T&&!G.isComponentChild){if(A.needsItemSize||!P.liquidLayout){T.remainingChildDimensions+=2}else{if(G.widthModel.calculated){++T.remainingChildDimensions}if(G.heightModel.calculated){++T.remainingChildDimensions}}}}else{if(H){G.recoverProp("x",H,O);G.recoverProp("y",H,O);if(G.widthModel.calculated){G.recoverProp("width",H,O)}else{if("width" in H){++L}}if(G.heightModel.calculated){G.recoverProp("height",H,O)}else{if("height" in H){++L}}if(T&&!G.isComponentChild){T.remainingChildDimensions+=L}}}if(H&&A&&A.manageMargins){G.recoverProp("margin-top",H,O);G.recoverProp("margin-right",H,O);G.recoverProp("margin-bottom",H,O);G.recoverProp("margin-left",H,O)}if(N){M=N.heightModel;B=N.widthModel;if(B&&M&&R&&Q){if(R.shrinkWrap&&Q.shrinkWrap){if(B.constrainedMax&&M.constrainedMin){M=null}}}if(B){G.widthModel=B}if(M){G.heightModel=M}if(N.state){Ext.apply(G.state,N.state)}}return S},initContinue:function(F){var C=this,A=C.ownerCtContext,G=C.target,E=C.widthModel,D=G.getInherited(),B;if(E.fixed){D.inShrinkWrapTable=false}else{delete D.inShrinkWrapTable}if(F){if(A&&E.shrinkWrap){B=A.isBoxParent?A:A.boxParent;if(B){B.addBoxChild(C)}}else{if(E.natural){C.boxParent=A}}}return F},initDone:function(C){var A=this,B=A.props,D=A.state;if(A.remainingChildDimensions===0){B.containerChildrenSizeDone=true}if(C){B.containerLayoutDone=true}if(A.boxChildren&&A.boxChildren.length&&A.widthModel.shrinkWrap){A.el.setWidth(10000);D.blocks=(D.blocks||0)+1}},initAnimation:function(){var B=this,C=B.target,A=B.ownerCtContext;if(A&&A.isTopLevel){B.animatePolicy=C.ownerLayout.getAnimatePolicy(B)}else{if(!A&&C.isCollapsingOrExpanding&&C.animCollapse){B.animatePolicy=C.componentLayout.getAnimatePolicy(B)}}if(B.animatePolicy){B.context.queueAnimation(B)}},addCls:function(A){this.getClassList().addMany(A)},removeCls:function(A){this.getClassList().removeMany(A)},addBlock:function(D,E,F){var B=this,C=B[D]||(B[D]={}),A=C[F]||(C[F]={});if(!A[E.id]){A[E.id]=E;++E.blockCount;++B.context.blockCount}},addBoxChild:function(A){var B=this,D,C=A.widthModel;A.boxParent=this;A.measuresBox=C.shrinkWrap?A.hasRawContent:C.natural;if(A.measuresBox){D=B.boxChildren;if(D){D.push(A)}else{B.boxChildren=[A]}}},addPositionStyles:function(B,C){var D=C.x,E=C.y,A=0;if(D!==undefined){B.left=D+"px";++A}if(E!==undefined){B.top=E+"px";++A}return A},addTrigger:function(A,D){var F=this,G=D?"domTriggers":"triggers",B=F[G]||(F[G]={}),C=F.context,E=C.currentLayout,H=B[A]||(B[A]={});if(!H[E.id]){H[E.id]=E;++E.triggerCount;H=C.triggers[D?"dom":"data"];(H[E.id]||(H[E.id]=[])).push({item:this,prop:A});if(F.props[A]!==undefined){if(!D||!(F.dirty&&(A in F.dirty))){++E.firedTriggers}}}},boxChildMeasured:function(){var B=this,C=B.state,A=(C.boxesMeasured=(C.boxesMeasured||0)+1);if(A==B.boxChildren.length){C.clearBoxWidth=1;++B.context.progressCount;B.markDirty()}},borderNames:["border-top-width","border-right-width","border-bottom-width","border-left-width"],marginNames:["margin-top","margin-right","margin-bottom","margin-left"],paddingNames:["padding-top","padding-right","padding-bottom","padding-left"],trblNames:["top","right","bottom","left"],cacheMissHandlers:{borderInfo:function(A){var B=A.getStyles(A.borderNames,A.trblNames);B.width=B.left+B.right;B.height=B.top+B.bottom;return B},marginInfo:function(A){var B=A.getStyles(A.marginNames,A.trblNames);B.width=B.left+B.right;B.height=B.top+B.bottom;return B},paddingInfo:function(B){var A=B.frameBodyContext||B,C=A.getStyles(B.paddingNames,B.trblNames);C.width=C.left+C.right;C.height=C.top+C.bottom;return C}},checkCache:function(A){return this.cacheMissHandlers[A](this)},clearAllBlocks:function(B){var A=this[B],C;if(A){for(C in A){this.clearBlocks(B,C)}}},clearBlocks:function(D,G){var C=this[D],A=C&&C[G],B,E,F;if(A){delete C[G];B=this.context;for(F in A){E=A[F];--B.blockCount;if(!--E.blockCount&&!E.pending&&!E.done){B.queueLayout(E)}}}},block:function(A,B){this.addBlock("blocks",A,B)},domBlock:function(A,B){this.addBlock("domBlocks",A,B)},fireTriggers:function(D,G){var C=this[D],E=C&&C[G],A=this.context,B,F;if(E){for(F in E){B=E[F];++B.firedTriggers;if(!B.done&&!B.blockCount&&!B.pending){A.queueLayout(B)}}}},flush:function(){var A=this,D=A.dirty,C=A.state,B=A.el;A.dirtyCount=0;if(A.classList&&A.classList.dirty){A.classList.flush()}if("attributes" in A){B.set(A.attributes);delete A.attributes}if("innerHTML" in A){B.innerHTML=A.innerHTML;delete A.innerHTML}if(C&&C.clearBoxWidth){C.clearBoxWidth=0;A.el.setStyle("width",null);if(!--C.blocks){A.context.queueItemLayouts(A)}}if(D){delete A.dirty;A.writeProps(D,true)}},flushAnimations:function(){var A=this,H=A.previousSize,G,L,F,J,K,B,E,M,C,I,D;if(H){G=A.target;L=G.getAnimationProps();F=L.duration;J=Ext.Object.getKeys(A.animatePolicy);K=Ext.apply({},{from:{},to:{},duration:F||Ext.fx.Anim.prototype.duration},L);for(B=0,E=0,M=J.length;E<M;E++){C=J[E];I=H[C];D=A.peek(C);if(I!=D){C=A.translateProps[C]||C;K.from[C]=I;K.to[C]=D;++B}}if(B){if(A.isCollapsingOrExpanding===1){G.componentLayout.undoLayout(A)}else{A.writeProps(K.from)}A.el.animate(K);Ext.fx.Manager.getFxQueue(A.el.id)[0].on({afteranimate:function(){if(A.isCollapsingOrExpanding===1){G.componentLayout.redoLayout(A);G.afterCollapse(true)}else{if(A.isCollapsingOrExpanding===2){G.afterExpand(true)}}}})}}},getBorderInfo:function(){var A=this,B=A.borderInfo;if(!B){A.borderInfo=B=A.checkCache("borderInfo")}return B},getClassList:function(){return this.classList||(this.classList=new Ext.layout.ClassList(this))},getEl:function(F,D){var C=this,E,A,B;if(F){if(F.dom){A=F}else{E=C.target;if(D){E=D}A=E[F];if(typeof A=="function"){A=A.call(E);if(A===C.el){return this}}}if(A){B=C.context.getEl(C,A)}}return B||null},getFrameInfo:function(){var C=this,D=C.frameInfo,B,A;if(!D){B=C.framing;A=C.getBorderInfo();C.frameInfo=D=B?{top:B.top+A.top,right:B.right+A.right,bottom:B.bottom+A.bottom,left:B.left+A.left,width:B.width+A.width,height:B.height+A.height}:A}return D},getMarginInfo:function(){var C=this,E=C.marginInfo,G,D,B,F,A;if(!E){if(!C.wrapsComponent){E=C.checkCache("marginInfo")}else{G=C.target;F=G.ownerLayout;A=F?F.id:null;D=F&&F.manageMargins;E=G.margin$;if(E&&E.ownerId!==A){E=null}if(!E){E=C.parseMargins(G,G.margin)||C.checkCache("marginInfo");if(D){C.setProp("margin-top",0);C.setProp("margin-right",0);C.setProp("margin-bottom",0);C.setProp("margin-left",0)}E.ownerId=A;G.margin$=E}E.width=E.left+E.right;E.height=E.top+E.bottom}C.marginInfo=E}return E},clearMarginCache:function(){delete this.marginInfo;delete this.target.margin$},getPaddingInfo:function(){var A=this,B=A.paddingInfo;if(!B){A.paddingInfo=B=A.checkCache("paddingInfo")}return B},getProp:function(C){var B=this,A=B.props[C];B.addTrigger(C);return A},getDomProp:function(C){var B=this,A=(B.dirty&&(C in B.dirty))?undefined:B.props[C];B.addTrigger(C,true);return A},getStyle:function(A){var B=this,C=B.styles,E,D;if(A in C){D=C[A]}else{E=B.styleInfo[A];D=B.el.getStyle(A);if(E&&E.parseInt){D=parseInt(D,10)||0}C[A]=D}return D},getStyles:function(I,G){var A=this,M=A.styles,L={},B=0,J=I.length,K,D,F,C,N,O,E,H;G=G||I;for(K=0;K<J;++K){C=I[K];if(C in M){L[G[K]]=M[C];++B;if(K&&B==1){D=I.slice(0,K);F=G.slice(0,K)}}else{if(B){(D||(D=[])).push(C);(F||(F=[])).push(G[K])}}}if(B<J){D=D||I;F=F||G;O=A.styleInfo;E=A.el.getStyle(D);for(K=D.length;K--;){C=D[K];N=O[C];H=E[C];if(N&&N.parseInt){H=parseInt(H,10)||0}L[F[K]]=H;M[C]=H}}return L},hasProp:function(A){return this.getProp(A)!=null},hasDomProp:function(A){return this.getDomProp(A)!=null},invalidate:function(A){this.context.queueInvalidate(this,A)},markDirty:function(){if(++this.dirtyCount==1){this.context.queueFlush(this)}},onBoxMeasured:function(){var A=this.boxParent,B=this.state;if(A&&A.widthModel.shrinkWrap&&!B.boxMeasured&&this.measuresBox){B.boxMeasured=1;A.boxChildMeasured()}},parseMargins:function(D,C){if(C===true){C=5}var A=typeof C,B;if(A=="string"||A=="number"){B=D.parseBox(C)}else{if(C){B={top:0,right:0,bottom:0,left:0};if(C){C=Ext.apply(B,D.parseBox(C))}}}return B},peek:function(A){return this.props[A]},recoverProp:function(F,E,A){var C=this,D=C.props,B;if(F in E){D[F]=E[F];if(A&&F in A){B=C.dirty||(C.dirty={});B[F]=A[F]}}},redo:function(B){var C=this,E,D,A;C.revertProps(C.props);if(B&&C.wrapsComponent){if(C.childItems){for(A=0,E=C.childItems,D=E.length;A<D;A++){E[A].redo(B)}}for(A=0,E=C.children,D=E.length;A<D;A++){E[A].redo()}}},removeEl:function(E,C){var B=this,D,A;if(E){if(E.dom){A=E}else{D=B.target;if(C){D=C}A=D[E];if(typeof A=="function"){A=A.call(D);if(A===B.el){return this}}}if(A){B.context.removeEl(B,A)}}},revertProps:function(C){var B,D=this.flushedProps,A={};for(B in C){if(D.hasOwnProperty(B)){A[B]=C[B]}}this.writeProps(A)},setAttribute:function(B,C){var A=this;if(!A.attributes){A.attributes={}}A.attributes[B]=C;A.markDirty()},setBox:function(A){var B=this;if("left" in A){B.setProp("x",A.left)}if("top" in A){B.setProp("y",A.top)}B.setSize(A.width,A.height)},setContentHeight:function(A,B){if(!B&&this.hasRawContent){return 1}return this.setProp("contentHeight",A)},setContentWidth:function(B,A){if(!A&&this.hasRawContent){return 1}return this.setProp("contentWidth",B)},setContentSize:function(C,A,B){return this.setContentWidth(C,B)+this.setContentHeight(A,B)==2},setProp:function(F,D,B){var C=this,A=typeof D,E;if(A=="undefined"||(A==="number"&&isNaN(D))){return 0}if(C.props[F]===D){return 1}C.props[F]=D;++C.context.progressCount;if(B===false){C.fireTriggers("domTriggers",F);C.clearBlocks("domBlocks",F)}else{E=C.styleInfo[F];if(E){if(!C.dirty){C.dirty={}}C.dirty[F]=D;C.markDirty()}}C.fireTriggers("triggers",F);C.clearBlocks("blocks",F);return 1},setHeight:function(A,C){var F=this,D=F.target,J=F.ownerCtContext,I,E,B,G,H;if(A<0){A=0}if(!F.wrapsComponent){if(!F.setProp("height",A,C)){return NaN}}else{B=F.collapsedVert?0:(D.minHeight||0);A=Ext.Number.constrain(A,B,D.maxHeight);G=F.props.height;if(!F.setProp("height",A,C)){return NaN}if(J&&!F.isComponentChild&&isNaN(G)){H=--J.remainingChildDimensions;if(!H){J.setProp("containerChildrenSizeDone",true)}}I=F.frameBodyContext;if(I){E=F.getFrameInfo();I[F.el.vertical?"setWidth":"setHeight"](A-E.height,C)}}return A},setWidth:function(F,C){var G=this,D=G.target,J=G.ownerCtContext,I,E,B,A,H;if(F<0){F=0}if(!G.wrapsComponent){if(!G.setProp("width",F,C)){return NaN}}else{B=G.collapsedHorz?0:(D.minWidth||0);F=Ext.Number.constrain(F,B,D.maxWidth);A=G.props.width;if(!G.setProp("width",F,C)){return NaN}if(J&&!G.isComponentChild&&isNaN(A)){H=--J.remainingChildDimensions;if(!H){J.setProp("containerChildrenSizeDone",true)}}I=G.frameBodyContext;if(I){E=G.getFrameInfo();I.setWidth(F-E.width,C)}}return F},setSize:function(B,A,C){this.setWidth(B,C);this.setHeight(A,C)},translateProps:{x:"left",y:"top"},undo:function(B){var C=this,E,D,A;C.revertProps(C.lastBox);if(B&&C.wrapsComponent){if(C.childItems){for(A=0,E=C.childItems,D=E.length;A<D;A++){E[A].undo(B)}}for(A=0,E=C.children,D=E.length;A<D;A++){E[A].undo()}}},unsetProp:function(B){var A=this.dirty;delete this.props[B];if(A){delete A[B]}},writeProps:function(F,G){if(!(F&&typeof F=="object")){Ext.Logger.warn("writeProps expected dirtyProps to be an object");return}var B=this,Q=B.el,N={},H=0,P=B.styleInfo,A,C,M,K=F.width,R=F.height,O=B.target,D,L,E,J,S,I;if("displayed" in F){Q.setDisplayed(F.displayed)}for(C in F){if(G){B.fireTriggers("domTriggers",C);B.clearBlocks("domBlocks",C);B.flushedProps[C]=1}A=P[C];if(A&&A.dom){if(A.suffix&&(M=parseInt(F[C],10))){N[C]=M+A.suffix}else{N[C]=F[C]}++H}}if("x" in F||"y" in F){if(O.isComponent){O.setPosition(F.x,F.y)}else{H+=B.addPositionStyles(N,F)}}if(B.wrapsComponent&&Ext.isIE9){if((D=K!==undefined&&B.hasOverflowY)||(L=R!==undefined&&B.hasOverflowX)){E=B.isAbsolute;if(E===undefined){E=false;I=B.target.getTargetEl();S=I.getStyle("position");B.isAbsolute=(S==="absolute")}if(E){J=Ext.getScrollbarSize();if(D){K=parseInt(K,10)+J.width;N.width=K+"px";++H}if(L){R=parseInt(R,10)+J.height;N.height=R+"px";++H}}}}if(H){Q.setStyle(N)}},debugHooks:{$enabled:false,addBlock:function(A,B,C){(B.blockedBy||(B.blockedBy={}))[this.id+"."+C+(A.substring(0,3)=="dom"?":dom":"")]=1;return this.callParent(arguments)},addBoxChild:function(A){var C=this.callParent(arguments),D=this.boxChildren,B;if(D&&D.length==1){B=this.context.boxParents||(this.context.boxParents=new Ext.util.MixedCollection());B.add(this)}return C},addTrigger:function(D,A){var B=this.context.currentLayout,C;this.callParent(arguments);C=this.context.triggersByLayoutId;(C[B.id]||(C[B.id]={}))[this.id+"."+D+(A?":dom":"")]={item:this,name:D}},checkAuthority:function(D){var B=this,F=B[D+"Model"],E=B.context.currentLayout,A,C;if(E==B.target.ownerLayout){A=F.calculated}else{if(E.isComponentLayout){A=B.isTopLevel||F.auto||F.configured}}if(!A){C=B.context.getLayoutName(E);Ext.log(C+" cannot set "+D)}},clearBlocks:function(D,G){var C=this[D],A=C&&C[G],B=this.id+"."+G+(D.substring(0,3)=="dom"?":dom":""),E,F;if(A){for(F in A){E=A[F];delete E.blockedBy[B]}}return this.callParent(arguments)},getEl:function(A){var B=this.callParent(arguments);if(B&&B!==this&&B.parent!==this){Ext.Error.raise({msg:"Got element from wrong component"})}return B},init:function(){var A=this,B;B=A.callParent(arguments);if(A.context.logOn.initItem){Ext.log(A.id," consumers: content=",A.consumersContentWidth,"/",A.consumersContentHeight,", container=",A.consumersContainerWidth,"/",A.consumersContainerHeight,", size=",A.consumersWidth,"/",A.consumersHeight)}return B},invalidate:function(){if(this.wrapsComponent){if(this.context.logOn.invalidate){Ext.log("invalidate: ",this.id)}}else{Ext.Error.raise({msg:"Cannot invalidate an element contextItem"})}return this.callParent(arguments)},setProp:function(A,C,B){var F=this,D=F.context.currentLayout,H=F.context.getLayoutName(D),E=F.id+"."+A,G;if(C!==null){G=F.setBy||(F.setBy={});if(!G[A]){G[A]=H}else{if(G[A]!=H){Ext.log({level:"warn"},"BAD! ",E," set by ",G[A]," and ",H)}}}if(F.context.logOn.setProp){if(typeof C!="undefined"&&!isNaN(C)&&F.props[A]!==C){Ext.log("set ",E," = ",C," (",B,")")}}return this.callParent(arguments)},setHeight:function(A,C,B){if(!B&&this.wrapsComponent){this.checkAuthority("height")}return this.callParent(arguments)},setWidth:function(B,C,A){if(!A&&this.wrapsComponent){this.checkAuthority("width")}return this.callParent(arguments)}}},function(){var B={dom:true,parseInt:true,suffix:"px"},A={dom:true},C={dom:false};this.prototype.styleInfo={containerChildrenSizeDone:C,containerLayoutDone:C,displayed:C,done:C,x:C,y:C,columnWidthsDone:C,left:B,top:B,right:B,bottom:B,width:B,height:B,"border-top-width":B,"border-right-width":B,"border-bottom-width":B,"border-left-width":B,"margin-top":B,"margin-right":B,"margin-bottom":B,"margin-left":B,"padding-top":B,"padding-right":B,"padding-bottom":B,"padding-left":B,"line-height":A,display:A}});
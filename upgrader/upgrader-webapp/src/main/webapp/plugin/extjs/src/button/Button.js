Ext.define("Ext.button.Button",{alias:"widget.button",extend:"Ext.Component",requires:["Ext.dom.ButtonElement","Ext.button.Manager","Ext.menu.Manager","Ext.util.ClickRepeater","Ext.util.TextMetrics","Ext.util.KeyMap"],mixins:["Ext.mixin.Queryable"],alternateClassName:"Ext.Button",config:{iconAlign:"left",text:null,textAlign:"center",arrowVisible:true},isButton:true,_syncFrameHeight:true,liquidLayout:true,hidden:false,disabled:false,pressed:false,tabIndex:0,enableToggle:false,menuAlign:"tl-bl?",showEmptyMenu:false,clickEvent:"click",preventDefault:true,handleMouseEvents:true,tooltipType:"qtip",baseCls:Ext.baseCSSPrefix+"btn",hrefTarget:"_blank",destroyMenu:true,ariaRole:"button",defaultBindProperty:"text",childEls:["btnEl","btnWrap","btnInnerEl","btnIconEl"],publishes:{pressed:1},menuClickBuffer:250,focusCls:"focus",_btnWrapCls:Ext.baseCSSPrefix+"btn-wrap",_btnCls:Ext.baseCSSPrefix+"btn-button",_baseIconCls:Ext.baseCSSPrefix+"btn-icon-el",_glyphCls:Ext.baseCSSPrefix+"btn-glyph",_innerCls:Ext.baseCSSPrefix+"btn-inner",_textCls:Ext.baseCSSPrefix+"btn-text",_noTextCls:Ext.baseCSSPrefix+"btn-no-text",_hasIconCls:Ext.baseCSSPrefix+"btn-icon",_pressedCls:Ext.baseCSSPrefix+"btn-pressed",overCls:Ext.baseCSSPrefix+"btn-over",_disabledCls:Ext.baseCSSPrefix+"btn-disabled",_menuActiveCls:Ext.baseCSSPrefix+"btn-menu-active",_operaArrowCls:Ext.baseCSSPrefix+"opera12m-btn-arrow",renderTpl:'<span id="{id}-btnWrap" data-ref="btnWrap" role="presentation" unselectable="on" style="{btnWrapStyle}" class="{btnWrapCls} {btnWrapCls}-{ui} {splitCls}{childElCls}"><span id="{id}-btnEl" data-ref="btnEl" role="presentation" unselectable="on" style="{btnElStyle}" class="{btnCls} {btnCls}-{ui} {textCls} {noTextCls} {hasIconCls} {iconAlignCls} {textAlignCls} {btnElAutoHeightCls}{childElCls}"><tpl if="iconBeforeText">{[values.$comp.renderIcon(values)]}</tpl><span id="{id}-btnInnerEl" data-ref="btnInnerEl" role="presentation" unselectable="on" class="{innerCls} {innerCls}-{ui}{childElCls}">{text}</span><tpl if="!iconBeforeText">{[values.$comp.renderIcon(values)]}</tpl></span></span>{[values.$comp.getAfterMarkup ? values.$comp.getAfterMarkup(values) : ""]}<tpl if="closable"><span id="{id}-closeEl" data-ref="closeEl" role="presentation" class="{baseCls}-close-btn"<tpl if="closeText"> title="{closeText}" aria-label="{closeText}"</tpl>></span></tpl>',iconTpl:'<span id="{id}-btnIconEl" data-ref="btnIconEl" role="presentation" unselectable="on" class="{baseIconCls} {baseIconCls}-{ui} {iconCls} {glyphCls}{childElCls}" style="<tpl if="iconUrl">background-image:url({iconUrl});</tpl><tpl if="glyph && glyphFontFamily">font-family:{glyphFontFamily};</tpl>"><tpl if="glyph">&#{glyph};</tpl><tpl if="iconCls || iconUrl">&#160;</tpl></span>',scale:"small",allowedScales:["small","medium","large"],arrowAlign:"right",arrowCls:"arrow",maskOnDisable:false,shrinkWrap:3,frame:true,autoEl:{tag:"a",hidefocus:"on",unselectable:"on"},hasFrameTable:function(){return this.href&&this.frameTable},frameTableListener:function(){if(!this.disabled){this.doNavigate()}},doNavigate:function(){if(this.hrefTarget==="_blank"){window.open(this.getHref(),this.hrefTarget)}else{location.href=this.getHref()}},_triggerRegion:{},initComponent:function(){var A=this;A.addCls(Ext.baseCSSPrefix+"unselectable");if(Ext.isOpera12m&&(A.split||A.menu)&&A.getArrowVisible()){A.addCls(A._operaArrowCls+"-"+A.arrowAlign)}A.callParent(arguments);if(A.menu){A.split=true;A.setMenu(A.menu,false)}if(A.url){A.href=A.url}if(A.href&&!A.hasOwnProperty("preventDefault")){A.preventDefault=false}if(Ext.isString(A.toggleGroup)&&A.toggleGroup!==""){A.enableToggle=true}if(A.html&&!A.text){A.text=A.html;delete A.html}},getElConfig:function(){var C=this,B=C.callParent(),A=C.getHref(),D=C.hrefTarget;if(B.tag==="a"){if(!C.disabled){B.tabIndex=C.tabIndex}if(A){B.href=(C.disabled&&Ext.os.is.ios)?null:A;if(D){B.target=D}}}return B},beforeRender:function(){this.callParent();if(this.pressed){this.addCls(this._pressedCls)}},initRenderData:function(){return Ext.apply(this.callParent(),this.getTemplateArgs())},getMenu:function(){return this.menu||null},setMenu:function(D,A){var B=this,C=B.menu;if(C&&A!==false&&B.destroyMenu){C.destroy()}if(C){delete C.ownerButton}if(D){D=Ext.menu.Manager.get(D);D.ownerButton=B;B.mon(D,{scope:B,show:B.onMenuShow,hide:B.onMenuHide});if(!C&&B.getArrowVisible()){B.split=true;if(B.rendered){B._addSplitCls();B.updateLayout()}}B.menu=D}else{if(B.rendered){B._removeSplitCls();B.updateLayout()}B.split=false;B.menu=null}},onRender:function(){var B=this,D,C,A;B.doc=Ext.getDoc();B.callParent(arguments);C=B.el;if(B.tooltip){B.setTooltip(B.tooltip,true)}if(B.handleMouseEvents){A={scope:B,mouseover:B.onMouseOver,mouseout:B.onMouseOut,mousedown:B.onMouseDown};if(B.split){A.mousemove=B.onMouseMove}}else{A={scope:B}}if(Ext.supports.Touch){A.touchstart=B.onTouchStart}if(B.menu){B.keyMap=new Ext.util.KeyMap({target:B.el,key:Ext.event.Event.prototype.DOWN,handler:B.onDownKey,scope:B})}if(B.repeat){B.mon(new Ext.util.ClickRepeater(C,Ext.isObject(B.repeat)?B.repeat:{}),"click",B.onRepeatClick,B)}else{if(A[B.clickEvent]){D=true}else{A[B.clickEvent]=B.onClick}}B.mon(C,A);if(B.hasFrameTable()){B.mon(B.frameTable,"click",B.frameTableListener,B)}if(D){B.mon(C,B.clickEvent,B.onClick,B)}Ext.button.Manager.register(B)},getTemplateArgs:function(){var I=this,G=I._btnCls,J=I._baseIconCls,D=I.getIconAlign(),B=I.glyph,H=Ext._glyphFontFamily,F=I.text,A=I._hasIcon(),E=I._hasIconCls,C;if(typeof B==="string"){C=B.split("@");B=C[0];H=C[1]}return{innerCls:I._innerCls,splitCls:I.getArrowVisible()?I.getSplitCls():"",iconUrl:I.icon,iconCls:I.iconCls,glyph:B,glyphCls:B?I._glyphCls:"",glyphFontFamily:H,text:F||"&#160;",closeText:I.closeText,textCls:F?I._textCls:"",noTextCls:F?"":I._noTextCls,hasIconCls:A?E:"",btnWrapCls:I._btnWrapCls,btnWrapStyle:I.width?"table-layout:fixed;":"",btnElStyle:I.height?"height:auto;":"",btnCls:G,baseIconCls:J,iconBeforeText:D==="left"||D==="top",iconAlignCls:A?(E+"-"+D):"",textAlignCls:G+"-"+I.getTextAlign()}},renderIcon:function(A){return this.getTpl("iconTpl").apply(A)},setHref:function(A){var B=this;B.href=A;B.el.dom.href=(B.disabled&&Ext.os.is.ios)?null:B.getHref()},getHref:function(){var B=this,A=B.href;return A?Ext.urlAppend(A,Ext.Object.toQueryString(Ext.apply({},B.params,B.baseParams))):false},setParams:function(B){var A=this;A.params=B;A.el.dom.href=(A.disabled&&Ext.os.is.ios)?null:A.getHref()},getSplitCls:function(){var A=this;return A.split?(A.baseCls+"-"+A.arrowCls)+" "+(A.baseCls+"-"+A.arrowCls+"-"+A.arrowAlign):""},setIcon:function(D){D=D||"";var C=this,A=C.btnIconEl,B=C.icon||"";C.icon=D;if(D!=B){if(A){A.setStyle("background-image",D?"url("+D+")":"");C._syncHasIconCls();if(C.didIconStateChange(B,D)){C.updateLayout()}}C.fireEvent("iconchange",C,B,D)}return C},setIconCls:function(B){B=B||"";var C=this,A=C.btnIconEl,D=C.iconCls||"";C.iconCls=B;if(D!=B){if(A){A.removeCls(D);A.addCls(B);C._syncHasIconCls();if(C.didIconStateChange(D,B)){C.updateLayout()}}C.fireEvent("iconchange",C,D,B)}return C},setGlyph:function(F){F=F||0;var D=this,A=D.btnIconEl,E=D.glyph,B=D._glyphCls,G,C;D.glyph=F;if(A){if(typeof F==="string"){C=F.split("@");F=C[0];G=C[1]||Ext._glyphFontFamily}if(!F){A.dom.innerHTML="";A.removeCls(B)}else{if(E!=F){A.dom.innerHTML="&#"+F+";";A.addCls(B)}}if(G){A.setStyle("font-family",G)}D._syncHasIconCls();if(D.didIconStateChange(E,F)){D.updateLayout()}}D.fireEvent("glyphchange",D,D.glyph,E);return D},setTooltip:function(C,A){var B=this;if(B.rendered){if(!A||!C){B.clearTip()}if(C){if(Ext.quickTipsActive&&Ext.isObject(C)){Ext.tip.QuickTipManager.register(Ext.apply({target:B.el.id},C));B.tooltip=C}else{B.el.dom.setAttribute(B.getTipAttr(),C)}}}else{B.tooltip=C}return B},updateIconAlign:function(D,B){var E=this,F,A,C;if(E.rendered){F=E.btnEl;A=E.btnIconEl;C=E._hasIconCls;if(B){F.removeCls(C+"-"+B)}F.addCls(C+"-"+D);if(D==="top"||D==="left"){F.insertFirst(A)}else{F.appendChild(A)}E.updateLayout()}},updateTextAlign:function(B,A){var D=this,E=D.btnEl,C=D._btnCls;if(D.rendered){E.removeCls(C+"-"+A);E.addCls(C+"-"+B)}},getTipAttr:function(){return this.tooltipType=="qtip"?"data-qtip":"title"},getRefItems:function(A){var C=this.menu,B;if(C){B=C.getRefItems(A);B.unshift(C)}return B||[]},clearTip:function(){var B=this,A=B.el;if(Ext.quickTipsActive&&Ext.isObject(B.tooltip)){Ext.tip.QuickTipManager.unregister(A)}else{A.dom.removeAttribute(B.getTipAttr())}},beforeDestroy:function(){var A=this;if(A.rendered){A.clearTip()}if(A.menu&&A.destroyMenu){A.menu.destroy()}Ext.destroy(A.repeater);A.callParent()},onDestroy:function(){var A=this;if(A.rendered){A.doc.un("mouseover",A.monitorMouseOver,A);delete A.doc;Ext.destroy(A.keyMap);delete A.keyMap}Ext.button.Manager.unregister(A);A.callParent()},setHandler:function(A,B){this.handler=A;if(arguments.length>1){this.scope=B}return this},applyText:function(C){C=C==null?"":String(C);var A=this,D=A.btnInnerEl,E=A.btnEl,B=A.text||"";if(C!=B){A.text=C;if(A.rendered){D.setHtml(C||"&#160;");E[C?"addCls":"removeCls"](A._textCls);E[C?"removeCls":"addCls"](A._noTextCls);A.updateLayout()}A.fireEvent("textchange",A,B,C)}},didIconStateChange:function(B,C){var A=Ext.isEmpty(C);return Ext.isEmpty(B)?!A:A},setPressed:function(A){return this.toggle(A!==false)},toggle:function(C,A){var B=this;C=C===undefined?!B.pressed:!!C;if(C!==B.pressed){B[C?"addCls":"removeCls"](B._pressedCls);B.pressed=C;if(!A){B.fireEvent("toggle",B,C);Ext.callback(B.toggleHandler,B.scope,[B,C],0,B);if(B.reference&&B.publishState){B.publishState("pressed",C)}}}return B},maybeShowMenu:function(){var A=this;if(A.menu&&!A.hasVisibleMenu()&&!A.ignoreNextClick){A.showMenu(true)}},showMenu:function(B){var A=this,C=A.menu;if(A.rendered){if(A.tooltip&&Ext.quickTipsActive&&A.getTipAttr()!="title"){Ext.tip.QuickTipManager.getQuickTip().cancelShow(A.el)}if(C.isVisible()){C.hide()}if(!B||A.showEmptyMenu||C.items.getCount()>0){C.showBy(A.el,A.menuAlign)}}return A},hideMenu:function(){if(this.hasVisibleMenu()){this.menu.hide()}return this},hasVisibleMenu:function(){var A=this.menu;return A&&A.rendered&&A.isVisible()},onRepeatClick:function(B,A){this.onClick(A)},onTouchStart:function(A){this.doPreventDefault(A)},onClick:function(A){var B=this;B.doPreventDefault(A);if(A.type!=="keydown"&&A.button){return}if(!B.disabled){B.doToggle();B.maybeShowMenu();B.fireHandler(A)}},doPreventDefault:function(A){if(A&&(this.preventDefault||(this.disabled&&this.getHref()))){A.preventDefault()}},fireHandler:function(A){var B=this;if(B.fireEvent("click",B,A)!==false){Ext.callback(B.handler,B.scope,[B,A],0,B)}},doToggle:function(){var A=this;if(A.enableToggle&&(A.allowDepress!==false||!A.pressed)){A.toggle()}},onMouseOver:function(A){var B=this;if(!B.disabled&&!A.within(B.el,true,true)){B.onMouseEnter(A)}},onMouseOut:function(A){var B=this;if(!A.within(B.el,true,true)){if(B.overMenuTrigger){B.onMenuTriggerOut(A)}B.onMouseLeave(A)}},onMouseMove:function(A){var B=this,C=B.overMenuTrigger;if(B.split){if(B.isWithinTrigger(A)){if(!C){B.onMenuTriggerOver(A)}}else{if(C){B.onMenuTriggerOut(A)}}}},isWithinTrigger:function(C){var E=this,A=E.el,D,B;D=(E.arrowAlign==="right")?C.getX()-E.getX():C.getY()-A.getY();B=E.getTriggerRegion();return D>B.begin&&D<B.end},getTriggerRegion:function(){var B=this,D=B._triggerRegion,C=B.arrowAlign==="right",A=C?"getRight":"getBottom",E=C?B.getWidth():B.getHeight();D.begin=E-(B.el[A]()-B.btnEl[A]());D.end=E;return D},onMouseEnter:function(A){this.fireEvent("mouseover",this,A)},onMouseLeave:function(A){this.fireEvent("mouseout",this,A)},onMenuTriggerOver:function(A){var B=this,C=B.arrowTooltip;B.overMenuTrigger=true;if(B.split&&C){B.btnWrap.dom.setAttribute(B.getTipAttr(),C)}B.fireEvent("menutriggerover",B,B.menu,A)},onMenuTriggerOut:function(A){var B=this;delete B.overMenuTrigger;if(B.split&&B.arrowTooltip){B.btnWrap.dom.setAttribute(B.getTipAttr(),"")}B.fireEvent("menutriggerout",B,B.menu,A)},enable:function(B){var A=this;A.callParent(arguments);A.removeCls(A._disabledCls);if(A.rendered){A.el.dom.setAttribute("tabIndex",A.tabIndex);if(Ext.os.is.ios&&A.href){A.el.dom.href=A.href}}return A},disable:function(B){var A=this;A.callParent(arguments);A.addCls(A._disabledCls);A.removeCls(A.overCls);if(A.rendered){A.el.dom.removeAttribute("tabIndex");if(Ext.os.is.ios&&A.href){A.el.dom.href=null}}return A},setScale:function(C){var B=this,A=B.ui.replace("-"+B.scale,"");if(!Ext.Array.contains(B.allowedScales,C)){throw ("#setScale: scale must be an allowed scale ("+B.allowedScales.join(", ")+")")}B.scale=C;B.setUI(A)},setUI:function(A){var B=this;if(B.scale&&!A.match(B.scale)){A=A+"-"+B.scale}B.callParent([A])},onMouseDown:function(A){var B=this;if(Ext.isIE){B.getFocusEl().focus()}if(!B.disabled&&A.button===0){Ext.button.Manager.onButtonMousedown(B,A);B.addCls(B._pressedCls)}},onMouseUp:function(A){var B=this;if(!B.isDestroyed&&A.button===0){if(!B.pressed){B.removeCls(B._pressedCls)}}},onMenuShow:function(){var A=this;A.ignoreNextClick=0;A.addCls(A._menuActiveCls);A.fireEvent("menushow",A,A.menu)},onMenuHide:function(A){var B=this,C=B.menuClickBuffer;B.removeCls(B._menuActiveCls);if(C){B.ignoreNextClick=Ext.defer(B.restoreClick,C,B)}B.fireEvent("menuhide",B,B.menu);B.focus()},restoreClick:function(){this.ignoreNextClick=0},onDownKey:function(C,A){var B=this;if(B.menu&&!B.disabled){B.showMenu();A.stopEvent();return false}},updateArrowVisible:function(A){var B=this;if(B.rendered){if(A){if(B.menu||B.isSplitButton){B.split=true;B._addSplitCls()}}else{B._removeSplitCls();B.split=false}}return A},privates:{addOverCls:function(){if(!this.disabled){this.addCls(this.overCls)}},_addSplitCls:function(){var A=this;A.btnWrap.addCls(A.getSplitCls());if(Ext.isOpera12m){A.addCls(A._operaArrowCls+"-"+A.arrowAlign)}},getFocusEl:function(){return this.el},getTdCls:function(){return Ext.baseCSSPrefix+"button-"+this.ui+"-"+this.scale+"-cell"},removeOverCls:function(){this.removeCls(this.overCls)},_removeSplitCls:function(){var A=this;A.btnWrap.removeCls(A.getSplitCls());if(Ext.isOpera12m){A.removeCls(A._operaArrowCls+"-"+A.arrowAlign)}},_syncHasIconCls:function(){var A=this,C=A.btnEl,B=A._hasIconCls;if(C){C[A._hasIcon()?"addCls":"removeCls"]([B,B+"-"+A.iconAlign])}},_hasIcon:function(){return !!(this.icon||this.iconCls||this.glyph)},wrapPrimaryEl:function(A){this.el=new Ext.dom.ButtonElement(A)}}});
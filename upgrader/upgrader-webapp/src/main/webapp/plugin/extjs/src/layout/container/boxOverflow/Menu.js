Ext.define("Ext.layout.container.boxOverflow.Menu",{extend:"Ext.layout.container.boxOverflow.None",requires:["Ext.toolbar.Separator","Ext.button.Button"],alternateClassName:"Ext.layout.boxOverflow.Menu",alias:["box.overflow.menu","box.overflow.Menu"],noItemsMenuText:'<div class="'+Ext.baseCSSPrefix+'toolbar-no-items" role="menuitem">(None)</div>',menuCls:Ext.baseCSSPrefix+"box-menu",constructor:function(A){var B=this;B.callParent(arguments);B.menuItems=[]},beginLayout:function(A){this.callParent(arguments);this.clearOverflow(A)},beginLayoutCycle:function(B,A){this.callParent(arguments);if(!A){this.clearOverflow(B);this.layout.cacheChildItems(B)}},onRemove:function(A){Ext.Array.remove(this.menuItems,A)},getSuffixConfig:function(){var B=this,C=B.layout,D=C.owner,A=D.id;B.menu=new Ext.menu.Menu({listeners:{scope:B,beforeshow:B.beforeMenuShow}});B.menuTrigger=new Ext.button.Button({id:A+"-menu-trigger",cls:B.menuCls+"-after "+Ext.baseCSSPrefix+"toolbar-item",plain:D.usePlainButtons,ownerCt:D,ownerLayout:C,iconCls:Ext.baseCSSPrefix+B.getOwnerType(D)+"-more-icon",ui:D.defaultButtonUI||"default",menu:B.menu,showEmptyMenu:true,getSplitCls:function(){return""}});return B.menuTrigger.getRenderTree()},getOverflowCls:function(A){return this.menuCls+"-body-"+A},handleOverflow:function(B){var A=this,C=A.layout;A.showTrigger(B);if(C.direction!=="vertical"){A.menuTrigger.setLocalY((B.state.boxPlan.maxSize-A.menuTrigger[C.names.getHeight]())/2)}return{reservedSpace:A.triggerTotalWidth}},captureChildElements:function(){var A=this,B=A.menuTrigger,C=A.layout.names;if(B.rendering){B.finishRender();A.triggerTotalWidth=B[C.getWidth]()+B.el.getMargin(C.parallelMargins)}},clearOverflow:function(A){var F=this,G=F.menuItems,H,E=0,D=G.length,B=F.layout.owner,C=B._asLayoutRoot;B.suspendLayouts();F.captureChildElements();F.hideTrigger();B.resumeLayouts();for(;E<D;E++){H=G[E];H.suspendLayouts();H.show();H.resumeLayouts(C)}G.length=0},showTrigger:function(A){var L=this,H=L.layout,B=H.owner,C=H.names,K=C.x,P=C.width,G=A.state.boxPlan,I=G.targetSize[P],D=A.childItems,M=D.length,O=L.menuTrigger,N,E,J,F;O.suspendLayouts();O.show();O.resumeLayouts(L._asLayoutRoot);I-=L.triggerTotalWidth;B.suspendLayouts();L.menuItems.length=0;for(J=0;J<M;J++){N=D[J];F=N.props;if(F[K]+F[P]>I){E=N.target;L.menuItems.push(E);E.hide()}}B.resumeLayouts()},hideTrigger:function(){var A=this.menuTrigger;if(A){A.hide()}},beforeMenuShow:function(D){var E=this,G=E.menuItems,B=0,F=G.length,H,C,A=function(I,J){return I.isXType("buttongroup")&&!(J instanceof Ext.toolbar.Separator)};D.suspendLayouts();E.clearMenu();D.removeAll();for(;B<F;B++){H=G[B];if(!B&&(H instanceof Ext.toolbar.Separator)){continue}if(C&&(A(H,C)||A(C,H))){D.add("-")}E.addComponentToMenu(D,H);C=H}if(D.items.length<1){D.add(E.noItemsMenuText)}D.resumeLayouts()},createMenuConfig:function(C,D){var B=Ext.apply({},C.initialConfig),A=C.toggleGroup;Ext.copyTo(B,C,["iconCls","icon","itemId","disabled","handler","scope","menu","tabIndex"]);Ext.applyIf(B,{text:C.overflowText||C.text,hideOnClick:D,destroyMenu:false,listeners:{}});if(C.isFormField){B.value=C.getValue();B.listeners.change=function(G,F,E){C.setValue(F)}}else{if(A||C.enableToggle){Ext.apply(B,{hideOnClick:false,group:A,checked:C.pressed,handler:function(F,E){C.onClick(E)}})}}if(C.isButton&&!C.changeListenersAdded){C.on({textchange:this.onButtonAttrChange,iconchange:this.onButtonAttrChange,toggle:this.onButtonToggle});C.changeListenersAdded=true}delete B.margin;delete B.ownerCt;delete B.xtype;delete B.id;delete B.itemId;return B},onButtonAttrChange:function(B){var A=B.overflowClone;A.suspendLayouts();A.setText(B.text);A.setIcon(B.icon);A.setIconCls(B.iconCls);A.resumeLayouts(true)},onButtonToggle:function(A,B){if(A.overflowClone.checked!==B){A.overflowClone.setChecked(B)}},addComponentToMenu:function(F,C){var A=this,B,D,E;if(C instanceof Ext.toolbar.Fill){return}else{if(C instanceof Ext.toolbar.Separator){F.add("-")}else{if(C.isComponent){if(C.isXType("splitbutton")){C.overflowClone=F.add(A.createMenuConfig(C,true))}else{if(C.isXType("button")){C.overflowClone=F.add(A.createMenuConfig(C,!C.menu))}else{if(C.isXType("buttongroup")){D=C.items.items;E=D.length;for(B=0;B<E;B++){A.addComponentToMenu(F,D[B])}}else{C.overflowClone=F.add(Ext.create(Ext.getClassName(C),A.createMenuConfig(C)))}}}}}}},clearMenu:function(){var E=this.menu,C,A,D,B;if(E&&E.items){C=E.items.items;D=C.length;for(A=0;A<D;A++){B=C[A];if(B.setMenu){B.setMenu(null)}}}},destroy:function(){var A=this.menuTrigger;if(A&&!this.layout.owner.items.contains(A)){delete A.ownerCt}Ext.destroy(this.menu,A)}});
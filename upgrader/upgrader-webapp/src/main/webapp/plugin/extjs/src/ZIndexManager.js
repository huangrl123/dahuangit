Ext.define("Ext.ZIndexManager",{alternateClassName:"Ext.WindowGroup",requires:["Ext.GlobalEvents"],statics:{zBase:9000},constructor:function(B){var A=this;A.map={};A.zIndexStack=[];A.front=null;if(B){if(B.isContainer){B.on("resize",A._onContainerResize,A);A.zseed=Ext.Number.from(A.rendered?B.getEl().getStyle("zIndex"):undefined,A.getNextZSeed());A.targetEl=B.getTargetEl();A.container=B}else{Ext.on("resize",A._onContainerResize,A);A.zseed=A.getNextZSeed();A.targetEl=Ext.get(B)}}else{A.zseed=A.getNextZSeed();Ext.onReady(function(){Ext.on("resize",A._onContainerResize,A);A.targetEl=Ext.getBody()})}},getNextZSeed:function(){return(Ext.ZIndexManager.zBase+=10000)},setBase:function(B){this.zseed=B;var A=this.assignZIndices();this._activateLast();return A},assignZIndices:function(){var E=this.zIndexStack,D=E.length,B=0,C=this.zseed,F,A;for(;B<D;B++){F=E[B];if(F&&!F.hidden){C=F.setZIndex(C);if(F.modal){A=F}}}if(A){this._showModalMask(A)}return C},_setActiveChild:function(D,A){var C=this.front,B=D.preventFocusOnActivate;if(D!==C){if(C&&!C.destroying){C.setActive(false,D)}this.front=D;if(D&&D!=A){D.preventFocusOnActivate=D.preventFocusOnActivate||A&&(A.preventFocusOnActivate||!A.focusOnToFront);D.setActive(true);if(D.modal){this._showModalMask(D)}D.preventFocusOnActivate=B}}},onComponentHide:function(A){this._activateLast()},_activateLast:function(){var C=this,A=C.zIndexStack,B=A.length-1,D;for(;B>=0&&A[B].hidden;--B){}if((D=A[B])){C._setActiveChild(D,C.front);if(D.modal){return}}else{if(C.front&&!C.front.destroying){C.front.setActive(false)}C.front=null}for(;B>=0;--B){D=A[B];if(D.isVisible()&&D.modal){C._showModalMask(D);return}}C._hideModalMask()},_showModalMask:function(G){var D=this,A=G.el.getStyle("zIndex")-4,C=G.floatParent?G.floatParent.getTargetEl():G.container,F=D.mask,E=D.maskShim,B;if(!F){F=D.mask=Ext.getBody().createChild({"data-sticky":true,role:"presentation",cls:Ext.baseCSSPrefix+"mask",style:"height:0;width:0"});F.setVisibilityMode(Ext.Element.DISPLAY);F.on("click",D._onMaskClick,D)}F.maskTarget=C;B=D.getMaskBox();if(E){E.setStyle("zIndex",A);E.show();E.setBox(B)}F.setStyle("zIndex",A);F.show();F.setBox(B)},_hideModalMask:function(){var B=this.mask,A=this.maskShim;if(B&&B.isVisible()){B.maskTarget=undefined;B.hide();if(A){A.hide()}}},_onMaskClick:function(){if(this.front){this.front.focus()}},getMaskBox:function(){var A=this.mask.maskTarget;if(A.dom===document.body){return{height:Math.max(document.body.scrollHeight,Ext.dom.Element.getDocumentHeight()),width:Math.max(document.body.scrollWidth,document.documentElement.clientWidth),x:0,y:0}}else{return A.getBox()}},_onContainerResize:function(){var C=this,D=C.mask,A=C.maskShim,B;if(D&&D.isVisible()){D.hide();if(A){A.hide()}B=C.getMaskBox();if(A){A.setSize(B);A.show()}D.setSize(B);D.show()}},register:function(C){var B=this,A=C.afterHide;if(C.zIndexManager){C.zIndexManager.unregister(C)}C.zIndexManager=B;B.map[C.id]=C;B.zIndexStack.push(C);C.afterHide=function(){A.apply(C,arguments);B.onComponentHide(C)}},unregister:function(C){var B=this,A=B.map;delete C.zIndexManager;if(A&&A[C.id]){delete A[C.id];delete C.afterHide;Ext.Array.remove(B.zIndexStack,C);B._activateLast()}},get:function(A){return A.isComponent?A:this.map[A]},bringToFront:function(E,C){var B=this,A=false,D=B.zIndexStack;E=B.get(E);if(E!==B.front){Ext.Array.remove(D,E);if(E.preventBringToFront){D.unshift(E)}else{D.push(E)}B.assignZIndices();if(!C){B._activateLast()}A=true;B.front=E;if(E.modal){B._showModalMask(E)}}return A},sendToBack:function(B){var A=this;B=A.get(B);Ext.Array.remove(A.zIndexStack,B);A.zIndexStack.unshift(B);A.assignZIndices();this._activateLast();return B},hideAll:function(){var A=this.map,B,C;for(C in A){if(A.hasOwnProperty(C)){B=A[C];if(B.isComponent&&B.isVisible()){B.hide()}}}},hide:function(){var A=0,C=this.zIndexStack,B=C.length,D;this.tempHidden=[];for(;A<B;A++){D=C[A];if(D.isVisible()){this.tempHidden.push(D);D.el.hide();D.hidden=true}}},show:function(){var A=0,B=this.tempHidden,C=B?B.length:0,D;for(;A<C;A++){D=B[A];D.el.show();D.hidden=false;D.setPosition(D.x,D.y)}delete this.tempHidden},getActive:function(){return this.front},getBy:function(C,E){var A=[],B=0,F=this.zIndexStack,D=F.length,G;for(;B<D;B++){G=F[B];if(C.call(E||G,G)!==false){A.push(G)}}return A},each:function(B,C){var A=this.map,E,D;for(E in A){if(A.hasOwnProperty(E)){D=A[E];if(D.isComponent&&B.call(C||D,D)===false){return}}}},eachBottomUp:function(C,E){var A=this.zIndexStack,B=0,D=A.length,F;for(;B<D;B++){F=A[B];if(F.isComponent&&C.call(E||F,F)===false){return}}},eachTopDown:function(C,D){var A=this.zIndexStack,B=A.length,E;for(;B-->0;){E=A[B];if(E.isComponent&&C.call(D||E,E)===false){return}}},destroy:function(){var B=this,A=B.map,D,C;for(C in A){if(A.hasOwnProperty(C)){D=A[C];if(D.isComponent){D.destroy()}}}Ext.destroy(B.mask);Ext.destroy(B.maskShim);delete B.zIndexStack;delete B.map;delete B.container;delete B.targetEl}},function(){Ext.WindowManager=Ext.WindowMgr=new this()});
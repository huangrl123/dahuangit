Ext.define("Ext.app.bindinspector.ComponentDetail",{extend:"Ext.panel.Panel",alias:"widget.bindinspector-componentdetail",requires:["Ext.form.field.Display","Ext.grid.Panel","Ext.layout.container.VBox","Ext.form.field.Checkbox","Ext.app.bindinspector.Util"],layout:"border",activeCls:Ext.baseCSSPrefix+"bindinspector-stub-active",descriptorCls:Ext.baseCSSPrefix+"bindinspector-descriptor",multipleCls:Ext.baseCSSPrefix+"bindinspector-mult-val",directCls:Ext.baseCSSPrefix+"bindinspector-direct-val",inheritedCls:Ext.baseCSSPrefix+"bindinspector-inherited-val",componentKeyCls:Ext.baseCSSPrefix+"bindinspector-comp-key",componentDescCls:Ext.baseCSSPrefix+"bindinspector-comp-desc",componentValCls:Ext.baseCSSPrefix+"bindinspector-comp-val",lastItemCls:Ext.baseCSSPrefix+"bindinspector-last-item",vmPreviewDefault:{xtype:"container",region:"east",split:true,width:"50%",cls:Ext.baseCSSPrefix+"bindinspector-prev-default",padding:20,layout:{type:"hbox",align:"middle",pack:"center"},items:[{xtype:"component",flex:1,html:"Select a component with a ViewModel (or inherited ViewModel) from the ComponentList to view the ViewModel details"}]},initComponent:function(){var I=this,A=I.up("bindinspector-container"),G=I.component||{},F=I.env,C=G.publishes,B=G.bindings,D="Bindings &nbsp;&nbsp;&nbsp;â‡’ &nbsp;&nbsp;&nbsp;",J=F.getInheritedVM(G),E,H;I.bindingsPreviewDefault={xtype:"panel",border:false,region:"center",cls:Ext.baseCSSPrefix+"bindinspector-prev-default",bodyPadding:20,layout:{type:"hbox",align:"middle",pack:"center"},items:[{xtype:"component",flex:1,html:"Select a component with bindings from the ComponentList to view the bindings details along with the component's inherited ViewModel"}],dockedItems:[{xtype:"toolbar",dock:"top",defaultButtonUI:"default",items:["->",{text:"Open in dedicated tab",handler:function(K){K.up("bindinspector-container").onComponentDblclick(null,G)}}]}]};if(G.reference){D+="["+G.reference+"] &bull; "}E=G.bindData||Ext.app.bindinspector.Util.buildBindData(B);if(C){H=[{xtype:"component",html:'Publishes: &nbsp;&nbsp;<span style="color: #5C5C5C;font-size: 14px;line-height: 14px;">'+Ext.Object.getKeys(C).join(" &bull; ")+"</span>"}]}I.bindingsGrid={xtype:"gridpanel",title:D+=G.id,header:{items:[{xtype:"button",text:"Open in dedicated tab",ui:"default-toolbar",handler:function(K){K.up("bindinspector-container").onComponentDblclick(null,G)}}]},region:"center",cls:Ext.baseCSSPrefix+"bindinspector-compdetail-grid",flex:1,hideHeaders:true,store:{model:I.BindingModel,data:E},columns:[{flex:1,scope:I,renderer:I.bindingRenderer}],tbar:H,bbar:[{xtype:"checkboxfield",itemId:"highlightToggle",boxLabel:"Highlight VM target nodes on binding selection",checked:true,listeners:{scope:I,change:I.onHighlightChange}}],viewConfig:{stripeRows:false,trackOver:false,getRowClass:function(M,N,O,K){var L=[];if(N===K.getCount()-1){L.push(I.lastItemCls)}return L.join(" ")}},listeners:{scope:I,cellclick:I.onCellClick,selectionchange:I.onSelectionChange}};I.viewModelTree={xtype:"bindinspector-viewmodeldetail",itemId:"vm-"+J.id,vm:J,region:"east",split:true,width:"50%",height:"50%"};I.items=[];I.items.push(B?I.bindingsGrid:I.bindingsPreviewDefault);I.items.push(J?I.viewModelTree:I.vmPreviewDefault);I.callParent(arguments)},bindingRenderer:function(C,E,B){var H=this,D=B.get("binding"),I=B.get("key"),A=H.descriptorRenderer(B.get("descriptor"),E,B),F=Ext.app.bindinspector.Util.valueRenderer(B.get("value")),J="",G="Direct";if(Ext.isEmpty(F)||F==="null"){F="<i>No value found</i>"}I='<span class="'+H.componentKeyCls+'">'+I+": </span>";A='<span class="'+H.componentDescCls+'">'+A+"</span>";F='<span class="'+H.componentValCls+'">'+F+"</span>";if(D.isTemplateBinding){G="Template"}else{if(D.isMultiBinding){G="Multi"}}G=Ext.util.Format.format('<div data-qtip="Binding Type" data-qclass="'+Ext.baseCSSPrefix+'componentlist-tip" class="'+Ext.baseCSSPrefix+'bindinspector-bind-type">{0}</div>',G);return I+A+"<br>"+F+G},onHighlightChange:function(C){var A=this.down("bindinspector-viewmodeldetail"),B=this.down("gridpanel"),D=B.getSelectionModel();if(!C.checked){this.onSelectionChange(D,null,true)}else{this.onSelectionChange(D,D.getSelection())}},onSelectionChange:function(A,J,K){var G=this.down("bindinspector-viewmodeldetail"),I=G.getStore(),E,C,F,I,B,H,D;if((J&&J.length===0)||K===true){I.suspendEvents();G.getStore().getRootNode().cascadeBy({before:function(L){L.set("highlighted",false)}});I.resumeEvents();G.getView().refresh();return}J=J[0];E=J.get("tokens");C=J.get("binding");F=this.down("#highlightToggle").checked;I=G.getStore();B=I.getRootNode();H=[];if(E&&F){if(C.isTemplateBinding){Ext.Array.forEach(E,function(L){H.push(B.findChild("name",L[0]))},this)}else{if(C.isMultiBinding){}else{H.push(B.findChild("name",E[0]))}}}I.suspendEvents();B.cascadeBy({before:function(L){D=H.length===0;Ext.Array.forEach(H,function(M){if(L===M||L.isAncestor(M)){D=true}});L.set("highlighted",D||-1)}});I.resumeEvents();G.getView().refresh();G.getSelectionModel().select(H[0])},onCellClick:function(A,I,C,G,D,H,B){var F=B.getTarget("."+this.activeCls),E;if(F){E=F.getAttribute("data-path");this.showPath(E)}},showPath:function(A){this.selectPath(this.down("bindinspector-viewmodeldetail"),A)},selectPath:function(C,F){var D=C.getRootNode(),A=F.split("."),E=A.length,B;for(B=0;D&&B<E;++B){D=this.getChildByKey(D,A[B])}if(D){C.getSelectionModel().select(D)}},getChildByKey:function(C,A){var B=C.childNodes;if(B){return Ext.Array.findBy(B,function(D){return D.get("name")===A})}return null},descriptorRenderer:function(C,E,A){var B=A.get("binding"),F=A.get("descriptor"),D=A.get("tokens");C=C||"";if(B.isTemplateBinding){Ext.Array.forEach(D,function(G){var H=new RegExp("{"+G.join("\\.")+"}","g");C=C.replace(H,this.parseTokens(G))},this)}else{if(B.isMultiBinding){}else{return C.replace(F,this.parseTokens(D))}}return Ext.String.htmlEncode(C)},parseTokens:function(H){var L=this,B=[],M=L.env.getInheritedVM(L.component),F="",E=M.rootStub,C=false,D=false,N="",K="",A="",I,G,J;H=H||[];Ext.Array.forEach(H,function(O){var P=Ext.app.bindinspector.Util.getChildStub(O,E),Q="",R;if(P){R=P.value;if(R!==undefined){Q=L.activeCls}}else{}B.push('<span data-path="'+F+O+'" class="stub '+Q+'">'+O+"</span>");F+=O+".";E=P},L);if(H[0]){A=H[0];ownerVMs=M.dataMap[H[0]].ownerVMs;G=ownerVMs.length;Ext.Array.forEach(ownerVMs,function(O){if(O.id===M.id){C=true}if(O.id!==M.id){D=true}})}if(C&&D){N+=" "+L.multipleCls;J=G>1?"VMs":"VM";K='data-qclass="'+Ext.baseCSSPrefix+'componentlist-tip" data-qtip="<b>'+A+"</b>&nbsp; provided by this VM and "+(G-1)+" ancestor "+J+'"'}else{if(C){N+=" "+L.directCls;K='data-qclass="'+Ext.baseCSSPrefix+'componentlist-tip" data-qtip="<b>'+A+'</b>&nbsp; is provided by this VM"'}else{if(D){N+=" "+L.inheritedCls;J=G>1?"VMs":"VM";K='data-qclass="'+Ext.baseCSSPrefix+'componentlist-tip" data-qtip="<b>'+A+"</b>&nbsp; is provided by "+G+" ancestor "+J+'"'}}}return"<span "+K+'class="'+L.descriptorCls+N+'">{'+B.join(".")+"}</span>"}},function(){this.prototype.BindingModel=Ext.define(null,{extend:"Ext.data.Model",fields:["key","descriptor","tokens","value","binding"]})});
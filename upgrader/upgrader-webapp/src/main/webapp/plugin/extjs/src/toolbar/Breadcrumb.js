Ext.define("Ext.toolbar.Breadcrumb",{extend:"Ext.Container",xtype:"breadcrumb",requires:["Ext.data.TreeStore","Ext.button.Split"],isBreadcrumb:true,baseCls:Ext.baseCSSPrefix+"breadcrumb",layout:"hbox",config:{buttonUI:"plain-toolbar",displayField:"text",overflowHandler:null,showIcons:null,store:null,useSplitButtons:true},renderConfig:{selection:"root"},_breadcrumbCls:Ext.baseCSSPrefix+"breadcrumb",_btnCls:Ext.baseCSSPrefix+"breadcrumb-btn",_folderIconCls:Ext.baseCSSPrefix+"breadcrumb-icon-folder",_leafIconCls:Ext.baseCSSPrefix+"breadcrumb-icon-leaf",initComponent:function(){var B=this,C=this.layout,A=B.getOverflowHandler();if(typeof C==="string"){C={type:C}}if(A){C.overflowHandler=A}this.layout=C;this.defaultButtonUI=this.getButtonUI();if(!this.getStore()){Ext.Error.raise("Ext.toolbar.Breadcrumb requires a store")}B._buttons=[];B.addCls([B._breadcrumbCls,B._breadcrumbCls+"-"+B.ui]);B.callParent()},onDestroy:function(){this._buttons=Ext.destroy(this._buttons);this.callParent()},afterComponentLayout:function(){var B=this,A=B.layout.overflowHandler;B.callParent(arguments);if(A&&B.tooNarrow&&A.scrollToItem){A.scrollToItem(B.getSelection().get("depth"))}},applySelection:function(A){return(A==="root")?this.getStore().getRoot():A},updateSelection:function(H){var F=this,P=F._buttons,O=[],N=F.items.getCount(),M=F._needsSync,E=F.getDisplayField(),A,G,I,Q,B,L,J,C,K,D;Ext.suspendLayouts();if(H){B=H;K=H.get("depth");Q=K+1;D=K;while(B){C=B.getId();J=P[D];if(!M&&J&&J._breadcrumbNodeId===C){break}L=B.get(E);if(J){J.setText(L)}else{J=P[D]=Ext.create({xtype:F.getUseSplitButtons()?"splitbutton":"button",ui:F.getButtonUI(),cls:F._btnCls+" "+F._btnCls+"-"+F.ui,text:L,showEmptyMenu:true,menu:{listeners:{click:"_onMenuClick",beforeshow:"_onMenuBeforeShow",scope:this}},handler:"_onButtonClick",scope:F})}A=this.getShowIcons();if(A!==false){I=B.get("icon");G=B.get("iconCls");if(I){J.setIconCls(null);J.setIcon(I)}else{if(G){J.setIcon(null);J.setIconCls(G)}else{if(A){J.setIcon(null);J.setIconCls((B.isLeaf()?F._leafIconCls:F._folderIconCls)+"-"+F.ui)}else{J.setIcon(null);J.setIconCls(null)}}}}J.setArrowVisible(B.hasChildNodes());J._breadcrumbNodeId=B.getId();B=B.parentNode;D--}if(Q>N){O=P.slice(N,K+1);F.add(O)}else{for(D=N-1;D>=Q;D--){F.remove(F.items.items[D],false)}}}else{F.removeAll(false)}Ext.resumeLayouts(true);F.fireEvent("selectionchange",F,H);F._needsSync=false},applyUseSplitButtons:function(A,B){if(this.rendered&&A!==B){Ext.Error.raise("Cannot reconfigure 'useSplitButtons' config of Ext.toolbar.Breadcrumb after initial render")}return A},updateStore:function(A,B){this._needsSync=true;if(B){this.setSelection(A.getRoot())}},updateOverflowHandler:function(A){if(A==="menu"){Ext.Error.raise("Using Menu overflow with breadcrumb is not currently supported.")}},privates:{_onButtonClick:function(A,B){if(this.getUseSplitButtons()){this.setSelection(this.getStore().getNodeById(A._breadcrumbNodeId))}},_onMenuClick:function(C,B,A){this.setSelection(this.getStore().getNodeById(B._breadcrumbNodeId))},_onMenuBeforeShow:function(E){var F=this.getStore().getNodeById(E.ownerButton._breadcrumbNodeId),C=this.getDisplayField(),A,G,H,D,B;if(F.hasChildNodes()){A=F.childNodes;H=[];for(D=0,B=A.length;D<B;D++){G=A[D];H.push({text:G.get(C),_breadcrumbNodeId:G.getId()})}E.removeAll();E.add(H)}else{return false}}}});
Ext.define("Ext.grid.feature.RowBody",{extend:"Ext.grid.feature.Feature",alias:"feature.rowbody",rowBodyCls:Ext.baseCSSPrefix+"grid-row-body",rowBodyHiddenCls:Ext.baseCSSPrefix+"grid-row-body-hidden",rowBodyTdSelector:"td."+Ext.baseCSSPrefix+"grid-cell-rowbody",eventPrefix:"rowbody",eventSelector:"tr."+Ext.baseCSSPrefix+"grid-rowbody-tr",colSpanDecrement:0,outerTpl:{fn:function(C,D,E){var A=D.view,B=A.rowValues;this.rowBody.setup(D.rows,B);this.nextTpl.applyOut(D,C,E);this.rowBody.cleanup(D.rows,B)},priority:100},extraRowTpl:["{%","this.nextTpl.applyOut(values, out, parent);","values.view.rowBodyFeature.setupRowData(values.record, values.recordIndex, values);","%}",'<tr class="'+Ext.baseCSSPrefix+'grid-rowbody-tr {rowBodyCls}" {ariaRowAttr}>','<td class="'+Ext.baseCSSPrefix+"grid-td "+Ext.baseCSSPrefix+'grid-cell-rowbody" colspan="{rowBodyColspan}" {ariaCellAttr}>','<div class="'+Ext.baseCSSPrefix+'grid-rowbody {rowBodyDivCls}" {ariaCellInnerAttr}>{rowBody}</div>',"</td>","</tr>",{priority:100,syncRowHeights:function(D,F){var G=this.owner,E=Ext.fly(D).down(G.eventSelector,true),C,B,A;if(E&&(C=Ext.fly(F).down(G.eventSelector,true))){if((B=E.offsetHeight)>(A=C.offsetHeight)){Ext.fly(C).setHeight(B)}else{if(A>B){Ext.fly(E).setHeight(A)}}}},syncContent:function(A,C,F){var E=this.owner,B=Ext.fly(A).down(E.eventSelector,true),D;if(B&&(D=Ext.fly(C).down(E.eventSelector,true))){Ext.fly(B).syncContent(D)}}}],init:function(C){var A=this,B=A.view=C.getView();C.variableRowHeight=B.variableRowHeight=true;B.rowBodyFeature=A;C.mon(B,{element:"el",click:A.onClick,scope:A});B.headerCt.on({columnschanged:A.onColumnsChanged,scope:A});B.addTpl(A.outerTpl).rowBody=A;B.addRowTpl(Ext.XTemplate.getTpl(this,"extraRowTpl"));A.callParent(arguments)},onClick:function(A){var C=this,B=A.getTarget(C.eventSelector);if(B&&Ext.fly(B=B.previousSibling).is(C.view.rowSelector)){A.target=B;C.view.handleEvent(A)}},getSelectedRow:function(B,A){var C=B.getNode(A);if(C){return Ext.fly(C).down(this.eventSelector)}return null},onColumnsChanged:function(B){var C=this.view.el.query(this.rowBodyTdSelector),E=B.getVisibleGridColumns().length,D=C.length,A;for(A=0;A<D;++A){C[A].colSpan=E}},setupRowData:function(C,B,A){if(this.getAdditionalData){Ext.apply(A,this.getAdditionalData(C.data,B,C,A))}},setup:function(B,A){A.rowBodyCls=this.rowBodyCls;A.rowBodyColspan=A.view.getGridColumns().length-this.colSpanDecrement},cleanup:function(B,A){A.rowBodyCls=A.rowBodyColspan=A.rowBody=null}});
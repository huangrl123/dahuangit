Ext.define("Ext.grid.column.Widget",{extend:"Ext.grid.column.Column",alias:"widget.widgetcolumn",config:{defaultWidgetUI:{}},sortable:false,stopSelection:true,preventUpdate:true,initComponent:function(){var A=this,B;A.callParent(arguments);B=A.widget;if(!B||B.isComponent){Ext.Error.raise("column.Widget requires a widget configuration.")}if(!B.ui){B.ui=A.getDefaultWidgetUI()[B.xtype]||"default"}A.isFixedSize=Ext.isNumber(B.width)},processEvent:function(D,A,J,E,C,B,I,F){var H=A.innerSelector,G;if(this.stopSelection&&D==="click"){G=B.getTarget(H);if(G&&G!==B.target){return false}}},beforeRender:function(){var A=this,B;A.liveWidgets={};A.cachedStyles={};A.freeWidgetStack=[];A.listenerScopeFn=function(C){if(C==="this"){return this}return A.resolveListenerScope(C)};B=A.getFreeWidget();A.tdCls=B.getTdCls();A.setupViewListeners(A.getView());A.callParent(arguments)},afterRender:function(){var A=this.getView();this.callParent(arguments);if(A&&A.viewReady){this.onViewRefresh(A,A.getViewRange())}},defaultRenderer:Ext.emptyFn,updater:function(C,B,A){this.updateWidget(A)},onResize:function(D){var C=this,A=C.liveWidgets,E=C.getView(),F,B;if(!C.isFixedSize&&C.rendered&&E&&E.viewReady){B=E.getEl().down(C.getCellInnerSelector());if(B){D-=parseInt(C.getCachedStyle(B,"padding-left"),10)+parseInt(C.getCachedStyle(B,"padding-right"),10);for(F in A){A[F].setWidth(D)}}}},onAdded:function(){var A;this.callParent(arguments);A=this.getView();if(A){this.setupViewListeners(A)}},onRemoved:function(F){var C=this,B=C.liveWidgets,A=C.viewListeners,D,E;if(C.rendered){if(A){A.destroy();this.viewListeners=null}if(!F){for(D in B){E=B[D];Ext.detachedBodyEl.dom.appendChild((E.el||E.element).dom)}}}C.callParent(arguments)},onDestroy:function(){var C=this,F=C.liveWidgets,A=C.freeWidgetStack,G,E,B,D;if(C.rendered){for(G in F){E=F[G];E.$widgetRecord=E.$widgetColumn=null;delete E.getWidgetRecord;delete E.getWidgetColumn;E.destroy()}for(B=0,D=A.length;B<D;++B){A[B].destroy()}}C.freeWidgetStack=C.liveWidgets=null;C.callParent()},getWidget:function(B){var A=this.liveWidgets,C;if(B&&A){C=A[B.internalId]}return C||null},privates:{getCachedStyle:function(A,B){var C=this.cachedStyles;return C[B]||(C[B]=Ext.fly(A).getStyle(B))},getFreeWidget:function(){var B=this,A=B.freeWidgetStack.pop();if(!A){A=Ext.widget(B.widget);A.resolveListenerScope=B.listenerScopeFn;A.getWidgetRecord=B.widgetRecordDecorator;A.getWidgetColumn=B.widgetColumnDecorator;A.dataIndex=B.dataIndex;A.measurer=B}return A},onViewRefresh:function(M,N){var A=this,H=M.all,J=!!A.onWidgetAttach,G=A.liveWidgets,P=A.dataIndex,C=A.isFixedSize,I,L,Q,K,E,D,O,F,B;if(A.rendered&&!A.hidden){A.liveWidgets={};Ext.suspendLayouts();for(D=H.startIndex,O=0;D<=H.endIndex;D++,O++){F=N[O];if(F.isNonData){continue}E=F.internalId;I=M.getRow(H.item(D)).cells[A.getVisibleIndex()].firstChild;L=A.liveWidgets[E]=G[E]||A.getFreeWidget();delete G[E];if(!C&&K===undefined){K=A.lastBox.width-parseInt(A.getCachedStyle(I,"padding-left"),10)-parseInt(A.getCachedStyle(I,"padding-right"),10)}Ext.fly(I).empty();if(Q=(L.el||L.element)){I.appendChild(Q.dom);if(!C){L.setWidth(K)}}else{if(!C){L.width=K}L.render(I)}if(L.defaultBindProperty&&P){L.setConfig(L.defaultBindProperty,N[O].get(P))}L.$widgetRecord=F;L.$widgetColumn=A;if(J){A.onWidgetAttach(L,F)}}Ext.resumeLayouts(true);for(B in G){L=G[B];L.$widgetRecord=L.$widgetColumn=null;A.freeWidgetStack.unshift(L);Ext.detachedBodyEl.dom.appendChild((L.el||L.element).dom)}}},onItemUpdate:function(C,B,A){this.updateWidget(C)},onItemAdd:function(C,D,O){var L=this,A=L.getView(),F=!!L.onWidgetAttach,K=L.dataIndex,B=L.isFixedSize,M=C.length,H,N,I,P,J,G,E;if(L.rendered&&!L.hidden){for(H=0;H<M;H++){N=C[H];if(N.isNonData){continue}I=A.getRowFromItem(O[H]);if(I){P=I.cells[L.getVisibleIndex()].firstChild;if(!B&&!E){E=L.lastBox.width-parseInt(L.getCachedStyle(P,"padding-left"),10)-parseInt(L.getCachedStyle(P,"padding-right"),10)}J=L.liveWidgets[N.internalId]=L.getFreeWidget();Ext.fly(P).empty();if(G=(J.el||J.element)){P.appendChild(G.dom);if(!B){J.setWidth(E)}}else{if(!B){J.width=E}J.render(P)}if(J.defaultBindProperty&&L.dataIndex){J.setConfig(J.defaultBindProperty,N.get(L.dataIndex))}J.$widgetColumn=L;if(F){L.onWidgetAttach(J,N)}}}}},onItemRemove:function(D,E,C){var A=this,B=A.liveWidgets,F;if(A.rendered&&D&&(F=B[D.internalId])){delete B[D.internalId];A.freeWidgetStack.unshift(F);F.$widgetRecord=F.$widgetColumn=null;Ext.detachedBodyEl.dom.appendChild((F.el||F.element).dom)}},setupViewListeners:function(B){var A=this;A.viewListeners=B.on({refresh:A.onViewRefresh,itemupdate:A.onItemUpdate,itemadd:A.onItemAdd,itemremove:A.onItemRemove,scope:A,destroyable:true})},updateWidget:function(B){var A=this.dataIndex,C;if(this.rendered){C=this.liveWidgets[B.internalId];if(C&&C.defaultBindProperty&&A){C.setConfig(C.defaultBindProperty,B.get(A))}}},widgetRecordDecorator:function(){return this.$widgetRecord},widgetColumnDecorator:function(){return this.$widgetColumn}}});